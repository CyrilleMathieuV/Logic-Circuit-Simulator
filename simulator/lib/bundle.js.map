{
  "version": 3,
  "sources": ["../../node_modules/lz-string/libs/lz-string.js", "../../node_modules/png-metadata-writer/crc32.js", "../../node_modules/png-metadata-writer/index.js", "../../node_modules/dialog-polyfill/dist/dialog-polyfill.esm.js", "../../node_modules/fp-ts/es6/Either.js", "../../node_modules/io-ts/es6/index.js", "../src/utils.ts", "../src/htmlgen.ts", "../src/strings.ts", "../src/components/Drawable.ts", "../src/drawutils.ts", "../src/components/Node.ts", "../src/components/Component.ts", "../../node_modules/bezier-js/src/utils.js", "../../node_modules/bezier-js/src/poly-bezier.js", "../../node_modules/bezier-js/src/bezier.js", "../src/components/Passthrough.ts", "../src/components/Wire.ts", "../../node_modules/@popperjs/core/lib/enums.js", "../../node_modules/@popperjs/core/lib/dom-utils/getNodeName.js", "../../node_modules/@popperjs/core/lib/dom-utils/getWindow.js", "../../node_modules/@popperjs/core/lib/dom-utils/instanceOf.js", "../../node_modules/@popperjs/core/lib/modifiers/applyStyles.js", "../../node_modules/@popperjs/core/lib/utils/getBasePlacement.js", "../../node_modules/@popperjs/core/lib/dom-utils/getBoundingClientRect.js", "../../node_modules/@popperjs/core/lib/dom-utils/getLayoutRect.js", "../../node_modules/@popperjs/core/lib/dom-utils/contains.js", "../../node_modules/@popperjs/core/lib/dom-utils/getComputedStyle.js", "../../node_modules/@popperjs/core/lib/dom-utils/isTableElement.js", "../../node_modules/@popperjs/core/lib/dom-utils/getDocumentElement.js", "../../node_modules/@popperjs/core/lib/dom-utils/getParentNode.js", "../../node_modules/@popperjs/core/lib/dom-utils/getOffsetParent.js", "../../node_modules/@popperjs/core/lib/utils/getMainAxisFromPlacement.js", "../../node_modules/@popperjs/core/lib/utils/math.js", "../../node_modules/@popperjs/core/lib/utils/within.js", "../../node_modules/@popperjs/core/lib/utils/getFreshSideObject.js", "../../node_modules/@popperjs/core/lib/utils/mergePaddingObject.js", "../../node_modules/@popperjs/core/lib/utils/expandToHashMap.js", "../../node_modules/@popperjs/core/lib/modifiers/arrow.js", "../../node_modules/@popperjs/core/lib/modifiers/computeStyles.js", "../../node_modules/@popperjs/core/lib/modifiers/eventListeners.js", "../../node_modules/@popperjs/core/lib/utils/getOppositePlacement.js", "../../node_modules/@popperjs/core/lib/utils/getOppositeVariationPlacement.js", "../../node_modules/@popperjs/core/lib/dom-utils/getWindowScroll.js", "../../node_modules/@popperjs/core/lib/dom-utils/getWindowScrollBarX.js", "../../node_modules/@popperjs/core/lib/dom-utils/getViewportRect.js", "../../node_modules/@popperjs/core/lib/dom-utils/getDocumentRect.js", "../../node_modules/@popperjs/core/lib/dom-utils/isScrollParent.js", "../../node_modules/@popperjs/core/lib/dom-utils/getScrollParent.js", "../../node_modules/@popperjs/core/lib/dom-utils/listScrollParents.js", "../../node_modules/@popperjs/core/lib/utils/rectToClientRect.js", "../../node_modules/@popperjs/core/lib/dom-utils/getClippingRect.js", "../../node_modules/@popperjs/core/lib/utils/getVariation.js", "../../node_modules/@popperjs/core/lib/utils/computeOffsets.js", "../../node_modules/@popperjs/core/lib/utils/detectOverflow.js", "../../node_modules/@popperjs/core/lib/utils/computeAutoPlacement.js", "../../node_modules/@popperjs/core/lib/modifiers/flip.js", "../../node_modules/@popperjs/core/lib/modifiers/hide.js", "../../node_modules/@popperjs/core/lib/modifiers/offset.js", "../../node_modules/@popperjs/core/lib/modifiers/popperOffsets.js", "../../node_modules/@popperjs/core/lib/utils/getAltAxis.js", "../../node_modules/@popperjs/core/lib/modifiers/preventOverflow.js", "../../node_modules/@popperjs/core/lib/dom-utils/getHTMLElementScroll.js", "../../node_modules/@popperjs/core/lib/dom-utils/getNodeScroll.js", "../../node_modules/@popperjs/core/lib/dom-utils/getCompositeRect.js", "../../node_modules/@popperjs/core/lib/utils/orderModifiers.js", "../../node_modules/@popperjs/core/lib/utils/debounce.js", "../../node_modules/@popperjs/core/lib/utils/mergeByName.js", "../../node_modules/@popperjs/core/lib/createPopper.js", "../../node_modules/@popperjs/core/lib/popper.js", "../src/components/TriStateBuffer.ts", "../src/components/Gate.ts", "../src/components/Adder.ts", "../src/components/ALU.ts", "../src/components/Comparator.ts", "../src/components/FlipflopOrLatch.ts", "../src/components/Counter.ts", "../src/components/Decoder16Seg.ts", "../src/components/Decoder7Seg.ts", "../src/components/DecoderBCD4.ts", "../src/components/Demux.ts", "../src/components/FlipflopD.ts", "../src/components/FlipflopJK.ts", "../src/components/FlipflopT.ts", "../src/components/HalfAdder.ts", "../src/components/LatchSR.ts", "../src/components/Mux.ts", "../src/components/QuadGate.ts", "../src/components/QuadTriState.ts", "../src/components/RAM.ts", "../src/components/Register.ts", "../src/components/SwitchedInverter.ts", "../src/components/IC.ts", "../src/components/InputBit.ts", "../src/components/Clock.ts", "../src/components/InputByte.ts", "../src/components/InputNibble.ts", "../src/components/InputRandom.ts", "../src/components/Inputs.ts", "../src/components/LabelRect.ts", "../src/components/LabelString.ts", "../src/components/Labels.ts", "../src/components/Layout.ts", "../src/components/OutputBar.ts", "../src/components/Output16Seg.ts", "../src/components/Output7Seg.ts", "../src/components/OutputAscii.ts", "../src/components/OutputBit.ts", "../src/components/OutputByte.ts", "../src/components/OutputByteDisplay.ts", "../src/components/OutputNibble.ts", "../src/components/OutputNibbleDisplay.ts", "../src/components/OutputShiftBuffer.ts", "../src/components/Outputs.ts", "../src/ComponentFactory.ts", "../src/ComponentList.ts", "../src/images.ts", "../src/CursorMovementManager.ts", "../src/gallery.ts", "../src/menuutils.ts", "../src/MoveManager.ts", "../src/NodeManager.ts", "../../node_modules/io-ts/es6/PathReporter.js", "../src/stringifySmart.ts", "../src/PersistenceManager.ts", "../src/RedrawRecalcManager.ts", "../src/Timeline.ts", "../src/LogicEditor.ts", "../src/Tests.ts", "../src/UndoManager.ts"],
  "sourcesContent": ["// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.4\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n}\n", "/* crc32.js (C) 2014-present SheetJS -- http://sheetjs.com */\n/* vim: set ts=2: */\n/*exported CRC32 */\nvar Crc32;\n(function (factory) {\n  /*jshint ignore:start */\n  /*eslint-disable */\n  if (typeof DO_NOT_EXPORT_CRC === \"undefined\") {\n    if (\"object\" === typeof exports) {\n      factory(exports);\n    } else if (\"function\" === typeof define && define.amd) {\n      define(function () {\n        var module = {};\n        factory(module);\n        return module;\n      });\n    } else {\n      factory((Crc32 = {}));\n    }\n  } else {\n    factory((Crc32 = {}));\n  }\n  /*eslint-enable */\n  /*jshint ignore:end */\n})(function (CRC32) {\n  CRC32.version = \"1.2.0\";\n  /* see perf/crc32table.js */\n  /*global Int32Array */\n  function signed_crc_table() {\n    var c = 0,\n      table = new Array(256);\n\n    for (var n = 0; n != 256; ++n) {\n      c = n;\n      c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n      c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n      c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n      c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n      c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n      c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n      c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n      c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n      table[n] = c;\n    }\n\n    return typeof Int32Array !== \"undefined\" ? new Int32Array(table) : table;\n  }\n\n  var T = signed_crc_table();\n  function crc32_bstr(bstr, seed) {\n    var C = seed ^ -1,\n      L = bstr.length - 1;\n    for (var i = 0; i < L; ) {\n      C = (C >>> 8) ^ T[(C ^ bstr.charCodeAt(i++)) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ bstr.charCodeAt(i++)) & 0xff];\n    }\n    if (i === L) C = (C >>> 8) ^ T[(C ^ bstr.charCodeAt(i)) & 0xff];\n    return C ^ -1;\n  }\n\n  function crc32_buf(buf, seed) {\n    if (buf.length > 10000) return crc32_buf_8(buf, seed);\n    var C = seed ^ -1,\n      L = buf.length - 3;\n    for (var i = 0; i < L; ) {\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n    }\n    while (i < L + 3) C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n    return C ^ -1;\n  }\n\n  function crc32_buf_8(buf, seed) {\n    var C = seed ^ -1,\n      L = buf.length - 7;\n    for (var i = 0; i < L; ) {\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n      C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n    }\n    while (i < L + 7) C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n    return C ^ -1;\n  }\n\n  function crc32_str(str, seed) {\n    var C = seed ^ -1;\n    for (var i = 0, L = str.length, c, d; i < L; ) {\n      c = str.charCodeAt(i++);\n      if (c < 0x80) {\n        C = (C >>> 8) ^ T[(C ^ c) & 0xff];\n      } else if (c < 0x800) {\n        C = (C >>> 8) ^ T[(C ^ (192 | ((c >> 6) & 31))) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ (128 | (c & 63))) & 0xff];\n      } else if (c >= 0xd800 && c < 0xe000) {\n        c = (c & 1023) + 64;\n        d = str.charCodeAt(i++) & 1023;\n        C = (C >>> 8) ^ T[(C ^ (240 | ((c >> 8) & 7))) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ (128 | ((c >> 2) & 63))) & 0xff];\n        C =\n          (C >>> 8) ^ T[(C ^ (128 | ((d >> 6) & 15) | ((c & 3) << 4))) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ (128 | (d & 63))) & 0xff];\n      } else {\n        C = (C >>> 8) ^ T[(C ^ (224 | ((c >> 12) & 15))) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ (128 | ((c >> 6) & 63))) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ (128 | (c & 63))) & 0xff];\n      }\n    }\n    return C ^ -1;\n  }\n  CRC32.table = T;\n  // $FlowIgnore\n  CRC32.bstr = crc32_bstr;\n  // $FlowIgnore\n  CRC32.buf = crc32_buf;\n  // $FlowIgnore\n  CRC32.str = crc32_str;\n});\n", "/**\n * library to read and write PNG Metadata\n *\n * References:\n * w3 PNG Chunks specification: https://www.w3.org/TR/PNG-Chunks.html\n * The Metadata in PNG files: https://dev.exiv2.org/projects/exiv2/wiki/The_Metadata_in_PNG_files\n */\n\nlet crc32 = require(\"./crc32\");\n\n// Used for fast-ish conversion between uint8s and uint32s/int32s.\n// Also required in order to remain agnostic for both Node Buffers and\n// Uint8Arrays.\nlet uint8 = new Uint8Array(4);\nlet int32 = new Int32Array(uint8.buffer);\nlet uint32 = new Uint32Array(uint8.buffer);\n\nconst RESOLUTION_UNITS = { UNDEFINED: 0, METERS: 1, INCHES: 2 };\n\n/**\n * https://github.com/aheckmann/sliced\n * An Array.prototype.slice.call(arguments) alternative\n * @param {Object} args something with a length\n * @param {Number} slice\n * @param {Number} sliceEnd\n * @api public\n */\nfunction sliced(args, slice, sliceEnd) {\n  var ret = [];\n  var len = args.length;\n\n  if (0 === len) return ret;\n\n  var start = slice < 0 ? Math.max(0, slice + len) : slice || 0;\n\n  if (sliceEnd !== undefined) {\n    len = sliceEnd < 0 ? sliceEnd + len : sliceEnd;\n  }\n\n  while (len-- > start) {\n    ret[len - start] = args[len];\n  }\n\n  return ret;\n}\n\n/**\n * https://github.com/hughsk/png-chunk-text\n * Returns a chunk object containing the metadata for a given key and value:\n * @param keyword\n * @param content\n * @param chunkName\n * @returns {{data: Uint8Array, name: 'tEXt'}}\n */\nfunction textEncode(keyword, content, chunkName = \"tEXt\") {\n  keyword = String(keyword);\n  content = String(content);\n\n  if (\n    content.length &&\n    (!/^[\\x00-\\xFF]+$/.test(keyword) || !/^[\\x00-\\xFF]+$/.test(content))\n  ) {\n    throw new Error(\n      \"Only Latin-1 characters are permitted in PNG tEXt chunks. You might want to consider base64 encoding and/or zEXt compression\"\n    );\n  }\n\n  if (keyword.length >= 80) {\n    throw new Error(\n      'Keyword \"' +\n        keyword +\n        '\" is longer than the 79-character limit imposed by the PNG specification'\n    );\n  }\n\n  let totalSize = keyword.length + content.length + 1;\n  let output = new Uint8Array(totalSize);\n  let idx = 0;\n  let code;\n\n  for (let i = 0; i < keyword.length; i++) {\n    if (!(code = keyword.charCodeAt(i))) {\n      throw new Error(\"0x00 character is not permitted in tEXt keywords\");\n    }\n\n    output[idx++] = code;\n  }\n\n  output[idx++] = 0;\n\n  for (let j = 0; j < content.length; j++) {\n    if (!(code = content.charCodeAt(j))) {\n      throw new Error(\"0x00 character is not permitted in tEXt content\");\n    }\n\n    output[idx++] = code;\n  }\n\n  return {\n    name: chunkName,\n    data: output,\n  };\n}\n\n/**\n * https://github.com/hughsk/png-chunk-text\n * Reads a Uint8Array or Node.js Buffer instance containing a tEXt PNG chunk's data and returns its keyword/text:\n * @param data\n * @returns {{text: string, keyword: string}}\n */\nfunction textDecode(data) {\n  if (data.data && data.name) {\n    data = data.data;\n  }\n\n  let naming = true;\n  let text = \"\";\n  let name = \"\";\n\n  for (let i = 0; i < data.length; i++) {\n    let code = data[i];\n\n    if (naming) {\n      if (code) {\n        name += String.fromCharCode(code);\n      } else {\n        naming = false;\n      }\n    } else {\n      if (code) {\n        text += String.fromCharCode(code);\n      } else {\n        throw new Error(\n          \"Invalid NULL character found. 0x00 character is not permitted in tEXt content\"\n        );\n      }\n    }\n  }\n\n  return {\n    keyword: name,\n    text: text,\n  };\n}\n\n/**\n * https://github.com/hughsk/png-chunks-extract\n * Extract the data chunks from a PNG file.\n * Useful for reading the metadata of a PNG image, or as the base of a more complete PNG parser.\n * Takes the raw image file data as a Uint8Array or Node.js Buffer, and returns an array of chunks. Each chunk has a name and data buffer:\n * @param data {Uint8Array}\n * @returns {[{name: String, data: Uint8Array}]}\n */\nfunction extractChunks(data) {\n  if (data[0] !== 0x89) throw new Error(\"Invalid .png file header\");\n  if (data[1] !== 0x50) throw new Error(\"Invalid .png file header\");\n  if (data[2] !== 0x4e) throw new Error(\"Invalid .png file header\");\n  if (data[3] !== 0x47) throw new Error(\"Invalid .png file header\");\n  if (data[4] !== 0x0d)\n    throw new Error(\n      \"Invalid .png file header: possibly caused by DOS-Unix line ending conversion?\"\n    );\n  if (data[5] !== 0x0a)\n    throw new Error(\n      \"Invalid .png file header: possibly caused by DOS-Unix line ending conversion?\"\n    );\n  if (data[6] !== 0x1a) throw new Error(\"Invalid .png file header\");\n  if (data[7] !== 0x0a)\n    throw new Error(\n      \"Invalid .png file header: possibly caused by DOS-Unix line ending conversion?\"\n    );\n\n  let ended = false;\n  let chunks = [];\n  let idx = 8;\n\n  while (idx < data.length) {\n    // Read the length of the current chunk,\n    // which is stored as a Uint32.\n    uint8[3] = data[idx++];\n    uint8[2] = data[idx++];\n    uint8[1] = data[idx++];\n    uint8[0] = data[idx++];\n\n    // Chunk includes name/type for CRC check (see below).\n    let length = uint32[0] + 4;\n    let chunk = new Uint8Array(length);\n    chunk[0] = data[idx++];\n    chunk[1] = data[idx++];\n    chunk[2] = data[idx++];\n    chunk[3] = data[idx++];\n\n    // Get the name in ASCII for identification.\n    let name =\n      String.fromCharCode(chunk[0]) +\n      String.fromCharCode(chunk[1]) +\n      String.fromCharCode(chunk[2]) +\n      String.fromCharCode(chunk[3]);\n\n    // The IHDR header MUST come first.\n    if (!chunks.length && name !== \"IHDR\") {\n      throw new Error(\"IHDR header missing\");\n    }\n\n    // The IEND header marks the end of the file,\n    // so on discovering it break out of the loop.\n    if (name === \"IEND\") {\n      ended = true;\n      chunks.push({\n        name: name,\n        data: new Uint8Array(0),\n      });\n\n      break;\n    }\n\n    // Read the contents of the chunk out of the main buffer.\n    for (let i = 4; i < length; i++) {\n      chunk[i] = data[idx++];\n    }\n\n    // Read out the CRC value for comparison.\n    // It's stored as an Int32.\n    uint8[3] = data[idx++];\n    uint8[2] = data[idx++];\n    uint8[1] = data[idx++];\n    uint8[0] = data[idx++];\n\n    let crcActual = int32[0];\n    let crcExpect = crc32.buf(chunk);\n    if (crcExpect !== crcActual) {\n      throw new Error(\n        \"CRC values for \" +\n          name +\n          \" header do not match, PNG file is likely corrupted\"\n      );\n    }\n\n    // The chunk data is now copied to remove the 4 preceding\n    // bytes used for the chunk name/type.\n    let chunkData = new Uint8Array(chunk.buffer.slice(4));\n\n    chunks.push({\n      name: name,\n      data: chunkData,\n    });\n  }\n\n  if (!ended) {\n    throw new Error(\".png file ended prematurely: no IEND header was found\");\n  }\n\n  return chunks;\n}\n\n/**\n * https://github.com/hughsk/png-chunks-encode\n * Return a fresh PNG buffer given a set of PNG chunks. Useful in combination with png-chunks-encode to easily modify or add to the data of a PNG file.\n * Takes an array of chunks, each with a name and data:\n * @param chunks {[{name: String, data: Uint8Array}]}\n * @returns {Uint8Array}\n */\nfunction encodeChunks(chunks) {\n  let totalSize = 8;\n  let idx = totalSize;\n  let i;\n\n  for (i = 0; i < chunks.length; i++) {\n    totalSize += chunks[i].data.length;\n    totalSize += 12;\n  }\n\n  let output = new Uint8Array(totalSize);\n\n  output[0] = 0x89;\n  output[1] = 0x50;\n  output[2] = 0x4e;\n  output[3] = 0x47;\n  output[4] = 0x0d;\n  output[5] = 0x0a;\n  output[6] = 0x1a;\n  output[7] = 0x0a;\n\n  for (i = 0; i < chunks.length; i++) {\n    let chunk = chunks[i];\n    let name = chunk.name;\n    let data = chunk.data;\n    let size = data.length;\n    let nameChars = [\n      name.charCodeAt(0),\n      name.charCodeAt(1),\n      name.charCodeAt(2),\n      name.charCodeAt(3),\n    ];\n\n    uint32[0] = size;\n    output[idx++] = uint8[3];\n    output[idx++] = uint8[2];\n    output[idx++] = uint8[1];\n    output[idx++] = uint8[0];\n\n    output[idx++] = nameChars[0];\n    output[idx++] = nameChars[1];\n    output[idx++] = nameChars[2];\n    output[idx++] = nameChars[3];\n\n    for (let j = 0; j < size; ) {\n      output[idx++] = data[j++];\n    }\n\n    let crcCheck = nameChars.concat(sliced(data));\n    int32[0] = crc32.buf(crcCheck);\n    output[idx++] = uint8[3];\n    output[idx++] = uint8[2];\n    output[idx++] = uint8[1];\n    output[idx++] = uint8[0];\n  }\n\n  return output;\n}\n\n/**\n * read 4 bytes number from UInt8Array.\n * @param uint8array\n * @param offset\n * @returns {number}\n */\nfunction readUint32(uint8array, offset) {\n  let byte1, byte2, byte3, byte4;\n  byte1 = uint8array[offset++];\n  byte2 = uint8array[offset++];\n  byte3 = uint8array[offset++];\n  byte4 = uint8array[offset];\n  return 0 | (byte1 << 24) | (byte2 << 16) | (byte3 << 8) | byte4;\n}\n\n/**\n * write 4 bytes number to UInt8Array.\n * @param uint8array\n * @param num\n * @param offset\n */\nfunction writeUInt32(uint8array, num, offset) {\n  uint8array[offset] = (num & 0xff000000) >> 24;\n  uint8array[offset + 1] = (num & 0x00ff0000) >> 16;\n  uint8array[offset + 2] = (num & 0x0000ff00) >> 8;\n  uint8array[offset + 3] = num & 0x000000ff;\n}\n\n/**\n * Get object with PNG metadata. only tEXt and pHYs chunks are parsed\n * @param buffer {Buffer}\n * @returns {{tEXt: {keyword: value}, pHYs: {x: number, y: number, units: RESOLUTION_UNITS}, [string]: true}}\n */\nfunction readMetadata(buffer) {\n  let result = {};\n  const chunks = extractChunks(buffer);\n  chunks.forEach((chunk) => {\n    switch (chunk.name) {\n      case \"tEXt\":\n        if (!result.tEXt) {\n          result.tEXt = {};\n        }\n        let textChunk = textDecode(chunk.data);\n        result.tEXt[textChunk.keyword] = textChunk.text;\n        break;\n      case \"pHYs\":\n        result.pHYs = {\n          // Pixels per unit, X axis: 4 bytes (unsigned integer)\n          x: readUint32(chunk.data, 0),\n          // Pixels per unit, Y axis: 4 bytes (unsigned integer)\n          y: readUint32(chunk.data, 4),\n          unit: chunk.data[8],\n        };\n        break;\n      case \"gAMA\":\n      case \"cHRM\":\n      case \"sRGB\":\n      case \"IHDR\":\n      case \"iCCP\":\n      default:\n        result[chunk.name] = true;\n    }\n  });\n  return result;\n}\n\n/**\n * create new Buffer with metadata. only tEXt and pHYs chunks are supported.\n * @param buffer {Buffer}\n * @param metadata {{tEXt: {keyword: value}, pHYs: {x: number, y: number, units: RESOLUTION_UNITS}}}\n * @returns {Buffer}\n */\nfunction writeMetadata(buffer, metadata) {\n  const chunks = extractChunks(buffer);\n  insertMetadata(chunks, metadata);\n  return new Buffer.from(encodeChunks(chunks));\n}\n\nfunction insertMetadata(chunks, metadata) {\n  if (metadata.clear) {\n    for (let i = chunks.length - 1; i--; ) {\n      switch (chunks[i].name) {\n        case \"IHDR\":\n        case \"IDAT\":\n        case \"IEND\":\n          break;\n        default:\n          chunks.splice(i, 1);\n      }\n    }\n  }\n  if (metadata.tEXt) {\n    for (var keyword in metadata.tEXt) {\n      chunks.splice(-1, 0, textEncode(keyword, metadata.tEXt[keyword]));\n    }\n  }\n\n  if (metadata.pHYs) {\n    const data = new Uint8Array(9);\n    writeUInt32(data, metadata.pHYs.x, 0);\n    writeUInt32(data, metadata.pHYs.y, 4);\n    data[8] = metadata.pHYs.units; // inches\n\n    let pHYs = chunks.find((chunk) => chunk.name === \"pHYs\");\n    if (pHYs) {\n      pHYs.data = data;\n    } else {\n      chunks.splice(1, 0, { name: \"pHYs\", data: data });\n    }\n  }\n}\n\nmodule.exports = {\n  RESOLUTION_UNITS: RESOLUTION_UNITS,\n  insertMetadata: insertMetadata,\n  readMetadata: readMetadata,\n  writeMetadata: writeMetadata,\n  textEncode: textEncode,\n  textDecode: textDecode,\n  extractChunks: extractChunks,\n  encodeChunks: encodeChunks,\n};\n", "// nb. This is for IE10 and lower _only_.\nvar supportCustomEvent = window.CustomEvent;\nif (!supportCustomEvent || typeof supportCustomEvent === 'object') {\n  supportCustomEvent = function CustomEvent(event, x) {\n    x = x || {};\n    var ev = document.createEvent('CustomEvent');\n    ev.initCustomEvent(event, !!x.bubbles, !!x.cancelable, x.detail || null);\n    return ev;\n  };\n  supportCustomEvent.prototype = window.Event.prototype;\n}\n\n/**\n * Dispatches the passed event to both an \"on<type>\" handler as well as via the\n * normal dispatch operation. Does not bubble.\n *\n * @param {!EventTarget} target\n * @param {!Event} event\n * @return {boolean}\n */\nfunction safeDispatchEvent(target, event) {\n  var check = 'on' + event.type.toLowerCase();\n  if (typeof target[check] === 'function') {\n    target[check](event);\n  }\n  return target.dispatchEvent(event);\n}\n\n/**\n * @param {Element} el to check for stacking context\n * @return {boolean} whether this el or its parents creates a stacking context\n */\nfunction createsStackingContext(el) {\n  while (el && el !== document.body) {\n    var s = window.getComputedStyle(el);\n    var invalid = function(k, ok) {\n      return !(s[k] === undefined || s[k] === ok);\n    };\n\n    if (s.opacity < 1 ||\n        invalid('zIndex', 'auto') ||\n        invalid('transform', 'none') ||\n        invalid('mixBlendMode', 'normal') ||\n        invalid('filter', 'none') ||\n        invalid('perspective', 'none') ||\n        s['isolation'] === 'isolate' ||\n        s.position === 'fixed' ||\n        s.webkitOverflowScrolling === 'touch') {\n      return true;\n    }\n    el = el.parentElement;\n  }\n  return false;\n}\n\n/**\n * Finds the nearest <dialog> from the passed element.\n *\n * @param {Element} el to search from\n * @return {HTMLDialogElement} dialog found\n */\nfunction findNearestDialog(el) {\n  while (el) {\n    if (el.localName === 'dialog') {\n      return /** @type {HTMLDialogElement} */ (el);\n    }\n    if (el.parentElement) {\n      el = el.parentElement;\n    } else if (el.parentNode) {\n      el = el.parentNode.host;\n    } else {\n      el = null;\n    }\n  }\n  return null;\n}\n\n/**\n * Blur the specified element, as long as it's not the HTML body element.\n * This works around an IE9/10 bug - blurring the body causes Windows to\n * blur the whole application.\n *\n * @param {Element} el to blur\n */\nfunction safeBlur(el) {\n  // Find the actual focused element when the active element is inside a shadow root\n  while (el && el.shadowRoot && el.shadowRoot.activeElement) {\n    el = el.shadowRoot.activeElement;\n  }\n\n  if (el && el.blur && el !== document.body) {\n    el.blur();\n  }\n}\n\n/**\n * @param {!NodeList} nodeList to search\n * @param {Node} node to find\n * @return {boolean} whether node is inside nodeList\n */\nfunction inNodeList(nodeList, node) {\n  for (var i = 0; i < nodeList.length; ++i) {\n    if (nodeList[i] === node) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * @param {HTMLFormElement} el to check\n * @return {boolean} whether this form has method=\"dialog\"\n */\nfunction isFormMethodDialog(el) {\n  if (!el || !el.hasAttribute('method')) {\n    return false;\n  }\n  return el.getAttribute('method').toLowerCase() === 'dialog';\n}\n\n/**\n * @param {!DocumentFragment|!Element} hostElement\n * @return {?Element}\n */\nfunction findFocusableElementWithin(hostElement) {\n  // Note that this is 'any focusable area'. This list is probably not exhaustive, but the\n  // alternative involves stepping through and trying to focus everything.\n  var opts = ['button', 'input', 'keygen', 'select', 'textarea'];\n  var query = opts.map(function(el) {\n    return el + ':not([disabled])';\n  });\n  // TODO(samthor): tabindex values that are not numeric are not focusable.\n  query.push('[tabindex]:not([disabled]):not([tabindex=\"\"])');  // tabindex != \"\", not disabled\n  var target = hostElement.querySelector(query.join(', '));\n\n  if (!target && 'attachShadow' in Element.prototype) {\n    // If we haven't found a focusable target, see if the host element contains an element\n    // which has a shadowRoot.\n    // Recursively search for the first focusable item in shadow roots.\n    var elems = hostElement.querySelectorAll('*');\n    for (var i = 0; i < elems.length; i++) {\n      if (elems[i].tagName && elems[i].shadowRoot) {\n        target = findFocusableElementWithin(elems[i].shadowRoot);\n        if (target) {\n          break;\n        }\n      }\n    }\n  }\n  return target;\n}\n\n/**\n * Determines if an element is attached to the DOM.\n * @param {Element} element to check\n * @return {boolean} whether the element is in DOM\n */\nfunction isConnected(element) {\n  return element.isConnected || document.body.contains(element);\n}\n\n/**\n * @param {!Event} event\n * @return {?Element}\n */\nfunction findFormSubmitter(event) {\n  if (event.submitter) {\n    return event.submitter;\n  }\n\n  var form = event.target;\n  if (!(form instanceof HTMLFormElement)) {\n    return null;\n  }\n\n  var submitter = dialogPolyfill.formSubmitter;\n  if (!submitter) {\n    var target = event.target;\n    var root = ('getRootNode' in target && target.getRootNode() || document);\n    submitter = root.activeElement;\n  }\n\n  if (!submitter || submitter.form !== form) {\n    return null;\n  }\n  return submitter;\n}\n\n/**\n * @param {!Event} event\n */\nfunction maybeHandleSubmit(event) {\n  if (event.defaultPrevented) {\n    return;\n  }\n  var form = /** @type {!HTMLFormElement} */ (event.target);\n\n  // We'd have a value if we clicked on an imagemap.\n  var value = dialogPolyfill.imagemapUseValue;\n  var submitter = findFormSubmitter(event);\n  if (value === null && submitter) {\n    value = submitter.value;\n  }\n\n  // There should always be a dialog as this handler is added specifically on them, but check just\n  // in case.\n  var dialog = findNearestDialog(form);\n  if (!dialog) {\n    return;\n  }\n\n  // Prefer formmethod on the button.\n  var formmethod = submitter && submitter.getAttribute('formmethod') || form.getAttribute('method');\n  if (formmethod !== 'dialog') {\n    return;\n  }\n  event.preventDefault();\n\n  if (value != null) {\n    // nb. we explicitly check against null/undefined\n    dialog.close(value);\n  } else {\n    dialog.close();\n  }\n}\n\n/**\n * @param {!HTMLDialogElement} dialog to upgrade\n * @constructor\n */\nfunction dialogPolyfillInfo(dialog) {\n  this.dialog_ = dialog;\n  this.replacedStyleTop_ = false;\n  this.openAsModal_ = false;\n\n  // Set a11y role. Browsers that support dialog implicitly know this already.\n  if (!dialog.hasAttribute('role')) {\n    dialog.setAttribute('role', 'dialog');\n  }\n\n  dialog.show = this.show.bind(this);\n  dialog.showModal = this.showModal.bind(this);\n  dialog.close = this.close.bind(this);\n\n  dialog.addEventListener('submit', maybeHandleSubmit, false);\n\n  if (!('returnValue' in dialog)) {\n    dialog.returnValue = '';\n  }\n\n  if ('MutationObserver' in window) {\n    var mo = new MutationObserver(this.maybeHideModal.bind(this));\n    mo.observe(dialog, {attributes: true, attributeFilter: ['open']});\n  } else {\n    // IE10 and below support. Note that DOMNodeRemoved etc fire _before_ removal. They also\n    // seem to fire even if the element was removed as part of a parent removal. Use the removed\n    // events to force downgrade (useful if removed/immediately added).\n    var removed = false;\n    var cb = function() {\n      removed ? this.downgradeModal() : this.maybeHideModal();\n      removed = false;\n    }.bind(this);\n    var timeout;\n    var delayModel = function(ev) {\n      if (ev.target !== dialog) { return; }  // not for a child element\n      var cand = 'DOMNodeRemoved';\n      removed |= (ev.type.substr(0, cand.length) === cand);\n      window.clearTimeout(timeout);\n      timeout = window.setTimeout(cb, 0);\n    };\n    ['DOMAttrModified', 'DOMNodeRemoved', 'DOMNodeRemovedFromDocument'].forEach(function(name) {\n      dialog.addEventListener(name, delayModel);\n    });\n  }\n  // Note that the DOM is observed inside DialogManager while any dialog\n  // is being displayed as a modal, to catch modal removal from the DOM.\n\n  Object.defineProperty(dialog, 'open', {\n    set: this.setOpen.bind(this),\n    get: dialog.hasAttribute.bind(dialog, 'open')\n  });\n\n  this.backdrop_ = document.createElement('div');\n  this.backdrop_.className = 'backdrop';\n  this.backdrop_.addEventListener('mouseup'  , this.backdropMouseEvent_.bind(this));\n  this.backdrop_.addEventListener('mousedown', this.backdropMouseEvent_.bind(this));\n  this.backdrop_.addEventListener('click'    , this.backdropMouseEvent_.bind(this));\n}\n\ndialogPolyfillInfo.prototype = /** @type {HTMLDialogElement.prototype} */ ({\n\n  get dialog() {\n    return this.dialog_;\n  },\n\n  /**\n   * Maybe remove this dialog from the modal top layer. This is called when\n   * a modal dialog may no longer be tenable, e.g., when the dialog is no\n   * longer open or is no longer part of the DOM.\n   */\n  maybeHideModal: function() {\n    if (this.dialog_.hasAttribute('open') && isConnected(this.dialog_)) { return; }\n    this.downgradeModal();\n  },\n\n  /**\n   * Remove this dialog from the modal top layer, leaving it as a non-modal.\n   */\n  downgradeModal: function() {\n    if (!this.openAsModal_) { return; }\n    this.openAsModal_ = false;\n    this.dialog_.style.zIndex = '';\n\n    // This won't match the native <dialog> exactly because if the user set top on a centered\n    // polyfill dialog, that top gets thrown away when the dialog is closed. Not sure it's\n    // possible to polyfill this perfectly.\n    if (this.replacedStyleTop_) {\n      this.dialog_.style.top = '';\n      this.replacedStyleTop_ = false;\n    }\n\n    // Clear the backdrop and remove from the manager.\n    this.backdrop_.parentNode && this.backdrop_.parentNode.removeChild(this.backdrop_);\n    dialogPolyfill.dm.removeDialog(this);\n  },\n\n  /**\n   * @param {boolean} value whether to open or close this dialog\n   */\n  setOpen: function(value) {\n    if (value) {\n      this.dialog_.hasAttribute('open') || this.dialog_.setAttribute('open', '');\n    } else {\n      this.dialog_.removeAttribute('open');\n      this.maybeHideModal();  // nb. redundant with MutationObserver\n    }\n  },\n\n  /**\n   * Handles mouse events ('mouseup', 'mousedown', 'click') on the fake .backdrop element, redirecting them as if\n   * they were on the dialog itself.\n   *\n   * @param {!Event} e to redirect\n   */\n  backdropMouseEvent_: function(e) {\n    if (!this.dialog_.hasAttribute('tabindex')) {\n      // Clicking on the backdrop should move the implicit cursor, even if dialog cannot be\n      // focused. Create a fake thing to focus on. If the backdrop was _before_ the dialog, this\n      // would not be needed - clicks would move the implicit cursor there.\n      var fake = document.createElement('div');\n      this.dialog_.insertBefore(fake, this.dialog_.firstChild);\n      fake.tabIndex = -1;\n      fake.focus();\n      this.dialog_.removeChild(fake);\n    } else {\n      this.dialog_.focus();\n    }\n\n    var redirectedEvent = document.createEvent('MouseEvents');\n    redirectedEvent.initMouseEvent(e.type, e.bubbles, e.cancelable, window,\n        e.detail, e.screenX, e.screenY, e.clientX, e.clientY, e.ctrlKey,\n        e.altKey, e.shiftKey, e.metaKey, e.button, e.relatedTarget);\n    this.dialog_.dispatchEvent(redirectedEvent);\n    e.stopPropagation();\n  },\n\n  /**\n   * Focuses on the first focusable element within the dialog. This will always blur the current\n   * focus, even if nothing within the dialog is found.\n   */\n  focus_: function() {\n    // Find element with `autofocus` attribute, or fall back to the first form/tabindex control.\n    var target = this.dialog_.querySelector('[autofocus]:not([disabled])');\n    if (!target && this.dialog_.tabIndex >= 0) {\n      target = this.dialog_;\n    }\n    if (!target) {\n      target = findFocusableElementWithin(this.dialog_);\n    }\n    safeBlur(document.activeElement);\n    target && target.focus();\n  },\n\n  /**\n   * Sets the zIndex for the backdrop and dialog.\n   *\n   * @param {number} dialogZ\n   * @param {number} backdropZ\n   */\n  updateZIndex: function(dialogZ, backdropZ) {\n    if (dialogZ < backdropZ) {\n      throw new Error('dialogZ should never be < backdropZ');\n    }\n    this.dialog_.style.zIndex = dialogZ;\n    this.backdrop_.style.zIndex = backdropZ;\n  },\n\n  /**\n   * Shows the dialog. If the dialog is already open, this does nothing.\n   */\n  show: function() {\n    if (!this.dialog_.open) {\n      this.setOpen(true);\n      this.focus_();\n    }\n  },\n\n  /**\n   * Show this dialog modally.\n   */\n  showModal: function() {\n    if (this.dialog_.hasAttribute('open')) {\n      throw new Error('Failed to execute \\'showModal\\' on dialog: The element is already open, and therefore cannot be opened modally.');\n    }\n    if (!isConnected(this.dialog_)) {\n      throw new Error('Failed to execute \\'showModal\\' on dialog: The element is not in a Document.');\n    }\n    if (!dialogPolyfill.dm.pushDialog(this)) {\n      throw new Error('Failed to execute \\'showModal\\' on dialog: There are too many open modal dialogs.');\n    }\n\n    if (createsStackingContext(this.dialog_.parentElement)) {\n      console.warn('A dialog is being shown inside a stacking context. ' +\n          'This may cause it to be unusable. For more information, see this link: ' +\n          'https://github.com/GoogleChrome/dialog-polyfill/#stacking-context');\n    }\n\n    this.setOpen(true);\n    this.openAsModal_ = true;\n\n    // Optionally center vertically, relative to the current viewport.\n    if (dialogPolyfill.needsCentering(this.dialog_)) {\n      dialogPolyfill.reposition(this.dialog_);\n      this.replacedStyleTop_ = true;\n    } else {\n      this.replacedStyleTop_ = false;\n    }\n\n    // Insert backdrop.\n    this.dialog_.parentNode.insertBefore(this.backdrop_, this.dialog_.nextSibling);\n\n    // Focus on whatever inside the dialog.\n    this.focus_();\n  },\n\n  /**\n   * Closes this HTMLDialogElement. This is optional vs clearing the open\n   * attribute, however this fires a 'close' event.\n   *\n   * @param {string=} opt_returnValue to use as the returnValue\n   */\n  close: function(opt_returnValue) {\n    if (!this.dialog_.hasAttribute('open')) {\n      throw new Error('Failed to execute \\'close\\' on dialog: The element does not have an \\'open\\' attribute, and therefore cannot be closed.');\n    }\n    this.setOpen(false);\n\n    // Leave returnValue untouched in case it was set directly on the element\n    if (opt_returnValue !== undefined) {\n      this.dialog_.returnValue = opt_returnValue;\n    }\n\n    // Triggering \"close\" event for any attached listeners on the <dialog>.\n    var closeEvent = new supportCustomEvent('close', {\n      bubbles: false,\n      cancelable: false\n    });\n    safeDispatchEvent(this.dialog_, closeEvent);\n  }\n\n});\n\nvar dialogPolyfill = {};\n\ndialogPolyfill.reposition = function(element) {\n  var scrollTop = document.body.scrollTop || document.documentElement.scrollTop;\n  var topValue = scrollTop + (window.innerHeight - element.offsetHeight) / 2;\n  element.style.top = Math.max(scrollTop, topValue) + 'px';\n};\n\ndialogPolyfill.isInlinePositionSetByStylesheet = function(element) {\n  for (var i = 0; i < document.styleSheets.length; ++i) {\n    var styleSheet = document.styleSheets[i];\n    var cssRules = null;\n    // Some browsers throw on cssRules.\n    try {\n      cssRules = styleSheet.cssRules;\n    } catch (e) {}\n    if (!cssRules) { continue; }\n    for (var j = 0; j < cssRules.length; ++j) {\n      var rule = cssRules[j];\n      var selectedNodes = null;\n      // Ignore errors on invalid selector texts.\n      try {\n        selectedNodes = document.querySelectorAll(rule.selectorText);\n      } catch(e) {}\n      if (!selectedNodes || !inNodeList(selectedNodes, element)) {\n        continue;\n      }\n      var cssTop = rule.style.getPropertyValue('top');\n      var cssBottom = rule.style.getPropertyValue('bottom');\n      if ((cssTop && cssTop !== 'auto') || (cssBottom && cssBottom !== 'auto')) {\n        return true;\n      }\n    }\n  }\n  return false;\n};\n\ndialogPolyfill.needsCentering = function(dialog) {\n  var computedStyle = window.getComputedStyle(dialog);\n  if (computedStyle.position !== 'absolute') {\n    return false;\n  }\n\n  // We must determine whether the top/bottom specified value is non-auto.  In\n  // WebKit/Blink, checking computedStyle.top == 'auto' is sufficient, but\n  // Firefox returns the used value. So we do this crazy thing instead: check\n  // the inline style and then go through CSS rules.\n  if ((dialog.style.top !== 'auto' && dialog.style.top !== '') ||\n      (dialog.style.bottom !== 'auto' && dialog.style.bottom !== '')) {\n    return false;\n  }\n  return !dialogPolyfill.isInlinePositionSetByStylesheet(dialog);\n};\n\n/**\n * @param {!Element} element to force upgrade\n */\ndialogPolyfill.forceRegisterDialog = function(element) {\n  if (window.HTMLDialogElement || element.showModal) {\n    console.warn('This browser already supports <dialog>, the polyfill ' +\n        'may not work correctly', element);\n  }\n  if (element.localName !== 'dialog') {\n    throw new Error('Failed to register dialog: The element is not a dialog.');\n  }\n  new dialogPolyfillInfo(/** @type {!HTMLDialogElement} */ (element));\n};\n\n/**\n * @param {!Element} element to upgrade, if necessary\n */\ndialogPolyfill.registerDialog = function(element) {\n  if (!element.showModal) {\n    dialogPolyfill.forceRegisterDialog(element);\n  }\n};\n\n/**\n * @constructor\n */\ndialogPolyfill.DialogManager = function() {\n  /** @type {!Array<!dialogPolyfillInfo>} */\n  this.pendingDialogStack = [];\n\n  var checkDOM = this.checkDOM_.bind(this);\n\n  // The overlay is used to simulate how a modal dialog blocks the document.\n  // The blocking dialog is positioned on top of the overlay, and the rest of\n  // the dialogs on the pending dialog stack are positioned below it. In the\n  // actual implementation, the modal dialog stacking is controlled by the\n  // top layer, where z-index has no effect.\n  this.overlay = document.createElement('div');\n  this.overlay.className = '_dialog_overlay';\n  this.overlay.addEventListener('click', function(e) {\n    this.forwardTab_ = undefined;\n    e.stopPropagation();\n    checkDOM([]);  // sanity-check DOM\n  }.bind(this));\n\n  this.handleKey_ = this.handleKey_.bind(this);\n  this.handleFocus_ = this.handleFocus_.bind(this);\n\n  this.zIndexLow_ = 100000;\n  this.zIndexHigh_ = 100000 + 150;\n\n  this.forwardTab_ = undefined;\n\n  if ('MutationObserver' in window) {\n    this.mo_ = new MutationObserver(function(records) {\n      var removed = [];\n      records.forEach(function(rec) {\n        for (var i = 0, c; c = rec.removedNodes[i]; ++i) {\n          if (!(c instanceof Element)) {\n            continue;\n          } else if (c.localName === 'dialog') {\n            removed.push(c);\n          }\n          removed = removed.concat(c.querySelectorAll('dialog'));\n        }\n      });\n      removed.length && checkDOM(removed);\n    });\n  }\n};\n\n/**\n * Called on the first modal dialog being shown. Adds the overlay and related\n * handlers.\n */\ndialogPolyfill.DialogManager.prototype.blockDocument = function() {\n  document.documentElement.addEventListener('focus', this.handleFocus_, true);\n  document.addEventListener('keydown', this.handleKey_);\n  this.mo_ && this.mo_.observe(document, {childList: true, subtree: true});\n};\n\n/**\n * Called on the first modal dialog being removed, i.e., when no more modal\n * dialogs are visible.\n */\ndialogPolyfill.DialogManager.prototype.unblockDocument = function() {\n  document.documentElement.removeEventListener('focus', this.handleFocus_, true);\n  document.removeEventListener('keydown', this.handleKey_);\n  this.mo_ && this.mo_.disconnect();\n};\n\n/**\n * Updates the stacking of all known dialogs.\n */\ndialogPolyfill.DialogManager.prototype.updateStacking = function() {\n  var zIndex = this.zIndexHigh_;\n\n  for (var i = 0, dpi; dpi = this.pendingDialogStack[i]; ++i) {\n    dpi.updateZIndex(--zIndex, --zIndex);\n    if (i === 0) {\n      this.overlay.style.zIndex = --zIndex;\n    }\n  }\n\n  // Make the overlay a sibling of the dialog itself.\n  var last = this.pendingDialogStack[0];\n  if (last) {\n    var p = last.dialog.parentNode || document.body;\n    p.appendChild(this.overlay);\n  } else if (this.overlay.parentNode) {\n    this.overlay.parentNode.removeChild(this.overlay);\n  }\n};\n\n/**\n * @param {Element} candidate to check if contained or is the top-most modal dialog\n * @return {boolean} whether candidate is contained in top dialog\n */\ndialogPolyfill.DialogManager.prototype.containedByTopDialog_ = function(candidate) {\n  while (candidate = findNearestDialog(candidate)) {\n    for (var i = 0, dpi; dpi = this.pendingDialogStack[i]; ++i) {\n      if (dpi.dialog === candidate) {\n        return i === 0;  // only valid if top-most\n      }\n    }\n    candidate = candidate.parentElement;\n  }\n  return false;\n};\n\ndialogPolyfill.DialogManager.prototype.handleFocus_ = function(event) {\n  var target = event.composedPath ? event.composedPath()[0] : event.target;\n\n  if (this.containedByTopDialog_(target)) { return; }\n\n  if (document.activeElement === document.documentElement) { return; }\n\n  event.preventDefault();\n  event.stopPropagation();\n  safeBlur(/** @type {Element} */ (target));\n\n  if (this.forwardTab_ === undefined) { return; }  // move focus only from a tab key\n\n  var dpi = this.pendingDialogStack[0];\n  var dialog = dpi.dialog;\n  var position = dialog.compareDocumentPosition(target);\n  if (position & Node.DOCUMENT_POSITION_PRECEDING) {\n    if (this.forwardTab_) {\n      // forward\n      dpi.focus_();\n    } else if (target !== document.documentElement) {\n      // backwards if we're not already focused on <html>\n      document.documentElement.focus();\n    }\n  }\n\n  return false;\n};\n\ndialogPolyfill.DialogManager.prototype.handleKey_ = function(event) {\n  this.forwardTab_ = undefined;\n  if (event.keyCode === 27) {\n    event.preventDefault();\n    event.stopPropagation();\n    var cancelEvent = new supportCustomEvent('cancel', {\n      bubbles: false,\n      cancelable: true\n    });\n    var dpi = this.pendingDialogStack[0];\n    if (dpi && safeDispatchEvent(dpi.dialog, cancelEvent)) {\n      dpi.dialog.close();\n    }\n  } else if (event.keyCode === 9) {\n    this.forwardTab_ = !event.shiftKey;\n  }\n};\n\n/**\n * Finds and downgrades any known modal dialogs that are no longer displayed. Dialogs that are\n * removed and immediately readded don't stay modal, they become normal.\n *\n * @param {!Array<!HTMLDialogElement>} removed that have definitely been removed\n */\ndialogPolyfill.DialogManager.prototype.checkDOM_ = function(removed) {\n  // This operates on a clone because it may cause it to change. Each change also calls\n  // updateStacking, which only actually needs to happen once. But who removes many modal dialogs\n  // at a time?!\n  var clone = this.pendingDialogStack.slice();\n  clone.forEach(function(dpi) {\n    if (removed.indexOf(dpi.dialog) !== -1) {\n      dpi.downgradeModal();\n    } else {\n      dpi.maybeHideModal();\n    }\n  });\n};\n\n/**\n * @param {!dialogPolyfillInfo} dpi\n * @return {boolean} whether the dialog was allowed\n */\ndialogPolyfill.DialogManager.prototype.pushDialog = function(dpi) {\n  var allowed = (this.zIndexHigh_ - this.zIndexLow_) / 2 - 1;\n  if (this.pendingDialogStack.length >= allowed) {\n    return false;\n  }\n  if (this.pendingDialogStack.unshift(dpi) === 1) {\n    this.blockDocument();\n  }\n  this.updateStacking();\n  return true;\n};\n\n/**\n * @param {!dialogPolyfillInfo} dpi\n */\ndialogPolyfill.DialogManager.prototype.removeDialog = function(dpi) {\n  var index = this.pendingDialogStack.indexOf(dpi);\n  if (index === -1) { return; }\n\n  this.pendingDialogStack.splice(index, 1);\n  if (this.pendingDialogStack.length === 0) {\n    this.unblockDocument();\n  }\n  this.updateStacking();\n};\n\ndialogPolyfill.dm = new dialogPolyfill.DialogManager();\ndialogPolyfill.formSubmitter = null;\ndialogPolyfill.imagemapUseValue = null;\n\n/**\n * Installs global handlers, such as click listers and native method overrides. These are needed\n * even if a no dialog is registered, as they deal with <form method=\"dialog\">.\n */\nif (window.HTMLDialogElement === undefined) {\n\n  /**\n   * If HTMLFormElement translates method=\"DIALOG\" into 'get', then replace the descriptor with\n   * one that returns the correct value.\n   */\n  var testForm = document.createElement('form');\n  testForm.setAttribute('method', 'dialog');\n  if (testForm.method !== 'dialog') {\n    var methodDescriptor = Object.getOwnPropertyDescriptor(HTMLFormElement.prototype, 'method');\n    if (methodDescriptor) {\n      // nb. Some older iOS and older PhantomJS fail to return the descriptor. Don't do anything\n      // and don't bother to update the element.\n      var realGet = methodDescriptor.get;\n      methodDescriptor.get = function() {\n        if (isFormMethodDialog(this)) {\n          return 'dialog';\n        }\n        return realGet.call(this);\n      };\n      var realSet = methodDescriptor.set;\n      /** @this {HTMLElement} */\n      methodDescriptor.set = function(v) {\n        if (typeof v === 'string' && v.toLowerCase() === 'dialog') {\n          return this.setAttribute('method', v);\n        }\n        return realSet.call(this, v);\n      };\n      Object.defineProperty(HTMLFormElement.prototype, 'method', methodDescriptor);\n    }\n  }\n\n  /**\n   * Global 'click' handler, to capture the <input type=\"submit\"> or <button> element which has\n   * submitted a <form method=\"dialog\">. Needed as Safari and others don't report this inside\n   * document.activeElement.\n   */\n  document.addEventListener('click', function(ev) {\n    dialogPolyfill.formSubmitter = null;\n    dialogPolyfill.imagemapUseValue = null;\n    if (ev.defaultPrevented) { return; }  // e.g. a submit which prevents default submission\n\n    var target = /** @type {Element} */ (ev.target);\n    if ('composedPath' in ev) {\n      var path = ev.composedPath();\n      target = path.shift() || target;\n    }\n    if (!target || !isFormMethodDialog(target.form)) { return; }\n\n    var valid = (target.type === 'submit' && ['button', 'input'].indexOf(target.localName) > -1);\n    if (!valid) {\n      if (!(target.localName === 'input' && target.type === 'image')) { return; }\n      // this is a <input type=\"image\">, which can submit forms\n      dialogPolyfill.imagemapUseValue = ev.offsetX + ',' + ev.offsetY;\n    }\n\n    var dialog = findNearestDialog(target);\n    if (!dialog) { return; }\n\n    dialogPolyfill.formSubmitter = target;\n\n  }, false);\n\n  /**\n   * Global 'submit' handler. This handles submits of `method=\"dialog\"` which are invalid, i.e.,\n   * outside a dialog. They get prevented.\n   */\n  document.addEventListener('submit', function(ev) {\n    var form = ev.target;\n    var dialog = findNearestDialog(form);\n    if (dialog) {\n      return;  // ignore, handle there\n    }\n\n    var submitter = findFormSubmitter(ev);\n    var formmethod = submitter && submitter.getAttribute('formmethod') || form.getAttribute('method');\n    if (formmethod === 'dialog') {\n      ev.preventDefault();\n    }\n  });\n\n  /**\n   * Replace the native HTMLFormElement.submit() method, as it won't fire the\n   * submit event and give us a chance to respond.\n   */\n  var nativeFormSubmit = HTMLFormElement.prototype.submit;\n  var replacementFormSubmit = function () {\n    if (!isFormMethodDialog(this)) {\n      return nativeFormSubmit.call(this);\n    }\n    var dialog = findNearestDialog(this);\n    dialog && dialog.close();\n  };\n  HTMLFormElement.prototype.submit = replacementFormSubmit;\n}\n\nexport default dialogPolyfill;\n", "import { tailRec } from './ChainRec';\nimport { identity, pipe, bind_, bindTo_, flow } from './function';\n// -------------------------------------------------------------------------------------\n// guards\n// -------------------------------------------------------------------------------------\n/**\n * Returns `true` if the either is an instance of `Left`, `false` otherwise.\n *\n * @category guards\n * @since 2.0.0\n */\nexport var isLeft = function (ma) { return ma._tag === 'Left'; };\n/**\n * Returns `true` if the either is an instance of `Right`, `false` otherwise.\n *\n * @category guards\n * @since 2.0.0\n */\nexport var isRight = function (ma) { return ma._tag === 'Right'; };\n// -------------------------------------------------------------------------------------\n// constructors\n// -------------------------------------------------------------------------------------\n/**\n * Constructs a new `Either` holding a `Left` value. This usually represents a failure, due to the right-bias of this\n * structure.\n *\n * @category constructors\n * @since 2.0.0\n */\nexport var left = function (e) { return ({ _tag: 'Left', left: e }); };\n/**\n * Constructs a new `Either` holding a `Right` value. This usually represents a successful value due to the right bias\n * of this structure.\n *\n * @category constructors\n * @since 2.0.0\n */\nexport var right = function (a) { return ({ _tag: 'Right', right: a }); };\n// TODO: make lazy in v3\n/**\n * Takes a default and a nullable value, if the value is not nully, turn it into a `Right`, if the value is nully use\n * the provided default as a `Left`.\n *\n * @example\n * import { fromNullable, left, right } from 'fp-ts/Either'\n *\n * const parse = fromNullable('nully')\n *\n * assert.deepStrictEqual(parse(1), right(1))\n * assert.deepStrictEqual(parse(null), left('nully'))\n *\n * @category constructors\n * @since 2.0.0\n */\nexport function fromNullable(e) {\n    return function (a) { return (a == null ? left(e) : right(a)); };\n}\n// TODO: `onError => Lazy<A> => Either` in v3\n/**\n * Constructs a new `Either` from a function that might throw.\n *\n * @example\n * import { Either, left, right, tryCatch } from 'fp-ts/Either'\n *\n * const unsafeHead = <A>(as: Array<A>): A => {\n *   if (as.length > 0) {\n *     return as[0]\n *   } else {\n *     throw new Error('empty array')\n *   }\n * }\n *\n * const head = <A>(as: Array<A>): Either<Error, A> => {\n *   return tryCatch(() => unsafeHead(as), e => (e instanceof Error ? e : new Error('unknown error')))\n * }\n *\n * assert.deepStrictEqual(head([]), left(new Error('empty array')))\n * assert.deepStrictEqual(head([1, 2, 3]), right(1))\n *\n * @category constructors\n * @since 2.0.0\n */\nexport function tryCatch(f, onError) {\n    try {\n        return right(f());\n    }\n    catch (e) {\n        return left(onError(e));\n    }\n}\n// TODO curry in v3\n/**\n * Converts a JavaScript Object Notation (JSON) string into an object.\n *\n * @example\n * import { parseJSON, toError, right, left } from 'fp-ts/Either'\n *\n * assert.deepStrictEqual(parseJSON('{\"a\":1}', toError), right({ a: 1 }))\n * assert.deepStrictEqual(parseJSON('{\"a\":}', toError), left(new SyntaxError('Unexpected token } in JSON at position 5')))\n *\n * @category constructors\n * @since 2.0.0\n */\nexport function parseJSON(s, onError) {\n    return tryCatch(function () { return JSON.parse(s); }, onError);\n}\n// TODO curry in v3\n/**\n * Converts a JavaScript value to a JavaScript Object Notation (JSON) string.\n *\n * @example\n * import * as E from 'fp-ts/Either'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(E.stringifyJSON({ a: 1 }, E.toError), E.right('{\"a\":1}'))\n * const circular: any = { ref: null }\n * circular.ref = circular\n * assert.deepStrictEqual(\n *   pipe(\n *     E.stringifyJSON(circular, E.toError),\n *     E.mapLeft(e => e.message.includes('Converting circular structure to JSON'))\n *   ),\n *   E.left(true)\n * )\n *\n * @category constructors\n * @since 2.0.0\n */\nexport function stringifyJSON(u, onError) {\n    return tryCatch(function () { return JSON.stringify(u); }, onError);\n}\n/**\n * Derivable from `MonadThrow`.\n *\n * @example\n * import { fromOption, left, right } from 'fp-ts/Either'\n * import { pipe } from 'fp-ts/function'\n * import { none, some } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     some(1),\n *     fromOption(() => 'error')\n *   ),\n *   right(1)\n * )\n * assert.deepStrictEqual(\n *   pipe(\n *     none,\n *     fromOption(() => 'error')\n *   ),\n *   left('error')\n * )\n *\n * @category constructors\n * @since 2.0.0\n */\nexport var fromOption = function (onNone) { return function (ma) {\n    return ma._tag === 'None' ? left(onNone()) : right(ma.value);\n}; };\n/**\n * Derivable from `MonadThrow`.\n *\n * @example\n * import { fromPredicate, left, right } from 'fp-ts/Either'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     1,\n *     fromPredicate(\n *       (n) => n > 0,\n *       () => 'error'\n *     )\n *   ),\n *   right(1)\n * )\n * assert.deepStrictEqual(\n *   pipe(\n *     -1,\n *     fromPredicate(\n *       (n) => n > 0,\n *       () => 'error'\n *     )\n *   ),\n *   left('error')\n * )\n *\n * @category constructors\n * @since 2.0.0\n */\nexport var fromPredicate = function (predicate, onFalse) { return function (a) { return (predicate(a) ? right(a) : left(onFalse(a))); }; };\n// -------------------------------------------------------------------------------------\n// destructors\n// -------------------------------------------------------------------------------------\n/**\n * Takes two functions and an `Either` value, if the value is a `Left` the inner value is applied to the first function,\n * if the value is a `Right` the inner value is applied to the second function.\n *\n * @example\n * import { fold, left, right } from 'fp-ts/Either'\n * import { pipe } from 'fp-ts/function'\n *\n * function onLeft(errors: Array<string>): string {\n *   return `Errors: ${errors.join(', ')}`\n * }\n *\n * function onRight(value: number): string {\n *   return `Ok: ${value}`\n * }\n *\n * assert.strictEqual(\n *   pipe(\n *     right(1),\n *     fold(onLeft, onRight)\n *   ),\n *   'Ok: 1'\n * )\n * assert.strictEqual(\n *   pipe(\n *     left(['error 1', 'error 2']),\n *     fold(onLeft, onRight)\n *   ),\n *   'Errors: error 1, error 2'\n * )\n *\n * @category destructors\n * @since 2.0.0\n */\nexport function fold(onLeft, onRight) {\n    return function (ma) { return (isLeft(ma) ? onLeft(ma.left) : onRight(ma.right)); };\n}\n/**\n * Less strict version of [`getOrElse`](#getOrElse).\n *\n * @category destructors\n * @since 2.6.0\n */\nexport var getOrElseW = function (onLeft) { return function (ma) {\n    return isLeft(ma) ? onLeft(ma.left) : ma.right;\n}; };\n/**\n * Returns the wrapped value if it's a `Right` or a default value if is a `Left`.\n *\n * @example\n * import { getOrElse, left, right } from 'fp-ts/Either'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     right(1),\n *     getOrElse(() => 0)\n *   ),\n *   1\n * )\n * assert.deepStrictEqual(\n *   pipe(\n *     left('error'),\n *     getOrElse(() => 0)\n *   ),\n *   0\n * )\n *\n * @category destructors\n * @since 2.0.0\n */\nexport var getOrElse = getOrElseW;\n// -------------------------------------------------------------------------------------\n// combinators\n// -------------------------------------------------------------------------------------\n/**\n * @category combinators\n * @since 2.9.0\n */\nexport function fromNullableK(e) {\n    var from = fromNullable(e);\n    return function (f) { return function () {\n        var a = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            a[_i] = arguments[_i];\n        }\n        return from(f.apply(void 0, a));\n    }; };\n}\n/**\n * @category combinators\n * @since 2.9.0\n */\nexport function chainNullableK(e) {\n    var from = fromNullableK(e);\n    return function (f) { return chain(from(f)); };\n}\n/**\n * Returns a `Right` if is a `Left` (and vice versa).\n *\n * @category combinators\n * @since 2.0.0\n */\nexport function swap(ma) {\n    return isLeft(ma) ? right(ma.left) : left(ma.right);\n}\n/**\n * Useful for recovering from errors.\n *\n * @category combinators\n * @since 2.0.0\n */\nexport function orElse(onLeft) {\n    return function (ma) { return (isLeft(ma) ? onLeft(ma.left) : ma); };\n}\n/**\n * Less strict version of [`filterOrElse`](#filterOrElse).\n *\n * @since 2.9.0\n */\nexport var filterOrElseW = function (predicate, onFalse) {\n    return chainW(function (a) { return (predicate(a) ? right(a) : left(onFalse(a))); });\n};\n/**\n * Derivable from `MonadThrow`.\n *\n * @example\n * import { filterOrElse, left, right } from 'fp-ts/Either'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     right(1),\n *     filterOrElse(\n *       (n) => n > 0,\n *       () => 'error'\n *     )\n *   ),\n *   right(1)\n * )\n * assert.deepStrictEqual(\n *   pipe(\n *     right(-1),\n *     filterOrElse(\n *       (n) => n > 0,\n *       () => 'error'\n *     )\n *   ),\n *   left('error')\n * )\n * assert.deepStrictEqual(\n *   pipe(\n *     left('a'),\n *     filterOrElse(\n *       (n) => n > 0,\n *       () => 'error'\n *     )\n *   ),\n *   left('a')\n * )\n *\n * @category combinators\n * @since 2.0.0\n */\nexport var filterOrElse = filterOrElseW;\n// -------------------------------------------------------------------------------------\n// non-pipeables\n// -------------------------------------------------------------------------------------\nvar map_ = function (fa, f) { return pipe(fa, map(f)); };\nvar ap_ = function (fab, fa) { return pipe(fab, ap(fa)); };\n/* istanbul ignore next */\nvar chain_ = function (ma, f) { return pipe(ma, chain(f)); };\n/* istanbul ignore next */\nvar reduce_ = function (fa, b, f) { return pipe(fa, reduce(b, f)); };\n/* istanbul ignore next */\nvar foldMap_ = function (M) { return function (fa, f) {\n    var foldMapM = foldMap(M);\n    return pipe(fa, foldMapM(f));\n}; };\n/* istanbul ignore next */\nvar reduceRight_ = function (fa, b, f) { return pipe(fa, reduceRight(b, f)); };\nvar traverse_ = function (F) {\n    var traverseF = traverse(F);\n    return function (ta, f) { return pipe(ta, traverseF(f)); };\n};\nvar bimap_ = function (fa, f, g) { return pipe(fa, bimap(f, g)); };\nvar mapLeft_ = function (fa, f) { return pipe(fa, mapLeft(f)); };\n/* istanbul ignore next */\nvar alt_ = function (fa, that) { return pipe(fa, alt(that)); };\n/* istanbul ignore next */\nvar extend_ = function (wa, f) { return pipe(wa, extend(f)); };\nvar chainRec_ = function (a, f) {\n    return tailRec(f(a), function (e) {\n        return isLeft(e) ? right(left(e.left)) : isLeft(e.right) ? left(f(e.right.left)) : right(right(e.right.right));\n    });\n};\n// -------------------------------------------------------------------------------------\n// pipeables\n// -------------------------------------------------------------------------------------\n/**\n * `map` can be used to turn functions `(a: A) => B` into functions `(fa: F<A>) => F<B>` whose argument and return types\n * use the type constructor `F` to represent some computational context.\n *\n * @category Functor\n * @since 2.0.0\n */\nexport var map = function (f) { return function (fa) {\n    return isLeft(fa) ? fa : right(f(fa.right));\n}; };\n/**\n * Map a pair of functions over the two type arguments of the bifunctor.\n *\n * @category Bifunctor\n * @since 2.0.0\n */\nexport var bimap = function (f, g) { return function (fa) { return (isLeft(fa) ? left(f(fa.left)) : right(g(fa.right))); }; };\n/**\n * Map a function over the first type argument of a bifunctor.\n *\n * @category Bifunctor\n * @since 2.0.0\n */\nexport var mapLeft = function (f) { return function (fa) {\n    return isLeft(fa) ? left(f(fa.left)) : fa;\n}; };\n/**\n * Less strict version of [`ap`](#ap).\n *\n * @category Apply\n * @since 2.8.0\n */\nexport var apW = function (fa) { return function (fab) {\n    return isLeft(fab) ? fab : isLeft(fa) ? fa : right(fab.right(fa.right));\n}; };\n/**\n * Apply a function to an argument under a type constructor.\n *\n * @category Apply\n * @since 2.0.0\n */\nexport var ap = apW;\n/**\n * Combine two effectful actions, keeping only the result of the first.\n *\n * Derivable from `Apply`.\n *\n * @category combinators\n * @since 2.0.0\n */\nexport var apFirst = function (fb) {\n    return flow(map(function (a) { return function () { return a; }; }), ap(fb));\n};\n/**\n * Combine two effectful actions, keeping only the result of the second.\n *\n * Derivable from `Apply`.\n *\n * @category combinators\n * @since 2.0.0\n */\nexport var apSecond = function (fb) {\n    return flow(map(function () { return function (b) { return b; }; }), ap(fb));\n};\n/**\n * Wrap a value into the type constructor.\n *\n * Equivalent to [`right`](#right).\n *\n * @example\n * import * as E from 'fp-ts/Either'\n *\n * assert.deepStrictEqual(E.of('a'), E.right('a'))\n *\n * @category Applicative\n * @since 2.7.0\n */\nexport var of = right;\n/**\n * Less strict version of [`chain`](#chain).\n *\n * @category Monad\n * @since 2.6.0\n */\nexport var chainW = function (f) { return function (ma) {\n    return isLeft(ma) ? ma : f(ma.right);\n}; };\n/**\n * Composes computations in sequence, using the return value of one computation to determine the next computation.\n *\n * @category Monad\n * @since 2.0.0\n */\nexport var chain = chainW;\n/**\n * Less strict version of [`chainFirst`](#chainFirst)\n *\n * Derivable from `Monad`.\n *\n * @category combinators\n * @since 2.8.0\n */\nexport var chainFirstW = function (f) { return function (ma) {\n    return pipe(ma, chainW(function (a) {\n        return pipe(f(a), map(function () { return a; }));\n    }));\n}; };\n/**\n * Composes computations in sequence, using the return value of one computation to determine the next computation and\n * keeping only the result of the first.\n *\n * Derivable from `Monad`.\n *\n * @category combinators\n * @since 2.0.0\n */\nexport var chainFirst = chainFirstW;\n/**\n * The `flatten` function is the conventional monad join operator. It is used to remove one level of monadic structure, projecting its bound argument into the outer level.\n *\n * Derivable from `Monad`.\n *\n * @example\n * import * as E from 'fp-ts/Either'\n *\n * assert.deepStrictEqual(E.flatten(E.right(E.right('a'))), E.right('a'))\n * assert.deepStrictEqual(E.flatten(E.right(E.left('e'))), E.left('e'))\n * assert.deepStrictEqual(E.flatten(E.left('e')), E.left('e'))\n *\n * @category combinators\n * @since 2.0.0\n */\nexport var flatten = \n/*#__PURE__*/\nchain(identity);\n/**\n * Less strict version of [`alt`](#alt).\n *\n * @category Alt\n * @since 2.9.0\n */\nexport var altW = function (that) { return function (fa) { return (isLeft(fa) ? that() : fa); }; };\n/**\n * Identifies an associative operation on a type constructor. It is similar to `Semigroup`, except that it applies to\n * types of kind `* -> *`.\n *\n * @category Alt\n * @since 2.0.0\n */\nexport var alt = altW;\n/**\n * @category Extend\n * @since 2.0.0\n */\nexport var extend = function (f) { return function (wa) {\n    return isLeft(wa) ? wa : right(f(wa));\n}; };\n/**\n * Derivable from `Extend`.\n *\n * @category combinators\n * @since 2.0.0\n */\nexport var duplicate = \n/*#__PURE__*/\nextend(identity);\n/**\n * Left-associative fold of a structure.\n *\n * @example\n * import { pipe } from 'fp-ts/function'\n * import * as E from 'fp-ts/Either'\n *\n * const startWith = 'prefix'\n * const concat = (a: string, b: string) => `${a}:${b}`\n *\n * assert.deepStrictEqual(\n *   pipe(E.right('a'), E.reduce(startWith, concat)),\n *   'prefix:a',\n * )\n *\n * assert.deepStrictEqual(\n *   pipe(E.left('e'), E.reduce(startWith, concat)),\n *   'prefix',\n * )\n *\n * @category Foldable\n * @since 2.0.0\n */\nexport var reduce = function (b, f) { return function (fa) {\n    return isLeft(fa) ? b : f(b, fa.right);\n}; };\n/**\n * Map each element of the structure to a monoid, and combine the results.\n *\n * @example\n * import { pipe } from 'fp-ts/function';\n * import * as E from 'fp-ts/Either'\n * import { monoidString } from 'fp-ts/Monoid'\n *\n * const yell = (a: string) => `${a}!`\n *\n * assert.deepStrictEqual(\n *   pipe(E.right('a'), E.foldMap(monoidString)(yell)),\n *   'a!',\n * )\n *\n * assert.deepStrictEqual(\n *   pipe(E.left('e'), E.foldMap(monoidString)(yell)),\n *   monoidString.empty,\n * )\n *\n * @category Foldable\n * @since 2.0.0\n */\nexport var foldMap = function (M) { return function (f) { return function (fa) {\n    return isLeft(fa) ? M.empty : f(fa.right);\n}; }; };\n/**\n * Right-associative fold of a structure.\n *\n * @example\n * import { pipe } from 'fp-ts/function'\n * import * as E from 'fp-ts/Either'\n *\n * const startWith = 'postfix'\n * const concat = (a: string, b: string) => `${a}:${b}`\n *\n * assert.deepStrictEqual(\n *   pipe(E.right('a'), E.reduceRight(startWith, concat)),\n *   'a:postfix',\n * )\n *\n * assert.deepStrictEqual(\n *   pipe(E.left('e'), E.reduceRight(startWith, concat)),\n *   'postfix',\n * )\n *\n * @category Foldable\n * @since 2.0.0\n */\nexport var reduceRight = function (b, f) { return function (fa) {\n    return isLeft(fa) ? b : f(fa.right, b);\n}; };\n/**\n * Map each element of a structure to an action, evaluate these actions from left to right, and collect the results.\n *\n * @example\n * import { pipe } from 'fp-ts/function'\n * import * as A from 'fp-ts/Array'\n * import * as E from 'fp-ts/Either'\n * import * as O from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(\n *   pipe(E.right(['a']), E.traverse(O.option)(A.head)),\n *   O.some(E.right('a')),\n *  )\n *\n * assert.deepStrictEqual(\n *   pipe(E.right([]), E.traverse(O.option)(A.head)),\n *   O.none,\n * )\n *\n * @category Traversable\n * @since 2.6.3\n */\nexport var traverse = function (F) { return function (f) { return function (ta) { return (isLeft(ta) ? F.of(left(ta.left)) : F.map(f(ta.right), right)); }; }; };\n/**\n * Evaluate each monadic action in the structure from left to right, and collect the results.\n *\n * @example\n * import { pipe } from 'fp-ts/function'\n * import * as E from 'fp-ts/Either'\n * import * as O from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(\n *   pipe(E.right(O.some('a')), E.sequence(O.option)),\n *   O.some(E.right('a')),\n *  )\n *\n * assert.deepStrictEqual(\n *   pipe(E.right(O.none), E.sequence(O.option)),\n *   O.none\n * )\n *\n * @category Traversable\n * @since 2.6.3\n */\nexport var sequence = function (F) { return function (ma) {\n    return isLeft(ma) ? F.of(left(ma.left)) : F.map(ma.right, right);\n}; };\n/**\n * @category MonadThrow\n * @since 2.6.3\n */\nexport var throwError = left;\n// -------------------------------------------------------------------------------------\n// instances\n// -------------------------------------------------------------------------------------\n/**\n * @category instances\n * @since 2.0.0\n */\nexport var URI = 'Either';\n/**\n * @category instances\n * @since 2.0.0\n */\nexport function getShow(SE, SA) {\n    return {\n        show: function (ma) { return (isLeft(ma) ? \"left(\" + SE.show(ma.left) + \")\" : \"right(\" + SA.show(ma.right) + \")\"); }\n    };\n}\n/**\n * @category instances\n * @since 2.0.0\n */\nexport function getEq(EL, EA) {\n    return {\n        equals: function (x, y) {\n            return x === y || (isLeft(x) ? isLeft(y) && EL.equals(x.left, y.left) : isRight(y) && EA.equals(x.right, y.right));\n        }\n    };\n}\n/**\n * Semigroup returning the left-most non-`Left` value. If both operands are `Right`s then the inner values are\n * concatenated using the provided `Semigroup`\n *\n * @example\n * import { getSemigroup, left, right } from 'fp-ts/Either'\n * import { semigroupSum } from 'fp-ts/Semigroup'\n *\n * const S = getSemigroup<string, number>(semigroupSum)\n * assert.deepStrictEqual(S.concat(left('a'), left('b')), left('a'))\n * assert.deepStrictEqual(S.concat(left('a'), right(2)), right(2))\n * assert.deepStrictEqual(S.concat(right(1), left('b')), right(1))\n * assert.deepStrictEqual(S.concat(right(1), right(2)), right(3))\n *\n * @category instances\n * @since 2.0.0\n */\nexport function getSemigroup(S) {\n    return {\n        concat: function (x, y) { return (isLeft(y) ? x : isLeft(x) ? y : right(S.concat(x.right, y.right))); }\n    };\n}\n/**\n * Semigroup returning the left-most `Left` value. If both operands are `Right`s then the inner values\n * are concatenated using the provided `Semigroup`\n *\n * @example\n * import { getApplySemigroup, left, right } from 'fp-ts/Either'\n * import { semigroupSum } from 'fp-ts/Semigroup'\n *\n * const S = getApplySemigroup<string, number>(semigroupSum)\n * assert.deepStrictEqual(S.concat(left('a'), left('b')), left('a'))\n * assert.deepStrictEqual(S.concat(left('a'), right(2)), left('a'))\n * assert.deepStrictEqual(S.concat(right(1), left('b')), left('b'))\n * assert.deepStrictEqual(S.concat(right(1), right(2)), right(3))\n *\n * @category instances\n * @since 2.0.0\n */\nexport function getApplySemigroup(S) {\n    return {\n        concat: function (x, y) { return (isLeft(x) ? x : isLeft(y) ? y : right(S.concat(x.right, y.right))); }\n    };\n}\n/**\n * @category instances\n * @since 2.0.0\n */\nexport function getApplyMonoid(M) {\n    return {\n        concat: getApplySemigroup(M).concat,\n        empty: right(M.empty)\n    };\n}\n/**\n * Builds a `Filterable` instance for `Either` given `Monoid` for the left side\n *\n * @category instances\n * @since 3.0.0\n */\nexport function getFilterable(M) {\n    var empty = left(M.empty);\n    var compact = function (ma) {\n        return isLeft(ma) ? ma : ma.right._tag === 'None' ? empty : right(ma.right.value);\n    };\n    var separate = function (ma) {\n        return isLeft(ma)\n            ? { left: ma, right: ma }\n            : isLeft(ma.right)\n                ? { left: right(ma.right.left), right: empty }\n                : { left: empty, right: right(ma.right.right) };\n    };\n    var partitionMap = function (ma, f) {\n        if (isLeft(ma)) {\n            return { left: ma, right: ma };\n        }\n        var e = f(ma.right);\n        return isLeft(e) ? { left: right(e.left), right: empty } : { left: empty, right: right(e.right) };\n    };\n    var partition = function (ma, p) {\n        return isLeft(ma)\n            ? { left: ma, right: ma }\n            : p(ma.right)\n                ? { left: empty, right: right(ma.right) }\n                : { left: right(ma.right), right: empty };\n    };\n    var filterMap = function (ma, f) {\n        if (isLeft(ma)) {\n            return ma;\n        }\n        var ob = f(ma.right);\n        return ob._tag === 'None' ? empty : right(ob.value);\n    };\n    var filter = function (ma, predicate) {\n        return isLeft(ma) ? ma : predicate(ma.right) ? ma : empty;\n    };\n    return {\n        URI: URI,\n        _E: undefined,\n        map: map_,\n        compact: compact,\n        separate: separate,\n        filter: filter,\n        filterMap: filterMap,\n        partition: partition,\n        partitionMap: partitionMap\n    };\n}\n/**\n * Builds `Witherable` instance for `Either` given `Monoid` for the left side\n *\n * @category instances\n * @since 2.0.0\n */\nexport function getWitherable(M) {\n    var F_ = getFilterable(M);\n    var wither = function (F) {\n        var traverseF = traverse_(F);\n        return function (ma, f) { return F.map(traverseF(ma, f), F_.compact); };\n    };\n    var wilt = function (F) {\n        var traverseF = traverse_(F);\n        return function (ma, f) { return F.map(traverseF(ma, f), F_.separate); };\n    };\n    return {\n        URI: URI,\n        _E: undefined,\n        map: map_,\n        compact: F_.compact,\n        separate: F_.separate,\n        filter: F_.filter,\n        filterMap: F_.filterMap,\n        partition: F_.partition,\n        partitionMap: F_.partitionMap,\n        traverse: traverse_,\n        sequence: sequence,\n        reduce: reduce_,\n        foldMap: foldMap_,\n        reduceRight: reduceRight_,\n        wither: wither,\n        wilt: wilt\n    };\n}\n/**\n * @category instances\n * @since 2.7.0\n */\nexport function getApplicativeValidation(SE) {\n    return {\n        URI: URI,\n        _E: undefined,\n        map: map_,\n        ap: function (fab, fa) {\n            return isLeft(fab)\n                ? isLeft(fa)\n                    ? left(SE.concat(fab.left, fa.left))\n                    : fab\n                : isLeft(fa)\n                    ? fa\n                    : right(fab.right(fa.right));\n        },\n        of: of\n    };\n}\n/**\n * @category instances\n * @since 2.7.0\n */\nexport function getAltValidation(SE) {\n    return {\n        URI: URI,\n        _E: undefined,\n        map: map_,\n        alt: function (me, that) {\n            if (isRight(me)) {\n                return me;\n            }\n            var ea = that();\n            return isLeft(ea) ? left(SE.concat(me.left, ea.left)) : ea;\n        }\n    };\n}\n// TODO: remove in v3\n/**\n * @category instances\n * @since 2.0.0\n */\nexport function getValidation(SE) {\n    var applicativeValidation = getApplicativeValidation(SE);\n    var altValidation = getAltValidation(SE);\n    return {\n        URI: URI,\n        _E: undefined,\n        map: map_,\n        of: of,\n        chain: chain_,\n        bimap: bimap_,\n        mapLeft: mapLeft_,\n        reduce: reduce_,\n        foldMap: foldMap_,\n        reduceRight: reduceRight_,\n        extend: extend_,\n        traverse: traverse_,\n        sequence: sequence,\n        chainRec: chainRec_,\n        throwError: throwError,\n        ap: applicativeValidation.ap,\n        alt: altValidation.alt\n    };\n}\n/**\n * @category instances\n * @since 2.0.0\n */\nexport function getValidationSemigroup(SE, SA) {\n    return {\n        concat: function (x, y) {\n            return isLeft(x) ? (isLeft(y) ? left(SE.concat(x.left, y.left)) : x) : isLeft(y) ? y : right(SA.concat(x.right, y.right));\n        }\n    };\n}\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var Functor = {\n    URI: URI,\n    map: map_\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var Applicative = {\n    URI: URI,\n    map: map_,\n    ap: ap_,\n    of: of\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var Monad = {\n    URI: URI,\n    map: map_,\n    ap: ap_,\n    of: of,\n    chain: chain_\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var Foldable = {\n    URI: URI,\n    reduce: reduce_,\n    foldMap: foldMap_,\n    reduceRight: reduceRight_\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var Traversable = {\n    URI: URI,\n    map: map_,\n    reduce: reduce_,\n    foldMap: foldMap_,\n    reduceRight: reduceRight_,\n    traverse: traverse_,\n    sequence: sequence\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var Bifunctor = {\n    URI: URI,\n    bimap: bimap_,\n    mapLeft: mapLeft_\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var Alt = {\n    URI: URI,\n    map: map_,\n    alt: alt_\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var Extend = {\n    URI: URI,\n    map: map_,\n    extend: extend_\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var ChainRec = {\n    URI: URI,\n    map: map_,\n    ap: ap_,\n    chain: chain_,\n    chainRec: chainRec_\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexport var MonadThrow = {\n    URI: URI,\n    map: map_,\n    ap: ap_,\n    of: of,\n    chain: chain_,\n    throwError: throwError\n};\n/**\n * @category instances\n * @since 2.0.0\n */\nexport function getValidationMonoid(SE, SA) {\n    return {\n        concat: getValidationSemigroup(SE, SA).concat,\n        empty: right(SA.empty)\n    };\n}\n/**\n * @category instances\n * @since 2.0.0\n */\nexport var either = {\n    URI: URI,\n    map: map_,\n    of: of,\n    ap: ap_,\n    chain: chain_,\n    reduce: reduce_,\n    foldMap: foldMap_,\n    reduceRight: reduceRight_,\n    traverse: traverse_,\n    sequence: sequence,\n    bimap: bimap_,\n    mapLeft: mapLeft_,\n    alt: alt_,\n    extend: extend_,\n    chainRec: chainRec_,\n    throwError: throwError\n};\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * Default value for the `onError` argument of `tryCatch`\n *\n * @since 2.0.0\n */\nexport function toError(e) {\n    return e instanceof Error ? e : new Error(String(e));\n}\n/**\n * @since 2.0.0\n */\nexport function elem(E) {\n    return function (a, ma) { return (isLeft(ma) ? false : E.equals(a, ma.right)); };\n}\n/**\n * Returns `false` if `Left` or returns the result of the application of the given predicate to the `Right` value.\n *\n * @example\n * import { exists, left, right } from 'fp-ts/Either'\n *\n * const gt2 = exists((n: number) => n > 2)\n *\n * assert.strictEqual(gt2(left('a')), false)\n * assert.strictEqual(gt2(right(1)), false)\n * assert.strictEqual(gt2(right(3)), true)\n *\n * @since 2.0.0\n */\nexport function exists(predicate) {\n    return function (ma) { return (isLeft(ma) ? false : predicate(ma.right)); };\n}\n// -------------------------------------------------------------------------------------\n// do notation\n// -------------------------------------------------------------------------------------\n/**\n * @since 2.9.0\n */\nexport var Do = \n/*#__PURE__*/\nof({});\n/**\n * @since 2.8.0\n */\nexport var bindTo = function (name) {\n    return map(bindTo_(name));\n};\n/**\n * @since 2.8.0\n */\nexport var bindW = function (name, f) {\n    return chainW(function (a) {\n        return pipe(f(a), map(function (b) { return bind_(a, name, b); }));\n    });\n};\n/**\n * @since 2.8.0\n */\nexport var bind = bindW;\n// -------------------------------------------------------------------------------------\n// pipeable sequence S\n// -------------------------------------------------------------------------------------\n/**\n * @since 2.8.0\n */\nexport var apSW = function (name, fb) {\n    return flow(map(function (a) { return function (b) { return bind_(a, name, b); }; }), apW(fb));\n};\n/**\n * @since 2.8.0\n */\nexport var apS = apSW;\n// -------------------------------------------------------------------------------------\n// array utils\n// -------------------------------------------------------------------------------------\n/**\n *\n * @since 2.9.0\n */\nexport var traverseArrayWithIndex = function (f) { return function (arr) {\n    // tslint:disable-next-line: readonly-array\n    var result = [];\n    for (var i = 0; i < arr.length; i++) {\n        var e = f(i, arr[i]);\n        if (e._tag === 'Left') {\n            return e;\n        }\n        result.push(e.right);\n    }\n    return right(result);\n}; };\n/**\n * map an array using provided function to Either then transform to Either of the array\n * this function has the same behavior of `A.traverse(E.either)` but it's optimized and performs better\n *\n * @example\n *\n *\n * import { traverseArray, left, right, fromPredicate } from 'fp-ts/Either'\n * import { pipe } from 'fp-ts/function'\n * import * as A from 'fp-ts/Array'\n *\n * const arr = A.range(0, 10)\n * assert.deepStrictEqual(\n *   pipe(\n *     arr,\n *     traverseArray((x) => right(x))\n *   ),\n *   right(arr)\n * )\n * assert.deepStrictEqual(\n *   pipe(\n *     arr,\n *     traverseArray(\n *       fromPredicate(\n *         (x) => x > 5,\n *         () => 'a'\n *       )\n *     )\n *   ),\n *   left('a')\n * )\n * @since 2.9.0\n */\nexport var traverseArray = function (f) { return traverseArrayWithIndex(function (_, a) { return f(a); }); };\n/**\n * convert an array of either to an either of array\n * this function has the same behavior of `A.sequence(E.either)` but it's optimized and performs better\n *\n * @example\n *\n * import { sequenceArray, left, right } from 'fp-ts/Either'\n * import { pipe } from 'fp-ts/function'\n * import * as A from 'fp-ts/Array'\n *\n * const arr = A.range(0, 10)\n * assert.deepStrictEqual(pipe(arr, A.map(right), sequenceArray), right(arr))\n * assert.deepStrictEqual(pipe(arr, A.map(right), A.cons(left('Error')), sequenceArray), left('Error'))\n *\n * @since 2.9.0\n */\nexport var sequenceArray = \n/*#__PURE__*/\ntraverseArray(identity);\n", "var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\n/**\n * @since 1.0.0\n */\nimport { isLeft, left, right } from 'fp-ts/es6/Either';\n/**\n * @category Decode error\n * @since 1.0.0\n */\nexport var failures = left;\n/**\n * @category Decode error\n * @since 1.0.0\n */\nexport var failure = function (value, context, message) {\n    return failures([{ value: value, context: context, message: message }]);\n};\n/**\n * @category Decode error\n * @since 1.0.0\n */\nexport var success = right;\n/**\n * @category Codec\n * @since 1.0.0\n */\nvar Type = /** @class */ (function () {\n    function Type(\n    /** a unique name for this codec */\n    name, \n    /** a custom type guard */\n    is, \n    /** succeeds if a value of type I can be decoded to a value of type A */\n    validate, \n    /** converts a value of type A to a value of type O */\n    encode) {\n        this.name = name;\n        this.is = is;\n        this.validate = validate;\n        this.encode = encode;\n        this.decode = this.decode.bind(this);\n    }\n    /**\n     * @since 1.0.0\n     */\n    Type.prototype.pipe = function (ab, name) {\n        var _this = this;\n        if (name === void 0) { name = \"pipe(\" + this.name + \", \" + ab.name + \")\"; }\n        return new Type(name, ab.is, function (i, c) {\n            var e = _this.validate(i, c);\n            if (isLeft(e)) {\n                return e;\n            }\n            return ab.validate(e.right, c);\n        }, this.encode === identity && ab.encode === identity ? identity : function (b) { return _this.encode(ab.encode(b)); });\n    };\n    /**\n     * @since 1.0.0\n     */\n    Type.prototype.asDecoder = function () {\n        return this;\n    };\n    /**\n     * @since 1.0.0\n     */\n    Type.prototype.asEncoder = function () {\n        return this;\n    };\n    /**\n     * a version of `validate` with a default context\n     * @since 1.0.0\n     */\n    Type.prototype.decode = function (i) {\n        return this.validate(i, [{ key: '', type: this, actual: i }]);\n    };\n    return Type;\n}());\nexport { Type };\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * @since 1.0.0\n */\nexport var identity = function (a) { return a; };\n/**\n * @since 1.0.0\n */\nexport function getFunctionName(f) {\n    return f.displayName || f.name || \"<function\" + f.length + \">\";\n}\n/**\n * @since 1.0.0\n */\nexport function getContextEntry(key, decoder) {\n    return { key: key, type: decoder };\n}\n/**\n * @since 1.0.0\n */\nexport function appendContext(c, key, decoder, actual) {\n    var len = c.length;\n    var r = Array(len + 1);\n    for (var i = 0; i < len; i++) {\n        r[i] = c[i];\n    }\n    r[len] = { key: key, type: decoder, actual: actual };\n    return r;\n}\nfunction pushAll(xs, ys) {\n    var l = ys.length;\n    for (var i = 0; i < l; i++) {\n        xs.push(ys[i]);\n    }\n}\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nfunction getNameFromProps(props) {\n    return Object.keys(props)\n        .map(function (k) { return k + \": \" + props[k].name; })\n        .join(', ');\n}\nfunction useIdentity(codecs) {\n    for (var i = 0; i < codecs.length; i++) {\n        if (codecs[i].encode !== identity) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction getInterfaceTypeName(props) {\n    return \"{ \" + getNameFromProps(props) + \" }\";\n}\nfunction getPartialTypeName(inner) {\n    return \"Partial<\" + inner + \">\";\n}\nfunction enumerableRecord(keys, domain, codomain, name) {\n    if (name === void 0) { name = \"{ [K in \" + domain.name + \"]: \" + codomain.name + \" }\"; }\n    var len = keys.length;\n    return new DictionaryType(name, function (u) { return UnknownRecord.is(u) && keys.every(function (k) { return codomain.is(u[k]); }); }, function (u, c) {\n        var e = UnknownRecord.validate(u, c);\n        if (isLeft(e)) {\n            return e;\n        }\n        var o = e.right;\n        var a = {};\n        var errors = [];\n        var changed = false;\n        for (var i = 0; i < len; i++) {\n            var k = keys[i];\n            var ok = o[k];\n            var codomainResult = codomain.validate(ok, appendContext(c, k, codomain, ok));\n            if (isLeft(codomainResult)) {\n                pushAll(errors, codomainResult.left);\n            }\n            else {\n                var vok = codomainResult.right;\n                changed = changed || vok !== ok;\n                a[k] = vok;\n            }\n        }\n        return errors.length > 0 ? failures(errors) : success((changed || Object.keys(o).length !== len ? a : o));\n    }, codomain.encode === identity\n        ? identity\n        : function (a) {\n            var s = {};\n            for (var i = 0; i < len; i++) {\n                var k = keys[i];\n                s[k] = codomain.encode(a[k]);\n            }\n            return s;\n        }, domain, codomain);\n}\n/**\n * @internal\n */\nexport function getDomainKeys(domain) {\n    var _a;\n    if (isLiteralC(domain)) {\n        var literal_1 = domain.value;\n        if (string.is(literal_1)) {\n            return _a = {}, _a[literal_1] = null, _a;\n        }\n    }\n    else if (isKeyofC(domain)) {\n        return domain.keys;\n    }\n    else if (isUnionC(domain)) {\n        var keys = domain.types.map(function (type) { return getDomainKeys(type); });\n        return keys.some(undefinedType.is) ? undefined : Object.assign.apply(Object, __spreadArrays([{}], keys));\n    }\n    return undefined;\n}\nfunction nonEnumerableRecord(domain, codomain, name) {\n    if (name === void 0) { name = \"{ [K in \" + domain.name + \"]: \" + codomain.name + \" }\"; }\n    return new DictionaryType(name, function (u) {\n        if (UnknownRecord.is(u)) {\n            return Object.keys(u).every(function (k) { return domain.is(k) && codomain.is(u[k]); });\n        }\n        return isAnyC(codomain) && Array.isArray(u);\n    }, function (u, c) {\n        if (UnknownRecord.is(u)) {\n            var a = {};\n            var errors = [];\n            var keys = Object.keys(u);\n            var len = keys.length;\n            var changed = false;\n            for (var i = 0; i < len; i++) {\n                var k = keys[i];\n                var ok = u[k];\n                var domainResult = domain.validate(k, appendContext(c, k, domain, k));\n                if (isLeft(domainResult)) {\n                    pushAll(errors, domainResult.left);\n                }\n                else {\n                    var vk = domainResult.right;\n                    changed = changed || vk !== k;\n                    k = vk;\n                    var codomainResult = codomain.validate(ok, appendContext(c, k, codomain, ok));\n                    if (isLeft(codomainResult)) {\n                        pushAll(errors, codomainResult.left);\n                    }\n                    else {\n                        var vok = codomainResult.right;\n                        changed = changed || vok !== ok;\n                        a[k] = vok;\n                    }\n                }\n            }\n            return errors.length > 0 ? failures(errors) : success((changed ? a : u));\n        }\n        if (isAnyC(codomain) && Array.isArray(u)) {\n            return success(u);\n        }\n        return failure(u, c);\n    }, domain.encode === identity && codomain.encode === identity\n        ? identity\n        : function (a) {\n            var s = {};\n            var keys = Object.keys(a);\n            var len = keys.length;\n            for (var i = 0; i < len; i++) {\n                var k = keys[i];\n                s[String(domain.encode(k))] = codomain.encode(a[k]);\n            }\n            return s;\n        }, domain, codomain);\n}\nfunction getUnionName(codecs) {\n    return '(' + codecs.map(function (type) { return type.name; }).join(' | ') + ')';\n}\n/**\n * @internal\n */\nexport function mergeAll(base, us) {\n    var equal = true;\n    var primitive = true;\n    var baseIsNotADictionary = !UnknownRecord.is(base);\n    for (var _i = 0, us_1 = us; _i < us_1.length; _i++) {\n        var u = us_1[_i];\n        if (u !== base) {\n            equal = false;\n        }\n        if (UnknownRecord.is(u)) {\n            primitive = false;\n        }\n    }\n    if (equal) {\n        return base;\n    }\n    else if (primitive) {\n        return us[us.length - 1];\n    }\n    var r = {};\n    for (var _a = 0, us_2 = us; _a < us_2.length; _a++) {\n        var u = us_2[_a];\n        for (var k in u) {\n            if (!r.hasOwnProperty(k) || baseIsNotADictionary || u[k] !== base[k]) {\n                r[k] = u[k];\n            }\n        }\n    }\n    return r;\n}\nfunction getProps(codec) {\n    switch (codec._tag) {\n        case 'RefinementType':\n        case 'ReadonlyType':\n            return getProps(codec.type);\n        case 'InterfaceType':\n        case 'StrictType':\n        case 'PartialType':\n            return codec.props;\n        case 'IntersectionType':\n            return codec.types.reduce(function (props, type) { return Object.assign(props, getProps(type)); }, {});\n    }\n}\nfunction stripKeys(o, props) {\n    var keys = Object.getOwnPropertyNames(o);\n    var shouldStrip = false;\n    var r = {};\n    for (var i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        if (!hasOwnProperty.call(props, key)) {\n            shouldStrip = true;\n        }\n        else {\n            r[key] = o[key];\n        }\n    }\n    return shouldStrip ? r : o;\n}\nfunction getExactTypeName(codec) {\n    if (isTypeC(codec)) {\n        return \"{| \" + getNameFromProps(codec.props) + \" |}\";\n    }\n    else if (isPartialC(codec)) {\n        return getPartialTypeName(\"{| \" + getNameFromProps(codec.props) + \" |}\");\n    }\n    return \"Exact<\" + codec.name + \">\";\n}\nfunction isNonEmpty(as) {\n    return as.length > 0;\n}\n/**\n * @internal\n */\nexport var emptyTags = {};\nfunction intersect(a, b) {\n    var r = [];\n    for (var _i = 0, a_1 = a; _i < a_1.length; _i++) {\n        var v = a_1[_i];\n        if (b.indexOf(v) !== -1) {\n            r.push(v);\n        }\n    }\n    return r;\n}\nfunction mergeTags(a, b) {\n    if (a === emptyTags) {\n        return b;\n    }\n    if (b === emptyTags) {\n        return a;\n    }\n    var r = Object.assign({}, a);\n    for (var k in b) {\n        if (a.hasOwnProperty(k)) {\n            var intersection_1 = intersect(a[k], b[k]);\n            if (isNonEmpty(intersection_1)) {\n                r[k] = intersection_1;\n            }\n            else {\n                r = emptyTags;\n                break;\n            }\n        }\n        else {\n            r[k] = b[k];\n        }\n    }\n    return r;\n}\nfunction intersectTags(a, b) {\n    if (a === emptyTags || b === emptyTags) {\n        return emptyTags;\n    }\n    var r = emptyTags;\n    for (var k in a) {\n        if (b.hasOwnProperty(k)) {\n            var intersection_2 = intersect(a[k], b[k]);\n            if (intersection_2.length === 0) {\n                if (r === emptyTags) {\n                    r = {};\n                }\n                r[k] = a[k].concat(b[k]);\n            }\n        }\n    }\n    return r;\n}\n// tslint:disable-next-line: deprecation\nfunction isAnyC(codec) {\n    return codec._tag === 'AnyType';\n}\nfunction isLiteralC(codec) {\n    return codec._tag === 'LiteralType';\n}\nfunction isKeyofC(codec) {\n    return codec._tag === 'KeyofType';\n}\nfunction isTypeC(codec) {\n    return codec._tag === 'InterfaceType';\n}\nfunction isPartialC(codec) {\n    return codec._tag === 'PartialType';\n}\n// tslint:disable-next-line: deprecation\nfunction isStrictC(codec) {\n    return codec._tag === 'StrictType';\n}\nfunction isExactC(codec) {\n    return codec._tag === 'ExactType';\n}\n// tslint:disable-next-line: deprecation\nfunction isRefinementC(codec) {\n    return codec._tag === 'RefinementType';\n}\nfunction isIntersectionC(codec) {\n    return codec._tag === 'IntersectionType';\n}\nfunction isUnionC(codec) {\n    return codec._tag === 'UnionType';\n}\nfunction isRecursiveC(codec) {\n    return codec._tag === 'RecursiveType';\n}\nvar lazyCodecs = [];\n/**\n * @internal\n */\nexport function getTags(codec) {\n    if (lazyCodecs.indexOf(codec) !== -1) {\n        return emptyTags;\n    }\n    if (isTypeC(codec) || isStrictC(codec)) {\n        var index = emptyTags;\n        // tslint:disable-next-line: forin\n        for (var k in codec.props) {\n            var prop = codec.props[k];\n            if (isLiteralC(prop)) {\n                if (index === emptyTags) {\n                    index = {};\n                }\n                index[k] = [prop.value];\n            }\n        }\n        return index;\n    }\n    else if (isExactC(codec) || isRefinementC(codec)) {\n        return getTags(codec.type);\n    }\n    else if (isIntersectionC(codec)) {\n        return codec.types.reduce(function (tags, codec) { return mergeTags(tags, getTags(codec)); }, emptyTags);\n    }\n    else if (isUnionC(codec)) {\n        return codec.types.slice(1).reduce(function (tags, codec) { return intersectTags(tags, getTags(codec)); }, getTags(codec.types[0]));\n    }\n    else if (isRecursiveC(codec)) {\n        lazyCodecs.push(codec);\n        var tags = getTags(codec.type);\n        lazyCodecs.pop();\n        return tags;\n    }\n    return emptyTags;\n}\n/**\n * @internal\n */\nexport function getIndex(codecs) {\n    var tags = getTags(codecs[0]);\n    var keys = Object.keys(tags);\n    var len = codecs.length;\n    var _loop_1 = function (k) {\n        var all = tags[k].slice();\n        var index = [tags[k]];\n        for (var i = 1; i < len; i++) {\n            var codec = codecs[i];\n            var ctags = getTags(codec);\n            var values = ctags[k];\n            // tslint:disable-next-line: strict-type-predicates\n            if (values === undefined) {\n                return \"continue-keys\";\n            }\n            else {\n                if (values.some(function (v) { return all.indexOf(v) !== -1; })) {\n                    return \"continue-keys\";\n                }\n                else {\n                    all.push.apply(all, values);\n                    index.push(values);\n                }\n            }\n        }\n        return { value: [k, index] };\n    };\n    keys: for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n        var k = keys_1[_i];\n        var state_1 = _loop_1(k);\n        if (typeof state_1 === \"object\")\n            return state_1.value;\n        switch (state_1) {\n            case \"continue-keys\": continue keys;\n        }\n    }\n    return undefined;\n}\n// -------------------------------------------------------------------------------------\n// primitives\n// -------------------------------------------------------------------------------------\n/**\n * @since 1.0.0\n */\nvar NullType = /** @class */ (function (_super) {\n    __extends(NullType, _super);\n    function NullType() {\n        var _this = _super.call(this, 'null', function (u) { return u === null; }, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'NullType';\n        return _this;\n    }\n    return NullType;\n}(Type));\nexport { NullType };\n/**\n * @category primitives\n * @since 1.0.0\n */\nexport var nullType = new NullType();\n/**\n * @since 1.0.0\n */\nvar UndefinedType = /** @class */ (function (_super) {\n    __extends(UndefinedType, _super);\n    function UndefinedType() {\n        var _this = _super.call(this, 'undefined', function (u) { return u === void 0; }, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'UndefinedType';\n        return _this;\n    }\n    return UndefinedType;\n}(Type));\nexport { UndefinedType };\nvar undefinedType = new UndefinedType();\n/**\n * @since 1.2.0\n */\nvar VoidType = /** @class */ (function (_super) {\n    __extends(VoidType, _super);\n    function VoidType() {\n        var _this = _super.call(this, 'void', undefinedType.is, undefinedType.validate, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'VoidType';\n        return _this;\n    }\n    return VoidType;\n}(Type));\nexport { VoidType };\n/**\n * @category primitives\n * @since 1.2.0\n */\nexport var voidType = new VoidType();\n/**\n * @since 1.5.0\n */\nvar UnknownType = /** @class */ (function (_super) {\n    __extends(UnknownType, _super);\n    function UnknownType() {\n        var _this = _super.call(this, 'unknown', function (_) { return true; }, success, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'UnknownType';\n        return _this;\n    }\n    return UnknownType;\n}(Type));\nexport { UnknownType };\n/**\n * @category primitives\n * @since 1.5.0\n */\nexport var unknown = new UnknownType();\n/**\n * @since 1.0.0\n */\nvar StringType = /** @class */ (function (_super) {\n    __extends(StringType, _super);\n    function StringType() {\n        var _this = _super.call(this, 'string', function (u) { return typeof u === 'string'; }, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'StringType';\n        return _this;\n    }\n    return StringType;\n}(Type));\nexport { StringType };\n/**\n * @category primitives\n * @since 1.0.0\n */\nexport var string = new StringType();\n/**\n * @since 1.0.0\n */\nvar NumberType = /** @class */ (function (_super) {\n    __extends(NumberType, _super);\n    function NumberType() {\n        var _this = _super.call(this, 'number', function (u) { return typeof u === 'number'; }, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'NumberType';\n        return _this;\n    }\n    return NumberType;\n}(Type));\nexport { NumberType };\n/**\n * @category primitives\n * @since 1.0.0\n */\nexport var number = new NumberType();\n/**\n * @since 2.1.0\n */\nvar BigIntType = /** @class */ (function (_super) {\n    __extends(BigIntType, _super);\n    function BigIntType() {\n        var _this = _super.call(this, 'bigint', \n        // tslint:disable-next-line: valid-typeof\n        function (u) { return typeof u === 'bigint'; }, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'BigIntType';\n        return _this;\n    }\n    return BigIntType;\n}(Type));\nexport { BigIntType };\n/**\n * @category primitives\n * @since 2.1.0\n */\nexport var bigint = new BigIntType();\n/**\n * @since 1.0.0\n */\nvar BooleanType = /** @class */ (function (_super) {\n    __extends(BooleanType, _super);\n    function BooleanType() {\n        var _this = _super.call(this, 'boolean', function (u) { return typeof u === 'boolean'; }, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'BooleanType';\n        return _this;\n    }\n    return BooleanType;\n}(Type));\nexport { BooleanType };\n/**\n * @category primitives\n * @since 1.0.0\n */\nexport var boolean = new BooleanType();\n/**\n * @since 1.0.0\n */\nvar AnyArrayType = /** @class */ (function (_super) {\n    __extends(AnyArrayType, _super);\n    function AnyArrayType() {\n        var _this = _super.call(this, 'UnknownArray', Array.isArray, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'AnyArrayType';\n        return _this;\n    }\n    return AnyArrayType;\n}(Type));\nexport { AnyArrayType };\n/**\n * @category primitives\n * @since 1.7.1\n */\nexport var UnknownArray = new AnyArrayType();\n/**\n * @since 1.0.0\n */\nvar AnyDictionaryType = /** @class */ (function (_super) {\n    __extends(AnyDictionaryType, _super);\n    function AnyDictionaryType() {\n        var _this = _super.call(this, 'UnknownRecord', function (u) {\n            var s = Object.prototype.toString.call(u);\n            return s === '[object Object]' || s === '[object Window]';\n        }, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'AnyDictionaryType';\n        return _this;\n    }\n    return AnyDictionaryType;\n}(Type));\nexport { AnyDictionaryType };\n/**\n * @category primitives\n * @since 1.7.1\n */\nexport var UnknownRecord = new AnyDictionaryType();\nexport { \n/**\n * @category primitives\n * @since 1.0.0\n */\nnullType as null, \n/**\n * @category primitives\n * @since 1.0.0\n */\nundefinedType as undefined, \n/**\n * @category primitives\n * @since 1.0.0\n */\nvoidType as void };\n/**\n * @since 1.0.0\n */\nvar LiteralType = /** @class */ (function (_super) {\n    __extends(LiteralType, _super);\n    function LiteralType(name, is, validate, encode, value) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.value = value;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'LiteralType';\n        return _this;\n    }\n    return LiteralType;\n}(Type));\nexport { LiteralType };\n/**\n * @category constructors\n * @since 1.0.0\n */\nexport function literal(value, name) {\n    if (name === void 0) { name = JSON.stringify(value); }\n    var is = function (u) { return u === value; };\n    return new LiteralType(name, is, function (u, c) { return (is(u) ? success(value) : failure(u, c)); }, identity, value);\n}\n/**\n * @since 1.0.0\n */\nvar KeyofType = /** @class */ (function (_super) {\n    __extends(KeyofType, _super);\n    function KeyofType(name, is, validate, encode, keys) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.keys = keys;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'KeyofType';\n        return _this;\n    }\n    return KeyofType;\n}(Type));\nexport { KeyofType };\n/**\n * @category constructors\n * @since 1.0.0\n */\nexport function keyof(keys, name) {\n    if (name === void 0) { name = Object.keys(keys)\n        .map(function (k) { return JSON.stringify(k); })\n        .join(' | '); }\n    var is = function (u) { return string.is(u) && hasOwnProperty.call(keys, u); };\n    return new KeyofType(name, is, function (u, c) { return (is(u) ? success(u) : failure(u, c)); }, identity, keys);\n}\n// -------------------------------------------------------------------------------------\n// combinators\n// -------------------------------------------------------------------------------------\n/**\n * @since 1.0.0\n */\nvar RefinementType = /** @class */ (function (_super) {\n    __extends(RefinementType, _super);\n    function RefinementType(name, is, validate, encode, type, predicate) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.type = type;\n        _this.predicate = predicate;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'RefinementType';\n        return _this;\n    }\n    return RefinementType;\n}(Type));\nexport { RefinementType };\n/**\n * @category combinators\n * @since 1.8.1\n */\nexport function brand(codec, predicate, name) {\n    // tslint:disable-next-line: deprecation\n    return refinement(codec, predicate, name);\n}\n/**\n * A branded codec representing an integer\n *\n * @category primitives\n * @since 1.8.1\n */\nexport var Int = brand(number, function (n) { return Number.isInteger(n); }, 'Int');\n/**\n * @since 1.0.0\n */\nvar RecursiveType = /** @class */ (function (_super) {\n    __extends(RecursiveType, _super);\n    function RecursiveType(name, is, validate, encode, runDefinition) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.runDefinition = runDefinition;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'RecursiveType';\n        return _this;\n    }\n    return RecursiveType;\n}(Type));\nexport { RecursiveType };\nObject.defineProperty(RecursiveType.prototype, 'type', {\n    get: function () {\n        return this.runDefinition();\n    },\n    enumerable: true,\n    configurable: true\n});\n/**\n * @category combinators\n * @since 1.0.0\n */\nexport function recursion(name, definition) {\n    var cache;\n    var runDefinition = function () {\n        if (!cache) {\n            cache = definition(Self);\n            cache.name = name;\n        }\n        return cache;\n    };\n    var Self = new RecursiveType(name, function (u) { return runDefinition().is(u); }, function (u, c) { return runDefinition().validate(u, c); }, function (a) { return runDefinition().encode(a); }, runDefinition);\n    return Self;\n}\n/**\n * @since 1.0.0\n */\nvar ArrayType = /** @class */ (function (_super) {\n    __extends(ArrayType, _super);\n    function ArrayType(name, is, validate, encode, type) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.type = type;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'ArrayType';\n        return _this;\n    }\n    return ArrayType;\n}(Type));\nexport { ArrayType };\n/**\n * @category combinators\n * @since 1.0.0\n */\nexport function array(item, name) {\n    if (name === void 0) { name = \"Array<\" + item.name + \">\"; }\n    return new ArrayType(name, function (u) { return UnknownArray.is(u) && u.every(item.is); }, function (u, c) {\n        var e = UnknownArray.validate(u, c);\n        if (isLeft(e)) {\n            return e;\n        }\n        var us = e.right;\n        var len = us.length;\n        var as = us;\n        var errors = [];\n        for (var i = 0; i < len; i++) {\n            var ui = us[i];\n            var result = item.validate(ui, appendContext(c, String(i), item, ui));\n            if (isLeft(result)) {\n                pushAll(errors, result.left);\n            }\n            else {\n                var ai = result.right;\n                if (ai !== ui) {\n                    if (as === us) {\n                        as = us.slice();\n                    }\n                    as[i] = ai;\n                }\n            }\n        }\n        return errors.length > 0 ? failures(errors) : success(as);\n    }, item.encode === identity ? identity : function (a) { return a.map(item.encode); }, item);\n}\n/**\n * @since 1.0.0\n */\nvar InterfaceType = /** @class */ (function (_super) {\n    __extends(InterfaceType, _super);\n    function InterfaceType(name, is, validate, encode, props) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.props = props;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'InterfaceType';\n        return _this;\n    }\n    return InterfaceType;\n}(Type));\nexport { InterfaceType };\n/**\n * @category combinators\n * @since 1.0.0\n */\nexport function type(props, name) {\n    if (name === void 0) { name = getInterfaceTypeName(props); }\n    var keys = Object.keys(props);\n    var types = keys.map(function (key) { return props[key]; });\n    var len = keys.length;\n    return new InterfaceType(name, function (u) {\n        if (UnknownRecord.is(u)) {\n            for (var i = 0; i < len; i++) {\n                var k = keys[i];\n                var uk = u[k];\n                if ((uk === undefined && !hasOwnProperty.call(u, k)) || !types[i].is(uk)) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        return false;\n    }, function (u, c) {\n        var e = UnknownRecord.validate(u, c);\n        if (isLeft(e)) {\n            return e;\n        }\n        var o = e.right;\n        var a = o;\n        var errors = [];\n        for (var i = 0; i < len; i++) {\n            var k = keys[i];\n            var ak = a[k];\n            var type_1 = types[i];\n            var result = type_1.validate(ak, appendContext(c, k, type_1, ak));\n            if (isLeft(result)) {\n                pushAll(errors, result.left);\n            }\n            else {\n                var vak = result.right;\n                if (vak !== ak || (vak === undefined && !hasOwnProperty.call(a, k))) {\n                    /* istanbul ignore next */\n                    if (a === o) {\n                        a = __assign({}, o);\n                    }\n                    a[k] = vak;\n                }\n            }\n        }\n        return errors.length > 0 ? failures(errors) : success(a);\n    }, useIdentity(types)\n        ? identity\n        : function (a) {\n            var s = __assign({}, a);\n            for (var i = 0; i < len; i++) {\n                var k = keys[i];\n                var encode = types[i].encode;\n                if (encode !== identity) {\n                    s[k] = encode(a[k]);\n                }\n            }\n            return s;\n        }, props);\n}\n/**\n * @since 1.0.0\n */\nvar PartialType = /** @class */ (function (_super) {\n    __extends(PartialType, _super);\n    function PartialType(name, is, validate, encode, props) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.props = props;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'PartialType';\n        return _this;\n    }\n    return PartialType;\n}(Type));\nexport { PartialType };\n/**\n * @category combinators\n * @since 1.0.0\n */\nexport function partial(props, name) {\n    if (name === void 0) { name = getPartialTypeName(getInterfaceTypeName(props)); }\n    var keys = Object.keys(props);\n    var types = keys.map(function (key) { return props[key]; });\n    var len = keys.length;\n    return new PartialType(name, function (u) {\n        if (UnknownRecord.is(u)) {\n            for (var i = 0; i < len; i++) {\n                var k = keys[i];\n                var uk = u[k];\n                if (uk !== undefined && !props[k].is(uk)) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        return false;\n    }, function (u, c) {\n        var e = UnknownRecord.validate(u, c);\n        if (isLeft(e)) {\n            return e;\n        }\n        var o = e.right;\n        var a = o;\n        var errors = [];\n        for (var i = 0; i < len; i++) {\n            var k = keys[i];\n            var ak = a[k];\n            var type_2 = props[k];\n            var result = type_2.validate(ak, appendContext(c, k, type_2, ak));\n            if (isLeft(result)) {\n                if (ak !== undefined) {\n                    pushAll(errors, result.left);\n                }\n            }\n            else {\n                var vak = result.right;\n                if (vak !== ak) {\n                    /* istanbul ignore next */\n                    if (a === o) {\n                        a = __assign({}, o);\n                    }\n                    a[k] = vak;\n                }\n            }\n        }\n        return errors.length > 0 ? failures(errors) : success(a);\n    }, useIdentity(types)\n        ? identity\n        : function (a) {\n            var s = __assign({}, a);\n            for (var i = 0; i < len; i++) {\n                var k = keys[i];\n                var ak = a[k];\n                if (ak !== undefined) {\n                    s[k] = types[i].encode(ak);\n                }\n            }\n            return s;\n        }, props);\n}\n/**\n * @since 1.0.0\n */\nvar DictionaryType = /** @class */ (function (_super) {\n    __extends(DictionaryType, _super);\n    function DictionaryType(name, is, validate, encode, domain, codomain) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.domain = domain;\n        _this.codomain = codomain;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'DictionaryType';\n        return _this;\n    }\n    return DictionaryType;\n}(Type));\nexport { DictionaryType };\n/**\n * @category combinators\n * @since 1.7.1\n */\nexport function record(domain, codomain, name) {\n    var keys = getDomainKeys(domain);\n    return keys\n        ? enumerableRecord(Object.keys(keys), domain, codomain, name)\n        : nonEnumerableRecord(domain, codomain, name);\n}\n/**\n * @since 1.0.0\n */\nvar UnionType = /** @class */ (function (_super) {\n    __extends(UnionType, _super);\n    function UnionType(name, is, validate, encode, types) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.types = types;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'UnionType';\n        return _this;\n    }\n    return UnionType;\n}(Type));\nexport { UnionType };\n/**\n * @category combinators\n * @since 1.0.0\n */\nexport function union(codecs, name) {\n    if (name === void 0) { name = getUnionName(codecs); }\n    var index = getIndex(codecs);\n    if (index !== undefined && codecs.length > 0) {\n        var tag_1 = index[0], groups_1 = index[1];\n        var len_1 = groups_1.length;\n        var find_1 = function (value) {\n            for (var i = 0; i < len_1; i++) {\n                if (groups_1[i].indexOf(value) !== -1) {\n                    return i;\n                }\n            }\n            return undefined;\n        };\n        // tslint:disable-next-line: deprecation\n        return new TaggedUnionType(name, function (u) {\n            if (UnknownRecord.is(u)) {\n                var i = find_1(u[tag_1]);\n                return i !== undefined ? codecs[i].is(u) : false;\n            }\n            return false;\n        }, function (u, c) {\n            var e = UnknownRecord.validate(u, c);\n            if (isLeft(e)) {\n                return e;\n            }\n            var r = e.right;\n            var i = find_1(r[tag_1]);\n            if (i === undefined) {\n                return failure(u, c);\n            }\n            var codec = codecs[i];\n            return codec.validate(r, appendContext(c, String(i), codec, r));\n        }, useIdentity(codecs)\n            ? identity\n            : function (a) {\n                var i = find_1(a[tag_1]);\n                if (i === undefined) {\n                    // https://github.com/gcanti/io-ts/pull/305\n                    throw new Error(\"no codec found to encode value in union codec \" + name);\n                }\n                else {\n                    return codecs[i].encode(a);\n                }\n            }, codecs, tag_1);\n    }\n    else {\n        return new UnionType(name, function (u) { return codecs.some(function (type) { return type.is(u); }); }, function (u, c) {\n            var errors = [];\n            for (var i = 0; i < codecs.length; i++) {\n                var codec = codecs[i];\n                var result = codec.validate(u, appendContext(c, String(i), codec, u));\n                if (isLeft(result)) {\n                    pushAll(errors, result.left);\n                }\n                else {\n                    return success(result.right);\n                }\n            }\n            return failures(errors);\n        }, useIdentity(codecs)\n            ? identity\n            : function (a) {\n                for (var _i = 0, codecs_1 = codecs; _i < codecs_1.length; _i++) {\n                    var codec = codecs_1[_i];\n                    if (codec.is(a)) {\n                        return codec.encode(a);\n                    }\n                }\n                // https://github.com/gcanti/io-ts/pull/305\n                throw new Error(\"no codec found to encode value in union type \" + name);\n            }, codecs);\n    }\n}\n/**\n * @since 1.0.0\n */\nvar IntersectionType = /** @class */ (function (_super) {\n    __extends(IntersectionType, _super);\n    function IntersectionType(name, is, validate, encode, types) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.types = types;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'IntersectionType';\n        return _this;\n    }\n    return IntersectionType;\n}(Type));\nexport { IntersectionType };\nexport function intersection(codecs, name) {\n    if (name === void 0) { name = \"(\" + codecs.map(function (type) { return type.name; }).join(' & ') + \")\"; }\n    var len = codecs.length;\n    return new IntersectionType(name, function (u) { return codecs.every(function (type) { return type.is(u); }); }, codecs.length === 0\n        ? success\n        : function (u, c) {\n            var us = [];\n            var errors = [];\n            for (var i = 0; i < len; i++) {\n                var codec = codecs[i];\n                var result = codec.validate(u, appendContext(c, String(i), codec, u));\n                if (isLeft(result)) {\n                    pushAll(errors, result.left);\n                }\n                else {\n                    us.push(result.right);\n                }\n            }\n            return errors.length > 0 ? failures(errors) : success(mergeAll(u, us));\n        }, codecs.length === 0\n        ? identity\n        : function (a) {\n            return mergeAll(a, codecs.map(function (codec) { return codec.encode(a); }));\n        }, codecs);\n}\n/**\n * @since 1.0.0\n */\nvar TupleType = /** @class */ (function (_super) {\n    __extends(TupleType, _super);\n    function TupleType(name, is, validate, encode, types) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.types = types;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'TupleType';\n        return _this;\n    }\n    return TupleType;\n}(Type));\nexport { TupleType };\nexport function tuple(codecs, name) {\n    if (name === void 0) { name = \"[\" + codecs.map(function (type) { return type.name; }).join(', ') + \"]\"; }\n    var len = codecs.length;\n    return new TupleType(name, function (u) { return UnknownArray.is(u) && u.length === len && codecs.every(function (type, i) { return type.is(u[i]); }); }, function (u, c) {\n        var e = UnknownArray.validate(u, c);\n        if (isLeft(e)) {\n            return e;\n        }\n        var us = e.right;\n        var as = us.length > len ? us.slice(0, len) : us; // strip additional components\n        var errors = [];\n        for (var i = 0; i < len; i++) {\n            var a = us[i];\n            var type_3 = codecs[i];\n            var result = type_3.validate(a, appendContext(c, String(i), type_3, a));\n            if (isLeft(result)) {\n                pushAll(errors, result.left);\n            }\n            else {\n                var va = result.right;\n                if (va !== a) {\n                    /* istanbul ignore next */\n                    if (as === us) {\n                        as = us.slice();\n                    }\n                    as[i] = va;\n                }\n            }\n        }\n        return errors.length > 0 ? failures(errors) : success(as);\n    }, useIdentity(codecs) ? identity : function (a) { return codecs.map(function (type, i) { return type.encode(a[i]); }); }, codecs);\n}\n/**\n * @since 1.0.0\n */\nvar ReadonlyType = /** @class */ (function (_super) {\n    __extends(ReadonlyType, _super);\n    function ReadonlyType(name, is, validate, encode, type) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.type = type;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'ReadonlyType';\n        return _this;\n    }\n    return ReadonlyType;\n}(Type));\nexport { ReadonlyType };\n/**\n * @category combinators\n * @since 1.0.0\n */\nexport function readonly(codec, name) {\n    if (name === void 0) { name = \"Readonly<\" + codec.name + \">\"; }\n    return new ReadonlyType(name, codec.is, codec.validate, codec.encode, codec);\n}\n/**\n * @since 1.0.0\n */\nvar ReadonlyArrayType = /** @class */ (function (_super) {\n    __extends(ReadonlyArrayType, _super);\n    function ReadonlyArrayType(name, is, validate, encode, type) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.type = type;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'ReadonlyArrayType';\n        return _this;\n    }\n    return ReadonlyArrayType;\n}(Type));\nexport { ReadonlyArrayType };\n/**\n * @category combinators\n * @since 1.0.0\n */\nexport function readonlyArray(item, name) {\n    if (name === void 0) { name = \"ReadonlyArray<\" + item.name + \">\"; }\n    var codec = array(item);\n    return new ReadonlyArrayType(name, codec.is, codec.validate, codec.encode, item);\n}\n/**\n * Strips additional properties, equivalent to `exact(type(props))`.\n *\n * @category combinators\n * @since 1.0.0\n */\nexport var strict = function (props, name) { return exact(type(props), name); };\n/**\n * @since 1.1.0\n */\nvar ExactType = /** @class */ (function (_super) {\n    __extends(ExactType, _super);\n    function ExactType(name, is, validate, encode, type) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.type = type;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'ExactType';\n        return _this;\n    }\n    return ExactType;\n}(Type));\nexport { ExactType };\n/**\n * Strips additional properties.\n *\n * @category combinators\n * @since 1.1.0\n */\nexport function exact(codec, name) {\n    if (name === void 0) { name = getExactTypeName(codec); }\n    var props = getProps(codec);\n    return new ExactType(name, codec.is, function (u, c) {\n        var e = UnknownRecord.validate(u, c);\n        if (isLeft(e)) {\n            return e;\n        }\n        var ce = codec.validate(u, c);\n        if (isLeft(ce)) {\n            return ce;\n        }\n        return right(stripKeys(ce.right, props));\n    }, function (a) { return codec.encode(stripKeys(a, props)); }, codec);\n}\n// -------------------------------------------------------------------------------------\n// deprecated\n// -------------------------------------------------------------------------------------\n/**\n * @since 1.0.0\n * @deprecated\n */\nvar FunctionType = /** @class */ (function (_super) {\n    __extends(FunctionType, _super);\n    function FunctionType() {\n        var _this = _super.call(this, 'Function', \n        // tslint:disable-next-line:strict-type-predicates\n        function (u) { return typeof u === 'function'; }, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'FunctionType';\n        return _this;\n    }\n    return FunctionType;\n}(Type));\nexport { FunctionType };\n/**\n * @category primitives\n * @since 1.0.0\n * @deprecated\n */\n// tslint:disable-next-line: deprecation\nexport var Function = new FunctionType();\n/**\n * @since 1.3.0\n * @deprecated\n */\nvar TaggedUnionType = /** @class */ (function (_super) {\n    __extends(TaggedUnionType, _super);\n    function TaggedUnionType(name, \n    // tslint:disable-next-line: deprecation\n    is, \n    // tslint:disable-next-line: deprecation\n    validate, \n    // tslint:disable-next-line: deprecation\n    encode, codecs, tag) {\n        var _this = _super.call(this, name, is, validate, encode, codecs) /* istanbul ignore next */ // <= workaround for https://github.com/Microsoft/TypeScript/issues/13455\n         || this;\n        _this.tag = tag;\n        return _this;\n    }\n    return TaggedUnionType;\n}(UnionType));\nexport { TaggedUnionType };\n/**\n * Use `union` instead.\n *\n * @category combinators\n * @since 1.3.0\n * @deprecated\n */\nexport var taggedUnion = function (tag, codecs, name\n// tslint:disable-next-line: deprecation\n) {\n    if (name === void 0) { name = getUnionName(codecs); }\n    var U = union(codecs, name);\n    // tslint:disable-next-line: deprecation\n    if (U instanceof TaggedUnionType) {\n        return U;\n    }\n    else {\n        console.warn(\"[io-ts] Cannot build a tagged union for \" + name + \", returning a de-optimized union\");\n        // tslint:disable-next-line: deprecation\n        return new TaggedUnionType(name, U.is, U.validate, U.encode, codecs, tag);\n    }\n};\nexport { \n/**\n * Use `UnknownArray` instead.\n *\n * @category primitives\n * @deprecated\n * @since 1.0.0\n */\nUnknownArray as Array };\nexport { \n/**\n * Use `type` instead.\n *\n * @category combinators\n * @deprecated\n * @since 1.0.0\n */\ntype as interface };\n/**\n * @since 1.0.0\n * @deprecated\n */\nexport var getValidationError /* istanbul ignore next */ = function (value, context) { return ({\n    value: value,\n    context: context\n}); };\n/**\n * @since 1.0.0\n * @deprecated\n */\nexport var getDefaultContext /* istanbul ignore next */ = function (decoder) { return [\n    { key: '', type: decoder }\n]; };\n/**\n * @since 1.0.0\n * @deprecated\n */\nvar NeverType = /** @class */ (function (_super) {\n    __extends(NeverType, _super);\n    function NeverType() {\n        var _this = _super.call(this, 'never', function (_) { return false; }, function (u, c) { return failure(u, c); }, \n        /* istanbul ignore next */\n        function () {\n            throw new Error('cannot encode never');\n        }) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'NeverType';\n        return _this;\n    }\n    return NeverType;\n}(Type));\nexport { NeverType };\n/**\n * @category primitives\n * @since 1.0.0\n * @deprecated\n */\n// tslint:disable-next-line: deprecation\nexport var never = new NeverType();\n/**\n * @since 1.0.0\n * @deprecated\n */\nvar AnyType = /** @class */ (function (_super) {\n    __extends(AnyType, _super);\n    function AnyType() {\n        var _this = _super.call(this, 'any', function (_) { return true; }, success, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'AnyType';\n        return _this;\n    }\n    return AnyType;\n}(Type));\nexport { AnyType };\n/**\n * Use `unknown` instead.\n *\n * @category primitives\n * @since 1.0.0\n * @deprecated\n */\n// tslint:disable-next-line: deprecation\nexport var any = new AnyType();\n/**\n * Use `UnknownRecord` instead.\n *\n * @category primitives\n * @since 1.0.0\n * @deprecated\n */\nexport var Dictionary = UnknownRecord;\n/**\n * @since 1.0.0\n * @deprecated\n */\nvar ObjectType = /** @class */ (function (_super) {\n    __extends(ObjectType, _super);\n    function ObjectType() {\n        var _this = _super.call(this, 'object', function (u) { return u !== null && typeof u === 'object'; }, function (u, c) { return (_this.is(u) ? success(u) : failure(u, c)); }, identity) || this;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'ObjectType';\n        return _this;\n    }\n    return ObjectType;\n}(Type));\nexport { ObjectType };\n/**\n * Use `UnknownRecord` instead.\n *\n * @category primitives\n * @since 1.0.0\n * @deprecated\n */\n// tslint:disable-next-line: deprecation\nexport var object = new ObjectType();\n/**\n * Use `brand` instead.\n *\n * @category combinators\n * @since 1.0.0\n * @deprecated\n */\nexport function refinement(codec, predicate, name) {\n    if (name === void 0) { name = \"(\" + codec.name + \" | \" + getFunctionName(predicate) + \")\"; }\n    return new RefinementType(name, function (u) { return codec.is(u) && predicate(u); }, function (i, c) {\n        var e = codec.validate(i, c);\n        if (isLeft(e)) {\n            return e;\n        }\n        var a = e.right;\n        return predicate(a) ? success(a) : failure(a, c);\n    }, codec.encode, codec, predicate);\n}\n/**\n * Use `Int` instead.\n *\n * @category primitives\n * @since 1.0.0\n * @deprecated\n */\n// tslint:disable-next-line: deprecation\nexport var Integer = refinement(number, Number.isInteger, 'Integer');\n/**\n * Use `record` instead.\n *\n * @category combinators\n * @since 1.0.0\n * @deprecated\n */\nexport var dictionary = record;\n/**\n * @since 1.0.0\n * @deprecated\n */\nvar StrictType = /** @class */ (function (_super) {\n    __extends(StrictType, _super);\n    function StrictType(name, \n    // tslint:disable-next-line: deprecation\n    is, \n    // tslint:disable-next-line: deprecation\n    validate, \n    // tslint:disable-next-line: deprecation\n    encode, props) {\n        var _this = _super.call(this, name, is, validate, encode) || this;\n        _this.props = props;\n        /**\n         * @since 1.0.0\n         */\n        _this._tag = 'StrictType';\n        return _this;\n    }\n    return StrictType;\n}(Type));\nexport { StrictType };\n/**\n * Drops the codec \"kind\".\n *\n * @category combinators\n * @since 1.1.0\n * @deprecated\n */\nexport function clean(codec) {\n    return codec;\n}\nexport function alias(codec) {\n    return function () { return codec; };\n}\n", "export type Dict<T> = Record<string, T | undefined>\nexport type TimeoutHandle = NodeJS.Timeout\n\n// Better types for an Object.keys() replacement\nexport function keysOf<K extends keyof any>(d: Record<K, any>): K[]\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function keysOf<K extends {}>(o: K): (keyof K)[]\nexport function keysOf(o: any) {\n    return Object.keys(o)\n}\n\n// Allows nice definitions of enums with associated data\nexport class RichStringEnum<K extends keyof any, P> {\n\n    public static withProps<P0>() {\n        return function <K0 extends keyof any>(defs: Record<K0, P0>) {\n            return new RichStringEnum<K0, P0>(defs)\n        }\n    }\n\n    private _values: Array<K>\n\n    private constructor(private props: Record<K, P>) {\n        this._values = keysOf(props)\n        for (let i = 0; i < this._values.length; i++) {\n            this[i] = this._values[i]\n        }\n    }\n\n    public get type(): K {\n        throw new Error()\n    }\n\n    public get values(): Array<K> {\n        return this._values\n    }\n\n    public get length(): number {\n        return this._values.length\n    }\n\n    public get definitions(): Array<[K, P]> {\n        const defs: Array<[K, P]> = []\n        for (const i of this._values) {\n            defs.push([i, this.props[i]])\n        }\n        return defs\n    }\n\n    public isValue(val: string | number | symbol | null | undefined): val is K {\n        return this.values.includes(val as any)\n    }\n\n    public indexOf(val: K): number {\n        return this.values.indexOf(val)\n    }\n\n    public propsOf(key: K): P {\n        return this.props[key]\n    }\n\n    [i: number]: K\n\n    public *[Symbol.iterator]() {\n        for (const i of this._values) {\n            yield i\n        }\n    }\n\n}\n\n// returns the passed parameter typed as a tuple\nexport function tuple<T extends readonly any[]>(...items: [...T]): [...T] {\n    return items\n}\n\n// Utility types to force the evaluation of computed types\n// See: https://stackoverflow.com/a/57683652/390581\n\n// expands object types one level deep\nexport type Expand<T> = T extends infer O ? { [K in keyof O]: O[K] } : never\n\n// expands object types recursively\nexport type ExpandRecursively<T> = T extends Record<string, unknown>\n    ? T extends infer O ? { [K in keyof O]: ExpandRecursively<O[K]> } : never\n    : T\n\n\nexport type OptionalKeysOf<T> = { [P in keyof T]-?: undefined extends T[P] ? P : never }[keyof T]\nexport type RequiredKeysOf<T> = Exclude<keyof T, OptionalKeysOf<T>>\n\nexport type KeysOfByType<T, U> = { [P in keyof T]: T[P] extends U ? P : never }[keyof T]\n\nexport type FilterProperties<T, U> = {\n    [P in KeysOfByType<T, U>]: T[P]\n}\n\nexport type PartialWhereUndefinedRecursively<T> = ExpandRecursively<_PartialWhereUndefinedRecursively<T>>\n\ntype _PartialWhereUndefinedRecursively<T> =\n    // is it an object?\n    T extends Record<string, unknown>\n    ? T extends infer O ? {\n        [P in RequiredKeysOf<O>]: _PartialWhereUndefinedRecursively<O[P]>\n    } & {\n        [P in OptionalKeysOf<O>]?: _PartialWhereUndefinedRecursively<O[P]>\n    }\n    : never // \"closing the infer block\"\n\n    // is it an array?\n    : T extends ReadonlyArray<infer E>\n    ? Array<_PartialWhereUndefinedRecursively<E>>\n\n    // other types\n    : T\n\n// uses for statically typing the number of component inputs\nexport type Plus<A extends number, B extends number> =\n    B extends 1 ? Plus1<A> :\n    B extends 2 ? Plus2<A> :\n    B extends 3 ? Plus3<A> :\n    never\n\nexport type Plus1<N extends number> =\n    N extends 0 ? 1 :\n    N extends 1 ? 2 :\n    N extends 2 ? 3 :\n    N extends 3 ? 4 :\n    N extends 4 ? 5 :\n    N extends 5 ? 6 :\n    N extends 6 ? 7 :\n    N extends 7 ? 8 :\n    N extends 8 ? 9 :\n    N extends 9 ? 10 :\n    N extends 10 ? 11 :\n    N extends 11 ? 12 :\n    N extends 12 ? 13 :\n    N extends 13 ? 14 :\n    N extends 14 ? 15 :\n    N extends 15 ? 16 :\n    N extends 16 ? 17 :\n    N extends 17 ? 18 :\n    N extends 18 ? 19 :\n    N extends 19 ? 20 :\n    N extends 20 ? 21 :\n    never\n\nexport type Plus2<N extends number> =\n    N extends 0 ? 2 :\n    N extends 1 ? 3 :\n    N extends 2 ? 4 :\n    N extends 3 ? 5 :\n    N extends 4 ? 6 :\n    N extends 5 ? 7 :\n    N extends 6 ? 8 :\n    N extends 7 ? 9 :\n    N extends 8 ? 10 :\n    N extends 9 ? 11 :\n    N extends 10 ? 12 :\n    N extends 11 ? 13 :\n    N extends 12 ? 14 :\n    N extends 13 ? 15 :\n    N extends 14 ? 16 :\n    N extends 15 ? 17 :\n    N extends 16 ? 18 :\n    N extends 17 ? 19 :\n    N extends 18 ? 20 :\n    N extends 19 ? 21 :\n    N extends 20 ? 22 :\n    never\n\nexport type Plus3<N extends number> =\n    N extends 0 ? 3 :\n    N extends 1 ? 4 :\n    N extends 2 ? 5 :\n    N extends 3 ? 6 :\n    N extends 4 ? 7 :\n    N extends 5 ? 8 :\n    N extends 6 ? 9 :\n    N extends 7 ? 10 :\n    N extends 8 ? 11 :\n    N extends 9 ? 12 :\n    N extends 10 ? 13 :\n    N extends 11 ? 14 :\n    N extends 12 ? 15 :\n    N extends 13 ? 16 :\n    N extends 14 ? 17 :\n    N extends 15 ? 18 :\n    N extends 16 ? 19 :\n    N extends 17 ? 20 :\n    N extends 18 ? 21 :\n    N extends 19 ? 22 :\n    N extends 20 ? 23 :\n    never\n\n\n// Series of type-assertion functions\n\nexport function isUndefined(v: unknown): v is undefined {\n    return typeof v === \"undefined\"\n}\n\nexport function isDefined<T>(v: T | undefined): v is T {\n    return typeof v !== \"undefined\"\n}\n\nexport function isNullOrUndefined(v: unknown): v is null | undefined {\n    return isUndefined(v) || v === null\n}\n\nexport function isNull<T>(v: T | null): v is null {\n    return v === null\n}\n\nexport function isNotNull<T>(v: T | null): v is T {\n    return v !== null\n}\n\nexport function isString(v: unknown): v is string {\n    return typeof v === \"string\"\n}\n\nexport function isArray(arg: unknown): arg is ReadonlyArray<any> {\n    return Array.isArray(arg)\n}\n\nexport function isEmpty(container: { length: number } | { size: number }): boolean {\n    return (\"length\" in container ? container.length : container.size) === 0\n}\n\nexport function nonEmpty(container: { length: number } | { size: number }): boolean {\n    return !isEmpty(container)\n}\n\nexport function isNumber(arg: unknown): arg is number {\n    return typeof arg === \"number\"\n}\n\nexport function isBoolean(arg: unknown): arg is boolean {\n    return typeof arg === \"boolean\"\n}\n\nimport * as t from \"io-ts\"\n\n// Fixed-size arrays up to 8 to model inputs statically\n\nexport type FixedArraySize = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 30 | 31\nexport type FixedArraySizeNonZero = Exclude<FixedArraySize, 0>\nexport type FixedArraySizeSeveral = Exclude<FixedArraySizeNonZero, 1>\n\nexport type FixedArray<T, N extends FixedArraySize> =\n    N extends 0 ? []\n    : N extends 1 ? [T]\n    : N extends 2 ? [T, T]\n    : N extends 3 ? [T, T, T]\n    : N extends 4 ? [T, T, T, T]\n    : N extends 5 ? [T, T, T, T, T]\n    : N extends 6 ? [T, T, T, T, T, T]\n    : N extends 7 ? [T, T, T, T, T, T, T]\n    : N extends 8 ? [T, T, T, T, T, T, T, T]\n    : N extends 9 ? [T, T, T, T, T, T, T, T, T]\n    : N extends 10 ? [T, T, T, T, T, T, T, T, T, T]\n    : N extends 11 ? [T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 12 ? [T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 13 ? [T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 14 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 15 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 16 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 17 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 18 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 19 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 20 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 21 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 22 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 23 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 24 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 25 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 26 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 27 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 28 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 29 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 30 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 31 ? [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    :/*N >= 32 12*/ Array<T>\n\nexport type FixedReadonlyArray<T, N extends FixedArraySize> =\n    N extends 0 ? readonly []\n    : N extends 1 ? readonly [T]\n    : N extends 2 ? readonly [T, T]\n    : N extends 3 ? readonly [T, T, T]\n    : N extends 4 ? readonly [T, T, T, T]\n    : N extends 5 ? readonly [T, T, T, T, T]\n    : N extends 6 ? readonly [T, T, T, T, T, T]\n    : N extends 7 ? readonly [T, T, T, T, T, T, T]\n    : N extends 8 ? readonly [T, T, T, T, T, T, T, T]\n    : N extends 9 ? readonly [T, T, T, T, T, T, T, T, T]\n    : N extends 10 ? readonly [T, T, T, T, T, T, T, T, T, T]\n    : N extends 11 ? readonly [T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 12 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 13 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 14 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 15 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 16 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 17 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 18 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 19 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 20 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 21 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 22 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 23 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 24 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 25 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 26 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 27 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 28 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 29 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 30 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    : N extends 31 ? readonly [T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T, T]\n    :/*N >= 32 12*/ ReadonlyArray<T>\n\n// type HashSize1 = { readonly HasSize1: unique symbol }\n// type H<N extends number, T> = { [K in `HasSize${N}`]: T }\ninterface HasSizeNBrand<__ extends number> {\n    readonly HasSizeN: unique symbol // TODO check unique per N\n}\n\nexport const FixedArray = <T extends t.Mixed, N extends FixedArraySize>(tpe: T, n: N) =>\n    t.brand(\n        t.array(tpe, `array of size ${n}`),\n        (arr): arr is t.Branded<[t.TypeOf<T>], HasSizeNBrand<N>> => arr.length === n,\n        \"HasSizeN\"\n    )\n\nexport function FixedArrayFill<T, N extends FixedArraySize>(val: T, n: N): FixedArray<T, N> {\n    return Array(n).fill(val) as FixedArray<T, N>\n}\nexport function FixedArrayFillFactory<T, N extends FixedArraySize>(val: (i: number) => T, n: N): FixedArray<T, N> {\n    const arr = Array(n)\n    for (let i = 0; i < n; i++) {\n        arr[i] = val(i)\n    }\n    return arr as FixedArray<T, N>\n}\n\n// This seemingly identity function allows to convert back from a fixed-size tuple\n// to a regular array. It is a safe type cast, in a way, and allows to see the\n// regular array methods as well as to use the for-of iteration on these tuples\nexport function asArray<T, N extends FixedArraySize>(tuple: FixedArray<T, N>): ReadonlyArray<T> {\n    return tuple\n}\n\nexport function isTruthyString(str: string | null | undefined): boolean {\n    return !isNullOrUndefined(str) && (str === \"1\" || str.toLowerCase() === \"true\")\n}\n\nexport function isFalsyString(str: string | null | undefined): boolean {\n    return !isNullOrUndefined(str) && (str === \"0\" || str.toLowerCase() === \"false\")\n}\n\nexport function getURLParameter<T>(sParam: string, defaultValue: T): string | T\nexport function getURLParameter(sParam: string, defaultValue?: undefined): string | undefined\nexport function getURLParameter(sParam: string, defaultValue: any) {\n    const sPageURL = window.location.search.substring(1)\n    const sURLVariables = sPageURL.split('&')\n    for (let i = 0; i < sURLVariables.length; i++) {\n        const sParameterName = sURLVariables[i].split('=')\n        if (sParameterName[0] === sParam) {\n            return sParameterName[1]\n        }\n    }\n    return defaultValue\n}\n\nexport function isEmbeddedInIframe(): boolean {\n    try {\n        return window.self !== window.top\n    } catch (e) {\n        return true\n    }\n}\n\nexport function setVisible(elem: HTMLElement, visible: boolean) {\n    if (visible) {\n        const prevDisplay = elem.getAttribute(\"data-prev-display\")\n        if (prevDisplay === null) {\n            if (elem.style.display === \"none\") {\n                elem.style.removeProperty(\"display\")\n            } else {\n                // not hidden\n            }\n        } else {\n            elem.removeAttribute(\"data-prev-display\")\n            elem.style.display = prevDisplay\n        }\n    } else {\n        const currentDisplay = elem.style.display\n        if (currentDisplay.length !== 0 && currentDisplay !== \"none\") {\n            elem.setAttribute(\"data-prev-display\", currentDisplay)\n        }\n        elem.style.display = \"none\"\n    }\n}\n\nexport function showModal(dlog: HTMLDialogElement): boolean {\n    if (typeof (dlog as any).showModal === \"function\") {\n        dlog.style.display = \"initial\";\n        (dlog as any).showModal()\n        const listener = () => {\n            dlog.style.display = \"none\"\n            dlog.removeEventListener(\"close\", listener)\n        }\n        dlog.addEventListener(\"close\", listener)\n        return true\n    }\n    return false\n}\n\n\n// More general-purpose utility functions\n\nexport function any(bools: boolean[]): boolean {\n    for (const b of bools) {\n        if (b) {\n            return true\n        }\n    }\n    return false\n}\n\nexport function repeatString(c: string, n: number) {\n    return Array(n + 1).join(c)\n}\n\nexport function formatString(str: string, ...varargs: any[]) {\n    if (varargs.length) {\n        const t = typeof varargs[0]\n        const args = (\"string\" === t || \"number\" === t) ?\n            Array.prototype.slice.call(varargs)\n            : varargs[0]\n\n        for (const key in args) {\n            str = str.replace(new RegExp(\"\\\\{\" + key + \"\\\\}\", \"gi\"), args[key])\n        }\n    }\n    return str\n}\n\n\nexport function deepEquals(v1: any, v2: any) {\n    if (Array.isArray(v1) && Array.isArray(v2)) {\n        if (v1.length !== v2.length) {\n            return false\n        }\n        for (let i = 0; i < v1.length; i++) {\n            if (v1[i] !== v2[i]) {\n                return false\n            }\n        }\n        return true\n    } else {\n        return v1 === v2\n    }\n}\n\n\n\n// io-ts utils\n\nexport function forceTypeOf<U, V, W>(tpe: t.Type<U, V, W>) {\n    return {\n        toMoreSpecific: function <UU extends U>() {\n            return tpe as unknown as t.Type<UU, V, W>\n        },\n    }\n}\n\nexport const typeOrUndefined = <T extends t.Mixed>(tpe: T) => {\n    return t.union([tpe, t.undefined], tpe.name + \" | undefined\")\n}\n\nexport const typeOrNull = <T extends t.Mixed>(tpe: T) => {\n    return t.union([tpe, t.null], tpe.name + \" | null\")\n}\n\n\n// Unset; LogicValue\n\nexport const HighImpedance = \"Z\" as const\nexport type HighImpedance = typeof HighImpedance\nexport function isHighImpedance<T>(v: T | HighImpedance): v is HighImpedance {\n    return v === HighImpedance\n}\n\nexport const Unknown = \"?\" as const\nexport type Unknown = typeof Unknown\nexport function isUnknown<T>(v: T | Unknown): v is Unknown {\n    return v === Unknown\n}\nexport const TUnknown = new t.Type<Unknown>(\n    \"Unknown\",\n    isUnknown,\n    (input, context) => isUnknown(input) ? t.success(input) : t.failure(input, context),\n    t.identity,\n)\n\nexport type LogicValue = boolean | HighImpedance | Unknown\nexport const LogicValue = {\n    invert(v: LogicValue): LogicValue {\n        return isUnknown(v) || isHighImpedance(v) ? v : !v\n    },\n}\n\nexport type LogicValueRepr = 0 | 1 | HighImpedance | Unknown\nexport const LogicValueRepr = new t.Type<LogicValueRepr>(\n    \"0|1|?|Z\",\n    (v: unknown): v is LogicValueRepr => isUnknown(v) || isHighImpedance(v) || v === 1 || v === 0,\n    (input, context) =>\n        isUnknown(input) ? t.success(input) :\n            isHighImpedance(input) ? t.success(input) :\n                input === 1 ? t.success(1) :\n                    input === 0 ? t.success(0) :\n                        t.failure(input, context),\n    t.identity,\n)\n\n// TODO put this in TriState object\nexport function toLogicValueRepr(v: LogicValue): LogicValueRepr\nexport function toLogicValueRepr(v: LogicValue | undefined): LogicValueRepr | undefined\nexport function toLogicValueRepr(v: LogicValue | undefined): LogicValueRepr | undefined {\n    switch (v) {\n        case true: return 1\n        case false: return 0\n        case Unknown: return Unknown\n        case HighImpedance: return HighImpedance\n        case undefined: return undefined\n    }\n}\n\nexport function toLogicValue(v: LogicValueRepr): LogicValue\nexport function toLogicValue(v: LogicValueRepr | undefined): LogicValue | undefined\nexport function toLogicValue(v: LogicValueRepr | undefined): LogicValue | undefined {\n    switch (v) {\n        case 1: return true\n        case 0: return false\n        case Unknown: return Unknown\n        case HighImpedance: return HighImpedance\n        case undefined: return undefined\n    }\n}\n\nexport function toLogicValueFromChar(char: string): LogicValue {\n    switch (char) {\n        case \"1\": return true\n        case \"0\": return false\n        case Unknown: return Unknown\n        case HighImpedance: return HighImpedance\n        default: return Unknown\n    }\n}\n\n// Enums or RichEnums used in several files\n\nexport enum Mode {\n    STATIC,  // cannot interact in any way\n    TRYOUT,  // can change inputs on predefined circuit\n    CONNECT, // can additionnally move preexisting components around and connect them\n    DESIGN,  // can additionally add components from left menu\n    FULL,    // can additionally force output nodes to 'unset' state and draw undetermined dates\n}\n\nexport function copyToClipboard(textToCopy: string): boolean {\n    function isOS() {\n        //can use a better detection logic here\n        return navigator.userAgent.match(/ipad|iphone/i)\n    }\n\n    const textArea = document.createElement('textarea')\n    textArea.readOnly = true\n    textArea.contentEditable = \"true\"\n    textArea.value = textToCopy\n    document.body.appendChild(textArea)\n\n    if (isOS()) {\n        const range = document.createRange()\n        range.selectNodeContents(textArea)\n        const selection = window.getSelection()\n        if (isNotNull(selection)) {\n            selection.removeAllRanges()\n            selection.addRange(range)\n            textArea.setSelectionRange(0, 999999)\n        }\n    } else {\n        textArea.select()\n    }\n\n    const ok = document.execCommand('copy')\n    document.body.removeChild(textArea)\n    return ok\n}\n\nexport function downloadBlob(dataUrl: string, filename: string) {\n    const link = document.createElement('a')\n    link.download = filename\n    link.href = dataUrl\n    document.body.appendChild(link)\n    link.click()\n    document.body.removeChild(link)\n}\n\nexport function targetIsFieldOrOtherInput(e: Event) {\n    const targets = e.composedPath()\n    let elem, tagName\n    return targets.length !== 0 && (elem = targets[0]) instanceof HTMLElement && ((tagName = elem.tagName) === \"INPUT\" || tagName === \"SELECT\")\n}\n\nexport const fetchJSONP = ((unique: number) => (url: string) =>\n    new Promise<string>(resolve => {\n        const script = document.createElement('script')\n        const name = `_jsonp_${unique++}`\n\n        if (url.match(/\\?/)) {\n            url += `&callback=${name}`\n        } else {\n            url += `?callback=${name}`\n        }\n\n        script.src = url;\n        (window as any)[name] = (json: any) => {\n            script.remove()\n            delete (window as any)[name]\n            resolve(JSON.stringify(json))\n        }\n\n        document.body.appendChild(script)\n    })\n)(0)\n", "\n//\n// Helper export function s to build HTML more smartly in JavaScript\n//\n\nimport { isHighImpedance, isUndefined, isUnknown, LogicValue, Unknown } from \"./utils\"\n\nexport interface ModifierObject {\n    applyTo(parent: Element): void\n}\nexport type Modifier = ModifierObject | Node | string\nexport interface RenderObject<T extends HTMLElement> {\n    render(): T\n}\nexport type ElemRenderer<T extends HTMLElement> = ModifierObject & RenderObject<T>\nexport interface AttrBuilder {\n    (attrValue: any): ModifierObject;\n    attrName: string;\n}\nexport interface StyleBuilder {\n    (styleValue: any): ModifierObject;\n    styleName: string;\n}\n\nexport function isModifierObject(mod: any): mod is ModifierObject {\n    return typeof mod.applyTo === \"function\"\n}\nexport function isNode(obj: any): obj is Node {\n    return typeof obj === \"object\" && \"nodeType\" in obj\n}\n\nexport function applyModifierTo(parent: Element, modifier: Modifier): void {\n    if (isNode(modifier)) {\n        parent.appendChild(modifier)\n    } else if (isModifierObject(modifier)) {\n        modifier.applyTo(parent)\n    } else {\n        const text = \"\" + modifier\n        parent.appendChild(document.createTextNode(text))\n    }\n}\n\nexport function applyModifiersTo(parent: Element, modifiers: Modifier[]): void {\n    for (const mod of modifiers) {\n        applyModifierTo(parent, mod)\n    }\n}\n\nexport function elemBuilder<K extends keyof HTMLElementTagNameMap>(tagName: K): (...modifiers: Modifier[]) => ElemRenderer<HTMLElementTagNameMap[K]> {\n    return (...modifiers: Modifier[]) => {\n        return {\n            render: () => {\n                const el = document.createElement(tagName)\n                applyModifiersTo(el, modifiers)\n                return el\n            },\n            applyTo: function (parent) {\n                parent.appendChild(this.render())\n            },\n        }\n    }\n}\n\n\nexport function attrBuilder(attrName: string): AttrBuilder {\n    const builder = ((attrValue: any): ModifierObject => {\n        return {\n            applyTo: p => p.setAttribute(attrName, \"\" + attrValue),\n        }\n    }) as AttrBuilder\n    builder.attrName = attrName\n    return builder\n}\n\nexport function styleBuilder(styleName: string): StyleBuilder {\n    const builder = ((styleValue: any): ModifierObject => {\n        return {\n            applyTo: p => (p as HTMLElement).style.setProperty(styleName, styleValue),\n        }\n    }) as StyleBuilder\n    builder.styleName = styleName\n    return builder\n}\n\nexport function data(dataName: string): AttrBuilder {\n    return attrBuilder(\"data-\" + dataName)\n}\n\nexport function raw(rawHTML: string): Modifier {\n    return {\n        applyTo: p => p.insertAdjacentHTML('beforeend', rawHTML),\n    }\n}\n\nexport function addClass(className: string): Modifier {\n    return {\n        applyTo: p => p.classList.add(className),\n    }\n}\n\nexport function mods(...modifiers: Modifier[]): Modifier {\n    return {\n        applyTo: p => applyModifiersTo(p, modifiers),\n    }\n}\n\nexport const emptyMod: Modifier = {\n    applyTo: __ => undefined, // do nothing\n}\n\nexport function attr(attrName: string, attrValue: string): Modifier {\n    return attrBuilder(attrName)(attrValue)\n}\n\nexport const div = elemBuilder(\"div\")\nexport const span = elemBuilder(\"span\")\n\nexport const a = elemBuilder(\"a\")\n\nexport const b = elemBuilder(\"b\")\nexport const i = elemBuilder(\"i\")\n\nexport const ul = elemBuilder(\"ul\")\nexport const ol = elemBuilder(\"ol\")\nexport const li = elemBuilder(\"li\")\n\nexport const table = elemBuilder(\"table\")\nexport const thead = elemBuilder(\"thead\")\nexport const tbody = elemBuilder(\"tbody\")\nexport const tr = elemBuilder(\"tr\")\nexport const th = elemBuilder(\"th\")\nexport const td = elemBuilder(\"td\")\n\nexport const input = elemBuilder(\"input\")\nexport const select = elemBuilder(\"select\")\nexport const option = elemBuilder(\"option\")\nexport const button = elemBuilder(\"button\")\nexport const label = elemBuilder(\"label\")\nexport const img = elemBuilder(\"img\")\nexport const canvas = elemBuilder(\"canvas\")\n\nexport const style = attrBuilder(\"style\")\nexport const type = attrBuilder(\"type\")\nexport const cls = attrBuilder(\"class\")\nexport const href = attrBuilder(\"href\")\nexport const target = attrBuilder(\"target\")\nexport const title = attrBuilder(\"title\")\nexport const src = attrBuilder(\"src\")\nexport const draggable = attrBuilder(\"draggable\")(\"true\")\nexport const br = raw('<br>')\n\nexport const dataComponent = attrBuilder(\"data-component\")\nexport const dataType = attrBuilder(\"data-type\")\nexport const dataClassId = attrBuilder(\"data-classid\")\n\n\n\n// Common Modifier-generating helpers\n\nexport const asValue = (bool: LogicValue) => b(isUnknown(bool) || isHighImpedance(bool) ? Unknown : String(Number(bool)))\n\nexport function tooltipContent(title: Modifier | undefined, body: Modifier, maxWidth = 200): ModifierObject {\n    return div(style(`max-width: ${maxWidth}px`),\n        isUndefined(title) ? emptyMod : div(style(\"padding-bottom: 3px; border-bottom: 1px solid grey;\"), title),\n        div(body)\n    )\n}\n", "import { Modifier, mods } from \"./htmlgen\"\nimport { RichStringEnum, tuple } from \"./utils\"\n\nexport type Strings = typeof Strings_fr\n\n// either just the title (mouseover), or the title and the caption\ntype ComponentStrings = string | [string, string]\n\nclass Template<K extends string[]> {\n    public constructor(public readonly templateString: string, __keys: [...K]) { }\n    public expand(values: { [key in K[number]]: any }) {\n        return this.templateString.replace(/\\$\\{(?:\\w+)\\}/g, (placeholder) => {\n            const key = placeholder.slice(2, -1)\n            return String((values as any)[key] ?? \"<<\" + key + \">>\")\n        })\n    }\n}\n\nexport function template<K extends string[]>(templ: string, ...keys: [...K]) {\n    return new Template<K>(templ, keys)\n}\n\nconst Strings_fr = {\n    ComponentBar: {\n        Labels: {\n            More: \"Plus\",\n            Less: \"Moins\",\n        },\n        SectionNames: {\n            InputOutput: \"Entr\u00E9es/ sorties\",\n            Layout: \"Dispo- sition\",\n            Gates: \"Portes\",\n            Components: \"Compo- sants\",\n        },\n        Components: RichStringEnum.withProps<ComponentStrings>()({\n            InputBit: \"Entr\u00E9e\",\n            OutputBit: \"Sortie\",\n            OutputByte: [\"Sortie octet (8 bits)\", \"Out 8 bits\"],\n            OutputByteDisplay: [\"Affichage de 8 bits\", \"Aff. 8 bits\"],\n            OutputNibble: [\"Sortie semioctet (4 bits)\", \"Out 4 bits\"],\n            OutputNibbleDisplay: [\"Affichage de 4 bits\", \"Aff. 4 bits\"],\n            Output7Seg: [\"Afficheur \u00E0 7 segments\", \"7 segments\"],\n            Output16Seg: [\"Afficheur \u00E0 16 segments\", \"16 segments\"],\n            OutputAscii: [\"Affichage d\u2019un caract\u00E8re ASCII (sur 7 bits)\", \"Caract\u00E8re\"],\n            OutputBar: [\"Affichage d\u2019un bit sous forme de segment lumineux\", \"Segment\"],\n            Clock: [\"G\u00E9n\u00E9rateur de signal d\u2019horloge\", \"Horloge\"],\n            InputByte: [\"Entr\u00E9e octet\", \"In 8 bits\"],\n            InputNibble: [\"Entr\u00E9e semioctet\", \"In 4 bits\"],\n            InputRandom: [\"Entr\u00E9e al\u00E9atoire\", \"Al\u00E9atoire\"],\n            OutputShiftBuffer: [\"Affichage avec buffer \u00E0 d\u00E9calage\", \"Affichage \u00E0 d\u00E9calage\"],\n\n            Passthrough1: [\"Broche\", \"Broche\"],\n            Passthrough4: [\"Broche \u00E0 4 entr\u00E9es-sortes\", \"Broche (4)\"],\n            Passthrough8: [\"Broche \u00E0 8 entr\u00E9es-sortes\", \"Broche (8)\"],\n            LabelString: [\"\u00C9tiquette\", \"Label\"],\n            LabelRectangle: [\"Rectangle de regroupement\", \"Groupe\"],\n\n            NOT: [\"Porte NON\", \"NON\"],\n            BUF: [\"Buffer (porte OUI)\", \"OUI\"],\n            TRI: [\"Sortie \u00E0 3 \u00E9tats\", \"3 \u00E9tats\"],\n            AND: [\"Porte ET\", \"ET\"],\n            OR: [\"Porte OU\", \"OU\"],\n            XOR: [\"Porte OU-X\", \"OU-X\"],\n            NAND: [\"Porte NON-ET\", \"NON-ET\"],\n            NOR: [\"Porte NON-OU\", \"NON-OU\"],\n            XNOR: [\"Porte NON-OU-X\", \"NON-OU-X\"],\n            IMPLY: [\"Porte IMPLIQUE\", \"IMPLIQUE\"],\n            NIMPLY: [\"Porte NON-IMPLIQUE\", \"NON-IMPL.\"],\n            TRANSFER: [\"Fausse porte TRANSFERT \u00E0 deux entr\u00E9es\", \"TRANSF.\"],\n\n            AND3: [\"Porte ET \u00E0 3 entr\u00E9es\", \"ET (3)\"],\n            OR3: [\"Porte OU \u00E0 3 entr\u00E9es\", \"OU (3)\"],\n            XOR3: [\"Porte OU-X \u00E0 3 entr\u00E9es\", \"OU-X (3)\"],\n            NAND3: [\"Porte NON-ET \u00E0 3 entr\u00E9es\", \"NON-ET (3)\"],\n            NOR3: [\"Porte NON-OU \u00E0 3 entr\u00E9es\", \"NON-OU (3)\"],\n            XNOR3: [\"Porte NON-OU-X \u00E0 3 entr\u00E9es\", \"NON-OU-X (3)\"],\n\n            AND4: [\"Porte ET \u00E0 4 entr\u00E9es\", \"ET (4)\"],\n            OR4: [\"Porte OU \u00E0 4 entr\u00E9es\", \"OU (4)\"],\n            XOR4: [\"Porte OU-X \u00E0 4 entr\u00E9es\", \"OU-X (4)\"],\n            NAND4: [\"Porte NON-ET \u00E0 4 entr\u00E9es\", \"NON-ET (4)\"],\n            NOR4: [\"Porte NON-OU \u00E0 4 entr\u00E9es\", \"NON-OU (4)\"],\n            XNOR4: [\"Porte NON-OU-X \u00E0 4 entr\u00E9es\", \"NON-OU-X (4)\"],\n\n            SwitchedInverter: [\"Inverseur commut\u00E9 \u00E0 4 bits\", \"Inv. comm.\"],\n            QuadGate: [\"Porte quadruple\", \"4 \u00D7 Porte\"],\n            QuadTriState: [\"Sortie \u00E0 3 \u00E9tats quadruple\", \"4 \u00D7 3 \u00E9tats\"],\n\n            HalfAdder: [\"Demi-additionneur\", \"Demi-add.\"],\n            Adder: [\"Additionneur\", \"Add.\"],\n            ALU: [\"Unit\u00E9 arithm\u00E9tique et logique \u00E0 4 bits\", \"ALU\"],\n\n            Mux2to1: [\"Multiplexer 2-vers-1 (1 bit de contr\u00F4le)\", \"Mux 2-1\"],\n            Mux4to1: [\"Multiplexer 4-vers-1 (2 bits de contr\u00F4le)\", \"Mux 4-1\"],\n            Mux8to1: [\"Multiplexer 8-vers-1 (3 bits de contr\u00F4le)\", \"Mux 8-1\"],\n            Mux4to2: [\"Multiplexer 4-vers-2 (1 bit de contr\u00F4le)\", \"Mux 4-2\"],\n            Mux8to2: [\"Multiplexer 8-vers-2 (2 bits de contr\u00F4le)\", \"Mux 8-2\"],\n            Mux8to4: [\"Multiplexer 8-vers-4 (1 bit de contr\u00F4le)\", \"Mux 8-4\"],\n            Mux16to8: [\"Multiplexer 16-vers-8 (1 bit de contr\u00F4le)\", \"Mux 16-8\"],\n            Demux1to2: [\"D\u00E9multiplexer 1-vers-2 (1 bit de contr\u00F4le)\", \"Demux 1-2\"],\n            Demux1to4: [\"D\u00E9multiplexer 1-vers-4 (2 bits de contr\u00F4le)\", \"Demux 1-4\"],\n            Demux1to8: [\"D\u00E9multiplexer 1-vers-8 (3 bits de contr\u00F4le)\", \"Demux 1-8\"],\n            Demux2to4: [\"D\u00E9multiplexer 2-vers-4 (1 bit de contr\u00F4le)\", \"Demux 2-4\"],\n            Demux2to8: [\"D\u00E9multiplexer 2-vers-8 (2 bits de contr\u00F4le)\", \"Demux 2-8\"],\n            Demux4to8: [\"D\u00E9multiplexer 4-vers-8 (1 bit de contr\u00F4le)\", \"Demux 4-8\"],\n            Demux8to16: [\"D\u00E9multiplexer 8-vers-16 (1 bit de contr\u00F4le)\", \"Demux 8-16\"],\n\n            LatchSR: [\"Verrou SR\", \"Verrou SR\"],\n            FlipflopJK: [\"Bascule JK\", \"Basc. JK\"],\n            FlipflopT: [\"Bascule T\", \"Basc. T\"],\n            FlipflopD: [\"Bascule D\", \"Basc. D\"],\n            Register: [\"Registre \u00E0 4 bits\", \"Registre\"],\n            RAM32x12: [\"RAM, 32 \u00D7 12 bits\", \"RAM 32\u00D712\"],\n            RAM16x4: [\"RAM, 16 \u00D7 4 bits\", \"RAM 16\u00D74\"],\n            RAM16x8: [\"RAM, 16 \u00D7 8 bits\", \"RAM 16\u00D78\"],\n            RAM64x8: [\"RAM, 64 \u00D7 8 bits\", \"RAM 64\u00D78\"],\n\n            Counter: [\"Compteur 4 bits\", \"Compteur\"],\n            Decoder7Seg: [\"D\u00E9codeur 7 segments\", \"D\u00E9c. 7 seg.\"],\n            Decoder16Seg: [\"D\u00E9codeur ASCII vers 16 segments\", \"D\u00E9c. 16 seg.\"],\n            DecoderBCD4: [\"D\u00E9codeur 4 bits vers BCD sur 5 bits\", \"D\u00E9c. BCD\"],\n\n            Comparator: [\"Comparateur\", \"Comp.\"],\n        }),\n    },\n    Modes: {\n        FULL: tuple(\"Admin\", \"En plus du mode complet, ce mode permet de rendre les entr\u00E9es, les sorties des portes, voire les portes elles-m\u00EAmes ind\u00E9termin\u00E9es\"),\n        DESIGN: tuple(\"Complet\", \"La totalit\u00E9 des actions de conception d\u2019un circuit sont possible\"),\n        CONNECT: tuple(\"Connexion\", \"Il est possible de d\u00E9placer et de connecter des \u00E9l\u00E9ments d\u00E9j\u00E0 sur le canevas, mais pas d\u2019en rajouter (le menu de gauche ne serait pas actif)\"),\n        TRYOUT: tuple(\"Test\", \"Il est seulement possible de changer les entr\u00E9es pour tester un circuit pr\u00E9\u00E9tabli\"),\n        STATIC: tuple(\"Statique\", \"Les \u00E9l\u00E9ments sont juste affich\u00E9s; aucune interaction n\u2019est possible\"),\n    },\n    Orientations: {\n        e: \"Vers la droite (par d\u00E9faut)\",\n        s: \"Vers le bas\",\n        w: \"Vers la gauche\",\n        n: \"Vers le haut\",\n    },\n    Settings: {\n        Settings: \"R\u00E9glages\",\n        CircuitName: \"Nom:\",\n        NameOfDownloadedFile: \"Ceci sera le nom du fichier t\u00E9l\u00E9charg\u00E9.\",\n        hideWireColors: tuple(\"Cacher l\u2019\u00E9tat des fils\", \"Si coch\u00E9, les fils sont affich\u00E9s avec une couleur neutre plut\u00F4t que de montrer s\u2019ils v\u00E9hiculent un 1 ou un 0.\"),\n        hideInputColors: tuple(\"Cacher l\u2019\u00E9tat des entr\u00E9es\", \"Si coch\u00E9, les entr\u00E9es sont affich\u00E9es avec une couleur neutre, m\u00EAme si elles livrent au circuit une valeur bien d\u00E9termin\u00E9e. S\u2019utilise volontiers en cachant aussi l\u2019\u00E9tat des fils.\"),\n        hideOutputColors: tuple(\"Cacher l\u2019\u00E9tat des sorties\", \"Si coch\u00E9, les sorties sont affich\u00E9es avec une couleur neutre. S\u2019utilise volontiers en cachant aussi l\u2019\u00E9tat des fils.\"),\n        hideMemoryContent: tuple(\"Cacher le contenu stock\u00E9\", \"Si coch\u00E9, les verrous, bascules, registres et autres m\u00E9moires ne montrent pas leur contenu.\"),\n        showGateTypes: tuple(\"Montrer type des portes\", \"Si coch\u00E9, affiche sur les portes logique le nom de la fonction r\u00E9alis\u00E9e.\"),\n        showDisconnectedPins: tuple(\"Toujours montrer les pattes\", \"Si non coch\u00E9, les pattes non connect\u00E9es des composants sont masqu\u00E9es dans les modes o\u00F9 les connexions du circuit ne peuvent pas \u00EAtre modifi\u00E9es (et restent visibles sinon).\"),\n        hideTooltips: tuple(\"D\u00E9sactiver tooltips\", \"Si coch\u00E9, les informations suppl\u00E9mentaires des tooltips (comme les tables de v\u00E9rit\u00E9) ne seront pas affich\u00E9es.\"),\n        groupParallelWires: tuple(\"Grouper les fils parall\u00E8les\", \"Si coch\u00E9, les fils parral\u00E8les allant d'un composant \u00E0 un autre seront regroup\u00E9s en un seul fil plus \u00E9pais.\"),\n        propagationDelay: \"Un 1 ou un 0 impos\u00E9 sur une connexion sera r\u00E9percut\u00E9 \u00E0 l\u2019autre bout de la connexion apr\u00E8s ce d\u00E9lai de propagation.\",\n        propagationDelayField: tuple(\"Propagation en\", \"ms\"),\n        zoomLevel: \"Le niveau de zoom sur les composants du circuit.\",\n        zoomLevelField: tuple(\"Zoom:\", \"%\"),\n        showUserDataLink: tuple(\"Voir les\", \"donn\u00E9es li\u00E9es\"),\n        userDataHeader: \"Les donn\u00E9es suivantes sont export\u00E9es avec le circuit:\",\n\n        wireStyle: \"Style des fils:\",\n        WireStyleAuto: \"Auto\",\n        WireStyleLine: \"Ligne\",\n        WireStyleCurve: \"Courbe\",\n    },\n    Timeline: {\n        Play: tuple(\"Play\", \"D\u00E9marre l\u2019\u00E9coulement du temps\"),\n        Pause: tuple(\"Pause\", \"Arr\u00EAte l\u2019\u00E9coulement du temps\"),\n        Step: tuple(undefined, \"Avance au prochain \u00E9v\u00E9nement\"),\n    },\n    Messages: {\n        ReallyCloseWindow: \"Voulez-vous vraiment fermer la fen\u00EAtre sans prendre en compte les derniers changements?\",\n    },\n    Components: {\n        Generic: {\n            contextMenu: {\n                Delete: \"Supprimer\",\n\n                SetIdentifier: \"Attribuer un identifiant\u2026\",\n                ChangeIdentifier: tuple(\"Changer l\u2019identifiant (\", \")\"),\n                SetIdentifierPrompt: \"Choisissez l\u2019identifiant \u00E0 attribuer \u00E0 ce composant ou laissez vide pour le supprimer:\\n\\n(L\u2019identifiant sert uniquement \u00E0 faire r\u00E9f\u00E9rence \u00E0 ce composant via du code JavaScript externe.)\",\n\n                Orientation: \"Orientation\",\n                ChangeOrientationDesc: \"Changez l\u2019orientation avec Commande + double-clic sur le composant\",\n                ShowAsUnknown: \"Afficher comme inconnu\",\n\n                ForceOutputSingle: \"Forcer la sortie\",\n                ForceOutputMultiple: \"Forcer une sortie\",\n                Output: \"Sortie\",\n                NormalOutput: \"Sortie normale\",\n                ForceAsUnknown: \"Forcer comme \u00E9tat inconnu\",\n                ForceAs1: \"Forcer \u00E0 1\",\n                ForceAs0: \"Forcer \u00E0 0\",\n                ForceAsZ: \"Forcer \u00E0 haute imp\u00E9dance\",\n                ForceOutputDesc: \"Forcez une sortie avec Option + double-clic sur la sortie\",\n\n                SetName: \"Ajouter un nom\u2026\",\n                ChangeName: \"Changer le nom\u2026\",\n                SetNamePrompt: \"Choisissez le nom \u00E0 afficher ou laissez vide pour le supprimer:\",\n\n                SetFontPrompt: tuple(\"Entrez une sp\u00E9cification de police ou laissez vide pour la valeur par d\u00E9faut (\", \"):\"),\n\n                TriggerOn: \"Stocker au\",\n                TriggerRisingEdge: \"flanc montant\",\n                TriggerFallingEdge: \"flanc descendant\",\n\n                ShowContent: \"Montrer le contenu\",\n            },\n\n            InputCarryInDesc: \"Cin (retenue pr\u00E9c\u00E9dente)\",\n            InputClockDesc: \"Clock (horloge)\",\n            InputClearDesc: \"C (Clear, mise \u00E0 0)\",\n            InputPresetDesc: \"P (Preset, mise \u00E0 1)\",\n            InputSetDesc: \"S (Set, mise \u00E0 1)\",\n            InputResetDesc: \"R (Reset, mise \u00E0 0)\",\n            InputDataDesc: \"D (Donn\u00E9es)\",\n            InputWriteEnableDesc: \"WE (\u00E9criture activ\u00E9e)\",\n\n            OutputSumDesc: \"S (somme)\",\n            OutputCarryDesc: \"C (retenue)\",\n            OutputCarryOutDesc: \"Cout (retenue)\",\n            OutputQDesc: \"Q (sortie normale)\",\n            OutputQBarDesc: \"Q\u0305 (sortie invers\u00E9e)\",\n        },\n        Adder: {\n            caption: \"Additionneur\",\n            tooltip: \"Additionne deux bits A et B et une retenue d\u2019entr\u00E9e Cin, et fournit un bit de somme S et une retenue de sortie Cout.\",\n        },\n        ALU: {\n            add: tuple(\"+\", \"Addition\"),\n            sub: tuple(\"\u2013\", \"Soustraction\"),\n            and: tuple(\"ET\", \"ET\"),\n            or: tuple(\"OU\", \"OU\"),\n            InputCinDesc: \"retenue d\u2019entr\u00E9e\",\n            OutputCoutDesc: \"retenue de sortie\",\n            tooltip: {\n                title: \"Unit\u00E9 arithm\u00E9tique et logique (ALU)\",\n                CurrentlyCarriesOut: \"Effectue actuellement\",\n                SomeUnknownOperation: \"une op\u00E9ration inconnue\",\n                ThisOperation: \"l\u2019op\u00E9ration\",\n            },\n            contextMenu: {\n                toggleShowOp: \"Afficher l\u2019op\u00E9ration\",\n            },\n        },\n        Clock: {\n            tooltip: {\n                title: \"Horloge\",\n                period: tuple(\"P\u00E9riode: \", \" ms\"),\n                dutycycle: tuple(\"Rapport cyclique: \", \"%\"),\n                phase: tuple(\"D\u00E9phasage: \", \" ms\"),\n            },\n            contextMenu: {\n                Period: \"P\u00E9riode\",\n            },\n        },\n        Comparator: {\n            caption: \"Comparateur\",\n            tooltip: \"Comparateur entre deux bits A et B, activ\u00E9 par une entr\u00E9e E.\",\n        },\n        Counter: {\n            tooltip: {\n                title: \"Compteur\",\n                desc: \"Compteur \u00E0 quatre bits.\",\n            },\n            contextMenu: {\n                DisplayTempl: template(\"Affichage ${desc}\", \"desc\"),\n                DisplayNone: \"absent\",\n                DisplayDecimal: \"d\u00E9cimal\",\n                DisplayHex: \"hexad\u00E9cimal\",\n            },\n        },\n        Decoder7Seg: {\n            tooltip: \"D\u00E9codeur 7 segments\",\n        },\n        Decoder16Seg: {\n            tooltip: \"D\u00E9codeur ASCII vers 16 segments\",\n        },\n        DecoderBCD4: {\n            tooltip: \"D\u00E9codeur 4 bits vers BCD (binary-coded decimal)\",\n        },\n        Demux: {\n            tooltip: template(\"D\u00E9multiplexeur ${from} vers ${to}\", \"from\", \"to\"),\n            contextMenu: {\n                UseZForDisconnected: \"Utiliser Z pour sorties d\u00E9connect\u00E9es\",\n            },\n        },\n        FlipflopD: {\n            tooltip: {\n                title: \"Bascule D\",\n                desc: \"Stocke un bit.\",\n            },\n        },\n        FlipflopJK: {\n            InputJDesc: \"J (Jump, mise \u00E0 1)\",\n            InputKDesc: \"K (Kill, mise \u00E0 0)\",\n            tooltip: {\n                title: \"Bascule JK\",\n                desc: \"Stocke un bit.\",\n            },\n        },\n        FlipflopT: {\n            InputTDesc: \"T (Toggle, bascule)\",\n            tooltip: {\n                title: \"Bascule T\",\n                desc: \"Stocke un bit.\",\n            },\n        },\n        Gate: {\n            NOT: tuple(\"NON\", \"NON\", \"La sortie est \u00E9gale \u00E0 l\u2019entr\u00E9e invers\u00E9e.\"),\n            BUF: tuple(\"OUI\", \"OUI\", \"La sortie est \u00E9gale \u00E0 l\u2019entr\u00E9e.\"),\n            AND: tuple(\"ET\", \"ET\", \"La sortie vaut 1 lorsque les deux entr\u00E9es valent 1.\"),\n            OR: tuple(\"OU\", \"OU\", \"La sortie vaut 1 lorsqu\u2019au moins une des deux entr\u00E9es vaut 1.\"),\n            XOR: tuple(\"OU-X\", \"OU-X\", \"La sortie vaut 1 lorsque l\u2019une ou l\u2019autre des deux entr\u00E9es vaut 1, mais pas les deux.\"),\n            NAND: tuple(\"NON-ET\", \"N-ET\", \"Porte ET invers\u00E9e: la sortie vaut 1 \u00E0 moins que les deux entr\u00E9es ne valent 1.\"),\n            NOR: tuple(\"NON-OU\", \"N-OU\", \"Porte OU invers\u00E9e: la sortie vaut 1 lorsque les deux entr\u00E9es valent 0.\"),\n            XNOR: tuple(\"NON-OU-X\", \"N-OU-X\", \"Porte OU-X invers\u00E9e: la sortie vaut 1 lorsque les entr\u00E9es valent soit les deux 1, soit les deux 0.\"),\n\n            IMPLY: tuple(\"IMPLIQUE\", \"IMPL\", \"La sortie vaut 1 si la premi\u00E8re entr\u00E9e vaut 0 ou si les deux entr\u00E9es valent 1.\"),\n            RIMPLY: tuple(\"IMPLIQUE (bis)\", \"IMPL\", \"La sortie vaut 1 si la seconde entr\u00E9e vaut 0 ou si les deux entr\u00E9es valent 1.\"),\n            NIMPLY: tuple(\"NON-IMPLIQUE\", \"N-IMPL\", \"Porte IMPLIQUE invers\u00E9e: la sortie ne vaut 1 que lorsque la premi\u00E8re entr\u00E9e vaut 1 et la seconde 0.\"),\n            RNIMPLY: tuple(\"NON-IMPLIQUE (bis)\", \"N-IMPL\", \"Porte IMPLIQUE invers\u00E9e: la sortie ne vaut 1 que lorsque la premi\u00E8re entr\u00E9e vaut 0 et la seconde 1.\"),\n\n            TXA: tuple(\"TRANSFERT-A\", undefined, \"La sortie est \u00E9gale \u00E0 la premi\u00E8re entr\u00E9e; la seconde entr\u00E9e est ignor\u00E9e.\"),\n            TXB: tuple(\"TRANSFERT-B\", undefined, \"La sortie est \u00E9gale \u00E0 la seconde entr\u00E9e; la premi\u00E8re entr\u00E9e est ignor\u00E9e.\"),\n            TXNA: tuple(\"TRANSFERT-NON-A\", undefined, \"La sortie est \u00E9gale \u00E0 la premi\u00E8re entr\u00E9e invers\u00E9e; la seconde entr\u00E9e est ignor\u00E9e.\"),\n            TXNB: tuple(\"TRANSFERT-NON-B\", undefined, \"La sortie est \u00E9gale \u00E0 la seconde entr\u00E9e invers\u00E9e; la premi\u00E8re entr\u00E9e est ignor\u00E9e.\"),\n\n            AND3: tuple(\"ET\", \"ET\", \"La sortie vaut 1 lorsque les trois entr\u00E9es valent 1.\"),\n            OR3: tuple(\"OU\", \"OU\", \"La sortie vaut 1 lorsqu\u2019au moins une des trois entr\u00E9es vaut 1.\"),\n            XOR3: tuple(\"OU-X\", \"OU-X\", \"La sortie vaut 1 lorsqu\u2019un nombre impair d\u2019entr\u00E9es valent 1.\"),\n            NAND3: tuple(\"NON-ET\", \"N-ET\", \"Porte ET invers\u00E9e: la sortie vaut 1 \u00E0 moins que les trois entr\u00E9es ne valent 1.\"),\n            NOR3: tuple(\"NON-OU\", \"N-OU\", \"Porte OU invers\u00E9e: la sortie vaut 1 lorsque les trois entr\u00E9es valent 0.\"),\n            XNOR3: tuple(\"NON-OU-X\", \"N-OU-X\", \"Porte OU-X invers\u00E9e: la sortie vaut 1 lorsqu\u2019un nombre pair d\u2019entr\u00E9es valent 1.\"),\n\n            AND4: tuple(\"ET\", \"ET\", \"La sortie vaut 1 lorsque les quatre entr\u00E9es valent 1.\"),\n            OR4: tuple(\"OU\", \"OU\", \"La sortie vaut 1 lorsqu\u2019au moins une des quatre entr\u00E9es vaut 1.\"),\n            XOR4: tuple(\"OU-X\", \"OU-X\", \"La sortie vaut 1 lorsqu\u2019un nombre impair d\u2019entr\u00E9es valent 1.\"),\n            NAND4: tuple(\"NON-ET\", \"N-ET\", \"Porte ET invers\u00E9e: la sortie vaut 1 \u00E0 moins que les quatre entr\u00E9es ne valent 1.\"),\n            NOR4: tuple(\"NON-OU\", \"N-OU\", \"Porte OU invers\u00E9e: la sortie vaut 1 lorsque les quatre entr\u00E9es valent 0.\"),\n            XNOR4: tuple(\"NON-OU-X\", \"N-OU-X\", \"Porte OU-X invers\u00E9e: la sortie vaut 1 lorsqu\u2019un nombre pair d\u2019entr\u00E9es valent 1.\"),\n\n            tooltip: {\n                GateTitle: (gateType: Modifier) => mods(\"Porte \", gateType),\n                UnknownGate: \"Porte inconnue\",\n                Input: \"Entr\u00E9e\",\n                Output: \"Sortie\",\n                CurrentlyDelivers: \"Actuellement, il livre\",\n                ShouldCurrentlyDeliver: \"Actuellement, il devrait livrer\",\n                UndeterminedOutputBecauseInputUnknown: \"une sortie ind\u00E9termin\u00E9e comme son entr\u00E9e n\u2019est pas connue. Sa table de v\u00E9rit\u00E9 est:\",\n                UndeterminedOutputBecauseInputsUnknown: \"une sortie ind\u00E9termin\u00E9e comme toutes ses entr\u00E9es ne sont connues. Sa table de v\u00E9rit\u00E9 est:\",\n                ThisOutput: \"une sortie de\",\n                BecauseInputIs: \"car son entr\u00E9e est\",\n                AccordingToTruthTable: \"selon la table de v\u00E9rit\u00E9 suivante:\",\n                Inverter: tuple(\"Inverseur (porte \", \")\"),\n                Buffer: tuple(\"Buffer (porte \", \")\"),\n            },\n\n            contextMenu: {\n                ReplaceBy: \"Remplacer par\",\n                GateTempl: template(\"Porte ${type}\", \"type\"),\n                ShowAs: \"Afficher comme\",\n                NormalGateTempl: template(\"Porte ${type} normale\", \"type\"),\n                UnknownGate: \"Porte inconnue (avec \u00AB?\u00BB)\",\n                VariantChangeDesc: \"Changez entre les variantes avec Majuscule + double-clic sur la porte\",\n            },\n        },\n        HalfAdder: {\n            tooltip: {\n                title: \"Demi-additionneur\",\n                desc: \"Additionne deux bits A et B et fournit un bit de somme S et une retenue de sortie C.\",\n            },\n        },\n        InputBit: {\n            tooltip: {\n                title: \"Entr\u00E9e\",\n                WhoseValueIsUnknown: \"dont la valeur n\u2019est pas d\u00E9termin\u00E9e\",\n            },\n            contextMenu: {\n                LockValue: \"Verrouiller cette valeur\",\n                PushButton: \"Poussoir\",\n                ToggleButton: \"Commutateur\",\n            },\n        },\n        InputByte: {\n            tooltip: \"Entr\u00E9e octet (8 bits)\",\n        },\n        InputNibble: {\n            tooltip: \"Entr\u00E9e semioctet (4 bits)\",\n        },\n        InputRandom: {\n            tooltip: {\n                title: \"Valeur al\u00E9atoire\",\n                desc: tuple(\"\u00C0 chaque coup d\u2019horloge, la valeur de sortie sera 1 avec une probabilit\u00E9 de \", \".\"),\n            },\n            contextMenu: {\n                ShowProb: \"Montrer la probabilit\u00E9\",\n            },\n        },\n        LabelRect: {\n            contextMenu: {\n                Size: \"Taille\",\n                SizePrompt: \"Entrez la taille de ce rectangle:\",\n                Rounded: \"Arrondi\",\n                WithBackgroundColor: \"Avec couleur de fond\",\n                SetTitle: \"Ajouter un titre\u2026\",\n                ChangeTitle: \"Changer le titre\u2026\",\n                SetTitlePrompt: \"Entrez le titre \u00E0 afficher ou laissez vide pour le supprimer:\",\n                InsideFrame: \"\u00C0 l\u2019int\u00E9rieur du cadre\",\n                Font: \"Police\u2026\",\n\n                Color: \"Couleur\",\n                ColorYellow: \"Jaune\",\n                ColorRed: \"Rouge\",\n                ColorGreen: \"Vert\",\n                ColorBlue: \"Bleu\",\n                ColorTurquoise: \"Turquoise\",\n                ColorGrey: \"Gris\",\n\n                Border: \"Bordure\",\n                BorderNone: \"Aucune bordure\",\n                Border1px: \"Fine (1 pixel)\",\n                Border2px: \"Moyenne (2 pixels)\",\n                Border3px: \"\u00C9paisse (3 pixels)\",\n                Border5px: \"Tr\u00E8s \u00E9paisse (5 pixels)\",\n                Border10px: \"\u00C9norme (10 pixels)\",\n\n                TitlePlacement: \"Position du titre\",\n                PlacementTop: \"En haut\",\n                PlacementTopLeft: \"En haut \u00E0 gauche\",\n                PlacementTopRight: \"En haut \u00E0 droite\",\n                PlacementBottom: \"En bas\",\n                PlacementBottomLeft: \"En bas \u00E0 gauche\",\n                PlacementBottomRight: \"En bas \u00E0 droite\",\n                PlacementLeft: \"\u00C0 gauche\",\n                PlacementRight: \"\u00C0 droite\",\n                PlacementCenter: \"Au centre\",\n            },\n        },\n        LabelString: {\n            contextMenu: {\n                ChangeText: \"Changer le texte\u2026\",\n                ChangeTextPrompt: \"Choisissez le texte \u00E0 afficher:\",\n                Font: \"Police\u2026\",\n            },\n        },\n        LatchSR: {\n            tooltip: {\n                title: \"Verrou SR\",\n                desc: \"Stocke un bit.\",\n            },\n        },\n        Mux: {\n            tooltip: template(\"Multiplexeur ${from} vers ${to}\", \"from\", \"to\"),\n            contextMenu: {\n                ShowWiring: \"Afficher les connexions\",\n            },\n        },\n        Output7Seg: {\n            tooltip: \"Afficheur 7 segments\",\n        },\n        Output16Seg: {\n            tooltip: \"Afficheur 16 segments\",\n        },\n        OutputAscii: {\n            tooltip: {\n                title: \"Afficheur de caract\u00E8re ASCII\",\n                desc: tuple(\"Affiche le caract\u00E8re ASCII repr\u00E9sent\u00E9 par ses 7 entr\u00E9es, actuellement \", \".\"),\n                CurrentlyUndefined: \"Comme toutes ses entr\u00E9es ne sont pas connues, ce caract\u00E8re est actuellement ind\u00E9fini.\",\n                CurrentlyThisCharacter: \"Actuellement, c\u2019est le caract\u00E8re num\u00E9ro\",\n                WhichIsNotPrintable: \" (un caract\u00E8re non imprimable).\",\n            },\n            contextMenu: {\n                AdditionalDisplay: \"Affichage suppl\u00E9mentaire\",\n                DisplayNone: \"Aucun\",\n                DisplayDecimal: \"Valeur d\u00E9cimale\",\n                DisplayHex: \"Valeur hexad\u00E9cimale\",\n                ChangeDisplayDesc: \"Changez l\u2019affichage suppl\u00E9mentaire avec un double-clic sur le composant\",\n            },\n        },\n        OutputBar: {\n            tooltip: {\n                title: \"Afficheur lumineux\",\n                ValueUnknown: \"Son \u00E9tat est ind\u00E9termin\u00E9 car son entr\u00E9e n\u2019est pas connue.\",\n                ValueZ: \"Son \u00E9tat est ind\u00E9termin\u00E9 car son entr\u00E9e est flottante (haute imp\u00E9dance).\",\n                Value1: tuple(\"Il est actuellement allum\u00E9 car son entr\u00E9e est de \", \".\"),\n                Value0: tuple(\"Il est actuellement \u00E9teint car son entr\u00E9e est de \", \".\"),\n            },\n            contextMenu: {\n                TransparentWhenOff: \"Transparent si \u00E9teint\",\n\n                Display: \"Affichage\",\n                DisplayVerticalBar: \"Barre verticale\",\n                DisplayHorizontalBar: \"Barre horizontale\",\n                DisplaySmallSquare: \"Petit carr\u00E9\",\n                DisplayLargeSquare: \"Grand carr\u00E9\",\n                DisplayChangeDesc: \"Changez l\u2019affichage avec un double-clic sur le composant\",\n\n                Color: \"Couleur\",\n                ColorGreen: \"Vert\",\n                ColorRed: \"Rouge\",\n                ColorYellow: \"Jaune\",\n            },\n        },\n        OutputBit: {\n            tooltip: {\n                title: \"Sortie\",\n                WhoseValueIsUndefined: \"dont la valeur n\u2019est pas d\u00E9termin\u00E9e\",\n            },\n        },\n        OutputByte: {\n            tooltip: \"Sortie octet (8 bits)\",\n        },\n        OutputByteDisplay: {\n            tooltip: {\n                title: \"Afficheur d\u2019octet\",\n\n                desc: tuple(template(\"Affiche la valeur ${radixStr} de ses 8 entr\u00E9es, actuellement \", \"radixStr\"), \".\"),\n            },\n        },\n        OutputDisplayShared: {\n            tooltip: {\n                RadixBinary: \"binaire\",\n                RadixDecimal: \"d\u00E9cimale\",\n                RadixSignedDecimal: \"d\u00E9cimale sign\u00E9e\",\n                RadixHexadecimal: \"hexad\u00E9cimale\",\n                RadixGeneric: template(\"en base ${radix}\", \"radix\"),\n\n                CurrentlyUndefined: \"Comme toutes ses entr\u00E9es ne sont pas connues, cette valeur est actuellement ind\u00E9finie.\",\n            },\n            contextMenu: {\n                DisplayAs: \"Afficher\",\n                DisplayAsDecimal: \"en d\u00E9cimal\",\n                DisplayAsSignedDecimal: \"en d\u00E9cimal sign\u00E9\",\n                DisplayAsHexadecimal: \"en hexad\u00E9cimal\",\n                DisplayAsUnknown: \"comme inconnu\",\n            },\n        },\n        OutputNibble: {\n            tooltip: \"Sortie semioctet (4 bits)\",\n        },\n        OutputNibbleDisplay: {\n            tooltip: {\n                title: \"Afficheur de semioctet\",\n\n                desc: tuple(template(\"Affiche la valeur ${radixStr} de ses 4 entr\u00E9es, actuellement \", \"radixStr\"), \".\"),\n            },\n        },\n        OutputShiftBuffer: {\n            tooltip: \"Affichage \u00E0 d\u00E9calage\",\n            contextMenu: {\n                Decoding: \"D\u00E9codage\",\n                DecodingNone: \"Aucun\",\n                DecodingOctal: \"Octal\",\n                DecodingHex: \"Hexad\u00E9cimal\",\n                DecodingAscii7: \"ASCII (7 bits)\",\n                DecodingAscii8: \"ASCII (8 bits)\",\n                DecodingUint4: \"Entier sur 4 bits\",\n                DecodingInt4: \"Entier sign\u00E9 sur 4 bits\",\n                DecodingUint8: \"Entier sur 8 bits\",\n                DecodingInt8: \"Entier sign\u00E9 sur 8 bits\",\n                DecodingUint16: \"Entier sur 16 bits\",\n                DecodingInt16: \"Entier sign\u00E9 sur 16 bits\",\n                DecodingChangeWarning: \"Attention, changer le d\u00E9codage peut tronquer la valeur stock\u00E9e\",\n\n                Grouping: \"Regrouper les donn\u00E9es\",\n                GroupingNone: \"Pas de regroupement\",\n                GroupBy: template(\"Par ${n}\", \"n\"),\n            },\n            EmptyCaption: \"(vide)\",\n        },\n        Passthrough: {\n            tooltip: \"Broche. Sert uniquement \u00E0 arranger les connexions.\",\n            contextMenu: {\n                Slant: \"Inclinaison\",\n                SlantNone: \"Aucune\",\n                SlantRight: \"De 45\u00B0 vers la droite\",\n                SlantLeft: \"De 45\u00B0 vers la gauche\",\n            },\n        },\n        QuadGate: {\n            tooltip: {\n                title: \"Porte quadruple\",\n                desc: template(\"Effectue quatre fois en parall\u00E8le l\u2019op\u00E9ration logique choisie; actuellement, ${op}.\", \"op\"),\n            },\n            contextMenu: {\n                Type: \"Type\",\n                ShowAsUnknown: \"Masquer le type\",\n            },\n        },\n        QuadTriState: {\n            tooltip: {\n                title: \"Sortie \u00E0 3 \u00E9tats quadruple\",\n                desc: \"Repr\u00E9sente quatre fois une sortie \u00E0 trois \u00E9tats, pilot\u00E9es par un bit de contr\u00F4le.\",\n            },\n        },\n        RAM: {\n            tooltip: {\n                title: \"RAM (m\u00E9moire vive)\",\n                desc: template(\"Stocke ${numWords} lignes de ${wordWidth} bits.\", \"numWords\", \"wordWidth\"),\n            },\n        },\n        Register: {\n            tooltip: {\n                title: \"Registre\",\n                desc: \"Stocke quatre bits.\",\n            },\n        },\n        SwitchedInverter: {\n            tooltip: {\n                title: \"Inverseur commut\u00E9 \u00E0 4 bits\",\n                desc: \"Inverse ses 4 entr\u00E9es si le bit de contr\u00F4le S vaut 1; sinon, les sorties sont \u00E9gales aux entr\u00E9es.\",\n            },\n        },\n        TriStateBuffer: {\n            tooltip: \"Sortie \u00E0 3 \u00E9tats\",\n        },\n        Wire: {\n            contextMenu: {\n                AddMiddlePoint: \"Ajouter un point interm\u00E9diaire\",\n                AddPassthrough: \"Ajouter une broche\",\n\n                CustomPropagationDelay: template(\"D\u00E9lai de propagation sp\u00E9cifique${current}\u2026\", \"current\"),\n                CustomPropagationDelayDesc: template(\"D\u00E9lai de propagation personnalis\u00E9 en millisecondes pour cette connexion (laisser vide pour utiliser la valeur par d\u00E9faut du circuit, actuellement de ${current} ms):\", \"current\"),\n\n                WireColor: \"Couleur du fil\",\n                WireColorBlack: \"Noir (par d\u00E9faut)\",\n                WireColorRed: \"Rouge\",\n                WireColorBlue: \"Bleu\",\n                WireColorYellow: \"Jaune\",\n                WireColorGreen: \"Vert\",\n                WireColorWhite: \"Blanc\",\n\n                WireStyle: \"Style\",\n                WireStyleDefault: \"Par d\u00E9faut\",\n                WireStyleAuto: \"Automatique\",\n                WireStyleStraight: \"Ligne droite\",\n                WireStyleCurved: \"Courbe\",\n            },\n        },\n    },\n    Palette: {\n        Design: \"Concevoir\",\n        Delete: \"Supprimer\",\n        Move: \"D\u00E9placer\",\n        Download: \"T\u00E9l\u00E9charger\",\n        Screenshot: \"Screenshot\",\n        Open: \"Ouvrir\",\n        Reset: \"R\u00E9initialiser\",\n    },\n    Dialogs: {\n        Generic: {\n            Close: \"Fermer\",\n        },\n        Share: {\n            title: \"Partager ce circuit\",\n            URL: \"URL:\",\n            EmbedInIframe: \"Inclusion via <iframe>:\",\n            EmbedWithWebComp: \"Inclusion via un web component:\",\n            EmbedInMarkdown: \"Inclusion en Markdown/Myst:\",\n        },\n    },\n}\n\nconst Strings_en: Strings = {\n    ComponentBar: {\n        SectionNames: {\n            InputOutput: \"Input/ Output\",\n            Gates: \"Gates\",\n            Layout: \"Layout\",\n            Components: \"Compo- nents\",\n        },\n        Labels: {\n            More: \"More\",\n            Less: \"Less\",\n        },\n        Components: RichStringEnum.withProps<ComponentStrings>()({\n            InputBit: \"Input\",\n            OutputBit: \"Output\",\n            OutputByte: [\"Byte (8-Bit) Output\", \"8-Bit Out\"],\n            OutputByteDisplay: [\"Byte (8-Bit) Display\", \"8-Bit Displ.\"],\n            OutputNibble: [\"Nibble (4-Bit) Output\", \"4-Bit Out\"],\n            OutputNibbleDisplay: [\"Nibble (4-Bit) Display\", \"4-Bit Displ.\"],\n            Output7Seg: [\"7-Segment Display\", \"7-Segment\"],\n            Output16Seg: [\"16-Segment Display\", \"16-Segment\"],\n            OutputAscii: [\"ASCII Character (7-Bit) Display\", \"Character\"],\n            OutputBar: [\"Bit Display as a Light Bar\", \"Bar\"],\n            Clock: [\"Clock Generator\", \"Clock\"],\n            InputByte: [\"Byte (8-Bit) Input\", \"8-Bit In\"],\n            InputNibble: [\"Nibble (4-Bit) Input\", \"4-Bit In\"],\n            InputRandom: [\"Random Input\", \"Random\"],\n            OutputShiftBuffer: [\"Display with Shift Buffer\", \"Shift Displ.\"],\n\n            Passthrough1: [\"Passthrough\", \"Passthrough\"],\n            Passthrough4: [\"Passthrough with 4 inputs-outputs\", \"Passthr. (4)\"],\n            Passthrough8: [\"Passthrough with 8 inputs-outputs\", \"Passthr. (8)\"],\n            LabelString: [\"Label\", \"Label\"],\n            LabelRectangle: [\"Grouping Rectangle\", \"Group\"],\n\n            NOT: [\"NOT Gate\", \"NOT\"],\n            BUF: [\"Buffer\", \"BUF\"],\n            TRI: [\"Tri-State Buffer\", \"Tri-state\"],\n            AND: [\"AND Gate\", \"AND\"],\n            OR: [\"OR Gate\", \"OR\"],\n            XOR: [\"XOR Gate\", \"XOR\"],\n            NAND: [\"NAND Gate\", \"NAND\"],\n            NOR: [\"NOR Gate\", \"NOR\"],\n            XNOR: [\"XNOR Gate\", \"XNOR\"],\n            IMPLY: [\"IMPLY Gate\", \"IMPLY\"],\n            NIMPLY: [\"NIMPLY Gate\", \"NIMPLY\"],\n            TRANSFER: [\"Fake 2-Input TRANSFER Gate\", \"TRANSF.\"],\n\n            AND3: [\"3-Input AND Gate\", \"AND (3)\"],\n            OR3: [\"3-Input OR Gate\", \"OR (3)\"],\n            XOR3: [\"3-Input XOR Gate\", \"XOR (3)\"],\n            NAND3: [\"3-Input NAND Gate\", \"NAND (3)\"],\n            NOR3: [\"3-Input NOR Gate\", \"NOR (3)\"],\n            XNOR3: [\"3-Input XNOR Gate\", \"XNOR (3)\"],\n\n            AND4: [\"4-Input AND Gate\", \"AND (4)\"],\n            OR4: [\"4-Input AND Gate\", \"OR (4)\"],\n            XOR4: [\"4-Input AND Gate\", \"XOR (4)\"],\n            NAND4: [\"4-Input AND Gate\", \"NAND (4)\"],\n            NOR4: [\"4-Input AND Gate\", \"NOR (4)\"],\n            XNOR4: [\"4-Input AND Gate\", \"XNOR (4)\"],\n\n            SwitchedInverter: [\"4-Bit Switched Inverter\", \"Switched Inv.\"],\n            QuadGate: [\"Quadruple Gate\", \"4 \u00D7 Gate\"],\n            QuadTriState: [\"Quadruple Tri-State Buffer\", \"4 \u00D7 Tri-state\"],\n\n            HalfAdder: [\"Half Adder\", \"Half Adder\"],\n            Adder: [\"Full Adder\", \"Full Adder\"],\n            ALU: [\"Arithmetic and Logic Unit\", \"ALU\"],\n\n            Mux2to1: [\"2-to-1 Multiplexer (1 Control Bit)\", \"Mux 2-1\"],\n            Mux4to1: [\"4-to-1 Multiplexer (2 Control Bit)\", \"Mux 4-1\"],\n            Mux8to1: [\"8-to-1 Multiplexer (3 Control Bit)\", \"Mux 8-1\"],\n            Mux4to2: [\"4-to-2 Multiplexer (1 Control Bit)\", \"Mux 4-2\"],\n            Mux8to2: [\"8-to-2 Multiplexer (2 Control Bit)\", \"Mux 8-2\"],\n            Mux8to4: [\"8-to-4 Multiplexer (1 Control Bit)\", \"Mux 8-4\"],\n            Mux16to8: [\"16-to-8 Multiplexer (1 Control Bit)\", \"Mux 16-8\"],\n            Demux1to2: [\"1-to-2 Demultiplexer (1 Control Bit)\", \"Demux 1-2\"],\n            Demux1to4: [\"1-to-4 Demultiplexer (2 Control Bit)\", \"Demux 1-4\"],\n            Demux1to8: [\"1-to-8 Demultiplexer (3 Control Bit)\", \"Demux 1-8\"],\n            Demux2to4: [\"2-to-4 Demultiplexer (1 Control Bit)\", \"Demux 2-4\"],\n            Demux2to8: [\"2-to-8 Demultiplexer (2 Control Bit)\", \"Demux 2-8\"],\n            Demux4to8: [\"4-to-8 Demultiplexer (1 Control Bit)\", \"Demux 4-8\"],\n            Demux8to16: [\"8-to-16 Demultiplexer (1 Control Bit)\", \"Demux 8-16\"],\n\n            LatchSR: [\"SR Latch\", \"SR Latch\"],\n            FlipflopJK: [\"JK Flip-Flop\", \"FF-JK\"],\n            FlipflopT: [\"T Flip-Flop\", \"FF-T\"],\n            FlipflopD: [\"D Flip-Flop\", \"FF-D\"],\n            Register: [\"4-Bit Register\", \"Register\"],\n            RAM16x4: [\"RAM, 16 \u00D7 4 Bits\", \"RAM 16\u00D74\"],\n            RAM16x8: [\"RAM, 16 \u00D7 8 Bits\", \"RAM 16\u00D78\"],\n            RAM64x8: [\"RAM, 64 \u00D7 8 Bits\", \"RAM 64\u00D78\"],\n            RAM32x12: [\"RAM, 32 \u00D7 12 Bits\", \"RAM 32\u00D712\"],\n\n            Counter: [\"4-Bit Counter\", \"Counter\"],\n            Decoder7Seg: [\"7-Segment Decoder\", \"7-Seg. Dec.\"],\n            Decoder16Seg: [\"ASCII-to-16-Segment Decoder\", \"16-Seg. Dec.\"],\n            DecoderBCD4: [\"4-Bit-to-BCD Decoder\", \"BCD Dec.\"],\n\n            Comparator: [\"Comparator\", \"Comp.\"],\n        }),\n    },\n    Modes: {\n        FULL: tuple(\"Admin\", \"In addition to the full mode, this enables features like hiding wire colors, setting inputs and output to undetermined values, create faulty components, etc.\"),\n        DESIGN: tuple(\"Full\", \"All standard circuit-design features are enabled\"),\n        CONNECT: tuple(\"Connect\", \"You can move and connect components already on the canvas, but not add more components (the left component bar is not shown)\"),\n        TRYOUT: tuple(\"Tryout\", \"You can only change inputs to try out a already-designed circuit\"),\n        STATIC: tuple(\"Static\", \"Components are displayed without any possible interaction\"),\n    },\n    Orientations: {\n        e: \"Right (default)\",\n        s: \"Down\",\n        w: \"Left\",\n        n: \"Up\",\n    },\n    Settings: {\n        Settings: \"Settings\",\n        CircuitName: \"Name:\",\n        NameOfDownloadedFile: \"This will be the name of the downloaded file.\",\n        hideWireColors: tuple(\"Hide wire colors\", \"If checked, wires are shown with a neutral color instead of showing whether they carry a 1 or a 0.\"),\n        hideInputColors: tuple(\"Hide input colors\", \"If checked, inputs are shown with a neutral color, even if they still deliver a well determined value. Can be used together with hidden wire colors.\"),\n        hideOutputColors: tuple(\"Hide output colors\", \"If checked, outputs are shown with a neutral color. Can be used together with hidden wire colors.\"),\n        hideMemoryContent: tuple(\"Hide stored values\", \"If checked, latches, flip-flops, registers and other memory components don\u2019t show the content they store.\"),\n        showGateTypes: tuple(\"Show gate types\", \"If checked, gates types are displayed textually on top of the gate symbol.\"),\n        showDisconnectedPins: tuple(\"Always show pins\", \"If unchecked, disconnected component pins are hidden in modes where new connections can\u2019t be made (but stay visible otherwise).\"),\n        hideTooltips: tuple(\"Disable tooltips\", \"If checked, additional information in component tooltips (such as truth tables) won\u2019t be shown.\"),\n        groupParallelWires: tuple(\"Group parallel wires\", \"If checked, parallel wires from one component to another will be grouped together as a thicker wire.\"),\n        propagationDelay: \"A 1 or 0 output on some wire will propagate to the other end of the wire after this propagation delay.\",\n        propagationDelayField: tuple(\"Propagation in\", \"ms\"),\n        zoomLevel: \"The zoom level on the circuit components.\",\n        zoomLevelField: tuple(\"Zoom:\", \"%\"),\n        showUserDataLink: tuple(\"See \", \"linked data\"),\n        userDataHeader: \"This data is exported with the circuit:\",\n\n        wireStyle: \"Wire style:\",\n        WireStyleAuto: \"Auto\",\n        WireStyleLine: \"Line\",\n        WireStyleCurve: \"Curve\",\n    },\n    Timeline: {\n        Play: tuple(\"Play\", \"Starts logical time\"),\n        Pause: tuple(\"Pause\", \"Stops logical time\"),\n        Step: tuple(undefined, \"Moves logical time to the next scheduled event\"),\n    },\n    Messages: {\n        ReallyCloseWindow: \"Do you really want to close the window without saving the changes?\",\n    },\n    Components: {\n        Generic: {\n            contextMenu: {\n                Delete: \"Delete\",\n\n                SetIdentifier: \"Set Identifier\u2026\",\n                ChangeIdentifier: tuple(\"Change Identifier (\", \")\"),\n                SetIdentifierPrompt: \"Choose the identifier to use for this component or leave empty to remove it:\\n\\n(The identifier is only used to refer to this component from external JavaScript code.)\",\n\n                Orientation: \"Orientation\",\n                ChangeOrientationDesc: \"Change the orientation with Command + double click on the component\",\n                ShowAsUnknown: \"Show As Unknown\",\n\n                ForceOutputSingle: \"Force Output\",\n                ForceOutputMultiple: \"Force an Output\",\n                Output: \"Output\",\n                NormalOutput: \"Normal Output\",\n                ForceAsUnknown: \"Force as Unkown\",\n                ForceAs1: \"Force as 1\",\n                ForceAs0: \"Force as 0\",\n                ForceAsZ: \"Force as High Impedance\",\n                ForceOutputDesc: \"Force an output with Option + click on an output node\",\n\n                SetName: \"Set Name\u2026\",\n                ChangeName: \"Change Name\u2026\",\n                SetNamePrompt: \"Choose the name to display or leave empty to remove it:\",\n\n                SetFontPrompt: tuple(\"Enter a font specification or leave empty to use the default value (\", \"):\"),\n\n                TriggerOn: \"Trigger on\",\n                TriggerRisingEdge: \"Rising Edge\",\n                TriggerFallingEdge: \"Fallling Edge\",\n\n                ShowContent: \"Show Content\",\n            },\n\n            InputCarryInDesc: \"Cin (Previous Carry)\",\n            InputClockDesc: \"Clock\",\n            InputClearDesc: \"C (Clear, set to 0)\",\n            InputPresetDesc: \"P (Preset, set to 1)\",\n            InputSetDesc: \"S (Set, set to 1)\",\n            InputResetDesc: \"R (Reset, set to 0)\",\n            InputDataDesc: \"D (Data)\",\n            InputWriteEnableDesc: \"WE (Write Enable)\",\n\n            OutputSumDesc: \"S (Sum)\",\n            OutputCarryDesc: \"C (Carry)\",\n            OutputCarryOutDesc: \"Cout (Carry)\",\n            OutputQDesc: \"Q (Normal Output)\",\n            OutputQBarDesc: \"Q\u0305 (Inverted Output)\",\n        },\n        Adder: {\n            caption: \"Adder\",\n            tooltip: \"Adds two bits A and B together with an input carry Cin, and outputs a sum bit S and an output carry Cout.\",\n        },\n        ALU: {\n            add: tuple(\"+\", \"Addition\"),\n            sub: tuple(\"\u2013\", \"Subtraction\"),\n            and: tuple(\"AND\", \"AND\"),\n            or: tuple(\"OR\", \"OR\"),\n            InputCinDesc: \"input carry\",\n            OutputCoutDesc: \"output carry\",\n            tooltip: {\n                title: \"Arithmetic and Logic Unit (ALU)\",\n                CurrentlyCarriesOut: \"Currently carries out\",\n                SomeUnknownOperation: \"an unknown operation\",\n                ThisOperation: \"operation\",\n            },\n            contextMenu: {\n                toggleShowOp: \"Show Operation\",\n            },\n        },\n        Clock: {\n            tooltip: {\n                title: \"Clock\",\n                period: tuple(\"Period: \", \" ms\"),\n                dutycycle: tuple(\"Duty cycle: \", \"%\"),\n                phase: tuple(\"Phase: \", \" ms\"),\n            },\n            contextMenu: {\n                Period: \"Period\",\n            },\n        },\n        Comparator: {\n            caption: \"Comparator\",\n            tooltip: \"Comparator between two bits A and B, enabled by an input E.\",\n        },\n        Counter: {\n            tooltip: {\n                title: \"Counter\",\n                desc: \"4-bit counter.\",\n            },\n            contextMenu: {\n                DisplayTempl: template(\"${desc} Display\", \"desc\"),\n                DisplayNone: \"No\",\n                DisplayDecimal: \"Decimal\",\n                DisplayHex: \"Hexadecimal\",\n            },\n        },\n        Decoder7Seg: {\n            tooltip: \"7-Segment Decoder\",\n        },\n        Decoder16Seg: {\n            tooltip: \"7-Bit ASCII to 16-Segment Decoder\",\n        },\n        DecoderBCD4: {\n            tooltip: \"4-Bit to BCD (Binary-Coded Decimal) Decoder\",\n        },\n        Demux: {\n            tooltip: template(\"${from}-to-${to} Demultiplexer\", \"from\", \"to\"),\n            contextMenu: {\n                UseZForDisconnected: \"Use Z For Disconnected Pins\",\n            },\n        },\n        FlipflopD: {\n            tooltip: {\n                title: \"D Flip-Flop\",\n                desc: \"Stores one bit.\",\n            },\n        },\n        FlipflopJK: {\n            InputJDesc: \"J (Jump, set to 1)\",\n            InputKDesc: \"K (Kill, set to 0)\",\n            tooltip: {\n                title: \"JK Flip-Flop\",\n                desc: \"Stores one bit.\",\n            },\n        },\n        FlipflopT: {\n            InputTDesc: \"T (Toggle)\",\n            tooltip: {\n                title: \"T Flip-Flop\",\n                desc: \"Stores one bit.\",\n            },\n        },\n        Gate: {\n            NOT: tuple(\"NOT\", \"NOT\", \"The output is the inverted input.\"),\n            BUF: tuple(\"BUF\", \"BUF\", \"The output is the same as the input.\"),\n            AND: tuple(\"AND\", \"AND\", \"The output is 1 when both inputs are also 1.\"),\n            OR: tuple(\"OR\", \"OR\", \"The output is 1 when at least one of the inputs is 1.\"),\n            XOR: tuple(\"XOR\", \"XOR\", \"The output is 1 when either one of the inputs is 1, but not both.\"),\n            NAND: tuple(\"NAND\", \"NAND\", \"Inverted AND gate: the output is 1 unless both inputs are 1.\"),\n            NOR: tuple(\"NOR\", \"NOR\", \"Inverted OR gate: the output is 1 when both inputs are 0.\"),\n            XNOR: tuple(\"XNOR\", \"XNOR\", \"Inverted XOR gate: the output is 1 when the inputs either both 1 or both 0.\"),\n\n            IMPLY: tuple(\"IMPLY\", \"IMPL\", \"The output is 1 if the first input is 0 or if both inputs are 1.\"),\n            RIMPLY: tuple(\"IMPLY (bis)\", \"IMPL\", \"The output is 1 if the second input is 0 or if both inputs are 1.\"),\n            NIMPLY: tuple(\"NIMPLY\", \"N-IMPL\", \"Inverted IMPLY gate: the output is only 1 if the first input is 1 and the second one 0.\"),\n            RNIMPLY: tuple(\"NIMPLY (bis)\", \"N-IMPL\", \"Inverted IMPLY gate: la sortie ne vaut 1 que lorsque la premi\u00E8re entr\u00E9e vaut 0 et la seconde 1.\"),\n\n            TXA: tuple(\"TRANSFER-A\", undefined, \"The output is the same as the first input; the second input is ignored.\"),\n            TXB: tuple(\"TRANSFER-B\", undefined, \"The output is the same as the second input; the first input is ignored.\"),\n            TXNA: tuple(\"TRANSFER-NOT-A\", undefined, \"The output is the inverted first input; the second input is ignored.\"),\n            TXNB: tuple(\"TRANSFER-NOT-B\", undefined, \"The output is the inverted second input; the first input is ignored.\"),\n\n            AND3: tuple(\"AND\", \"AND\", \"The output is 1 when all three inputs are 1.\"),\n            OR3: tuple(\"OR\", \"OR\", \"The output is 1 when at least one of the three inputs is 1.\"),\n            XOR3: tuple(\"XOR\", \"XOR\", \"The output is 1 when an odd number of inputs are 1.\"),\n            NAND3: tuple(\"NAND\", \"NAND\", \"Inverted AND gate: the output is 1 unless the three inputs are 1.\"),\n            NOR3: tuple(\"NOR\", \"NOR\", \"Inverted OR gate: the output is 1 when the three inputs are 0.\"),\n            XNOR3: tuple(\"XNOR\", \"XNOR\", \"Inverted XOR gate: the output is 1 when an even number of inputs are 1.\"),\n\n            AND4: tuple(\"AND\", \"AND\", \"The output is 1 when all four inputs are 1.\"),\n            OR4: tuple(\"OR\", \"OR\", \"The output is 1 when at least one of the four inputs is 1.\"),\n            XOR4: tuple(\"XOR\", \"XOR\", \"The output is 1 when an odd number of inputs are 1.\"),\n            NAND4: tuple(\"NAND\", \"NAND\", \"Inverted AND gate: the output is 1 unless the four inputs are 1.\"),\n            NOR4: tuple(\"NOR\", \"NOR\", \"Inverted OR gate: the output is 1 when the four inputs are 0.\"),\n            XNOR4: tuple(\"XNOR\", \"XNOR\", \"Inverted XOR gate: the output is 1 when an even number of inputs are 1.\"),\n\n            tooltip: {\n                GateTitle: (gateType: Modifier) => mods(gateType, \" Gate\"),\n                UnknownGate: \"Unknown Gate\",\n                Input: \"Input\",\n                Output: \"Output\",\n                CurrentlyDelivers: \"It currently delivers\",\n                ShouldCurrentlyDeliver: \"it should currently deliver\",\n                UndeterminedOutputBecauseInputUnknown: \"an unknown output as its input is unknown. Its truth table is:\",\n                UndeterminedOutputBecauseInputsUnknown: \"an unknown output as not all inputs are known. Its truth table is:\",\n                ThisOutput: \"the output\",\n                BecauseInputIs: \"because its input is\",\n                AccordingToTruthTable: \"according to the following truth table:\",\n                Inverter: tuple(\"Inverter (\", \" gate)\"),\n                Buffer: tuple(\"Buffer (\", \" gate)\"),\n            },\n\n            contextMenu: {\n                ReplaceBy: \"Replace By\",\n                GateTempl: template(\"${type} Gate\", \"type\"),\n                ShowAs: \"Show As\",\n                NormalGateTempl: template(\"Normal ${type} Gate\", \"type\"),\n                UnknownGate: \"Unknown Gate (with \u201C?\u201D)\",\n                VariantChangeDesc: \"Switch to a variant with Shift + double-click on the gate\",\n            },\n        },\n        HalfAdder: {\n            tooltip: {\n                title: \"Half Adder\",\n                desc: \"Adds two bits A and B. Outputs a sum bit S and an output carry bit C.\",\n            },\n        },\n        InputBit: {\n            tooltip: {\n                title: \"Input\",\n                WhoseValueIsUnknown: \"whose value is undetermined\",\n            },\n            contextMenu: {\n                LockValue: \"Lock This Value\",\n                PushButton: \"Push Button\",\n                ToggleButton: \"Toggle Button\",\n            },\n        },\n        InputByte: {\n            tooltip: \"Byte (8-bit) Input\",\n        },\n        InputNibble: {\n            tooltip: \"Nibble (4-Bit) Input\",\n        },\n        InputRandom: {\n            tooltip: {\n                title: \"Random Input\",\n                desc: tuple(\"When triggered by the clock, the output value will be 1 with probability \", \".\"),\n            },\n            contextMenu: {\n                ShowProb: \"Show Probability\",\n            },\n        },\n        LabelRect: {\n            contextMenu: {\n                Size: \"Size\",\n                SizePrompt: \"Enter the size of this rectangle:\",\n                Rounded: \"Rounded\",\n                WithBackgroundColor: \"With Background Color\",\n                SetTitle: \"Add Title\u2026\",\n                ChangeTitle: \"Change Title\u2026\",\n                SetTitlePrompt: \"Enter the title to display or leave empty to remove it:\",\n                InsideFrame: \"Inside Frame\",\n                Font: \"Font\",\n\n                Color: \"Color\",\n                ColorYellow: \"Yellow\",\n                ColorRed: \"Red\",\n                ColorGreen: \"Green\",\n                ColorBlue: \"Blue\",\n                ColorTurquoise: \"Turquoise\",\n                ColorGrey: \"Grey\",\n\n                Border: \"Border\",\n                BorderNone: \"None\",\n                Border1px: \"Fine (1 pixel)\",\n                Border2px: \"Medium (2 pixels)\",\n                Border3px: \"Thick (3 pixels)\",\n                Border5px: \"Very Thick (5 pixels)\",\n                Border10px: \"Huge (10 pixels)\",\n\n                TitlePlacement: \"Title Placement\",\n                PlacementTop: \"Top\",\n                PlacementTopLeft: \"Top Left\",\n                PlacementTopRight: \"Top Right\",\n                PlacementBottom: \"Bottom\",\n                PlacementBottomLeft: \"Bottom Left\",\n                PlacementBottomRight: \"Bottom Right\",\n                PlacementLeft: \"Left\",\n                PlacementRight: \"Right\",\n                PlacementCenter: \"Center\",\n            },\n        },\n        LabelString: {\n            contextMenu: {\n                ChangeText: \"Change Text\u2026\",\n                ChangeTextPrompt: \"Type the text to display:\",\n                Font: \"Font\u2026\",\n            },\n        },\n        LatchSR: {\n            tooltip: {\n                title: \"SR Latch\",\n                desc: \"Stores one bit.\",\n            },\n        },\n        Mux: {\n            tooltip: template(\"${from}-to-${to} Multiplexer\", \"from\", \"to\"),\n            contextMenu: {\n                ShowWiring: \"Show Internal Wiring\",\n            },\n        },\n        Output7Seg: {\n            tooltip: \"7-Segment Display\",\n        },\n        Output16Seg: {\n            tooltip: \"16-Segment Display\",\n        },\n        OutputAscii: {\n            tooltip: {\n                title: \"ASCII Character Display\",\n                desc: tuple(\"Displays the ASCII character represented by the 7 inputs, currently \", \".\"),\n                CurrentlyUndefined: \"As not all inputs are known, this character is currently undefined.\",\n                CurrentlyThisCharacter: \"Currently, this character is\",\n                WhichIsNotPrintable: \" (a non-printable character).\",\n            },\n            contextMenu: {\n                AdditionalDisplay: \"Additional Display\",\n                DisplayNone: \"None\",\n                DisplayDecimal: \"Decimal Value\",\n                DisplayHex: \"Hexadecimal Value\",\n                ChangeDisplayDesc: \"Change the additional display with a double-click on the component\",\n            },\n        },\n        OutputBar: {\n            tooltip: {\n                title: \"Bar/LED Display\",\n                ValueUnknown: \"Its state is undefined because its input is unknown.\",\n                ValueZ: \"Its state is undefined because its input is floating (high impedance).\",\n                Value1: tuple(\"It is currently on because its input is \", \".\"),\n                Value0: tuple(\"It is currently off because its input is \", \".\"),\n            },\n            contextMenu: {\n                TransparentWhenOff: \"Transparent When Off\",\n\n                Display: \"Display\",\n                DisplayVerticalBar: \"Vertical Bar\",\n                DisplayHorizontalBar: \"Horizontal Bar\",\n                DisplaySmallSquare: \"Small Square\",\n                DisplayLargeSquare: \"Large Square\",\n                DisplayChangeDesc: \"Change display types with a double-click on the component\",\n\n                Color: \"Color\",\n                ColorGreen: \"Green\",\n                ColorRed: \"Red\",\n                ColorYellow: \"Yellow\",\n            },\n        },\n        OutputBit: {\n            tooltip: {\n                title: \"Output\",\n                WhoseValueIsUndefined: \"whose value is undefined\",\n            },\n        },\n        OutputByte: {\n            tooltip: \"Byte (8-Bit) Output\",\n        },\n        OutputByteDisplay: {\n            tooltip: {\n                title: \"Byte (8-Bit) Display\",\n\n                desc: tuple(template(\"Displays the ${radixStr} value of its 8 inputs, which is currently \", \"radixStr\"), \".\"),\n            },\n        },\n        OutputDisplayShared: {\n            tooltip: {\n                RadixBinary: \"binary\",\n                RadixDecimal: \"decimal\",\n                RadixSignedDecimal: \"signed decimal\",\n                RadixHexadecimal: \"hexadecimal\",\n                RadixGeneric: template(\"base-${radix}\", \"radix\"),\n\n                CurrentlyUndefined: \"As not all inputs are known, this value is currently undefined.\",\n            },\n            contextMenu: {\n                DisplayAs: \"Display as\",\n                DisplayAsDecimal: \"Decimal\",\n                DisplayAsSignedDecimal: \"Signed Decimal\",\n                DisplayAsHexadecimal: \"Hexadecimal\",\n                DisplayAsUnknown: \"Unkown\",\n            },\n        },\n        OutputNibble: {\n            tooltip: \"Nibble (4-Bit) Output\",\n        },\n        OutputNibbleDisplay: {\n            tooltip: {\n                title: \"Nibble (4-Bit) Display\",\n\n                desc: tuple(template(\"Displays the ${radixStr} value of its 4 inputs, which is currently \", \"radixStr\"), \".\"),\n            },\n        },\n        OutputShiftBuffer: {\n            tooltip: \"Shift Buffer Display\",\n            contextMenu: {\n                Decoding: \"Decoding\",\n                DecodingNone: \"None\",\n                DecodingOctal: \"Octal\",\n                DecodingHex: \"Hexadecimal\",\n                DecodingAscii7: \"ASCII (on 7 bits)\",\n                DecodingAscii8: \"ASCII (on 8 bits)\",\n                DecodingUint4: \"4-Bit Integer\",\n                DecodingInt4: \"4-Bit Signed Integer\",\n                DecodingUint8: \"8-Bit Integer\",\n                DecodingInt8: \"8-Bit Signed Integer\",\n                DecodingUint16: \"16-Bit Integer\",\n                DecodingInt16: \"16-Bit Signed Integer\",\n                DecodingChangeWarning: \"Changing the decoding may truncate the stored value.\",\n\n                Grouping: \"Group Data\",\n                GroupingNone: \"No Grouping\",\n                GroupBy: template(\"By ${n}\", \"n\"),\n            },\n            EmptyCaption: \"(empty)\",\n        },\n        Passthrough: {\n            tooltip: \"Passthrough. Only used to arrange wires.\",\n            contextMenu: {\n                Slant: \"Slant\",\n                SlantNone: \"None\",\n                SlantRight: \"Rightward By 45\u00B0\",\n                SlantLeft: \"Leftward By 45\u00B0\",\n            },\n        },\n        QuadGate: {\n            tooltip: {\n                title: \"Quadruple Gate\",\n                desc: template(\"Computes in parallel four times the chosen logical operation, which currently is ${op}.\", \"op\"),\n            },\n            contextMenu: {\n                Type: \"Type\",\n                ShowAsUnknown: \"Hide Type\",\n            },\n        },\n        QuadTriState: {\n            tooltip: {\n                title: \"Quadruple Tri-State Buffer\",\n                desc: \"Represents four tri-state buffers switched by a single control bit.\",\n            },\n        },\n        RAM: {\n            tooltip: {\n                title: \"RAM\",\n                desc: template(\"Stores ${numWords} rows of ${wordWidth} bits.\", \"numWords\", \"wordWidth\"),\n            },\n        },\n        Register: {\n            tooltip: {\n                title: \"Register\",\n                desc: \"Stores four bits.\",\n            },\n        },\n        SwitchedInverter: {\n            tooltip: {\n                title: \"4-Bit Switched Inverter\",\n                desc: \"Inverts its four inputs when the control bit S is on; otherwise, just outputs the inputs.\",\n            },\n        },\n        TriStateBuffer: {\n            tooltip: \"Tri-State Buffer\",\n        },\n        Wire: {\n            contextMenu: {\n                AddMiddlePoint: \"Add Middle Point\",\n                AddPassthrough: \"Add Passthrough\",\n\n                CustomPropagationDelay: template(\"Specific Propagation Delay${current}\u2026\", \"current\"),\n                CustomPropagationDelayDesc: template(\"Specific propagation delay in milliseconds for this connection (leave empty to use the default value for the circuit, which currently is ${current} ms):\", \"current\"),\n\n                WireColor: \"Wire Color\",\n                WireColorBlack: \"Black (default)\",\n                WireColorRed: \"Red\",\n                WireColorGreen: \"Green\",\n                WireColorBlue: \"Blue\",\n                WireColorYellow: \"Yellow\",\n                WireColorWhite: \"White\",\n\n                WireStyle: \"Style\",\n                WireStyleDefault: \"By Default\",\n                WireStyleAuto: \"Automatic\",\n                WireStyleStraight: \"Straight Line\",\n                WireStyleCurved: \"Curve\",\n            },\n        },\n    },\n    Palette: {\n        Design: \"Design\",\n        Delete: \"Delete\",\n        Move: \"Move\",\n        Download: \"Download\",\n        Screenshot: \"Screenshot\",\n        Open: \"Open\",\n        Reset: \"Reset\",\n    },\n    Dialogs: {\n        Generic: {\n            Close: \"Close\",\n        },\n        Share: {\n            title: \"Share Circuit\",\n            URL: \"URL:\",\n            EmbedInIframe: \"Embed using <iframe>:\",\n            EmbedWithWebComp: \"Embed with a web component:\",\n            EmbedInMarkdown: \"Embed in Markdown/Myst:\",\n        },\n    },\n}\n\n\nconst langs = {\n    fr: Strings_fr,\n    en: Strings_en,\n}\n\nexport type Lang = keyof typeof langs\n\nexport const DefaultLang: Lang = \"en\"\n\nexport function isLang(lang: string): lang is Lang {\n    return lang in langs\n}\n\nexport function setLang(l: Lang) {\n    console.log(`Setting language to '${l}'`)\n    S = langs[l]\n}\n\nexport let S: Strings = Strings_fr\n", "import * as t from \"io-ts\"\nimport { DrawZIndex } from \"../ComponentList\"\nimport { GRID_STEP, inRect } from \"../drawutils\"\nimport { Modifier, ModifierObject, span, style } from \"../htmlgen\"\nimport { IconName } from \"../images\"\nimport { DrawParams, LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { Expand, isDefined, isNotNull, isUndefined, Mode, RichStringEnum, typeOrUndefined } from \"../utils\"\n\nexport interface DrawContext {\n    g: CanvasRenderingContext2D\n    drawParams: DrawParams\n    isMouseOver: boolean\n    inNonTransformedFrame(f: (ctx: DrawContextExt) => unknown): void\n}\n\nexport interface DrawContextExt extends DrawContext {\n    rotatePoint(x: number, y: number): readonly [x: number, y: number]\n}\n\nexport type ContextMenuItem =\n    | { _tag: \"sep\" }\n    | { _tag: \"text\", caption: Modifier }\n    | { _tag: \"item\", icon: IconName | undefined, caption: Modifier, danger: boolean | undefined, action: (itemEvent: MouseEvent | TouchEvent, menuEvent: MouseEvent | TouchEvent) => unknown }\n    | { _tag: \"submenu\", icon: IconName | undefined, caption: Modifier, items: ContextMenuData }\n\nexport type ContextMenuData = ContextMenuItem[]\nexport const ContextMenuData = {\n    sep(): ContextMenuItem {\n        return { _tag: \"sep\" }\n    },\n    text(caption: Modifier): ContextMenuItem {\n        return { _tag: \"text\", caption }\n    },\n    item(icon: IconName | undefined, caption: Modifier, action: (itemEvent: MouseEvent | TouchEvent, menuEvent: MouseEvent | TouchEvent) => unknown, danger?: boolean): ContextMenuItem {\n        return { _tag: \"item\", icon, caption, action, danger }\n    },\n    submenu(icon: IconName | undefined, caption: Modifier, items: ContextMenuData): ContextMenuItem {\n        return { _tag: \"submenu\", icon, caption, items }\n    },\n}\n\nexport type ContextMenuItemPlacement = \"start\" | \"mid\" | \"end\" // where to insert items created by components\n\nclass _DrawContextImpl implements DrawContext, DrawContextExt {\n\n    private readonly entranceTransform: DOMMatrix\n    private readonly entranceTransformInv: DOMMatrix\n    private readonly componentTransform: DOMMatrix\n\n    public constructor(\n        private comp: Drawable,\n        public readonly g: CanvasRenderingContext2D,\n        public readonly drawParams: DrawParams,\n        public readonly isMouseOver: boolean,\n    ) {\n        this.entranceTransform = g.getTransform()\n        this.entranceTransformInv = this.entranceTransform.inverse()\n        comp.applyDrawTransform(g)\n        this.componentTransform = g.getTransform()\n    }\n\n    public exit() {\n        this.g.setTransform(this.entranceTransform)\n    }\n\n    public inNonTransformedFrame(f: (ctx: DrawContextExt) => unknown) {\n        this.g.setTransform(this.entranceTransform)\n        f(this)\n        this.g.setTransform(this.componentTransform)\n    }\n\n    public rotatePoint(x: number, y: number): readonly [x: number, y: number] {\n        return mult(this.entranceTransformInv, ...mult(this.componentTransform, x, y))\n    }\n\n}\n\nfunction mult(m: DOMMatrix, x: number, y: number): [x: number, y: number] {\n    return [\n        m.a * x + m.c * y + m.e,\n        m.b * x + m.d * y + m.f,\n    ]\n}\n\nexport abstract class Drawable {\n\n    public readonly editor: LogicEditor\n    public ref: string | undefined = undefined\n\n    protected constructor(editor: LogicEditor) {\n        this.editor = editor\n        this.setNeedsRedraw(\"newly created\")\n    }\n\n    protected setNeedsRedraw(reason: string) {\n        this.editor.redrawMgr.addReason(reason, this)\n    }\n\n    public get drawZIndex(): DrawZIndex {\n        return 1\n    }\n\n    public draw(g: CanvasRenderingContext2D, drawParams: DrawParams): void {\n        const inSelectionRect = drawParams.currentSelection?.isSelected(this) ?? false\n        const ctx = new _DrawContextImpl(this, g, drawParams, this === drawParams.currentMouseOverComp || inSelectionRect)\n        this.doDraw(g, ctx)\n        ctx.exit()\n    }\n\n    public applyDrawTransform(__g: CanvasRenderingContext2D) {\n        // by default, do nothing\n    }\n\n    protected abstract doDraw(g: CanvasRenderingContext2D, ctx: DrawContext): void\n\n    public abstract isOver(x: number, y: number): boolean\n\n    public abstract isInRect(rect: DOMRect): boolean\n\n    public get cursorWhenMouseover(): string | undefined {\n        return undefined\n    }\n\n    public toString(): string {\n        return `${this.constructor.name}(${this.toStringDetails()})`\n    }\n\n    protected toStringDetails(): string {\n        return \"\"\n    }\n\n    public makeTooltip(): ModifierObject | undefined {\n        return undefined\n    }\n\n    public makeContextMenu(): ContextMenuData | undefined {\n        return undefined\n    }\n\n    protected makeSetRefContextMenuItem(): ContextMenuItem {\n        const currentRef = this.ref\n        const s = S.Components.Generic.contextMenu\n        const caption: Modifier = isUndefined(currentRef) ? s.SetIdentifier : span(s.ChangeIdentifier[0], span(style(\"font-family: monospace; font-weight: bolder; font-size: 90%\"), currentRef), s.ChangeIdentifier[1])\n        return ContextMenuData.item(\"ref\", caption, () => {\n            const newRef = window.prompt(s.SetIdentifierPrompt, currentRef)\n            if (newRef !== null) {\n                // OK button pressed\n                this.ref = newRef.length === 0 ? undefined : newRef\n                if (currentRef !== this.ref) {\n                    this.setNeedsRedraw(\"ref changed\")\n                }\n            }\n        })\n    }\n\n    // Return { wantsDragEvents: true } (default) to signal the component\n    // wants to get all mouseDragged and the final mouseUp event. Useful to\n    // return false to allow drag destinations to get a mouseUp\n    public mouseDown(__: MouseEvent | TouchEvent): { wantsDragEvents: boolean } {\n        // empty default implementation\n        return { wantsDragEvents: true }\n    }\n\n    public mouseDragged(__: MouseEvent | TouchEvent) {\n        // empty default implementation\n    }\n\n    // Return true to indicate it was handled and had an effect, in which\n    // case a snapshot should be taken for undo/redo\n    public mouseUp(__: MouseEvent | TouchEvent): boolean {\n        // empty default implementation\n        return false\n    }\n\n    // Return true to indicate it was handled and had an effect\n    // (and presumably doesn't need to be handled any more)\n    public mouseClicked(__: MouseEvent | TouchEvent): boolean {\n        // empty default implementation\n        return false\n    }\n\n    // Return true to indicate it was handled and had an effect\n    // (and presumably doesn't need to be handled any more)\n    public mouseDoubleClicked(__: MouseEvent | TouchEvent): boolean {\n        // empty default implementation\n        return false\n    }\n\n    public keyDown(__: KeyboardEvent): void {\n        // empty default implementation\n    }\n\n}\n\n\n// implemented by components with no array to hold the members\n// for direct access for performance\nexport interface HasPosition {\n\n    readonly posX: number\n    readonly posY: number\n\n}\n\nexport const Orientations_ = {\n    \"e\": {},\n    \"s\": {},\n    \"w\": {},\n    \"n\": {},\n} as const\n\nexport const Orientations = RichStringEnum.withProps<{\n}>()(Orientations_)\n\n\nexport type Orientation = typeof Orientations.type\n\nexport const Orientation = {\n    default: \"e\" as Orientation,\n    invert(o: Orientation): Orientation {\n        switch (o) {\n            case \"e\": return \"w\"\n            case \"w\": return \"e\"\n            case \"n\": return \"s\"\n            case \"s\": return \"n\"\n        }\n    },\n    nextClockwise(o: Orientation): Orientation {\n        switch (o) {\n            case \"e\": return \"s\"\n            case \"s\": return \"w\"\n            case \"w\": return \"n\"\n            case \"n\": return \"e\"\n        }\n    },\n    nextCounterClockwise(o: Orientation): Orientation {\n        switch (o) {\n            case \"e\": return \"n\"\n            case \"n\": return \"w\"\n            case \"w\": return \"s\"\n            case \"s\": return \"e\"\n        }\n    },\n    isVertical(o: Orientation): o is \"s\" | \"n\" {\n        return o === \"s\" || o === \"n\"\n    },\n    add(compOrient: Orientation, nodeOrient: Orientation): Orientation {\n        switch (compOrient) {\n            case \"e\": return nodeOrient\n            case \"w\": return Orientation.invert(nodeOrient)\n            case \"s\": return Orientation.nextClockwise(nodeOrient)\n            case \"n\": return Orientation.nextCounterClockwise(nodeOrient)\n        }\n    },\n}\n\n\n// for compact JSON repr, pos is an array\nexport const PositionSupportRepr = t.type({\n    pos: t.readonly(t.tuple([t.number, t.number])),\n    orient: typeOrUndefined(t.keyof(Orientations_)),\n    ref: typeOrUndefined(t.string),\n})\n\nexport type PositionSupportRepr = Expand<t.TypeOf<typeof PositionSupportRepr>>\n\n\nexport abstract class DrawableWithPosition extends Drawable implements HasPosition {\n\n    private _posX: number\n    private _posY: number\n    private _orient: Orientation\n\n    protected constructor(editor: LogicEditor, savedData: PositionSupportRepr | null) {\n        super(editor)\n\n        // using null and not undefined to prevent subclasses from\n        // unintentionally skipping the parameter\n\n        if (isNotNull(savedData)) {\n            // restoring from saved object\n            this.ref = savedData.ref\n            this._posX = savedData.pos[0]\n            this._posY = savedData.pos[1]\n            this._orient = savedData.orient ?? Orientation.default\n        } else {\n            // creating new object\n            this._posX = Math.max(0, this.editor.mouseX)\n            this._posY = this.editor.mouseY\n            this._orient = Orientation.default\n        }\n    }\n\n    protected toJSONBase(): PositionSupportRepr {\n        return {\n            pos: [this.posX, this.posY] as const,\n            orient: this.orient === Orientation.default ? undefined : this.orient,\n            ref: this.ref,\n        }\n    }\n\n    public get posX() {\n        return this._posX\n    }\n\n    public get posY() {\n        return this._posY\n    }\n\n    public isInRect(rect: DOMRect) {\n        return this._posX >= rect.left && this._posX <= rect.right && this._posY >= rect.top && this._posY <= rect.bottom\n    }\n\n    public get orient() {\n        return this._orient\n    }\n\n    public canRotate() {\n        return true\n    }\n\n    public doSetOrient(newOrient: Orientation) {\n        this._orient = newOrient\n        this.setNeedsRedraw(\"orientation changed\")\n    }\n\n    public get width(): number {\n        return Orientation.isVertical(this._orient) ? this.unrotatedHeight : this.unrotatedWidth\n    }\n\n    public get height(): number {\n        return Orientation.isVertical(this._orient) ? this.unrotatedWidth : this.unrotatedHeight\n    }\n\n    public abstract get unrotatedWidth(): number\n\n    public abstract get unrotatedHeight(): number\n\n    public override applyDrawTransform(g: CanvasRenderingContext2D) {\n        const rotation = (() => {\n            switch (this._orient) {\n                case \"e\": return undefined\n                case \"s\": return Math.PI / 2\n                case \"w\": return Math.PI\n                case \"n\": return -Math.PI / 2\n            }\n        })()\n\n        if (isDefined(rotation)) {\n            g.translate(this.posX, this.posY)\n            g.rotate(rotation)\n            g.translate(-this.posX, -this.posY)\n        }\n    }\n\n    public isOver(x: number, y: number) {\n        return this.editor.mode >= Mode.CONNECT && inRect(this._posX, this._posY, this.width, this.height, x, y)\n    }\n\n    protected trySetPosition(posX: number, posY: number, snapToGrid: boolean): undefined | [number, number] {\n        const roundTo = snapToGrid ? GRID_STEP : (GRID_STEP / 2)\n        posX = Math.round(posX / roundTo) * roundTo\n        posY = Math.round(posY / roundTo) * roundTo\n        if (posX !== this._posX || posY !== this.posY) {\n            this._posX = posX\n            this._posY = posY\n            this.setNeedsRedraw(\"position changed\")\n            return [posX, posY]\n        }\n        return undefined\n    }\n\n    protected makeChangeOrientationContextMenuItem(): ContextMenuItem {\n        const s = S.Components.Generic.contextMenu\n        return ContextMenuData.submenu(\"direction\", s.Orientation, [\n            ...Orientations.values.map(orient => {\n                const isCurrent = this._orient === orient\n                const icon = isCurrent ? \"check\" : \"none\"\n                const caption = S.Orientations[orient]\n                const action = isCurrent ? () => undefined : () => {\n                    this.doSetOrient(orient)\n                }\n                return ContextMenuData.item(icon, caption, action)\n            }),\n            ContextMenuData.sep(),\n            ContextMenuData.text(s.ChangeOrientationDesc),\n        ])\n    }\n\n}\n\n\ninterface DragContext {\n    mouseOffsetToPosX: number\n    mouseOffsetToPosY: number\n    lastAnchorX: number\n    lastAnchorY: number\n}\n\n\nexport abstract class DrawableWithDraggablePosition extends DrawableWithPosition {\n\n    private _isMovingWithContext: undefined | DragContext = undefined\n\n    protected constructor(editor: LogicEditor, savedData: PositionSupportRepr | null) {\n        super(editor, savedData)\n    }\n\n    public get isMoving() {\n        return isDefined(this._isMovingWithContext)\n    }\n\n    protected tryStartMoving(e: MouseEvent | TouchEvent) {\n        if (isUndefined(this._isMovingWithContext)) {\n            const [offsetX, offsetY] = this.editor.offsetXY(e)\n            this._isMovingWithContext = {\n                mouseOffsetToPosX: offsetX - this.posX,\n                mouseOffsetToPosY: offsetY - this.posY,\n                lastAnchorX: this.posX,\n                lastAnchorY: this.posY,\n            }\n        }\n    }\n\n    protected updateWhileMoving(e: MouseEvent | TouchEvent) {\n        this.updatePositionIfNeeded(e)\n        this.editor.moveMgr.setDrawableMoving(this)\n    }\n\n    protected tryStopMoving(): boolean {\n        let wasMoving = false\n        if (isDefined(this._isMovingWithContext)) {\n            this._isMovingWithContext = undefined\n            wasMoving = true\n        }\n        this.editor.moveMgr.setDrawableStoppedMoving(this)\n        return wasMoving\n    }\n\n    private updatePositionIfNeeded(e: MouseEvent | TouchEvent): undefined | [number, number] {\n        const [x, y] = this.editor.offsetXY(e)\n        const snapToGrid = !e.metaKey\n        const newPos = this.updateSelfPositionIfNeeded(x, y, snapToGrid, e)\n        if (isDefined(newPos)) { // position changed\n            this.positionChanged()\n        }\n        return newPos\n    }\n\n    public setPosition(x: number, y: number) {\n        const newPos = this.trySetPosition(x, y, false)\n        if (isDefined(newPos)) { // position changed\n            this.positionChanged()\n        }\n    }\n\n    protected positionChanged() {\n        // do nothing by default\n    }\n\n    protected updateSelfPositionIfNeeded(x: number, y: number, snapToGrid: boolean, e: MouseEvent | TouchEvent): undefined | [number, number] {\n        if (isDefined(this._isMovingWithContext)) {\n            const { mouseOffsetToPosX, mouseOffsetToPosY, lastAnchorX, lastAnchorY } = this._isMovingWithContext\n            let targetX = x - mouseOffsetToPosX\n            let targetY = y - mouseOffsetToPosY\n            if (e.shiftKey) {\n                // move along axis only\n                const dx = Math.abs(lastAnchorX - targetX)\n                const dy = Math.abs(lastAnchorY - targetY)\n                if (dx <= dy) {\n                    targetX = lastAnchorX\n                } else {\n                    targetY = lastAnchorY\n                }\n            }\n            return this.trySetPosition(targetX, targetY, snapToGrid)\n        }\n        return undefined\n    }\n\n}", "import { Component, ComponentName } from \"./components/Component\"\nimport { DrawContext, DrawContextExt, HasPosition, Orientation } from \"./components/Drawable\"\nimport { RectangleColor } from \"./components/LabelRect\"\nimport { Node, WireColor } from \"./components/Node\"\nimport { LedColor } from \"./components/OutputBar\"\nimport { LogicEditor } from \"./LogicEditor\"\nimport { isArray, isDefined, isHighImpedance, isNumber, isString, isUndefined, isUnknown, LogicValue, Mode, Unknown } from \"./utils\"\n\n\n//\n// GRID, GENERAL\n//\n\nexport const GRID_STEP = 10\nexport const WIRE_WIDTH = 8\nexport const WAYPOINT_DIAMETER = 8\nconst WAYPOINT_HIT_RANGE = WAYPOINT_DIAMETER + 5\n\n\nexport function pxToGrid(x: number) {\n    return Math.round(x / GRID_STEP)\n}\n\nexport function clampZoom(zoom: number) {\n    return Math.max(0.1, Math.min(10, zoom / 100))\n}\n\nexport function dist(x0: number, y0: number, x1: number, y1: number): number {\n    const dx = x1 - x0\n    const dy = y1 - y0\n    return Math.sqrt(dx * dx + dy * dy)\n}\n\nexport function inRect(centerX: number, centerY: number, width: number, height: number, pointX: number, pointY: number): boolean {\n    const w2 = width / 2\n    const h2 = height / 2\n    return pointX >= centerX - w2 && pointX < centerX + w2 &&\n        pointY >= centerY - h2 && pointY < centerY + h2\n}\n\n\n//\n// COLORS\n//\n\nexport type ColorGreyLevel = number\nexport type ColorComponentsRGB = [number, number, number]\nexport type ColorComponentsRGBA = [number, number, number, number]\nexport type ColorString = string\n\nexport let COLOR_BACKGROUND: ColorString\nexport let COLOR_OFF_BACKGROUND: ColorString\nexport let COLOR_BACKGROUND_UNUSED_REGION: ColorString\nexport let COLOR_BACKGROUND_INVALID: ColorString\nexport let COLOR_BORDER: ColorString\nexport let COLOR_GRID_LINES: ColorString\nexport let COLOR_GRID_LINES_GUIDES: ColorString\nexport let COLOR_LABEL_OFF: ColorString\nexport let COLOR_LABEL_ON: ColorString\nexport let COLORCOMP_COMPONENT_BORDER: ColorGreyLevel\nexport let COLOR_COMPONENT_BORDER: ColorString\nexport let COLOR_COMPONENT_INNER_LABELS: ColorString\nexport let COLOR_WIRE_BORDER: ColorString\nexport let COLOR_MOUSE_OVER: ColorString\nexport let COLOR_MOUSE_OVER_NORMAL: ColorString\nexport let COLOR_MOUSE_OVER_DANGER: ColorString\nexport let COLOR_NODE_MOUSE_OVER: ColorString\nexport let COLORCOMPS_FULL: ColorComponentsRGB\nexport let COLOR_FULL: ColorString\nexport let COLOR_DARK_RED: ColorString\nexport let COLORCOMPS_EMPTY: ColorComponentsRGB\nexport let COLOR_EMPTY: ColorString\nexport let COLOR_UNKNOWN: ColorString\nexport let COLOR_HIGH_IMPEDANCE: ColorString\nexport let COLOR_GATE_NAMES: ColorString\nexport let COLOR_LED_ON: { [C in LedColor]: ColorString }\nexport let COLOR_WIRE: { [C in WireColor]: ColorString }\nexport let COLOR_RECTANGLE_BACKGROUND: { [C in RectangleColor]: ColorString }\nexport let COLOR_RECTANGLE_BORDER: { [C in RectangleColor]: ColorString }\nexport let PATTERN_STRIPED_GRAY: CanvasPattern\n\nlet _currentModeIsDark = false\ndoSetColors(_currentModeIsDark)\n\nexport function setColors(darkMode: boolean) {\n    if (darkMode !== _currentModeIsDark) {\n        doSetColors(darkMode)\n        for (const editor of LogicEditor.allConnectedEditors) {\n            editor.wrapHandler(() => {\n                editor.redrawMgr.addReason(\"dark/light mode switch\", null)\n            })()\n        }\n    }\n}\n\nfunction doSetColors(darkMode: boolean) {\n    if (!darkMode) {\n        // Light Theme\n        COLOR_BACKGROUND = ColorString(0xFF)\n        COLOR_OFF_BACKGROUND = ColorString(0xDF)\n        COLOR_BACKGROUND_INVALID = ColorString([0xFF, 0xBB, 0xBB])\n        COLOR_BACKGROUND_UNUSED_REGION = ColorString(0xEE)\n        COLOR_BORDER = ColorString(200)\n        COLOR_GRID_LINES = ColorString(240)\n        COLOR_GRID_LINES_GUIDES = ColorString(215)\n        COLOR_LABEL_OFF = ColorString(0xFF)\n        COLOR_LABEL_ON = ColorString(0)\n        COLORCOMP_COMPONENT_BORDER = 0x00\n        COLOR_COMPONENT_INNER_LABELS = ColorString(0xAA)\n        COLOR_WIRE_BORDER = ColorString(80)\n        COLOR_MOUSE_OVER_NORMAL = ColorString([0, 0x7B, 0xFF])\n        COLOR_MOUSE_OVER_DANGER = ColorString([194, 34, 14])\n        COLOR_NODE_MOUSE_OVER = ColorString([128, 128, 128, 0.5])\n        COLORCOMPS_FULL = [255, 193, 7]\n        COLOR_DARK_RED = ColorString([180, 0, 0])\n        COLORCOMPS_EMPTY = [52, 58, 64]\n        COLOR_UNKNOWN = ColorString([152, 158, 164])\n        COLOR_HIGH_IMPEDANCE = ColorString([137, 114, 35])\n        COLOR_GATE_NAMES = ColorString([190, 190, 190])\n        COLOR_LED_ON = {\n            green: ColorString([20, 232, 20]),\n            red: ColorString([232, 20, 20]),\n            yellow: ColorString([232, 232, 20]),\n        }\n        COLOR_WIRE = {\n            black: COLOR_WIRE_BORDER,\n            red: ColorString([206, 63, 57]),\n            blue: ColorString([77, 102, 153]),\n            yellow: ColorString([245, 209, 63]),\n            green: ColorString([87, 136, 97]),\n            white: ColorString([230, 217, 199]),\n        }\n        PATTERN_STRIPED_GRAY = createStripedPattern(COLOR_BACKGROUND, \"rgba(128,128,128,0.2)\")\n\n    } else {\n        // Dark Theme\n        COLOR_BACKGROUND = ColorString([19, 20, 22])\n        COLOR_OFF_BACKGROUND = ColorString(60)\n        COLOR_BACKGROUND_INVALID = ColorString([0xA8, 0x14, 0x14])\n        COLOR_BACKGROUND_UNUSED_REGION = ColorString(55)\n        COLOR_BORDER = ColorString(0x55)\n        COLOR_GRID_LINES = ColorString(30)\n        COLOR_GRID_LINES_GUIDES = ColorString(45)\n        COLOR_LABEL_OFF = ColorString(185)\n        COLOR_LABEL_ON = COLOR_BACKGROUND\n        COLORCOMP_COMPONENT_BORDER = 200\n        COLOR_COMPONENT_INNER_LABELS = ColorString(0x8B)\n        COLOR_WIRE_BORDER = ColorString(175)\n        COLOR_MOUSE_OVER_NORMAL = ColorString([0, 0x7B, 0xFF])\n        COLOR_MOUSE_OVER_DANGER = ColorString([194, 34, 14])\n        COLOR_NODE_MOUSE_OVER = ColorString([128, 128, 128, 0.5])\n        COLORCOMPS_FULL = [255, 193, 7]\n        COLOR_DARK_RED = ColorString([180, 0, 0])\n        COLORCOMPS_EMPTY = [80, 89, 99]\n        COLOR_UNKNOWN = ColorString([108, 106, 98])\n        COLOR_HIGH_IMPEDANCE = ColorString([103, 84, 23])\n        COLOR_GATE_NAMES = ColorString([95, 95, 95])\n        COLOR_LED_ON = {\n            green: ColorString([11, 144, 11]),\n            red: ColorString([144, 11, 11]),\n            yellow: ColorString([144, 144, 11]),\n        }\n        COLOR_WIRE = {\n            black: COLOR_WIRE_BORDER,\n            red: ColorString([206, 63, 57]), // TODO update these colors below\n            blue: ColorString([77, 102, 153]),\n            yellow: ColorString([245, 209, 63]),\n            green: ColorString([87, 136, 97]),\n            white: ColorString([230, 217, 199]),\n        }\n\n        PATTERN_STRIPED_GRAY = createStripedPattern(COLOR_BACKGROUND, \"rgba(128,128,128,0.4)\")\n\n    }\n\n    // same for both light and dark theme thanks to alpha\n    COLOR_RECTANGLE_BACKGROUND = {\n        yellow: ColorString([230, 230, 0, 0.2]),\n        blue: ColorString([54, 54, 255, 0.2]),\n        green: ColorString([54, 255, 54, 0.2]),\n        red: ColorString([255, 54, 54, 0.2]),\n        grey: ColorString([120, 120, 120, 0.2]),\n        turquoise: ColorString([0, 210, 210, 0.2]),\n    }\n    COLOR_RECTANGLE_BORDER = {\n        yellow: ColorString([196, 196, 0, 0.5]),\n        blue: ColorString([115, 115, 255, 0.5]),\n        green: ColorString([0, 167, 0, 0.5]),\n        red: ColorString([214, 0, 0, 0.5]),\n        grey: ColorString([35, 35, 35, 0.5]),\n        turquoise: ColorString([0, 162, 162, 0.5]),\n    }\n    COLOR_COMPONENT_BORDER = ColorString(COLORCOMP_COMPONENT_BORDER)\n    setColorMouseOverIsDanger(false)\n    COLOR_FULL = ColorString(COLORCOMPS_FULL)\n    COLOR_EMPTY = ColorString(COLORCOMPS_EMPTY)\n\n    _currentModeIsDark = darkMode\n}\n\nfunction createStripedPattern(background: ColorString, stripeColor: string) {\n    const canvas = document.createElement(\"canvas\")\n    const step = 4\n    canvas.width = 2 * step\n    canvas.height = 6 * step\n    const g = canvas.getContext(\"2d\")!\n    g.fillStyle = background\n    g.fillRect(0, 0, canvas.width, canvas.height)\n    g.fillStyle = stripeColor\n    g.beginPath()\n    g.moveTo(step, 0)\n    g.lineTo(canvas.width, 0)\n    g.lineTo(0, canvas.height)\n    g.lineTo(0, 3 * step)\n    g.closePath()\n    g.moveTo(step, canvas.height)\n    g.lineTo(canvas.width, canvas.height)\n    g.lineTo(canvas.width, 3 * step)\n    g.closePath()\n    g.fill()\n    const pattern = g.createPattern(canvas, \"repeat\")\n    if (pattern === null) {\n        console.log(\"Failed to create pattern\")\n    }\n    return pattern!\n}\n\nexport function setColorMouseOverIsDanger(mouseOverIsDanger: boolean) {\n    COLOR_MOUSE_OVER = mouseOverIsDanger ? COLOR_MOUSE_OVER_DANGER : COLOR_MOUSE_OVER_NORMAL\n}\n\nexport function ColorString(input: ColorGreyLevel | ColorComponentsRGB | ColorComponentsRGBA): ColorString {\n    if (isArray(input)) {\n        if (input.length === 3) {\n            return `rgb(${input[0]},${input[1]},${input[2]})`\n        }\n        // else, rgba\n        return `rgba(${input[0]},${input[1]},${input[2]},${input[3]})`\n    }\n    // else, grey\n    return `rgb(${input},${input},${input})`\n}\n\nexport function colorComps(c: ColorString) {\n    const PREFIX = \"rgb(\"\n    if (c.startsWith(PREFIX)) {\n        c = c.substring(PREFIX.length)\n    }\n    const SUFFIX = \")\"\n    if (c.endsWith(SUFFIX)) {\n        c = c.substring(0, c.length - SUFFIX.length)\n    }\n    return c.split(',').map(compStr => parseInt(compStr))\n}\n\nexport function colorForBoolean(value: LogicValue): ColorString {\n    return isUnknown(value) ? COLOR_UNKNOWN : isHighImpedance(value) ? COLOR_HIGH_IMPEDANCE : value ? COLOR_FULL : COLOR_EMPTY\n}\n\nexport function colorForFraction(fraction: number): ColorString {\n    const c: ColorComponentsRGB = [\n        (COLORCOMPS_FULL[0] - COLORCOMPS_EMPTY[0]) * fraction + COLORCOMPS_EMPTY[0],\n        (COLORCOMPS_FULL[1] - COLORCOMPS_EMPTY[1]) * fraction + COLORCOMPS_EMPTY[1],\n        (COLORCOMPS_FULL[2] - COLORCOMPS_EMPTY[2]) * fraction + COLORCOMPS_EMPTY[2],\n    ]\n    return ColorString(c)\n}\n\n\n//\n// FONTS\n//\n\nexport const FONT_LABEL_DEFAULT = \"18px sans-serif\"\n\n\n//\n// DRAWING\n//\n\n// Adding to current path\n\nexport function triangle(g: CanvasRenderingContext2D, x0: number, y0: number, x1: number, y1: number, x2: number, y2: number) {\n    g.moveTo(x0, y0)\n    g.lineTo(x1, y1)\n    g.lineTo(x2, y2)\n    g.closePath()\n}\n\nexport function circle(g: CanvasRenderingContext2D, cx: number, cy: number, d: number) {\n    const r = d / 2\n    g.ellipse(cx, cy, r, r, 0, 0, 2 * Math.PI)\n}\n\n// Stroking/filling\n\nexport function strokeSingleLine(g: CanvasRenderingContext2D, x0: number, y0: number, x1: number, y1: number) {\n    g.beginPath()\n    g.moveTo(x0, y0)\n    g.lineTo(x1, y1)\n    g.stroke()\n}\n\nexport function strokeBezier(g: CanvasRenderingContext2D, x0: number, y0: number, anchorX0: number, anchorY0: number, anchorX1: number, anchorY1: number, x1: number, y1: number) {\n    g.beginPath()\n    g.moveTo(x0, y0)\n    g.bezierCurveTo(anchorX0, anchorY0, anchorX1, anchorY1, x1, y1)\n    g.stroke()\n}\n\nexport function shouldShowNode(node: Node): boolean {\n    const editor = node.editor\n    if (editor.mode <= Mode.TRYOUT && !editor.options.showDisconnectedPins && node.isDisconnected) {\n        return false\n    }\n    return true\n}\n\nexport function drawWireLineToComponent(g: CanvasRenderingContext2D, node: Node, x1: number, y1: number, withTriangle = false) {\n    if (!shouldShowNode(node)) {\n        return\n    }\n    const neutral = node.editor.options.hideWireColors\n    const x0 = node.posXInParentTransform\n    const y0 = node.posYInParentTransform\n    drawStraightWireLine(g, x0, y0, x1, y1, node.value, node.color, neutral)\n    if (withTriangle) {\n        g.strokeStyle = COLOR_COMPONENT_BORDER\n        g.fillStyle = COLOR_COMPONENT_BORDER\n        g.beginPath()\n        if (x0 === x1) {\n            // vertical line\n            const pointsDown = (node.isOutput && y1 <= y0) || (!node.isOutput && y0 <= y1)\n            if (pointsDown) {\n                const shift = node.isOutput ? 2 : -1\n                triangle(g,\n                    x1 - 3, y1 - 2 + shift,\n                    x1 + 3, y1 - 2 + shift,\n                    x1, y1 + 1 + shift,\n                )\n            } else {\n                const shift = node.isOutput ? -2 : -1\n                triangle(g,\n                    x1 - 3, y1 - 2 - shift,\n                    x1 + 3, y1 - 2 - shift,\n                    x1, y1 - 5 - shift,\n                )\n            }\n        } else if (y0 === y1) {\n            // horizontal line\n            const shift = node.isOutput ? 2 : -1\n            const pointsRight = (node.isOutput && x1 <= x0) || (!node.isOutput && x0 <= x1)\n            if (pointsRight) {\n                triangle(g,\n                    x1 - 2 + shift, y1 - 3,\n                    x1 - 2 + shift, y1 + 3,\n                    x1 + 1 + shift, y1,\n                )\n            } else {\n                triangle(g,\n                    x1 + 2 - shift, y1 - 3,\n                    x1 + 2 - shift, y1 + 3,\n                    x1 - 1 - shift, y1,\n                )\n            }\n        } else {\n            console.log(`ERROR  wireLineToComponent cannot draw triangle as line is not vertical or horizontal between (${x0}, ${y0}) and (${x1}, ${y1})`)\n        }\n        g.fill()\n        g.stroke()\n    }\n}\n\nexport function drawStraightWireLine(g: CanvasRenderingContext2D, x0: number, y0: number, x1: number, y1: number, value: LogicValue, color: WireColor, neutral: boolean) {\n    g.beginPath()\n    g.moveTo(x0, y0)\n    g.lineTo(x1, y1)\n    strokeAsWireLine(g, value, color, false, neutral)\n}\n\nexport function strokeAsWireLine(g: CanvasRenderingContext2D, value: LogicValue, color: WireColor, isMouseOver: boolean, neutral: boolean, path?: Path2D) {\n    const oldLineCap = g.lineCap\n    g.lineCap = \"butt\"\n\n    const mainStrokeWidth = WIRE_WIDTH / 2\n    if (isMouseOver) {\n        g.lineWidth = mainStrokeWidth + 2\n        g.strokeStyle = COLOR_MOUSE_OVER\n    } else {\n        g.lineWidth = mainStrokeWidth\n        g.strokeStyle = COLOR_WIRE[color]\n    }\n    if (path) { g.stroke(path) }\n    else { g.stroke() }\n\n    g.strokeStyle = neutral ? COLOR_UNKNOWN : colorForBoolean(value)\n    g.lineWidth = mainStrokeWidth - 2\n    if (path) { g.stroke(path) }\n    else { g.stroke() }\n\n    g.lineCap = oldLineCap\n}\n\nexport function isOverWaypoint(x: number, y: number, waypointX: number, waypointY: number): boolean {\n    return dist(x, y, waypointX, waypointY) < WAYPOINT_HIT_RANGE / 2\n}\n\nexport enum NodeStyle {\n    IN_CONNECTED,\n    IN_DISCONNECTED,\n    OUT_CONNECTED,\n    OUT_DISCONNECTED,\n    IN_OUT,\n    WAYPOINT,\n}\n\nexport function drawWaypoint(g: CanvasRenderingContext2D, ctx: DrawContext, x: number, y: number, style: NodeStyle, value: LogicValue, isMouseOver: boolean, neutral: boolean, showForced: boolean, showForcedWarning: boolean, parentOrientIsVertical: boolean) {\n\n    const [circleColor, thickness] =\n        showForced\n            ? [COLOR_DARK_RED, 3] // show forced nodes with red border if not in teacher mode\n            : [COLOR_WIRE_BORDER, 1]   // show normally\n\n    g.strokeStyle = circleColor\n    g.lineWidth = thickness\n    g.fillStyle = style === NodeStyle.IN_DISCONNECTED ? \"white\" : (neutral ? COLOR_UNKNOWN : colorForBoolean(value))\n\n    g.beginPath()\n    circle(g, x, y, WAYPOINT_DIAMETER)\n    g.fill()\n    g.stroke()\n\n    if (isMouseOver) {\n        g.fillStyle = COLOR_NODE_MOUSE_OVER\n        g.beginPath()\n        circle(g, x, y, WAYPOINT_DIAMETER * 2)\n        g.fill()\n        g.stroke()\n    }\n\n    if (showForcedWarning) {\n        // forced value to something that is contrary to normal output\n        g.textAlign = \"center\"\n        g.fillStyle = circleColor\n        g.font = \"bold 14px sans-serif\"\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillText(\"!!\", ...ctx.rotatePoint(\n                x + (parentOrientIsVertical ? 13 : 0),\n                y + (parentOrientIsVertical ? 0 : -13),\n            ))\n        })\n    }\n}\n\nexport function drawLabel(ctx: DrawContextExt, compOrient: Orientation, text: string | undefined, anchor: Orientation | undefined, x: number, y: Node): void\nexport function drawLabel(ctx: DrawContextExt, compOrient: Orientation, text: string | undefined, anchor: Orientation | undefined, x: Node, y: number): void\nexport function drawLabel(ctx: DrawContextExt, compOrient: Orientation, text: string | undefined, anchor: Orientation | undefined, x: number, y: number, referenceNode: Node | undefined): void\n\nexport function drawLabel(ctx: DrawContextExt, compOrient: Orientation, text: string | undefined, anchor: Orientation | undefined, x: number | Node, y: number | Node, referenceNode?: Node) {\n    if (isUndefined(text)) {\n        return\n    }\n\n    let nodeHidden = false\n    if (isUndefined(referenceNode)) {\n        if (!isNumber(x)) {\n            referenceNode = x\n        } else if (!isNumber(y)) {\n            referenceNode = y\n        }\n    }\n    if (isDefined(referenceNode)) {\n        nodeHidden = !shouldShowNode(referenceNode)\n    }\n    if (nodeHidden) {\n        return\n    }\n\n    // we assume a color and a font have been set before this function is called\n    const [halign, valign, dx, dy] = (() => {\n        if (isUndefined(anchor)) {\n            return [\"center\", \"middle\", 0, 0] as const\n        }\n        const rotatedAnchor = Orientation.add(compOrient, anchor)\n        switch (rotatedAnchor) {\n            case \"e\": return [\"right\", \"middle\", -3, 0] as const\n            case \"w\": return [\"left\", \"middle\", 3, 0] as const\n            case \"n\": return [\"center\", \"top\", 0, 2] as const\n            case \"s\": return [\"center\", \"bottom\", 0, -2] as const\n        }\n    })()\n\n    const xx = (isNumber(x) ? x : x.posXInParentTransform)\n    const yy = (isNumber(y) ? y : y.posYInParentTransform)\n    const [finalX, finalY] = ctx.rotatePoint(xx, yy)\n\n    const g = ctx.g\n    g.textAlign = halign\n    g.textBaseline = valign\n    g.fillText(text, finalX + dx, finalY + dy)\n}\n\nexport function drawRoundValueCentered(g: CanvasRenderingContext2D, value: LogicValue, comp: HasPosition, opts?: { fillStyle?: string, small?: boolean }) {\n    drawRoundValue(g, value, comp.posX, comp.posY, opts)\n}\n\nexport function drawRoundValue(g: CanvasRenderingContext2D, value: LogicValue, x: number, y: number, opts?: { fillStyle?: string, small?: boolean }) {\n    g.textAlign = \"center\"\n    g.textBaseline = \"middle\"\n\n    let spec = \"\"\n    let label = \"\"\n\n    const small = opts?.small ?? false\n    const fillStyle = opts?.fillStyle\n\n    const sizeStrBig = small ? \"12\" : \"18\"\n    const sizeStrSmall = small ? \"10\" : \"16\"\n\n    if (isUnknown(value)) {\n        g.fillStyle = fillStyle ?? COLOR_LABEL_OFF\n        spec = \"bold \" + sizeStrBig\n        label = '?'\n    } else if (isHighImpedance(value)) {\n        g.fillStyle = fillStyle ?? COLOR_LABEL_OFF\n        spec = sizeStrSmall\n        label = 'Z'\n    } else if (value) {\n        g.fillStyle = fillStyle ?? COLOR_LABEL_ON\n        spec = \"bold \" + sizeStrBig\n        label = '1'\n    } else {\n        g.fillStyle = fillStyle ?? COLOR_LABEL_OFF\n        spec = sizeStrBig\n        label = '0'\n    }\n    g.font = `${spec}px sans-serif`\n    g.fillText(label, x, y)\n}\n\n\n//\n// MISC\n//\n\nexport const INPUT_OUTPUT_DIAMETER = 26\n\nconst NAME_POSITION_SETTINGS = {\n    right: [\"start\", \"middle\", 7],\n    left: [\"end\", \"middle\", 9],\n    top: [\"center\", \"bottom\", 5],\n    bottom: [\"center\", \"top\", 5],\n} as const\n\nfunction textSettingsForName(onRight: boolean, orient: Orientation) {\n    if (onRight) {\n        switch (orient) {\n            case \"e\": return NAME_POSITION_SETTINGS.right\n            case \"w\": return NAME_POSITION_SETTINGS.left\n            case \"n\": return NAME_POSITION_SETTINGS.top\n            case \"s\": return NAME_POSITION_SETTINGS.bottom\n        }\n    } else {\n        switch (orient) {\n            case \"e\": return NAME_POSITION_SETTINGS.left\n            case \"w\": return NAME_POSITION_SETTINGS.right\n            case \"n\": return NAME_POSITION_SETTINGS.bottom\n            case \"s\": return NAME_POSITION_SETTINGS.top\n        }\n    }\n}\n\nexport function drawComponentName(g: CanvasRenderingContext2D, ctx: DrawContextExt, name: ComponentName, value: string | number, comp: Component, onRight: boolean) {\n    if (isUndefined(name)) {\n        return\n    }\n\n    let displayName\n    if (isString(name)) {\n        displayName = name\n    } else {\n        // dynamic name\n        if (value in name) {\n            displayName = `${value}: ${name[value]}`\n        } else if (\"default\" in name) {\n            displayName = `${value}: ${name.default}`\n        } else if (isUnknown(value)) {\n            displayName = Unknown\n        } else {\n            displayName = undefined\n        }\n    }\n\n    if (isUndefined(displayName)) {\n        return\n    }\n\n    const [hAlign, vAlign, deltaX] = textSettingsForName(onRight, comp.orient)\n    g.textAlign = hAlign\n    g.textBaseline = vAlign\n    g.font = \"italic 18px sans-serif\"\n    g.fillStyle = COLOR_COMPONENT_BORDER\n    const point = ctx.rotatePoint(comp.posX + (onRight ? 1 : -1) * (comp.unrotatedWidth / 2 + deltaX), comp.posY)\n    g.fillText(displayName, ...point)\n    g.textBaseline = \"middle\" // restore\n}\n\nexport function displayValuesFromArray(values: readonly LogicValue[], mostSignificantFirst: boolean): [string, number | Unknown] {\n    // lowest significant bit is the first bit\n    let binaryStringRep = \"\"\n    let hasUnset = false\n    const add: (v: any) => void = mostSignificantFirst\n        ? v => binaryStringRep = binaryStringRep + v\n        : v => binaryStringRep = v + binaryStringRep\n\n    for (const value of values) {\n        if (isUnknown(value) || isHighImpedance(value)) {\n            hasUnset = true\n            add(value)\n        } else {\n            add(+value)\n        }\n    }\n    const value = hasUnset ? Unknown : parseInt(binaryStringRep, 2)\n    return [binaryStringRep, value]\n}\n\nexport function formatWithRadix(value: number | Unknown, radix: number, width: number, withPrefix = true): string {\n    if (isUnknown(value)) {\n        return Unknown\n    }\n    if (radix === -10) {\n        // signed int\n        const asBinStr = (value >>> 0).toString(2).padStart(width, '0')\n        if (asBinStr[0] === '1') {\n            // negative\n            const rest = parseInt(asBinStr.substring(1), 2)\n            // swap hyphen for minus sign as en-dash\n            return '\u2013' + String(-(-Math.pow(2, width - 1) + rest))\n        } else {\n            return String(value)\n        }\n    } else {\n        const caption = value.toString(radix).toUpperCase()\n        const prefix = !withPrefix ? \"\" : (() => {\n            switch (radix) {\n                case 16: return \"0x\"\n                case 8: return \"0o\"\n                case 2: return \"0b\"\n                default: return \"\"\n            }\n        })()\n        return prefix + caption\n    }\n}\n", "import { drawWaypoint, GRID_STEP, isOverWaypoint, NodeStyle, WAYPOINT_DIAMETER } from \"../drawutils\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { HighImpedance, isDefined, isNull, isUnknown, LogicValue, Mode, toLogicValue, Unknown } from \"../utils\"\nimport { ComponentState, InputNodeRepr, NodeGroup, OutputNodeRepr } from \"./Component\"\nimport { DrawableWithPosition, DrawContext, Orientation } from \"./Drawable\"\nimport { Wire } from \"./Wire\"\n\n\n\n// This should just be Component, but it then has some cyclic \n// type definition issue which causes problems\ntype NodeParent = DrawableWithPosition & { isMoving: boolean, state: ComponentState, setNeedsRecalc(): void, allowsForcedOutputs: boolean, alwaysDrawMultiOutNodes: boolean }\n\nexport type Node = NodeIn | NodeOut\n\n\nexport const WireColor = {\n    black: \"black\",\n    red: \"red\",\n    blue: \"blue\",\n    yellow: \"yellow\",\n    green: \"green\",\n    white: \"white\",\n} as const\n\nexport const DEFAULT_WIRE_COLOR = WireColor.black\n\nexport type WireColor = keyof typeof WireColor\n\nabstract class NodeBase<N extends Node> extends DrawableWithPosition {\n\n    public readonly id: number\n    private _isAlive = true\n    private _value: LogicValue = false\n    protected _initialValue: LogicValue | undefined = undefined\n    protected _forceValue: LogicValue | undefined\n    protected _color: WireColor = DEFAULT_WIRE_COLOR\n\n    public constructor(\n        editor: LogicEditor,\n        nodeSpec: InputNodeRepr | OutputNodeRepr,\n        public readonly parent: NodeParent,\n        public readonly group: NodeGroup<N> | undefined,\n        public readonly name: string | undefined,\n        private _gridOffsetX: number,\n        private _gridOffsetY: number,\n        relativePosition: Orientation,\n    ) {\n        super(editor, null)\n        this.id = nodeSpec.id\n        if (\"force\" in nodeSpec) {\n            this._forceValue = toLogicValue(nodeSpec.force)\n        }\n        if (\"color\" in nodeSpec && isDefined(nodeSpec.color)) {\n            this._color = nodeSpec.color\n        }\n        if (\"initialValue\" in nodeSpec && isDefined(nodeSpec.initialValue)) {\n            const initialValue = toLogicValue(nodeSpec.initialValue)\n            this._initialValue = initialValue\n            this._value = initialValue\n        }\n        this.editor.nodeMgr.addLiveNode(this.asNode)\n        this.updatePositionFromParent()\n        this.doSetOrient(relativePosition)\n    }\n\n    private get asNode(): Node {\n        return this as unknown as Node\n    }\n\n    public get isOutput(): boolean {\n        return Node.isOutput(this.asNode)\n    }\n\n    public get unrotatedWidth() {\n        return WAYPOINT_DIAMETER\n    }\n\n    public get unrotatedHeight() {\n        return WAYPOINT_DIAMETER\n    }\n\n    public get color(): WireColor {\n        return this._color\n    }\n\n    public doSetColor(color: WireColor) {\n        this._color = color\n        this.propagateColor(color)\n        this.setNeedsRedraw(\"color changed\")\n    }\n\n    protected propagateColor(__color: WireColor) {\n        // nothing by default; overridden in NodeOut\n    }\n\n    public override isOver(x: number, y: number) {\n        return this.editor.mode >= Mode.CONNECT\n            && this.acceptsMoreConnections\n            && isOverWaypoint(x, y, this.posX, this.posY)\n    }\n\n    public destroy() {\n        this.preDestroy()\n        this._isAlive = false\n        this.editor.nodeMgr.removeLiveNode(this.asNode)\n    }\n\n    protected abstract preDestroy(): void\n\n    protected forceDraw() {\n        return false\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        const mode = this.editor.mode\n        if (mode < Mode.CONNECT && !this.forceDraw()) {\n            return\n        }\n\n        const showForced = isDefined(this._forceValue) && mode >= Mode.FULL\n        const showForcedWarning = mode >= Mode.FULL && !isUnknown(this._value) && !isUnknown(this.value) && this._value !== this.value\n        const parentOrientIsVertical = Orientation.isVertical(this.parent.orient)\n        const neutral = this.editor.options.hideWireColors\n        drawWaypoint(g, ctx, this.posX, this.posY, this.nodeDisplayStyle, this.value, ctx.isMouseOver, neutral, showForced, showForcedWarning, parentOrientIsVertical)\n    }\n\n    protected abstract get nodeDisplayStyle(): NodeStyle\n\n    public get isAlive() {\n        return this._isAlive\n    }\n\n    public get value(): LogicValue {\n        return isDefined(this._forceValue) ? this._forceValue : this._value\n    }\n\n    public set value(val: LogicValue) {\n        const oldVisibleValue = this.value\n        if (val !== this._value) {\n            this._value = val\n            this.propagateNewValueIfNecessary(oldVisibleValue)\n        }\n    }\n\n    protected propagateNewValueIfNecessary(oldVisibleValue: LogicValue) {\n        const newVisibleValue = this.value\n        if (newVisibleValue !== oldVisibleValue) {\n            this.propagateNewValue(newVisibleValue)\n        }\n    }\n\n    protected abstract propagateNewValue(newValue: LogicValue): void\n\n    public abstract get forceValue(): LogicValue | undefined\n\n    public abstract get initialValue(): LogicValue | undefined\n\n    public get gridOffsetX() {\n        return this._gridOffsetX\n    }\n\n    public set gridOffsetX(newVal: number) {\n        this._gridOffsetX = newVal\n        this.updatePositionFromParent()\n    }\n\n    public get gridOffsetY() {\n        return this._gridOffsetY\n    }\n\n    public set gridOffsetY(newVal: number) {\n        this._gridOffsetY = newVal\n        this.updatePositionFromParent()\n    }\n\n    public abstract get acceptsMoreConnections(): boolean\n\n    public abstract get isDisconnected(): boolean\n\n    public get posXInParentTransform() {\n        return this.parent.posX + this._gridOffsetX * GRID_STEP\n    }\n\n    public get posYInParentTransform() {\n        return this.parent.posY + this._gridOffsetY * GRID_STEP\n    }\n\n    public updatePositionFromParent() {\n        const [appliedGridOffsetX, appliedGridOffsetY] = (() => {\n            switch (this.parent.orient) {\n                case \"e\": return [+this._gridOffsetX, +this._gridOffsetY]\n                case \"w\": return [-this._gridOffsetX, -this._gridOffsetY]\n                case \"s\": return [-this._gridOffsetY, +this._gridOffsetX]\n                case \"n\": return [+this._gridOffsetY, -this._gridOffsetX]\n            }\n        })()\n        return super.trySetPosition(\n            this.parent.posX + appliedGridOffsetX * GRID_STEP,\n            this.parent.posY + appliedGridOffsetY * GRID_STEP,\n            false\n        ) ?? [this.posX, this.posY]\n    }\n\n    public get wireProlongDirection(): Orientation {\n        switch (this.parent.orient) {\n            case \"e\":\n                switch (this.orient) {\n                    case \"e\": return \"w\"\n                    case \"w\": return \"e\"\n                    case \"s\": return \"n\"\n                    case \"n\": return \"s\"\n                }\n                break\n            case \"w\": return this.orient\n            case \"s\":\n                switch (this.orient) {\n                    case \"e\": return \"n\"\n                    case \"w\": return \"s\"\n                    case \"s\": return \"e\"\n                    case \"n\": return \"w\"\n                }\n                break\n            case \"n\":\n                switch (this.orient) {\n                    case \"e\": return \"s\"\n                    case \"w\": return \"n\"\n                    case \"s\": return \"w\"\n                    case \"n\": return \"e\"\n                }\n        }\n    }\n\n    public override get cursorWhenMouseover() {\n        return \"crosshair\"\n    }\n\n    public override mouseDown(__: MouseEvent | TouchEvent) {\n        this.editor.wireMgr.addNode(this.asNode)\n        return { wantsDragEvents: false }\n    }\n\n    public override mouseUp(__: MouseEvent | TouchEvent) {\n        const newWire = this.editor.wireMgr.addNode(this.asNode)\n        const shouldTakeSnapshot = isDefined(newWire)\n        return shouldTakeSnapshot\n    }\n\n}\n\nexport class NodeIn extends NodeBase<NodeIn> {\n\n    public readonly _tag = \"_nodein\"\n\n    private _incomingWire: Wire | null = null\n    public _prefersSpike = false\n\n    public get incomingWire() {\n        return this._incomingWire\n    }\n\n    public set incomingWire(wire: Wire | null) {\n        this._incomingWire = wire\n        if (isNull(wire)) {\n            this.value = false\n        } else {\n            this.value = wire.startNode.value\n        }\n    }\n\n    protected preDestroy() {\n        if (this._incomingWire !== null) {\n            this.editor.wireMgr.deleteWire(this._incomingWire)\n        }\n    }\n\n    public get acceptsMoreConnections() {\n        return isNull(this._incomingWire)\n    }\n\n    public get isDisconnected() {\n        return isNull(this._incomingWire)\n    }\n\n    public get forceValue() {\n        return undefined\n    }\n\n    public get initialValue() {\n        return undefined\n    }\n\n    protected propagateNewValue(__newValue: LogicValue) {\n        this.parent.setNeedsRecalc()\n    }\n\n    protected get nodeDisplayStyle() {\n        const disconnected = this._incomingWire === null\n        return disconnected ? NodeStyle.IN_DISCONNECTED : NodeStyle.IN_CONNECTED\n    }\n\n}\n\n\nexport class NodeOut extends NodeBase<NodeOut> {\n\n    public readonly _tag = \"_nodeout\"\n\n    private readonly _outgoingWires: Wire[] = []\n\n    public addOutgoingWire(wire: Wire) {\n        // don't add the same wire twice\n        const i = this._outgoingWires.indexOf(wire)\n        if (i === -1) {\n            this._outgoingWires.push(wire)\n        }\n    }\n\n    public removeOutgoingWire(wire: Wire) {\n        const i = this._outgoingWires.indexOf(wire)\n        if (i !== -1) {\n            this._outgoingWires.splice(i, 1)\n        }\n    }\n\n    public get outgoingWires(): readonly Wire[] {\n        return this._outgoingWires\n    }\n\n    protected preDestroy() {\n        // we need to make a copy of the array because the wires will remove themselves from the array\n        for (const wire of [... this._outgoingWires]) {\n            this.editor.wireMgr.deleteWire(wire)\n        }\n    }\n\n    public get acceptsMoreConnections() {\n        return true\n    }\n\n    public get isDisconnected() {\n        return this._outgoingWires.length === 0\n    }\n\n    public findWireTo(node: NodeIn): Wire | undefined {\n        return this._outgoingWires.find(wire => wire.endNode === node)\n    }\n\n    public get forceValue() {\n        return this._forceValue\n    }\n\n    public set forceValue(newForceValue: LogicValue | undefined) {\n        const oldVisibleValue = this.value\n        this._forceValue = newForceValue\n        this.propagateNewValueIfNecessary(oldVisibleValue)\n        this.setNeedsRedraw(\"changed forced output value\")\n    }\n\n    public get initialValue() {\n        return this._initialValue\n    }\n\n    protected override propagateColor(color: WireColor) {\n        for (const wire of this._outgoingWires) {\n            wire.endNode?.doSetColor(color)\n        }\n    }\n\n    protected propagateNewValue(newValue: LogicValue) {\n        const now = this.editor.timeline.adjustedTime()\n        for (const wire of this._outgoingWires) {\n            wire.propageNewValue(newValue, now)\n        }\n    }\n\n    protected override forceDraw() {\n        return this._outgoingWires.length > 1 && this.parent.alwaysDrawMultiOutNodes\n    }\n\n    protected get nodeDisplayStyle() {\n        const disconnected = this._outgoingWires.length === 0\n        return disconnected ? NodeStyle.OUT_DISCONNECTED : NodeStyle.OUT_CONNECTED\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseDoubleClicked(e)) {\n            return true // already handled\n        }\n        if (this.editor.mode >= Mode.FULL && e.altKey && this.isOutput && this.parent.allowsForcedOutputs) {\n            this.forceValue = (() => {\n                switch (this._forceValue) {\n                    case undefined: return Unknown\n                    case Unknown: return HighImpedance\n                    case HighImpedance: return false\n                    case false: return true\n                    case true: return undefined\n                }\n            })()\n            return true\n        }\n        return false\n    }\n\n}\n\nexport const Node = {\n    isOutput(node: Node): node is NodeOut {\n        return node._tag === \"_nodeout\"\n    },\n}\n", "import * as t from \"io-ts\"\nimport { GRID_STEP } from \"../drawutils\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { asArray, deepEquals, Expand, FixedArray, FixedArraySize, FixedArraySizeNonZero, FixedReadonlyArray, forceTypeOf, HighImpedance, isArray, isDefined, isNotNull, isNumber, isString, isUndefined, LogicValue, LogicValueRepr, Mode, RichStringEnum, toLogicValueRepr, typeOrUndefined, Unknown } from \"../utils\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawableWithDraggablePosition, Orientation, PositionSupportRepr } from \"./Drawable\"\nimport { DEFAULT_WIRE_COLOR, Node, NodeIn, NodeOut, WireColor } from \"./Node\"\n\n\n// Node IDs are just represented by a non-negative number\nexport const NodeID = t.number\nexport type NodeID = t.TypeOf<typeof NodeID>\n\n// Input nodes are represented by just the ID; output nodes can be forced\n// to a given value to bypass their naturally computed value\nexport const InputNodeRepr = t.type({ id: NodeID }, \"InputNode\")\nexport type InputNodeRepr = t.TypeOf<typeof InputNodeRepr>\nexport const OutputNodeRepr = t.intersection([t.type({ id: NodeID }), t.partial({\n    force: LogicValueRepr,\n    initialValue: LogicValueRepr,\n    color: typeOrUndefined(t.keyof(WireColor)),\n})], \"OutputNode\")\nexport type OutputNodeRepr = t.TypeOf<typeof OutputNodeRepr>\n\n// Allows collapsing an array of 1 element into the element itself,\n// used for compact JSON representation. Does not work well if T itself is\n// an array\nexport const FixedArrayOrDirect = <T extends t.Mixed, N extends FixedArraySizeNonZero>(tpe: T, n: N) =>\n    (n === 1) ? tpe : FixedArray<T, N>(tpe, n)\nexport type FixedArrayOrDirect<T, N extends FixedArraySizeNonZero> =\n    N extends 1 ? T : FixedArray<T, N>\n\n\n// Defines how the JSON looks like depending on the number of inputs and outputs.\n// If only inputs or only outputs, all IDs are put into an \"id\" field.\n// If both inputs and outputs are present, we have separate \"in\" and \"out\" fields.\n\n// These are just 3 intermediate types\nconst OnlyInNodeIds = <N extends FixedArraySizeNonZero>(n: N) =>\n    t.type({ id: FixedArrayOrDirect(t.union([NodeID, InputNodeRepr]), n) })\ntype OnlyInNodeIds<N extends FixedArraySizeNonZero> =\n    { id: FixedArrayOrDirect<NodeID | InputNodeRepr, N> }\n\nconst OnlyOutNodeIds = <N extends FixedArraySizeNonZero>(n: N) =>\n    t.type({ id: FixedArrayOrDirect(t.union([NodeID, OutputNodeRepr]), n) })\ntype OnlyOutNodeIds<N extends FixedArraySizeNonZero> =\n    { id: FixedArrayOrDirect<NodeID | OutputNodeRepr, N> }\n\nconst InAndOutNodeIds = <N extends FixedArraySizeNonZero, M extends FixedArraySizeNonZero>(n: N, m: M) =>\n    t.type({\n        in: FixedArrayOrDirect(t.union([NodeID, InputNodeRepr]), n),\n        out: FixedArrayOrDirect(t.union([NodeID, OutputNodeRepr]), m),\n    })\ntype InAndOutNodeIds<N extends FixedArraySizeNonZero, M extends FixedArraySizeNonZero> = {\n    in: FixedArrayOrDirect<NodeID | InputNodeRepr, N>\n    out: FixedArrayOrDirect<NodeID | OutputNodeRepr, M>\n}\n\n// This is the final conditional type showing what the JSON representation\n// will look like depending on number of inputs and outputs\nexport const NodeIDsRepr = <NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize>(numInputs: NumInputs, numOutputs: NumOutputs) =>\n    numInputs > 0\n        ? /* NumInputs != 0 */ (\n            numOutputs > 0\n                ? /* NumInputs != 0, NumOutputs != 0 */ InAndOutNodeIds(numInputs as FixedArraySizeNonZero, numOutputs as FixedArraySizeNonZero)\n                : /* NumInputs != 0, NumOutputs == 0 */ OnlyInNodeIds(numInputs as FixedArraySizeNonZero)\n        )\n        : /* NumInputs == 0 */  (\n            numOutputs > 0\n                ? /* NumInputs == 0, NumOutputs != 0 */ OnlyOutNodeIds(numOutputs as FixedArraySizeNonZero)\n                // eslint-disable-next-line @typescript-eslint/ban-types\n                : /* NumInputs == 0, NumOutputs == 0 */ t.type({})\n        )\nexport type NodeIDsRepr<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize> =\n    NumInputs extends FixedArraySizeNonZero\n    ? /* NumInputs != 0 */ (\n        NumOutputs extends FixedArraySizeNonZero\n        ? /* NumInputs != 0, NumOutputs != 0 */ InAndOutNodeIds<NumInputs, NumOutputs>\n        : /* NumInputs != 0, NumOutputs == 0 */ OnlyInNodeIds<NumInputs>\n    )\n    : /* NumInputs == 0 */  (\n        NumOutputs extends FixedArraySizeNonZero\n        ? /* NumInputs == 0, NumOutputs != 0 */ OnlyOutNodeIds<NumOutputs>\n        // eslint-disable-next-line @typescript-eslint/ban-types\n        : /* NumInputs == 0, NumOutputs == 0 */ {}\n    )\n\n// Tests\n\n// type IDs_00 = Expand<NodeIDsRepr<0, 0>>\n// type IDs_01 = Expand<NodeIDsRepr<0, 1>>\n// type IDs_10 = Expand<NodeIDsRepr<1, 0>>\n// type IDs_11 = Expand<NodeIDsRepr<1, 1>>\n// type IDs_02 = Expand<NodeIDsRepr<0, 2>>\n// type IDs_20 = Expand<NodeIDsRepr<2, 0>>\n// type IDs_12 = Expand<NodeIDsRepr<1, 2>>\n// type IDs_21 = Expand<NodeIDsRepr<2, 1>>\n// type IDs_22 = Expand<NodeIDsRepr<2, 2>>\n\n// A generic component is represented by its position\n// and the representation of its nodes\nexport type ComponentRepr<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize> =\n    PositionSupportRepr & NodeIDsRepr<NumInputs, NumOutputs>\n\nexport const ComponentRepr = <NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize>(numInputs: NumInputs, numOutputs: NumOutputs) =>\n    forceTypeOf(\n        t.intersection([PositionSupportRepr, NodeIDsRepr(numInputs, numOutputs)], `Component(numInputs=${numInputs}, numOutputs=${numOutputs})`)\n    ).toMoreSpecific<ComponentRepr<NumInputs, NumOutputs>>()\n\nexport function ExtendComponentRepr<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize, T extends t.Mixed>(n: NumInputs, m: NumOutputs, savedData: T) {\n    return t.intersection([ComponentRepr(n, m), savedData], savedData.name)\n}\n\nexport type NodeVisualNoGroup = readonly [name: string | undefined, xShift: number, yShift: number, orient: Orientation]\nexport type NodeVisualWithGroup = readonly [name: string | undefined, xShift: number, yShift: number, orient: Orientation, groupName: string]\nexport type NodeVisual = NodeVisualNoGroup | NodeVisualWithGroup\n\nfunction hasGroup(nodeVisual: NodeVisual): nodeVisual is NodeVisualWithGroup {\n    return nodeVisual.length === 5\n}\n\nexport class NodeGroup<N extends Node> {\n\n    private _nodes: N[] = []\n\n    public constructor(\n        public readonly parent: Component,\n        public readonly name: string,\n    ) {\n    }\n\n    public get nodes(): readonly N[] {\n        return this._nodes\n    }\n\n    public addNode(node: N) {\n        this._nodes.push(node)\n    }\n\n    public indexOf(node: Node): number {\n        for (let i = 0; i < this._nodes.length; i++) {\n            if (this._nodes[i] === node) {\n                return i\n            }\n        }\n        return -1\n    }\n\n}\n\n\n// Node visuals are not stored in JSON, but provided by the concrete\n// subclasses to the Component superclass to indicate where to place\n// the input and output nodes. Strong typing allows us to check the\n// size of the passed arrays in the super() call.\nexport type NodeVisuals<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize>\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    = (NumInputs extends 0 ? {} : { ins: FixedArray<NodeVisual, NumInputs> })\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    & (NumOutputs extends 0 ? {} : { outs: FixedArray<NodeVisual, NumOutputs> })\n\n// Given an \"as const\" variable with NodeVisuals for in or out, this allows stuff like\n//   type OutName = NodeNamesFrom<typeof outs>\n// to statically yield a disjunction type of all node names\nexport type NodeNamesFrom<V extends ReadonlyArray<NodeVisual>> = V[number][0]\n\nexport enum ComponentState {\n    SPAWNING,\n    SPAWNED,\n    DEAD\n}\n\n// Simplified, generics-free representation of a component\nexport type Component = ComponentBase<FixedArraySize, FixedArraySize, ComponentRepr<FixedArraySize, FixedArraySize>, unknown>\n\nexport const JsonFieldsComponents = [\"in\", \"out\", \"gates\", \"components\", \"labels\", \"layout\"] as const\nexport type JsonFieldComponent = typeof JsonFieldsComponents[number]\nexport const JsonFieldsAux = [\"v\", \"opts\", \"userdata\"] as const\nexport type JsonFieldAux = typeof JsonFieldsAux[number]\nexport type JsonField = JsonFieldComponent | JsonFieldAux\n\nconst ComponentTypes_ = {\n    in: { jsonFieldName: \"in\" },\n    out: { jsonFieldName: \"out\" },\n    gate: { jsonFieldName: \"gates\" },\n    ic: { jsonFieldName: \"components\" },\n    label: { jsonFieldName: \"labels\" },\n    layout: { jsonFieldName: \"layout\" },\n} as const\n\nexport const ComponentTypes = RichStringEnum.withProps<{\n    jsonFieldName: JsonFieldComponent\n}>()(ComponentTypes_)\n\nexport type ComponentType = typeof ComponentTypes.type\nexport type MainJsonFieldName = typeof ComponentTypes_[ComponentType][\"jsonFieldName\"]\n\nexport type DynamicName = Record<string | number, string>\nexport function isDynamicName(obj: any): obj is DynamicName {\n    if (typeof obj !== \"object\") {\n        return false\n    }\n    for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key) && typeof obj[key] !== \"string\") {\n            return false\n        }\n    }\n    return true\n}\nexport type ComponentName = string | DynamicName | undefined\nexport const ComponentNameRepr = typeOrUndefined(\n    t.union([\n        t.string,\n        t.record(t.union([t.string, t.number]), t.string),\n    ])\n)\n\nexport abstract class ComponentBase<\n    NumInputs extends FixedArraySize, // statically know the number of inputs\n    NumOutputs extends FixedArraySize, // statically know the number of outputs\n    Repr extends ComponentRepr<NumInputs, NumOutputs>, // JSON representation, varies according to input/output number\n    Value // usually LogicValue or number\n    > extends DrawableWithDraggablePosition {\n\n    private _state: ComponentState\n    private readonly _inputs: FixedArray<NodeIn, NumInputs>\n    private readonly _inputGroups: Map<string, NodeGroup<NodeIn>> | undefined\n    private readonly _outputs: FixedArray<NodeOut, NumOutputs>\n    private readonly _outputGroups: Map<string, NodeGroup<NodeOut>> | undefined\n\n    protected constructor(\n        editor: LogicEditor,\n        private _value: Value,\n        savedData: Repr | null,\n        nodeOffsets: NodeVisuals<NumInputs, NumOutputs>) {\n        super(editor, savedData)\n\n        // hack to get around the inOffsets and outOffsets properties\n        // being inferred as nonexistant (basically, the '\"key\" in savedData'\n        // check fails to provide enough info for type narrowing)\n        type NodeOffsetsKey = keyof NodeVisuals<1, 0> | keyof NodeVisuals<0, 1>\n        function get(key: NodeOffsetsKey): ReadonlyArray<NodeVisual> {\n            if (key in nodeOffsets) {\n                return (nodeOffsets as any as NodeVisuals<1, 1>)[key]\n            } else {\n                return [] as const\n            }\n        }\n\n        const inOffsets = get(\"ins\")\n        const outOffsets = get(\"outs\")\n        const numInputs = inOffsets.length as NumInputs\n        const numOutputs = outOffsets.length as NumOutputs\n\n        if (isNotNull(savedData)) {\n            // restoring\n            this._state = ComponentState.SPAWNED\n\n        } else {\n            // newly placed\n            this._state = ComponentState.SPAWNING\n            editor.moveMgr.setDrawableMoving(this)\n        }\n\n        // build node specs either from scratch if new or from saved data\n        const [inputSpecs, outputSpecs, hasAnyPrecomputedInitialValues] = this.nodeSpecsFromRepr(savedData, numInputs, numOutputs);\n\n        // so, hasAnyPrecomputedInitialValues is true if ANY of the outputs was built\n        // with \"initialValue\" in the JSON. This is used to stabilize circuits (such as\n        // an SR latch) that would otherwise oscillate. But this also means that NO OTHER\n        // OUTPUT from this component would be recomputed (even if they are always\n        // propagated). So, it is a good idea to either set no initial values at all, or\n        // to set all of them.\n\n        // generate the input and output nodes\n        [this._inputs, this._inputGroups] = this.makeNodes<NodeIn, NumInputs>(inOffsets, inputSpecs, NodeIn);\n        [this._outputs, this._outputGroups] = this.makeNodes<NodeOut, NumOutputs>(outOffsets, outputSpecs, NodeOut)\n\n        // setNeedsRecalc with a force propadation is needed:\n        // * the forced propagation allows the current value (e.g. for InputBits)\n        //   to be set to the outputs, if if the \"new\" value is the same as the current one\n        // * setNeedsRecalc schedules a recalculation (e.g. for Gates)\n        if (!hasAnyPrecomputedInitialValues) {\n            this.setNeedsRecalc(true)\n        } else {\n            this.setNeedsPropagate()\n        }\n    }\n\n    public setSpawned() {\n        this._state = ComponentState.SPAWNED\n        this.editor.moveMgr.setDrawableStoppedMoving(this)\n    }\n\n    public abstract toJSON(): Repr\n\n    // typically used by subclasses to provide only their specific JSON,\n    // splatting in the result of super.toJSONBase() in the object\n    protected override toJSONBase(): ComponentRepr<NumInputs, NumOutputs> {\n        return {\n            ...super.toJSONBase(),\n            ...this.buildNodesRepr(),\n        }\n    }\n\n    // creates the input/output nodes based on array of offsets (provided\n    // by subclass) and spec (either loaded from JSON repr or newly generated)\n    private makeNodes<N extends Node, Num extends FixedArraySize>(\n        nodeVisuals: readonly NodeVisual[],\n        specs: readonly (InputNodeRepr | OutputNodeRepr)[], node: new (\n            editor: LogicEditor,\n            nodeSpec: InputNodeRepr | OutputNodeRepr,\n            parent: Component,\n            group: NodeGroup<N> | undefined,\n            name: string | undefined,\n            _gridOffsetX: number,\n            _gridOffsetY: number,\n            relativePosition: Orientation,\n        ) => N): [FixedArray<N, Num>, Map<string, NodeGroup<N>> | undefined] {\n\n        const nodes: N[] = []\n        let groupMap: Map<string, NodeGroup<N>> | undefined = undefined\n\n        for (let i = 0; i < nodeVisuals.length; i++) {\n            const nodeVisual = nodeVisuals[i]\n            let group: NodeGroup<N> | undefined = undefined\n            const [name, offsetX, offsetY, orient] = nodeVisual\n            if (hasGroup(nodeVisual)) {\n                const groupName = nodeVisual[4]\n                // lazily create group map\n                if (isUndefined(groupMap)) {\n                    groupMap = new Map<string, NodeGroup<N>>()\n                }\n                group = groupMap.get(groupName)\n                if (isUndefined(group)) {\n                    group = new NodeGroup<N>(this, groupName)\n                    groupMap.set(groupName, group)\n                }\n            }\n            const newNode = new node(this.editor, specs[i], this, group, name, offsetX, offsetY, orient)\n            nodes.push(newNode)\n            if (isDefined(group)) {\n                group.addNode(newNode)\n            }\n        }\n\n        return [nodes as FixedArray<N, Num>, groupMap]\n    }\n\n    // generates two arrays of normalized node specs either as loaded from\n    // JSON or obtained with default values when _repr is null and we're\n    // creating a new component from scratch\n    private nodeSpecsFromRepr(_repr: NodeIDsRepr<NumInputs, NumOutputs> | null, numInputs: number, numOutputs: number): [InputNodeRepr[], OutputNodeRepr[], boolean] {\n        const inputSpecs: InputNodeRepr[] = []\n        const outputSpecs: OutputNodeRepr[] = []\n        const nodeMgr = this.editor.nodeMgr\n        let hasAnyPrecomputedInitialValues = false\n\n        if (_repr === null) {\n            // build default spec for nodes\n            for (let i = 0; i < numInputs; i++) {\n                inputSpecs.push({ id: nodeMgr.newID() })\n            }\n            for (let i = 0; i < numOutputs; i++) {\n                outputSpecs.push({ id: nodeMgr.newID() })\n            }\n\n        } else {\n            // parse from cast repr according to cases\n\n            // the next two functions take either a single ID or an array of them and\n            // generate the corresponding node specs from it\n            const genOutSpecs = function (outReprs: FixedArrayOrDirect<NodeID | OutputNodeRepr, FixedArraySizeNonZero>) {\n                const pushOne = (outRepr: NodeID | OutputNodeRepr) => {\n                    const fullOutRepr = isNumber(outRepr)\n                        ? { id: outRepr }\n                        : { id: outRepr.id, force: outRepr.force, color: outRepr.color, initialValue: outRepr.initialValue }\n                    hasAnyPrecomputedInitialValues ||= isDefined(fullOutRepr.initialValue)\n                    outputSpecs.push(fullOutRepr)\n                }\n                if (isArray(outReprs)) {\n                    for (const outRepr of outReprs) {\n                        pushOne(outRepr)\n                    }\n                } else {\n                    pushOne(outReprs)\n                }\n            }\n            const genInSpecs = function (inReprs: FixedArrayOrDirect<NodeID | InputNodeRepr, FixedArraySizeNonZero>) {\n                const pushOne = (inRepr: NodeID | InputNodeRepr) =>\n                    inputSpecs.push({ id: isNumber(inRepr) ? inRepr : inRepr.id })\n                if (isArray(inReprs)) {\n                    for (const inRepr of inReprs) {\n                        pushOne(inRepr)\n                    }\n                } else {\n                    pushOne(inReprs)\n                }\n            }\n\n            // manually distinguishing the cases where we have no inputs or no\n            // outputs as we then have a more compact JSON representation\n            if (numInputs !== 0) {\n                if (numOutputs !== 0) {\n                    // NumInputs != 0, NumOutputs != 0\n                    const repr: InAndOutNodeIds<FixedArraySizeNonZero, FixedArraySizeNonZero> = _repr as any\n                    genInSpecs(repr.in)\n                    genOutSpecs(repr.out)\n                } else {\n                    // NumInputs != 0, NumOutputs == 0\n                    const repr: OnlyInNodeIds<FixedArraySizeNonZero> = _repr as any\n                    genInSpecs(repr.id)\n                }\n            } else if (numOutputs !== 0) {\n                // NumInputs == 0, NumOutputs != 0\n                const repr: OnlyOutNodeIds<FixedArraySizeNonZero> = _repr as any\n                genOutSpecs(repr.id)\n            }\n\n            // id availability check\n            for (const specs of [inputSpecs, outputSpecs]) {\n                for (const spec of specs) {\n                    nodeMgr.markIDUsed(spec.id)\n                }\n            }\n        }\n\n        return [inputSpecs, outputSpecs, hasAnyPrecomputedInitialValues]\n    }\n\n    // from the known nodes, builds the JSON representation of them,\n    // using the most compact form available\n    private buildNodesRepr(): NodeIDsRepr<NumInputs, NumOutputs> {\n        const numInputs = this.inputs.length as NumInputs\n        const numOutputs = this.outputs.length as NumOutputs\n\n        // these two functions return either an array of JSON\n        // representations, or just the element skipping the array\n        // if there is only one\n        function inNodeReprs(nodes: readonly Node[]): FixedArrayOrDirect<NodeID, FixedArraySizeNonZero> {\n            const reprOne = (node: Node) => node.id\n            if (nodes.length === 1) {\n                return reprOne(nodes[0])\n            } else {\n                return nodes.map(reprOne) as any\n            }\n        }\n        function outNodeReprs(nodes: readonly Node[]): FixedArrayOrDirect<NodeID | OutputNodeRepr, FixedArraySizeNonZero> {\n            const reprOne = (node: Node) => {\n                const valueNotForced = isUndefined(node.forceValue)\n                const noInitialValue = isUndefined(node.initialValue)\n                const hasStandardColor = node.color === DEFAULT_WIRE_COLOR\n                if (valueNotForced && hasStandardColor && noInitialValue) {\n                    return node.id\n                } else {\n                    return {\n                        id: node.id,\n                        intialValue: noInitialValue ? undefined : toLogicValueRepr(node.initialValue),\n                        force: valueNotForced ? undefined : toLogicValueRepr(node.forceValue),\n                        color: hasStandardColor ? undefined : node.color,\n                    }\n                }\n            }\n            if (nodes.length === 1) {\n                return reprOne(nodes[0])\n            } else {\n                return nodes.map(reprOne) as any\n            }\n        }\n\n        let result: any = {}\n\n        // manually distinguishing the cases where we have no inputs or no\n        // outputs as we then have a more compact JSON representation\n        if (numInputs !== 0) {\n            const inRepr = inNodeReprs(this.inputs)\n\n            if (numOutputs !== 0) {\n                // NumInputs != 0, NumOutputs != 0\n                const outRepr = outNodeReprs(this.outputs)\n                const repr: InAndOutNodeIds<FixedArraySizeNonZero, FixedArraySizeNonZero> =\n                    { in: inRepr as any, out: outRepr as any }\n                result = repr\n\n            } else {\n                // NumInputs != 0, NumOutputs == 0\n                const repr: OnlyOutNodeIds<FixedArraySizeNonZero> = { id: inRepr as any }\n                result = repr\n            }\n        } else if (numOutputs !== 0) {\n            // NumInputs == 0, NumOutputs != 0\n            const outRepr = outNodeReprs(this.outputs)\n            const repr: OnlyOutNodeIds<FixedArraySizeNonZero> = { id: outRepr as any }\n            result = repr\n        }\n\n        return result\n    }\n\n    protected setInputsPreferSpike(...inputs: number[]) {\n        for (const i of inputs) {\n            this._inputs[i]._prefersSpike = true\n        }\n    }\n\n    public abstract get componentType(): ComponentType\n\n    public get state() {\n        return this._state\n    }\n\n    public get allowsForcedOutputs() {\n        return true\n    }\n\n    public get alwaysDrawMultiOutNodes() {\n        return false\n    }\n\n    public get inputs(): FixedReadonlyArray<NodeIn, NumInputs> {\n        return this._inputs\n    }\n\n    public get outputs(): FixedReadonlyArray<NodeOut, NumOutputs> {\n        return this._outputs\n    }\n\n    public forEachNode(f: (node: Node) => boolean): void {\n        for (const node of this.inputs) {\n            const goOn = f(node)\n            if (!goOn) {\n                return\n            }\n        }\n        for (const node of this.outputs) {\n            const goOn = f(node)\n            if (!goOn) {\n                return\n            }\n        }\n    }\n\n    public get value(): Value {\n        return this._value\n    }\n\n    protected doSetValue(newValue: Value, forcePropagate = false) {\n        const oldValue = this._value\n        if (forcePropagate || !deepEquals(newValue, oldValue)) {\n            this._value = newValue\n            this.setNeedsRedraw(\"value changed\")\n            this.setNeedsPropagate()\n        }\n    }\n\n    public recalcValue(forcePropagate: boolean) {\n        this.doSetValue(this.doRecalcValue(), forcePropagate)\n    }\n\n    protected abstract doRecalcValue(): Value\n\n    public propagateCurrentValue() {\n        this.propagateValue(this._value)\n    }\n\n    protected propagateValue(__newValue: Value) {\n        // by default, do nothing\n    }\n\n    protected inputValues<N extends FixedArraySize>(inds: FixedReadonlyArray<number, N>): FixedArray<LogicValue, N> {\n        return inds.map(i => this.inputs[i].value) as any as FixedArray<LogicValue, N>\n    }\n\n    public setNeedsRecalc(forcePropagate = false) {\n        this.editor.recalcMgr.enqueueForRecalc(this, forcePropagate)\n    }\n\n    private setNeedsPropagate() {\n        this.editor.recalcMgr.enqueueForPropagate(this)\n    }\n\n    private updateNodePositions() {\n        this.forEachNode((node) => {\n            node.updatePositionFromParent()\n            return true\n        })\n    }\n\n    public override mouseDown(e: MouseEvent | TouchEvent) {\n        if (this.editor.mode >= Mode.CONNECT) {\n            this.tryStartMoving(e)\n        }\n        return { wantsDragEvents: true }\n    }\n\n    public override mouseDragged(e: MouseEvent | TouchEvent) {\n        if (this.editor.mode >= Mode.CONNECT) {\n            this.updateWhileMoving(e)\n        }\n    }\n\n    public override mouseUp(__: MouseEvent | TouchEvent) {\n        let wasSpawning = false\n        if (this._state === ComponentState.SPAWNING) {\n            this._state = ComponentState.SPAWNED\n            wasSpawning = true\n        }\n        const wasMoving = this.tryStopMoving()\n        if (wasSpawning || wasMoving) {\n            const newLinks = this.editor.nodeMgr.tryConnectNodesOf(this)\n            if (newLinks.length > 0) {\n                this.autoConnected(newLinks)\n            }\n            this.editor.setDirty(\"moved component\")\n            return true\n        }\n        return false\n    }\n\n    protected autoConnected(__newLinks: [Node, Component, Node][]) {\n        // by default, do nothing\n    }\n\n    protected override updateSelfPositionIfNeeded(x: number, y: number, snapToGrid: boolean, e: MouseEvent | TouchEvent): undefined | [number, number] {\n        if (this._state === ComponentState.SPAWNING) {\n            return this.trySetPosition(x, y, snapToGrid)\n        }\n        return super.updateSelfPositionIfNeeded(x, y, snapToGrid, e)\n    }\n\n    protected override positionChanged() {\n        this.updateNodePositions()\n    }\n\n    public override mouseClicked(e: MouseEvent | TouchEvent) {\n        if (this.editor.mode >= Mode.CONNECT && e.shiftKey) {\n            this.editor.cursorMovementMgr.toggleSelect(this)\n            return true\n        }\n        return false\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent): boolean {\n        if (this.editor.mode >= Mode.CONNECT && e.metaKey && this.canRotate()) {\n            this.doSetOrient((() => {\n                switch (this.orient) {\n                    case \"e\": return \"s\"\n                    case \"s\": return \"w\"\n                    case \"w\": return \"n\"\n                    case \"n\": return \"e\"\n                }\n            })())\n            return true\n        }\n        return false\n    }\n\n    public override doSetOrient(orient: Orientation) {\n        super.doSetOrient(orient)\n        this.updateNodePositions()\n    }\n\n    public destroy() {\n        this._state = ComponentState.DEAD\n        this.forEachNode((node) => {\n            node.destroy()\n            return true\n        })\n    }\n\n    public override get cursorWhenMouseover(): string | undefined {\n        return \"grab\"\n    }\n\n    public override makeContextMenu(): ContextMenuData {\n        const menuItems: ContextMenuData = []\n\n        const baseItems = this.makeBaseContextMenu()\n        const specificItems = this.makeComponentSpecificContextMenuItems()\n\n        let lastWasSep = true\n        function addItemsAt(placement: ContextMenuItemPlacement, items: [ContextMenuItemPlacement, ContextMenuItem][] | undefined, insertSep = false) {\n            if (isUndefined(items)) {\n                return\n            }\n            if (insertSep) {\n                if (!lastWasSep) {\n                    menuItems.push(ContextMenuData.sep())\n                }\n                lastWasSep = true\n            }\n            for (const [pl, it] of items) {\n                if (pl === placement) {\n                    menuItems.push(it)\n                    lastWasSep = false\n                }\n            }\n        }\n\n        addItemsAt(\"start\", specificItems)\n        addItemsAt(\"start\", baseItems)\n        addItemsAt(\"mid\", baseItems, true)\n        addItemsAt(\"mid\", specificItems)\n        addItemsAt(\"end\", baseItems, true)\n        addItemsAt(\"end\", specificItems)\n\n        return menuItems\n    }\n\n    private makeBaseContextMenu(): [ContextMenuItemPlacement, ContextMenuItem][] {\n        const setRefItems: [ContextMenuItemPlacement, ContextMenuItem][] =\n            this.editor.mode < Mode.FULL ? [] : [\n                [\"end\", this.makeSetRefContextMenuItem()],\n                [\"end\", ContextMenuData.sep()],\n            ]\n\n        const rotateItems: [ContextMenuItemPlacement, ContextMenuItem][] =\n            !this.canRotate() ? [] : [\n                [\"start\", this.makeChangeOrientationContextMenuItem()],\n            ]\n\n        return [\n            ...rotateItems,\n            ...setRefItems,\n            [\"end\", this.makeDeleteContextMenuItem()],\n        ]\n    }\n\n    protected makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        return undefined\n    }\n\n    protected makeDeleteContextMenuItem(): ContextMenuItem {\n        return ContextMenuData.item(\"trash\", S.Components.Generic.contextMenu.Delete, () => {\n            this.editor.tryDeleteDrawable(this)\n        }, true)\n    }\n\n    protected makeForceOutputsContextMenuItem(): undefined | ContextMenuItem {\n        const numOutputs = this.outputs.length\n\n        if (numOutputs === 0 || this.editor.mode < Mode.FULL) {\n            return undefined\n        }\n\n        const s = S.Components.Generic.contextMenu\n\n        function makeOutputItems(out: NodeOut): ContextMenuItem[] {\n            const currentForceValue = out.forceValue\n            const items = [undefined, Unknown, true, false, HighImpedance]\n                .map(newForceValue => ContextMenuData.item(\n                    currentForceValue === newForceValue ? \"check\" : \"none\",\n                    (() => {\n                        switch (newForceValue) {\n                            case undefined: return s.NormalOutput\n                            case Unknown: return s.ForceAsUnknown\n                            case true: return s.ForceAs1\n                            case false: return s.ForceAs0\n                            case HighImpedance: return s.ForceAsZ\n                        }\n                    })(),\n                    () => {\n                        out.forceValue = newForceValue\n                    }\n                ))\n\n            // insert separator\n            items.splice(1, 0, ContextMenuData.sep())\n            return items\n        }\n\n        const footerItems = [\n            ContextMenuData.sep(),\n            ContextMenuData.text(s.ForceOutputDesc),\n        ]\n\n        if (numOutputs === 1) {\n            return ContextMenuData.submenu(\"force\", s.ForceOutputSingle, [\n                ...makeOutputItems(this._outputs[0]!),\n                ...footerItems,\n            ])\n\n        } else {\n            return ContextMenuData.submenu(\"force\", s.ForceOutputMultiple, [\n                ...asArray(this._outputs).map((out) => {\n                    const icon = isDefined(out.forceValue) ? \"force\" : \"none\"\n                    return ContextMenuData.submenu(icon, s.Output + \" \" + out.name,\n                        makeOutputItems(out)\n                    )\n                }),\n                ...footerItems,\n            ])\n        }\n    }\n\n    protected makeSetNameContextMenuItem(currentName: ComponentName, handler: (newName: ComponentName) => void): ContextMenuItem {\n        const s = S.Components.Generic.contextMenu\n        const caption = isUndefined(currentName) ? s.SetName : s.ChangeName\n        return ContextMenuData.item(\"pen\", caption, () => this.runSetNameDialog(currentName, handler))\n    }\n\n    protected runSetNameDialog(currentName: ComponentName, handler: (newName: ComponentName) => void): void {\n        const currentDisplayName = isUndefined(currentName) || isString(currentName) ? currentName : JSON.stringify(currentName)\n        const promptReturnValue = window.prompt(S.Components.Generic.contextMenu.SetNamePrompt, currentDisplayName)\n        if (promptReturnValue !== null) {\n            // OK button pressed\n            let newName\n            if (promptReturnValue.length === 0) {\n                newName = undefined\n            } else {\n                // is it JSON that can be valid as a DynamicName?\n                try {\n                    const parsedValue = JSON.parse(promptReturnValue)\n                    if (isDynamicName(parsedValue)) {\n                        newName = parsedValue\n                    } else {\n                        newName = promptReturnValue\n                    }\n                } catch {\n                    newName = promptReturnValue\n                }\n            }\n            handler(newName)\n        }\n    }\n\n    protected runSetFontDialog(currentFont: string, defaultIfEmpty: string, callback: (font: string) => void) {\n        const s = S.Components.Generic.contextMenu\n        const promptReturnValue = window.prompt(s.SetFontPrompt[0] + defaultIfEmpty + s.SetFontPrompt[1], currentFont === defaultIfEmpty ? \"\" : currentFont)\n        if (promptReturnValue !== null) {\n            const newFont = promptReturnValue.length === 0 ? defaultIfEmpty : promptReturnValue\n            callback(newFont)\n        }\n    }\n\n}\n\n\nexport abstract class ComponentBaseWithSubclassDefinedNodes<\n    InputIndices,\n    OutputIndices,\n    NumInputs extends FixedArraySize,\n    NumOutputs extends FixedArraySize,\n    Repr extends ComponentRepr<NumInputs, NumOutputs>,\n    Value,\n    > extends ComponentBase<NumInputs, NumOutputs, Repr, Value> {\n\n    protected constructor(\n        editor: LogicEditor,\n        protected readonly gridWidth: number,\n        protected readonly gridHeight: number,\n        protected readonly INPUT: InputIndices,\n        protected readonly OUTPUT: OutputIndices,\n        _value: Value,\n        savedData: Repr | null,\n        nodeOffsets: NodeVisuals<NumInputs, NumOutputs>) {\n        super(editor, _value, savedData, nodeOffsets)\n    }\n\n    public get unrotatedWidth() {\n        return this.gridWidth * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return this.gridHeight * GRID_STEP\n    }\n\n}\n\n\ntype ReprType<Repr extends t.Mixed> = Expand<t.TypeOf<Repr>>\n\nexport function defineComponent<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize, T extends t.Mixed>(numInputs: NumInputs, numOutputs: NumOutputs, type: T) {\n    const repr = t.intersection([ComponentRepr(numInputs, numOutputs), type], type.name)\n    return {\n        numInputs,\n        numOutputs,\n        repr,\n        get reprType(): ReprType<typeof repr> { throw new Error() },\n    } as const\n}\n\nexport function extendComponent<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize, T extends t.Mixed, U extends t.Mixed>(superDef: { numInputs: NumInputs, numOutputs: NumOutputs, repr: T }, subType: U) {\n    const repr = t.intersection([superDef.repr, subType], subType.name)\n    return {\n        numInputs: superDef.numInputs,\n        numOutputs: superDef.numOutputs,\n        repr,\n        get reprType(): ReprType<typeof repr> { throw new Error() },\n    } as const\n}\n", "import { Bezier } from \"./bezier.js\";\n\n// math-inlining.\nconst { abs, cos, sin, acos, atan2, sqrt, pow } = Math;\n\n// cube root function yielding real roots\nfunction crt(v) {\n  return v < 0 ? -pow(-v, 1 / 3) : pow(v, 1 / 3);\n}\n\n// trig constants\nconst pi = Math.PI,\n  tau = 2 * pi,\n  quart = pi / 2,\n  // float precision significant decimal\n  epsilon = 0.000001,\n  // extremas used in bbox calculation and similar algorithms\n  nMax = Number.MAX_SAFE_INTEGER || 9007199254740991,\n  nMin = Number.MIN_SAFE_INTEGER || -9007199254740991,\n  // a zero coordinate, which is surprisingly useful\n  ZERO = { x: 0, y: 0, z: 0 };\n\n// Bezier utility functions\nconst utils = {\n  // Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))\n  Tvalues: [\n    -0.0640568928626056260850430826247450385909,\n    0.0640568928626056260850430826247450385909,\n    -0.1911188674736163091586398207570696318404,\n    0.1911188674736163091586398207570696318404,\n    -0.3150426796961633743867932913198102407864,\n    0.3150426796961633743867932913198102407864,\n    -0.4337935076260451384870842319133497124524,\n    0.4337935076260451384870842319133497124524,\n    -0.5454214713888395356583756172183723700107,\n    0.5454214713888395356583756172183723700107,\n    -0.6480936519369755692524957869107476266696,\n    0.6480936519369755692524957869107476266696,\n    -0.7401241915785543642438281030999784255232,\n    0.7401241915785543642438281030999784255232,\n    -0.8200019859739029219539498726697452080761,\n    0.8200019859739029219539498726697452080761,\n    -0.8864155270044010342131543419821967550873,\n    0.8864155270044010342131543419821967550873,\n    -0.9382745520027327585236490017087214496548,\n    0.9382745520027327585236490017087214496548,\n    -0.9747285559713094981983919930081690617411,\n    0.9747285559713094981983919930081690617411,\n    -0.9951872199970213601799974097007368118745,\n    0.9951872199970213601799974097007368118745,\n  ],\n\n  // Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)\n  Cvalues: [\n    0.1279381953467521569740561652246953718517,\n    0.1279381953467521569740561652246953718517,\n    0.1258374563468282961213753825111836887264,\n    0.1258374563468282961213753825111836887264,\n    0.121670472927803391204463153476262425607,\n    0.121670472927803391204463153476262425607,\n    0.1155056680537256013533444839067835598622,\n    0.1155056680537256013533444839067835598622,\n    0.1074442701159656347825773424466062227946,\n    0.1074442701159656347825773424466062227946,\n    0.0976186521041138882698806644642471544279,\n    0.0976186521041138882698806644642471544279,\n    0.086190161531953275917185202983742667185,\n    0.086190161531953275917185202983742667185,\n    0.0733464814110803057340336152531165181193,\n    0.0733464814110803057340336152531165181193,\n    0.0592985849154367807463677585001085845412,\n    0.0592985849154367807463677585001085845412,\n    0.0442774388174198061686027482113382288593,\n    0.0442774388174198061686027482113382288593,\n    0.0285313886289336631813078159518782864491,\n    0.0285313886289336631813078159518782864491,\n    0.0123412297999871995468056670700372915759,\n    0.0123412297999871995468056670700372915759,\n  ],\n\n  arcfn: function (t, derivativeFn) {\n    const d = derivativeFn(t);\n    let l = d.x * d.x + d.y * d.y;\n    if (typeof d.z !== \"undefined\") {\n      l += d.z * d.z;\n    }\n    return sqrt(l);\n  },\n\n  compute: function (t, points, _3d) {\n    // shortcuts\n    if (t === 0) {\n      points[0].t = 0;\n      return points[0];\n    }\n\n    const order = points.length - 1;\n\n    if (t === 1) {\n      points[order].t = 1;\n      return points[order];\n    }\n\n    const mt = 1 - t;\n    let p = points;\n\n    // constant?\n    if (order === 0) {\n      points[0].t = t;\n      return points[0];\n    }\n\n    // linear?\n    if (order === 1) {\n      const ret = {\n        x: mt * p[0].x + t * p[1].x,\n        y: mt * p[0].y + t * p[1].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = mt * p[0].z + t * p[1].z;\n      }\n      return ret;\n    }\n\n    // quadratic/cubic curve?\n    if (order < 4) {\n      let mt2 = mt * mt,\n        t2 = t * t,\n        a,\n        b,\n        c,\n        d = 0;\n      if (order === 2) {\n        p = [p[0], p[1], p[2], ZERO];\n        a = mt2;\n        b = mt * t * 2;\n        c = t2;\n      } else if (order === 3) {\n        a = mt2 * mt;\n        b = mt2 * t * 3;\n        c = mt * t2 * 3;\n        d = t * t2;\n      }\n      const ret = {\n        x: a * p[0].x + b * p[1].x + c * p[2].x + d * p[3].x,\n        y: a * p[0].y + b * p[1].y + c * p[2].y + d * p[3].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = a * p[0].z + b * p[1].z + c * p[2].z + d * p[3].z;\n      }\n      return ret;\n    }\n\n    // higher order curves: use de Casteljau's computation\n    const dCpts = JSON.parse(JSON.stringify(points));\n    while (dCpts.length > 1) {\n      for (let i = 0; i < dCpts.length - 1; i++) {\n        dCpts[i] = {\n          x: dCpts[i].x + (dCpts[i + 1].x - dCpts[i].x) * t,\n          y: dCpts[i].y + (dCpts[i + 1].y - dCpts[i].y) * t,\n        };\n        if (typeof dCpts[i].z !== \"undefined\") {\n          dCpts[i] = dCpts[i].z + (dCpts[i + 1].z - dCpts[i].z) * t;\n        }\n      }\n      dCpts.splice(dCpts.length - 1, 1);\n    }\n    dCpts[0].t = t;\n    return dCpts[0];\n  },\n\n  computeWithRatios: function (t, points, ratios, _3d) {\n    const mt = 1 - t,\n      r = ratios,\n      p = points;\n\n    let f1 = r[0],\n      f2 = r[1],\n      f3 = r[2],\n      f4 = r[3],\n      d;\n\n    // spec for linear\n    f1 *= mt;\n    f2 *= t;\n\n    if (p.length === 2) {\n      d = f1 + f2;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to quadratic\n    f1 *= mt;\n    f2 *= 2 * mt;\n    f3 *= t * t;\n\n    if (p.length === 3) {\n      d = f1 + f2 + f3;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to cubic\n    f1 *= mt;\n    f2 *= 1.5 * mt;\n    f3 *= 3 * mt;\n    f4 *= t * t * t;\n\n    if (p.length === 4) {\n      d = f1 + f2 + f3 + f4;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x + f4 * p[3].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y + f4 * p[3].y) / d,\n        z: !_3d\n          ? false\n          : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z + f4 * p[3].z) / d,\n        t: t,\n      };\n    }\n  },\n\n  derive: function (points, _3d) {\n    const dpoints = [];\n    for (let p = points, d = p.length, c = d - 1; d > 1; d--, c--) {\n      const list = [];\n      for (let j = 0, dpt; j < c; j++) {\n        dpt = {\n          x: c * (p[j + 1].x - p[j].x),\n          y: c * (p[j + 1].y - p[j].y),\n        };\n        if (_3d) {\n          dpt.z = c * (p[j + 1].z - p[j].z);\n        }\n        list.push(dpt);\n      }\n      dpoints.push(list);\n      p = list;\n    }\n    return dpoints;\n  },\n\n  between: function (v, m, M) {\n    return (\n      (m <= v && v <= M) ||\n      utils.approximately(v, m) ||\n      utils.approximately(v, M)\n    );\n  },\n\n  approximately: function (a, b, precision) {\n    return abs(a - b) <= (precision || epsilon);\n  },\n\n  length: function (derivativeFn) {\n    const z = 0.5,\n      len = utils.Tvalues.length;\n\n    let sum = 0;\n\n    for (let i = 0, t; i < len; i++) {\n      t = z * utils.Tvalues[i] + z;\n      sum += utils.Cvalues[i] * utils.arcfn(t, derivativeFn);\n    }\n    return z * sum;\n  },\n\n  map: function (v, ds, de, ts, te) {\n    const d1 = de - ds,\n      d2 = te - ts,\n      v2 = v - ds,\n      r = v2 / d1;\n    return ts + d2 * r;\n  },\n\n  lerp: function (r, v1, v2) {\n    const ret = {\n      x: v1.x + r * (v2.x - v1.x),\n      y: v1.y + r * (v2.y - v1.y),\n    };\n    if (v1.z !== undefined && v2.z !== undefined) {\n      ret.z = v1.z + r * (v2.z - v1.z);\n    }\n    return ret;\n  },\n\n  pointToString: function (p) {\n    let s = p.x + \"/\" + p.y;\n    if (typeof p.z !== \"undefined\") {\n      s += \"/\" + p.z;\n    }\n    return s;\n  },\n\n  pointsToString: function (points) {\n    return \"[\" + points.map(utils.pointToString).join(\", \") + \"]\";\n  },\n\n  copy: function (obj) {\n    return JSON.parse(JSON.stringify(obj));\n  },\n\n  angle: function (o, v1, v2) {\n    const dx1 = v1.x - o.x,\n      dy1 = v1.y - o.y,\n      dx2 = v2.x - o.x,\n      dy2 = v2.y - o.y,\n      cross = dx1 * dy2 - dy1 * dx2,\n      dot = dx1 * dx2 + dy1 * dy2;\n    return atan2(cross, dot);\n  },\n\n  // round as string, to avoid rounding errors\n  round: function (v, d) {\n    const s = \"\" + v;\n    const pos = s.indexOf(\".\");\n    return parseFloat(s.substring(0, pos + 1 + d));\n  },\n\n  dist: function (p1, p2) {\n    const dx = p1.x - p2.x,\n      dy = p1.y - p2.y;\n    return sqrt(dx * dx + dy * dy);\n  },\n\n  closest: function (LUT, point) {\n    let mdist = pow(2, 63),\n      mpos,\n      d;\n    LUT.forEach(function (p, idx) {\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        mpos = idx;\n      }\n    });\n    return { mdist: mdist, mpos: mpos };\n  },\n\n  abcratio: function (t, n) {\n    // see ratio(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const bottom = pow(t, n) + pow(1 - t, n),\n      top = bottom - 1;\n    return abs(top / bottom);\n  },\n\n  projectionratio: function (t, n) {\n    // see u(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const top = pow(1 - t, n),\n      bottom = pow(t, n) + top;\n    return top / bottom;\n  },\n\n  lli8: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n    const nx =\n        (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n      ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n      d = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n    if (d == 0) {\n      return false;\n    }\n    return { x: nx / d, y: ny / d };\n  },\n\n  lli4: function (p1, p2, p3, p4) {\n    const x1 = p1.x,\n      y1 = p1.y,\n      x2 = p2.x,\n      y2 = p2.y,\n      x3 = p3.x,\n      y3 = p3.y,\n      x4 = p4.x,\n      y4 = p4.y;\n    return utils.lli8(x1, y1, x2, y2, x3, y3, x4, y4);\n  },\n\n  lli: function (v1, v2) {\n    return utils.lli4(v1, v1.c, v2, v2.c);\n  },\n\n  makeline: function (p1, p2) {\n    return new Bezier(\n      p1.x,\n      p1.y,\n      (p1.x + p2.x) / 2,\n      (p1.y + p2.y) / 2,\n      p2.x,\n      p2.y\n    );\n  },\n\n  findbbox: function (sections) {\n    let mx = nMax,\n      my = nMax,\n      MX = nMin,\n      MY = nMin;\n    sections.forEach(function (s) {\n      const bbox = s.bbox();\n      if (mx > bbox.x.min) mx = bbox.x.min;\n      if (my > bbox.y.min) my = bbox.y.min;\n      if (MX < bbox.x.max) MX = bbox.x.max;\n      if (MY < bbox.y.max) MY = bbox.y.max;\n    });\n    return {\n      x: { min: mx, mid: (mx + MX) / 2, max: MX, size: MX - mx },\n      y: { min: my, mid: (my + MY) / 2, max: MY, size: MY - my },\n    };\n  },\n\n  shapeintersections: function (\n    s1,\n    bbox1,\n    s2,\n    bbox2,\n    curveIntersectionThreshold\n  ) {\n    if (!utils.bboxoverlap(bbox1, bbox2)) return [];\n    const intersections = [];\n    const a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];\n    const a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];\n    a1.forEach(function (l1) {\n      if (l1.virtual) return;\n      a2.forEach(function (l2) {\n        if (l2.virtual) return;\n        const iss = l1.intersects(l2, curveIntersectionThreshold);\n        if (iss.length > 0) {\n          iss.c1 = l1;\n          iss.c2 = l2;\n          iss.s1 = s1;\n          iss.s2 = s2;\n          intersections.push(iss);\n        }\n      });\n    });\n    return intersections;\n  },\n\n  makeshape: function (forward, back, curveIntersectionThreshold) {\n    const bpl = back.points.length;\n    const fpl = forward.points.length;\n    const start = utils.makeline(back.points[bpl - 1], forward.points[0]);\n    const end = utils.makeline(forward.points[fpl - 1], back.points[0]);\n    const shape = {\n      startcap: start,\n      forward: forward,\n      back: back,\n      endcap: end,\n      bbox: utils.findbbox([start, forward, back, end]),\n    };\n    shape.intersections = function (s2) {\n      return utils.shapeintersections(\n        shape,\n        shape.bbox,\n        s2,\n        s2.bbox,\n        curveIntersectionThreshold\n      );\n    };\n    return shape;\n  },\n\n  getminmax: function (curve, d, list) {\n    if (!list) return { min: 0, max: 0 };\n    let min = nMax,\n      max = nMin,\n      t,\n      c;\n    if (list.indexOf(0) === -1) {\n      list = [0].concat(list);\n    }\n    if (list.indexOf(1) === -1) {\n      list.push(1);\n    }\n    for (let i = 0, len = list.length; i < len; i++) {\n      t = list[i];\n      c = curve.get(t);\n      if (c[d] < min) {\n        min = c[d];\n      }\n      if (c[d] > max) {\n        max = c[d];\n      }\n    }\n    return { min: min, mid: (min + max) / 2, max: max, size: max - min };\n  },\n\n  align: function (points, line) {\n    const tx = line.p1.x,\n      ty = line.p1.y,\n      a = -atan2(line.p2.y - ty, line.p2.x - tx),\n      d = function (v) {\n        return {\n          x: (v.x - tx) * cos(a) - (v.y - ty) * sin(a),\n          y: (v.x - tx) * sin(a) + (v.y - ty) * cos(a),\n        };\n      };\n    return points.map(d);\n  },\n\n  roots: function (points, line) {\n    line = line || { p1: { x: 0, y: 0 }, p2: { x: 1, y: 0 } };\n\n    const order = points.length - 1;\n    const aligned = utils.align(points, line);\n    const reduce = function (t) {\n      return 0 <= t && t <= 1;\n    };\n\n    if (order === 2) {\n      const a = aligned[0].y,\n        b = aligned[1].y,\n        c = aligned[2].y,\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2].filter(reduce);\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * b - 2 * c)].filter(reduce);\n      }\n      return [];\n    }\n\n    // see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\n    const pa = aligned[0].y,\n      pb = aligned[1].y,\n      pc = aligned[2].y,\n      pd = aligned[3].y;\n\n    let d = -pa + 3 * pb - 3 * pc + pd,\n      a = 3 * pa - 6 * pb + 3 * pc,\n      b = -3 * pa + 3 * pb,\n      c = pa;\n\n    if (utils.approximately(d, 0)) {\n      // this is not a cubic curve.\n      if (utils.approximately(a, 0)) {\n        // in fact, this is not a quadratic curve either.\n        if (utils.approximately(b, 0)) {\n          // in fact in fact, there are no solutions.\n          return [];\n        }\n        // linear solution:\n        return [-c / b].filter(reduce);\n      }\n      // quadratic solution:\n      const q = sqrt(b * b - 4 * a * c),\n        a2 = 2 * a;\n      return [(q - b) / a2, (-b - q) / a2].filter(reduce);\n    }\n\n    // at this point, we know we need a cubic solution:\n\n    a /= d;\n    b /= d;\n    c /= d;\n\n    const p = (3 * b - a * a) / 3,\n      p3 = p / 3,\n      q = (2 * a * a * a - 9 * a * b + 27 * c) / 27,\n      q2 = q / 2,\n      discriminant = q2 * q2 + p3 * p3 * p3;\n\n    let u1, v1, x1, x2, x3;\n    if (discriminant < 0) {\n      const mp3 = -p / 3,\n        mp33 = mp3 * mp3 * mp3,\n        r = sqrt(mp33),\n        t = -q / (2 * r),\n        cosphi = t < -1 ? -1 : t > 1 ? 1 : t,\n        phi = acos(cosphi),\n        crtr = crt(r),\n        t1 = 2 * crtr;\n      x1 = t1 * cos(phi / 3) - a / 3;\n      x2 = t1 * cos((phi + tau) / 3) - a / 3;\n      x3 = t1 * cos((phi + 2 * tau) / 3) - a / 3;\n      return [x1, x2, x3].filter(reduce);\n    } else if (discriminant === 0) {\n      u1 = q2 < 0 ? crt(-q2) : -crt(q2);\n      x1 = 2 * u1 - a / 3;\n      x2 = -u1 - a / 3;\n      return [x1, x2].filter(reduce);\n    } else {\n      const sd = sqrt(discriminant);\n      u1 = crt(-q2 + sd);\n      v1 = crt(q2 + sd);\n      return [u1 - v1 - a / 3].filter(reduce);\n    }\n  },\n\n  droots: function (p) {\n    // quadratic roots are easy\n    if (p.length === 3) {\n      const a = p[0],\n        b = p[1],\n        c = p[2],\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2];\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * (b - c))];\n      }\n      return [];\n    }\n\n    // linear roots are even easier\n    if (p.length === 2) {\n      const a = p[0],\n        b = p[1];\n      if (a !== b) {\n        return [a / (a - b)];\n      }\n      return [];\n    }\n\n    return [];\n  },\n\n  curvature: function (t, d1, d2, _3d, kOnly) {\n    let num,\n      dnm,\n      adk,\n      dk,\n      k = 0,\n      r = 0;\n\n    //\n    // We're using the following formula for curvature:\n    //\n    //              x'y\" - y'x\"\n    //   k(t) = ------------------\n    //           (x'\u00B2 + y'\u00B2)^(3/2)\n    //\n    // from https://en.wikipedia.org/wiki/Radius_of_curvature#Definition\n    //\n    // With it corresponding 3D counterpart:\n    //\n    //          sqrt( (y'z\" - y\"z')\u00B2 + (z'x\" - z\"x')\u00B2 + (x'y\" - x\"y')\u00B2)\n    //   k(t) = -------------------------------------------------------\n    //                     (x'\u00B2 + y'\u00B2 + z'\u00B2)^(3/2)\n    //\n\n    const d = utils.compute(t, d1);\n    const dd = utils.compute(t, d2);\n    const qdsum = d.x * d.x + d.y * d.y;\n\n    if (_3d) {\n      num = sqrt(\n        pow(d.y * dd.z - dd.y * d.z, 2) +\n          pow(d.z * dd.x - dd.z * d.x, 2) +\n          pow(d.x * dd.y - dd.x * d.y, 2)\n      );\n      dnm = pow(qdsum + d.z * d.z, 3 / 2);\n    } else {\n      num = d.x * dd.y - d.y * dd.x;\n      dnm = pow(qdsum, 3 / 2);\n    }\n\n    if (num === 0 || dnm === 0) {\n      return { k: 0, r: 0 };\n    }\n\n    k = num / dnm;\n    r = dnm / num;\n\n    // We're also computing the derivative of kappa, because\n    // there is value in knowing the rate of change for the\n    // curvature along the curve. And we're just going to\n    // ballpark it based on an epsilon.\n    if (!kOnly) {\n      // compute k'(t) based on the interval before, and after it,\n      // to at least try to not introduce forward/backward pass bias.\n      const pk = utils.curvature(t - 0.001, d1, d2, _3d, true).k;\n      const nk = utils.curvature(t + 0.001, d1, d2, _3d, true).k;\n      dk = (nk - k + (k - pk)) / 2;\n      adk = (abs(nk - k) + abs(k - pk)) / 2;\n    }\n\n    return { k: k, r: r, dk: dk, adk: adk };\n  },\n\n  inflections: function (points) {\n    if (points.length < 4) return [];\n\n    // FIXME: TODO: add in inflection abstraction for quartic+ curves?\n\n    const p = utils.align(points, { p1: points[0], p2: points.slice(-1)[0] }),\n      a = p[2].x * p[1].y,\n      b = p[3].x * p[1].y,\n      c = p[1].x * p[2].y,\n      d = p[3].x * p[2].y,\n      v1 = 18 * (-3 * a + 2 * b + 3 * c - d),\n      v2 = 18 * (3 * a - b - 3 * c),\n      v3 = 18 * (c - a);\n\n    if (utils.approximately(v1, 0)) {\n      if (!utils.approximately(v2, 0)) {\n        let t = -v3 / v2;\n        if (0 <= t && t <= 1) return [t];\n      }\n      return [];\n    }\n\n    const d2 = 2 * v1;\n\n    if (utils.approximately(d2, 0)) return [];\n\n    const trm = v2 * v2 - 4 * v1 * v3;\n\n    if (trm < 0) return [];\n\n    const sq = Math.sqrt(trm);\n\n    return [(sq - v2) / d2, -(v2 + sq) / d2].filter(function (r) {\n      return 0 <= r && r <= 1;\n    });\n  },\n\n  bboxoverlap: function (b1, b2) {\n    const dims = [\"x\", \"y\"],\n      len = dims.length;\n\n    for (let i = 0, dim, l, t, d; i < len; i++) {\n      dim = dims[i];\n      l = b1[dim].mid;\n      t = b2[dim].mid;\n      d = (b1[dim].size + b2[dim].size) / 2;\n      if (abs(l - t) >= d) return false;\n    }\n    return true;\n  },\n\n  expandbox: function (bbox, _bbox) {\n    if (_bbox.x.min < bbox.x.min) {\n      bbox.x.min = _bbox.x.min;\n    }\n    if (_bbox.y.min < bbox.y.min) {\n      bbox.y.min = _bbox.y.min;\n    }\n    if (_bbox.z && _bbox.z.min < bbox.z.min) {\n      bbox.z.min = _bbox.z.min;\n    }\n    if (_bbox.x.max > bbox.x.max) {\n      bbox.x.max = _bbox.x.max;\n    }\n    if (_bbox.y.max > bbox.y.max) {\n      bbox.y.max = _bbox.y.max;\n    }\n    if (_bbox.z && _bbox.z.max > bbox.z.max) {\n      bbox.z.max = _bbox.z.max;\n    }\n    bbox.x.mid = (bbox.x.min + bbox.x.max) / 2;\n    bbox.y.mid = (bbox.y.min + bbox.y.max) / 2;\n    if (bbox.z) {\n      bbox.z.mid = (bbox.z.min + bbox.z.max) / 2;\n    }\n    bbox.x.size = bbox.x.max - bbox.x.min;\n    bbox.y.size = bbox.y.max - bbox.y.min;\n    if (bbox.z) {\n      bbox.z.size = bbox.z.max - bbox.z.min;\n    }\n  },\n\n  pairiteration: function (c1, c2, curveIntersectionThreshold) {\n    const c1b = c1.bbox(),\n      c2b = c2.bbox(),\n      r = 100000,\n      threshold = curveIntersectionThreshold || 0.5;\n\n    if (\n      c1b.x.size + c1b.y.size < threshold &&\n      c2b.x.size + c2b.y.size < threshold\n    ) {\n      return [\n        (((r * (c1._t1 + c1._t2)) / 2) | 0) / r +\n          \"/\" +\n          (((r * (c2._t1 + c2._t2)) / 2) | 0) / r,\n      ];\n    }\n\n    let cc1 = c1.split(0.5),\n      cc2 = c2.split(0.5),\n      pairs = [\n        { left: cc1.left, right: cc2.left },\n        { left: cc1.left, right: cc2.right },\n        { left: cc1.right, right: cc2.right },\n        { left: cc1.right, right: cc2.left },\n      ];\n\n    pairs = pairs.filter(function (pair) {\n      return utils.bboxoverlap(pair.left.bbox(), pair.right.bbox());\n    });\n\n    let results = [];\n\n    if (pairs.length === 0) return results;\n\n    pairs.forEach(function (pair) {\n      results = results.concat(\n        utils.pairiteration(pair.left, pair.right, threshold)\n      );\n    });\n\n    results = results.filter(function (v, i) {\n      return results.indexOf(v) === i;\n    });\n\n    return results;\n  },\n\n  getccenter: function (p1, p2, p3) {\n    const dx1 = p2.x - p1.x,\n      dy1 = p2.y - p1.y,\n      dx2 = p3.x - p2.x,\n      dy2 = p3.y - p2.y,\n      dx1p = dx1 * cos(quart) - dy1 * sin(quart),\n      dy1p = dx1 * sin(quart) + dy1 * cos(quart),\n      dx2p = dx2 * cos(quart) - dy2 * sin(quart),\n      dy2p = dx2 * sin(quart) + dy2 * cos(quart),\n      // chord midpoints\n      mx1 = (p1.x + p2.x) / 2,\n      my1 = (p1.y + p2.y) / 2,\n      mx2 = (p2.x + p3.x) / 2,\n      my2 = (p2.y + p3.y) / 2,\n      // midpoint offsets\n      mx1n = mx1 + dx1p,\n      my1n = my1 + dy1p,\n      mx2n = mx2 + dx2p,\n      my2n = my2 + dy2p,\n      // intersection of these lines:\n      arc = utils.lli8(mx1, my1, mx1n, my1n, mx2, my2, mx2n, my2n),\n      r = utils.dist(arc, p1);\n\n    // arc start/end values, over mid point:\n    let s = atan2(p1.y - arc.y, p1.x - arc.x),\n      m = atan2(p2.y - arc.y, p2.x - arc.x),\n      e = atan2(p3.y - arc.y, p3.x - arc.x),\n      _;\n\n    // determine arc direction (cw/ccw correction)\n    if (s < e) {\n      // if s<m<e, arc(s, e)\n      // if m<s<e, arc(e, s + tau)\n      // if s<e<m, arc(e, s + tau)\n      if (s > m || m > e) {\n        s += tau;\n      }\n      if (s > e) {\n        _ = e;\n        e = s;\n        s = _;\n      }\n    } else {\n      // if e<m<s, arc(e, s)\n      // if m<e<s, arc(s, e + tau)\n      // if e<s<m, arc(s, e + tau)\n      if (e < m && m < s) {\n        _ = e;\n        e = s;\n        s = _;\n      } else {\n        e += tau;\n      }\n    }\n    // assign and done.\n    arc.s = s;\n    arc.e = e;\n    arc.r = r;\n    return arc;\n  },\n\n  numberSort: function (a, b) {\n    return a - b;\n  },\n};\n\nexport { utils };\n", "import { utils } from \"./utils.js\";\n\n/**\n * Poly Bezier\n * @param {[type]} curves [description]\n */\nclass PolyBezier {\n  constructor(curves) {\n    this.curves = [];\n    this._3d = false;\n    if (!!curves) {\n      this.curves = curves;\n      this._3d = this.curves[0]._3d;\n    }\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return (\n      \"[\" +\n      this.curves\n        .map(function (curve) {\n          return utils.pointsToString(curve.points);\n        })\n        .join(\", \") +\n      \"]\"\n    );\n  }\n\n  addCurve(curve) {\n    this.curves.push(curve);\n    this._3d = this._3d || curve._3d;\n  }\n\n  length() {\n    return this.curves\n      .map(function (v) {\n        return v.length();\n      })\n      .reduce(function (a, b) {\n        return a + b;\n      });\n  }\n\n  curve(idx) {\n    return this.curves[idx];\n  }\n\n  bbox() {\n    const c = this.curves;\n    var bbox = c[0].bbox();\n    for (var i = 1; i < c.length; i++) {\n      utils.expandbox(bbox, c[i].bbox());\n    }\n    return bbox;\n  }\n\n  offset(d) {\n    const offset = [];\n    this.curves.forEach(function (v) {\n      offset.push(...v.offset(d));\n    });\n    return new PolyBezier(offset);\n  }\n}\n\nexport { PolyBezier };\n", "/**\n  A javascript Bezier curve library by Pomax.\n\n  Based on http://pomax.github.io/bezierinfo\n\n  This code is MIT licensed.\n**/\n\nimport { utils } from \"./utils.js\";\nimport { PolyBezier } from \"./poly-bezier.js\";\n\n// math-inlining.\nconst { abs, min, max, cos, sin, acos, sqrt } = Math;\nconst pi = Math.PI;\n// a zero coordinate, which is surprisingly useful\nconst ZERO = { x: 0, y: 0, z: 0 };\n\n/**\n * Bezier curve constructor.\n *\n * ...docs pending...\n */\nclass Bezier {\n  constructor(coords) {\n    let args =\n      coords && coords.forEach ? coords : Array.from(arguments).slice();\n    let coordlen = false;\n\n    if (typeof args[0] === \"object\") {\n      coordlen = args.length;\n      const newargs = [];\n      args.forEach(function (point) {\n        [\"x\", \"y\", \"z\"].forEach(function (d) {\n          if (typeof point[d] !== \"undefined\") {\n            newargs.push(point[d]);\n          }\n        });\n      });\n      args = newargs;\n    }\n\n    let higher = false;\n    const len = args.length;\n\n    if (coordlen) {\n      if (coordlen > 4) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n        higher = true;\n      }\n    } else {\n      if (len !== 6 && len !== 8 && len !== 9 && len !== 12) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n      }\n    }\n\n    const _3d = (this._3d =\n      (!higher && (len === 9 || len === 12)) ||\n      (coords && coords[0] && typeof coords[0].z !== \"undefined\"));\n\n    const points = (this.points = []);\n    for (let idx = 0, step = _3d ? 3 : 2; idx < len; idx += step) {\n      var point = {\n        x: args[idx],\n        y: args[idx + 1],\n      };\n      if (_3d) {\n        point.z = args[idx + 2];\n      }\n      points.push(point);\n    }\n    const order = (this.order = points.length - 1);\n\n    const dims = (this.dims = [\"x\", \"y\"]);\n    if (_3d) dims.push(\"z\");\n    this.dimlen = dims.length;\n\n    // is this curve, practically speaking, a straight line?\n    const aligned = utils.align(points, { p1: points[0], p2: points[order] });\n    const baselength = utils.dist(points[0], points[order]);\n    this._linear = aligned.reduce((t, p) => t + abs(p.y), 0) < baselength / 50;\n\n    this._lut = [];\n    this._t1 = 0;\n    this._t2 = 1;\n    this.update();\n  }\n\n  static quadraticFromPoints(p1, p2, p3, t) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    // shortcuts, although they're really dumb\n    if (t === 0) {\n      return new Bezier(p2, p2, p3);\n    }\n    if (t === 1) {\n      return new Bezier(p1, p2, p2);\n    }\n    // real fitting.\n    const abc = Bezier.getABC(2, p1, p2, p3, t);\n    return new Bezier(p1, abc.A, p3);\n  }\n\n  static cubicFromPoints(S, B, E, t, d1) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    const abc = Bezier.getABC(3, S, B, E, t);\n    if (typeof d1 === \"undefined\") {\n      d1 = utils.dist(B, abc.C);\n    }\n    const d2 = (d1 * (1 - t)) / t;\n\n    const selen = utils.dist(S, E),\n      lx = (E.x - S.x) / selen,\n      ly = (E.y - S.y) / selen,\n      bx1 = d1 * lx,\n      by1 = d1 * ly,\n      bx2 = d2 * lx,\n      by2 = d2 * ly;\n    // derivation of new hull coordinates\n    const e1 = { x: B.x - bx1, y: B.y - by1 },\n      e2 = { x: B.x + bx2, y: B.y + by2 },\n      A = abc.A,\n      v1 = { x: A.x + (e1.x - A.x) / (1 - t), y: A.y + (e1.y - A.y) / (1 - t) },\n      v2 = { x: A.x + (e2.x - A.x) / t, y: A.y + (e2.y - A.y) / t },\n      nc1 = { x: S.x + (v1.x - S.x) / t, y: S.y + (v1.y - S.y) / t },\n      nc2 = {\n        x: E.x + (v2.x - E.x) / (1 - t),\n        y: E.y + (v2.y - E.y) / (1 - t),\n      };\n    // ...done\n    return new Bezier(S, nc1, nc2, E);\n  }\n\n  static getUtils() {\n    return utils;\n  }\n\n  getUtils() {\n    return Bezier.getUtils();\n  }\n\n  static get PolyBezier() {\n    return PolyBezier;\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return utils.pointsToString(this.points);\n  }\n\n  toSVG() {\n    if (this._3d) return false;\n    const p = this.points,\n      x = p[0].x,\n      y = p[0].y,\n      s = [\"M\", x, y, this.order === 2 ? \"Q\" : \"C\"];\n    for (let i = 1, last = p.length; i < last; i++) {\n      s.push(p[i].x);\n      s.push(p[i].y);\n    }\n    return s.join(\" \");\n  }\n\n  setRatios(ratios) {\n    if (ratios.length !== this.points.length) {\n      throw new Error(\"incorrect number of ratio values\");\n    }\n    this.ratios = ratios;\n    this._lut = []; //  invalidate any precomputed LUT\n  }\n\n  verify() {\n    const print = this.coordDigest();\n    if (print !== this._print) {\n      this._print = print;\n      this.update();\n    }\n  }\n\n  coordDigest() {\n    return this.points\n      .map(function (c, pos) {\n        return \"\" + pos + c.x + c.y + (c.z ? c.z : 0);\n      })\n      .join(\"\");\n  }\n\n  update() {\n    // invalidate any precomputed LUT\n    this._lut = [];\n    this.dpoints = utils.derive(this.points, this._3d);\n    this.computedirection();\n  }\n\n  computedirection() {\n    const points = this.points;\n    const angle = utils.angle(points[0], points[this.order], points[1]);\n    this.clockwise = angle > 0;\n  }\n\n  length() {\n    return utils.length(this.derivative.bind(this));\n  }\n\n  static getABC(order = 2, S, B, E, t = 0.5) {\n    const u = utils.projectionratio(t, order),\n      um = 1 - u,\n      C = {\n        x: u * S.x + um * E.x,\n        y: u * S.y + um * E.y,\n      },\n      s = utils.abcratio(t, order),\n      A = {\n        x: B.x + (B.x - C.x) / s,\n        y: B.y + (B.y - C.y) / s,\n      };\n    return { A, B, C, S, E };\n  }\n\n  getABC(t, B) {\n    B = B || this.get(t);\n    let S = this.points[0];\n    let E = this.points[this.order];\n    return Bezier.getABC(this.order, S, B, E, t);\n  }\n\n  getLUT(steps) {\n    this.verify();\n    steps = steps || 100;\n    if (this._lut.length === steps) {\n      return this._lut;\n    }\n    this._lut = [];\n    // n steps means n+1 points\n    steps++;\n    this._lut = [];\n    for (let i = 0, p, t; i < steps; i++) {\n      t = i / (steps - 1);\n      p = this.compute(t);\n      p.t = t;\n      this._lut.push(p);\n    }\n    return this._lut;\n  }\n\n  on(point, error) {\n    error = error || 5;\n    const lut = this.getLUT(),\n      hits = [];\n    for (let i = 0, c, t = 0; i < lut.length; i++) {\n      c = lut[i];\n      if (utils.dist(c, point) < error) {\n        hits.push(c);\n        t += i / lut.length;\n      }\n    }\n    if (!hits.length) return false;\n    return (t /= hits.length);\n  }\n\n  project(point) {\n    // step 1: coarse check\n    const LUT = this.getLUT(),\n      l = LUT.length - 1,\n      closest = utils.closest(LUT, point),\n      mpos = closest.mpos,\n      t1 = (mpos - 1) / l,\n      t2 = (mpos + 1) / l,\n      step = 0.1 / l;\n\n    // step 2: fine check\n    let mdist = closest.mdist,\n      t = t1,\n      ft = t,\n      p;\n    mdist += 1;\n    for (let d; t < t2 + step; t += step) {\n      p = this.compute(t);\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        ft = t;\n      }\n    }\n    ft = ft < 0 ? 0 : ft > 1 ? 1 : ft;\n    p = this.compute(ft);\n    p.t = ft;\n    p.d = mdist;\n    return p;\n  }\n\n  get(t) {\n    return this.compute(t);\n  }\n\n  point(idx) {\n    return this.points[idx];\n  }\n\n  compute(t) {\n    if (this.ratios) {\n      return utils.computeWithRatios(t, this.points, this.ratios, this._3d);\n    }\n    return utils.compute(t, this.points, this._3d, this.ratios);\n  }\n\n  raise() {\n    const p = this.points,\n      np = [p[0]],\n      k = p.length;\n    for (let i = 1, pi, pim; i < k; i++) {\n      pi = p[i];\n      pim = p[i - 1];\n      np[i] = {\n        x: ((k - i) / k) * pi.x + (i / k) * pim.x,\n        y: ((k - i) / k) * pi.y + (i / k) * pim.y,\n      };\n    }\n    np[k] = p[k - 1];\n    return new Bezier(np);\n  }\n\n  derivative(t) {\n    return utils.compute(t, this.dpoints[0], this._3d);\n  }\n\n  dderivative(t) {\n    return utils.compute(t, this.dpoints[1], this._3d);\n  }\n\n  align() {\n    let p = this.points;\n    return new Bezier(utils.align(p, { p1: p[0], p2: p[p.length - 1] }));\n  }\n\n  curvature(t) {\n    return utils.curvature(t, this.dpoints[0], this.dpoints[1], this._3d);\n  }\n\n  inflections() {\n    return utils.inflections(this.points);\n  }\n\n  normal(t) {\n    return this._3d ? this.__normal3(t) : this.__normal2(t);\n  }\n\n  __normal2(t) {\n    const d = this.derivative(t);\n    const q = sqrt(d.x * d.x + d.y * d.y);\n    return { t, x: -d.y / q, y: d.x / q };\n  }\n\n  __normal3(t) {\n    // see http://stackoverflow.com/questions/25453159\n    const r1 = this.derivative(t),\n      r2 = this.derivative(t + 0.01),\n      q1 = sqrt(r1.x * r1.x + r1.y * r1.y + r1.z * r1.z),\n      q2 = sqrt(r2.x * r2.x + r2.y * r2.y + r2.z * r2.z);\n    r1.x /= q1;\n    r1.y /= q1;\n    r1.z /= q1;\n    r2.x /= q2;\n    r2.y /= q2;\n    r2.z /= q2;\n    // cross product\n    const c = {\n      x: r2.y * r1.z - r2.z * r1.y,\n      y: r2.z * r1.x - r2.x * r1.z,\n      z: r2.x * r1.y - r2.y * r1.x,\n    };\n    const m = sqrt(c.x * c.x + c.y * c.y + c.z * c.z);\n    c.x /= m;\n    c.y /= m;\n    c.z /= m;\n    // rotation matrix\n    const R = [\n      c.x * c.x,\n      c.x * c.y - c.z,\n      c.x * c.z + c.y,\n      c.x * c.y + c.z,\n      c.y * c.y,\n      c.y * c.z - c.x,\n      c.x * c.z - c.y,\n      c.y * c.z + c.x,\n      c.z * c.z,\n    ];\n    // normal vector:\n    const n = {\n      t,\n      x: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,\n      y: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,\n      z: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z,\n    };\n    return n;\n  }\n\n  hull(t) {\n    let p = this.points,\n      _p = [],\n      q = [],\n      idx = 0;\n    q[idx++] = p[0];\n    q[idx++] = p[1];\n    q[idx++] = p[2];\n    if (this.order === 3) {\n      q[idx++] = p[3];\n    }\n    // we lerp between all points at each iteration, until we have 1 point left.\n    while (p.length > 1) {\n      _p = [];\n      for (let i = 0, pt, l = p.length - 1; i < l; i++) {\n        pt = utils.lerp(t, p[i], p[i + 1]);\n        q[idx++] = pt;\n        _p.push(pt);\n      }\n      p = _p;\n    }\n    return q;\n  }\n\n  split(t1, t2) {\n    // shortcuts\n    if (t1 === 0 && !!t2) {\n      return this.split(t2).left;\n    }\n    if (t2 === 1) {\n      return this.split(t1).right;\n    }\n\n    // no shortcut: use \"de Casteljau\" iteration.\n    const q = this.hull(t1);\n    const result = {\n      left:\n        this.order === 2\n          ? new Bezier([q[0], q[3], q[5]])\n          : new Bezier([q[0], q[4], q[7], q[9]]),\n      right:\n        this.order === 2\n          ? new Bezier([q[5], q[4], q[2]])\n          : new Bezier([q[9], q[8], q[6], q[3]]),\n      span: q,\n    };\n\n    // make sure we bind _t1/_t2 information!\n    result.left._t1 = utils.map(0, 0, 1, this._t1, this._t2);\n    result.left._t2 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t1 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t2 = utils.map(1, 0, 1, this._t1, this._t2);\n\n    // if we have no t2, we're done\n    if (!t2) {\n      return result;\n    }\n\n    // if we have a t2, split again:\n    t2 = utils.map(t2, t1, 1, 0, 1);\n    return result.right.split(t2).left;\n  }\n\n  extrema() {\n    const result = {};\n    let roots = [];\n\n    this.dims.forEach(\n      function (dim) {\n        let mfn = function (v) {\n          return v[dim];\n        };\n        let p = this.dpoints[0].map(mfn);\n        result[dim] = utils.droots(p);\n        if (this.order === 3) {\n          p = this.dpoints[1].map(mfn);\n          result[dim] = result[dim].concat(utils.droots(p));\n        }\n        result[dim] = result[dim].filter(function (t) {\n          return t >= 0 && t <= 1;\n        });\n        roots = roots.concat(result[dim].sort(utils.numberSort));\n      }.bind(this)\n    );\n\n    result.values = roots.sort(utils.numberSort).filter(function (v, idx) {\n      return roots.indexOf(v) === idx;\n    });\n\n    return result;\n  }\n\n  bbox() {\n    const extrema = this.extrema(),\n      result = {};\n    this.dims.forEach(\n      function (d) {\n        result[d] = utils.getminmax(this, d, extrema[d]);\n      }.bind(this)\n    );\n    return result;\n  }\n\n  overlaps(curve) {\n    const lbbox = this.bbox(),\n      tbbox = curve.bbox();\n    return utils.bboxoverlap(lbbox, tbbox);\n  }\n\n  offset(t, d) {\n    if (typeof d !== \"undefined\") {\n      const c = this.get(t),\n        n = this.normal(t);\n      const ret = {\n        c: c,\n        n: n,\n        x: c.x + n.x * d,\n        y: c.y + n.y * d,\n      };\n      if (this._3d) {\n        ret.z = c.z + n.z * d;\n      }\n      return ret;\n    }\n    if (this._linear) {\n      const nv = this.normal(0),\n        coords = this.points.map(function (p) {\n          const ret = {\n            x: p.x + t * nv.x,\n            y: p.y + t * nv.y,\n          };\n          if (p.z && nv.z) {\n            ret.z = p.z + t * nv.z;\n          }\n          return ret;\n        });\n      return [new Bezier(coords)];\n    }\n    return this.reduce().map(function (s) {\n      if (s._linear) {\n        return s.offset(t)[0];\n      }\n      return s.scale(t);\n    });\n  }\n\n  simple() {\n    if (this.order === 3) {\n      const a1 = utils.angle(this.points[0], this.points[3], this.points[1]);\n      const a2 = utils.angle(this.points[0], this.points[3], this.points[2]);\n      if ((a1 > 0 && a2 < 0) || (a1 < 0 && a2 > 0)) return false;\n    }\n    const n1 = this.normal(0);\n    const n2 = this.normal(1);\n    let s = n1.x * n2.x + n1.y * n2.y;\n    if (this._3d) {\n      s += n1.z * n2.z;\n    }\n    return abs(acos(s)) < pi / 3;\n  }\n\n  reduce() {\n    // TODO: examine these var types in more detail...\n    let i,\n      t1 = 0,\n      t2 = 0,\n      step = 0.01,\n      segment,\n      pass1 = [],\n      pass2 = [];\n    // first pass: split on extrema\n    let extrema = this.extrema().values;\n    if (extrema.indexOf(0) === -1) {\n      extrema = [0].concat(extrema);\n    }\n    if (extrema.indexOf(1) === -1) {\n      extrema.push(1);\n    }\n\n    for (t1 = extrema[0], i = 1; i < extrema.length; i++) {\n      t2 = extrema[i];\n      segment = this.split(t1, t2);\n      segment._t1 = t1;\n      segment._t2 = t2;\n      pass1.push(segment);\n      t1 = t2;\n    }\n\n    // second pass: further reduce these segments to simple segments\n    pass1.forEach(function (p1) {\n      t1 = 0;\n      t2 = 0;\n      while (t2 <= 1) {\n        for (t2 = t1 + step; t2 <= 1 + step; t2 += step) {\n          segment = p1.split(t1, t2);\n          if (!segment.simple()) {\n            t2 -= step;\n            if (abs(t1 - t2) < step) {\n              // we can never form a reduction\n              return [];\n            }\n            segment = p1.split(t1, t2);\n            segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n            segment._t2 = utils.map(t2, 0, 1, p1._t1, p1._t2);\n            pass2.push(segment);\n            t1 = t2;\n            break;\n          }\n        }\n      }\n      if (t1 < 1) {\n        segment = p1.split(t1, 1);\n        segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n        segment._t2 = p1._t2;\n        pass2.push(segment);\n      }\n    });\n    return pass2;\n  }\n\n  translate(v, d1, d2) {\n    d2 = typeof d2 === \"number\" ? d2 : d1;\n\n    // TODO: make this take curves with control points outside\n    //       of the start-end interval into account\n\n    const o = this.order;\n    let d = this.points.map((_, i) => (1 - i / o) * d1 + (i / o) * d2);\n    return new Bezier(\n      this.points.map((p, i) => ({\n        x: p.x + v.x * d[i],\n        y: p.y + v.y * d[i],\n      }))\n    );\n  }\n\n  scale(d) {\n    const order = this.order;\n    let distanceFn = false;\n    if (typeof d === \"function\") {\n      distanceFn = d;\n    }\n    if (distanceFn && order === 2) {\n      return this.raise().scale(distanceFn);\n    }\n\n    // TODO: add special handling for non-linear degenerate curves.\n\n    const clockwise = this.clockwise;\n    const points = this.points;\n\n    if (this._linear) {\n      return this.translate(\n        this.normal(0),\n        distanceFn ? distanceFn(0) : d,\n        distanceFn ? distanceFn(1) : d\n      );\n    }\n\n    const r1 = distanceFn ? distanceFn(0) : d;\n    const r2 = distanceFn ? distanceFn(1) : d;\n    const v = [this.offset(0, 10), this.offset(1, 10)];\n    const np = [];\n    const o = utils.lli4(v[0], v[0].c, v[1], v[1].c);\n\n    if (!o) {\n      throw new Error(\"cannot scale this curve. Try reducing it first.\");\n    }\n\n    // move all points by distance 'd' wrt the origin 'o',\n    // and move end points by fixed distance along normal.\n    [0, 1].forEach(function (t) {\n      const p = (np[t * order] = utils.copy(points[t * order]));\n      p.x += (t ? r2 : r1) * v[t].n.x;\n      p.y += (t ? r2 : r1) * v[t].n.y;\n    });\n\n    if (!distanceFn) {\n      // move control points to lie on the intersection of the offset\n      // derivative vector, and the origin-through-control vector\n      [0, 1].forEach((t) => {\n        if (order === 2 && !!t) return;\n        const p = np[t * order];\n        const d = this.derivative(t);\n        const p2 = { x: p.x + d.x, y: p.y + d.y };\n        np[t + 1] = utils.lli4(p, p2, o, points[t + 1]);\n      });\n      return new Bezier(np);\n    }\n\n    // move control points by \"however much necessary to\n    // ensure the correct tangent to endpoint\".\n    [0, 1].forEach(function (t) {\n      if (order === 2 && !!t) return;\n      var p = points[t + 1];\n      var ov = {\n        x: p.x - o.x,\n        y: p.y - o.y,\n      };\n      var rc = distanceFn ? distanceFn((t + 1) / order) : d;\n      if (distanceFn && !clockwise) rc = -rc;\n      var m = sqrt(ov.x * ov.x + ov.y * ov.y);\n      ov.x /= m;\n      ov.y /= m;\n      np[t + 1] = {\n        x: p.x + rc * ov.x,\n        y: p.y + rc * ov.y,\n      };\n    });\n    return new Bezier(np);\n  }\n\n  outline(d1, d2, d3, d4) {\n    d2 = d2 === undefined ? d1 : d2;\n\n    if (this._linear) {\n      // TODO: find the actual extrema, because they might\n      //       be before the start, or past the end.\n\n      const n = this.normal(0);\n      const start = this.points[0];\n      const end = this.points[this.points.length - 1];\n      let s, mid, e;\n\n      if (d3 === undefined) {\n        d3 = d1;\n        d4 = d2;\n      }\n\n      s = { x: start.x + n.x * d1, y: start.y + n.y * d1 };\n      e = { x: end.x + n.x * d3, y: end.y + n.y * d3 };\n      mid = { x: (s.x + e.x) / 2, y: (s.y + e.y) / 2 };\n      const fline = [s, mid, e];\n\n      s = { x: start.x - n.x * d2, y: start.y - n.y * d2 };\n      e = { x: end.x - n.x * d4, y: end.y - n.y * d4 };\n      mid = { x: (s.x + e.x) / 2, y: (s.y + e.y) / 2 };\n      const bline = [e, mid, s];\n\n      const ls = utils.makeline(bline[2], fline[0]);\n      const le = utils.makeline(fline[2], bline[0]);\n      const segments = [ls, new Bezier(fline), le, new Bezier(bline)];\n      return new PolyBezier(segments);\n    }\n\n    const reduced = this.reduce(),\n      len = reduced.length,\n      fcurves = [];\n\n    let bcurves = [],\n      p,\n      alen = 0,\n      tlen = this.length();\n\n    const graduated = typeof d3 !== \"undefined\" && typeof d4 !== \"undefined\";\n\n    function linearDistanceFunction(s, e, tlen, alen, slen) {\n      return function (v) {\n        const f1 = alen / tlen,\n          f2 = (alen + slen) / tlen,\n          d = e - s;\n        return utils.map(v, 0, 1, s + f1 * d, s + f2 * d);\n      };\n    }\n\n    // form curve oulines\n    reduced.forEach(function (segment) {\n      const slen = segment.length();\n      if (graduated) {\n        fcurves.push(\n          segment.scale(linearDistanceFunction(d1, d3, tlen, alen, slen))\n        );\n        bcurves.push(\n          segment.scale(linearDistanceFunction(-d2, -d4, tlen, alen, slen))\n        );\n      } else {\n        fcurves.push(segment.scale(d1));\n        bcurves.push(segment.scale(-d2));\n      }\n      alen += slen;\n    });\n\n    // reverse the \"return\" outline\n    bcurves = bcurves\n      .map(function (s) {\n        p = s.points;\n        if (p[3]) {\n          s.points = [p[3], p[2], p[1], p[0]];\n        } else {\n          s.points = [p[2], p[1], p[0]];\n        }\n        return s;\n      })\n      .reverse();\n\n    // form the endcaps as lines\n    const fs = fcurves[0].points[0],\n      fe = fcurves[len - 1].points[fcurves[len - 1].points.length - 1],\n      bs = bcurves[len - 1].points[bcurves[len - 1].points.length - 1],\n      be = bcurves[0].points[0],\n      ls = utils.makeline(bs, fs),\n      le = utils.makeline(fe, be),\n      segments = [ls].concat(fcurves).concat([le]).concat(bcurves);\n\n    return new PolyBezier(segments);\n  }\n\n  outlineshapes(d1, d2, curveIntersectionThreshold) {\n    d2 = d2 || d1;\n    const outline = this.outline(d1, d2).curves;\n    const shapes = [];\n    for (let i = 1, len = outline.length; i < len / 2; i++) {\n      const shape = utils.makeshape(\n        outline[i],\n        outline[len - i],\n        curveIntersectionThreshold\n      );\n      shape.startcap.virtual = i > 1;\n      shape.endcap.virtual = i < len / 2 - 1;\n      shapes.push(shape);\n    }\n    return shapes;\n  }\n\n  intersects(curve, curveIntersectionThreshold) {\n    if (!curve) return this.selfintersects(curveIntersectionThreshold);\n    if (curve.p1 && curve.p2) {\n      return this.lineIntersects(curve);\n    }\n    if (curve instanceof Bezier) {\n      curve = curve.reduce();\n    }\n    return this.curveintersects(\n      this.reduce(),\n      curve,\n      curveIntersectionThreshold\n    );\n  }\n\n  lineIntersects(line) {\n    const mx = min(line.p1.x, line.p2.x),\n      my = min(line.p1.y, line.p2.y),\n      MX = max(line.p1.x, line.p2.x),\n      MY = max(line.p1.y, line.p2.y);\n    return utils.roots(this.points, line).filter((t) => {\n      var p = this.get(t);\n      return utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);\n    });\n  }\n\n  selfintersects(curveIntersectionThreshold) {\n    // \"simple\" curves cannot intersect with their direct\n    // neighbour, so for each segment X we check whether\n    // it intersects [0:x-2][x+2:last].\n\n    const reduced = this.reduce(),\n      len = reduced.length - 2,\n      results = [];\n\n    for (let i = 0, result, left, right; i < len; i++) {\n      left = reduced.slice(i, i + 1);\n      right = reduced.slice(i + 2);\n      result = this.curveintersects(left, right, curveIntersectionThreshold);\n      results.push(...result);\n    }\n    return results;\n  }\n\n  curveintersects(c1, c2, curveIntersectionThreshold) {\n    const pairs = [];\n    // step 1: pair off any overlapping segments\n    c1.forEach(function (l) {\n      c2.forEach(function (r) {\n        if (l.overlaps(r)) {\n          pairs.push({ left: l, right: r });\n        }\n      });\n    });\n    // step 2: for each pairing, run through the convergence algorithm.\n    let intersections = [];\n    pairs.forEach(function (pair) {\n      const result = utils.pairiteration(\n        pair.left,\n        pair.right,\n        curveIntersectionThreshold\n      );\n      if (result.length > 0) {\n        intersections = intersections.concat(result);\n      }\n    });\n    return intersections;\n  }\n\n  arcs(errorThreshold) {\n    errorThreshold = errorThreshold || 0.5;\n    return this._iterate(errorThreshold, []);\n  }\n\n  _error(pc, np1, s, e) {\n    const q = (e - s) / 4,\n      c1 = this.get(s + q),\n      c2 = this.get(e - q),\n      ref = utils.dist(pc, np1),\n      d1 = utils.dist(pc, c1),\n      d2 = utils.dist(pc, c2);\n    return abs(d1 - ref) + abs(d2 - ref);\n  }\n\n  _iterate(errorThreshold, circles) {\n    let t_s = 0,\n      t_e = 1,\n      safety;\n    // we do a binary search to find the \"good `t` closest to no-longer-good\"\n    do {\n      safety = 0;\n\n      // step 1: start with the maximum possible arc\n      t_e = 1;\n\n      // points:\n      let np1 = this.get(t_s),\n        np2,\n        np3,\n        arc,\n        prev_arc;\n\n      // booleans:\n      let curr_good = false,\n        prev_good = false,\n        done;\n\n      // numbers:\n      let t_m = t_e,\n        prev_e = 1,\n        step = 0;\n\n      // step 2: find the best possible arc\n      do {\n        prev_good = curr_good;\n        prev_arc = arc;\n        t_m = (t_s + t_e) / 2;\n        step++;\n\n        np2 = this.get(t_m);\n        np3 = this.get(t_e);\n\n        arc = utils.getccenter(np1, np2, np3);\n\n        //also save the t values\n        arc.interval = {\n          start: t_s,\n          end: t_e,\n        };\n\n        let error = this._error(arc, np1, t_s, t_e);\n        curr_good = error <= errorThreshold;\n\n        done = prev_good && !curr_good;\n        if (!done) prev_e = t_e;\n\n        // this arc is fine: we can move 'e' up to see if we can find a wider arc\n        if (curr_good) {\n          // if e is already at max, then we're done for this arc.\n          if (t_e >= 1) {\n            // make sure we cap at t=1\n            arc.interval.end = prev_e = 1;\n            prev_arc = arc;\n            // if we capped the arc segment to t=1 we also need to make sure that\n            // the arc's end angle is correct with respect to the bezier end point.\n            if (t_e > 1) {\n              let d = {\n                x: arc.x + arc.r * cos(arc.e),\n                y: arc.y + arc.r * sin(arc.e),\n              };\n              arc.e += utils.angle({ x: arc.x, y: arc.y }, d, this.get(1));\n            }\n            break;\n          }\n          // if not, move it up by half the iteration distance\n          t_e = t_e + (t_e - t_s) / 2;\n        } else {\n          // this is a bad arc: we need to move 'e' down to find a good arc\n          t_e = t_m;\n        }\n      } while (!done && safety++ < 100);\n\n      if (safety >= 100) {\n        break;\n      }\n\n      // console.log(\"L835: [F] arc found\", t_s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);\n\n      prev_arc = prev_arc ? prev_arc : arc;\n      circles.push(prev_arc);\n      t_s = prev_e;\n    } while (t_e < 1);\n    return circles;\n  }\n}\n\nexport { Bezier };\n", "import * as t from \"io-ts\"\nimport { COLOR_COMPONENT_BORDER, COLOR_NODE_MOUSE_OVER, COLOR_UNKNOWN, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArrayFill, FixedArrayFillFactory, FixedArraySize, FixedReadonlyArray, isDefined, isUndefined, LogicValue, Mode, typeOrUndefined } from \"../utils\"\nimport { ComponentBase, ComponentRepr, defineComponent, NodeVisuals } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { NodeIn, NodeOut } from \"./Node\"\nimport { WireStyle } from \"./Wire\"\n\n\nconst GRID_WIDTH = 1\n\nconst GRID_HEIGHT_1 = 2\nconst GRID_HEIGHT_4 = 8\nconst GRID_UPPER_HEIGHT_8 = 4.5\nconst GRID_LOWER_HEIGHT_8 = 3.5\n\nexport const Slant = {\n    none: \"none\",\n    up: \"up\",\n    down: \"down\",\n} as const\n\nexport type Slant = keyof typeof Slant\nconst SlantRepr = t.keyof(Slant)\n\nconst PassthroughDefaults = {\n    slant: Slant.none,\n}\n\ntype PassthroughRepr<N extends FixedArraySize> = ComponentRepr<N, N> & {\n    slant: Slant | undefined\n}\n\nabstract class PassthroughBase<N extends FixedArraySize, Repr extends PassthroughRepr<N>> extends ComponentBase<N, N, Repr, FixedReadonlyArray<LogicValue, N>> {\n\n    protected readonly n: N\n    private _slant: Slant\n    private _hShift: [number, number]\n\n    protected constructor(editor: LogicEditor, n: N, savedData: Repr | null, nodeOffsets: NodeVisuals<N, N>) {\n        super(editor, FixedArrayFill(false, n), savedData, nodeOffsets)\n        this.n = n\n        this._hShift = [0, 0] // updated by updateNodeOffsets\n        this._slant = savedData?.slant ?? PassthroughDefaults.slant\n        this.updateNodeOffsets()\n    }\n\n    protected override toJSONBase(): PassthroughRepr<N> {\n        return {\n            ...super.toJSONBase(),\n            slant: this._slant === PassthroughDefaults.slant ? undefined : this._slant,\n        }\n    }\n\n    public override destroy(): void {\n        type SavedNodeProps = WireStyle | undefined\n        type EndNodes = [NodeIn, SavedNodeProps][]\n\n        const savedWireEnds: [NodeOut, EndNodes][] = []\n        for (let i = 0; i < this.n; i++) {\n            const nodeOut = this.inputs[i].incomingWire?.startNode\n            if (isUndefined(nodeOut) || !(nodeOut instanceof NodeOut)) {\n                continue\n            }\n            const nodeIns: EndNodes = []\n            for (const wire of this.outputs[i].outgoingWires) {\n                const endNode = wire.endNode\n                if (endNode !== null) {\n                    nodeIns.push([endNode, wire.style])\n                }\n            }\n            if (nodeIns.length > 0) {\n                savedWireEnds.push([nodeOut, nodeIns])\n            }\n        }\n\n        super.destroy()\n\n        if (savedWireEnds.length > 0) {\n            const wireMgr = this.editor.wireMgr\n            for (const [nodeOut, nodeIns] of savedWireEnds) {\n                for (const [nodeIn, style] of nodeIns) {\n                    wireMgr.addNode(nodeOut)\n                    const wire = wireMgr.addNode(nodeIn)\n                    if (isUndefined(wire)) {\n                        console.error(\"Failed to add wire back\")\n                        continue\n                    }\n                    // restore wire properties\n                    if (isDefined(style)) {\n                        wire.doSetStyle(style)\n                    }\n                }\n            }\n        }\n    }\n\n    public override get alwaysDrawMultiOutNodes() {\n        return true\n    }\n\n    public get componentType() {\n        return \"layout\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP * 2\n    }\n\n    protected doRecalcValue(): FixedReadonlyArray<LogicValue, N> {\n        const indices = FixedArrayFillFactory(i => i, this.n)\n        return this.inputValues<N>(indices)\n    }\n\n    protected override propagateValue(newValue: FixedReadonlyArray<LogicValue, N>): void {\n        let i = 0\n        for (const v of newValue) {\n            this.outputs[i++].value = v\n        }\n    }\n\n    public override isOver(x: number, y: number): boolean {\n        if (this._slant === Slant.none) {\n            return super.isOver(x, y)\n        }\n\n        let yPosWithNoHOffset = 0\n        let f = 0\n        switch (this._slant) {\n            case Slant.up:\n                // n - n will always be 0, but this is needed to make the compiler happy\n                yPosWithNoHOffset = this.inputs[this.n - this.n].posY\n                f = -1\n                break\n            case Slant.down:\n                yPosWithNoHOffset = this.inputs[this.n - 1].posY\n                f = 1\n                break\n        }\n\n        const deltaX = (y - yPosWithNoHOffset) * f\n        return super.isOver(x + deltaX, y)\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(\n            div(S.Components.Passthrough.tooltip)\n        ))\n    }\n\n    protected doDrawShared(g: CanvasRenderingContext2D, ctx: DrawContext, halfHeightUp: number, halfHeightDown: number) {\n        const width = 3\n        const left = this.posX - width / 2\n        const right = left + width\n        const mouseoverMargin = 4\n        const [topShift, bottomShift] = this._hShift\n\n        g.beginPath()\n        g.moveTo(this.posX + topShift, this.posY - halfHeightUp)\n        g.lineTo(this.posX + bottomShift, this.posY + halfHeightDown)\n\n        if (ctx.isMouseOver) {\n            g.lineWidth = width + mouseoverMargin * 2\n            g.strokeStyle = COLOR_NODE_MOUSE_OVER\n            g.stroke()\n\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n        } else {\n            g.strokeStyle = COLOR_UNKNOWN\n        }\n\n        if (this.editor.mode >= Mode.CONNECT) {\n            g.lineWidth = width\n            g.stroke()\n        }\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, left + 2 + ((input.gridOffsetX + 1) * GRID_STEP), input.posYInParentTransform)\n        }\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right - 2 + ((output.gridOffsetX - 1) * GRID_STEP), output.posYInParentTransform)\n        }\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        if (this.n > 1) {\n            const s = S.Components.Passthrough.contextMenu\n\n            const makeItemSetSlant = (desc: string, slant: Slant) => {\n                const isCurrent = this._slant === slant\n                const icon = isCurrent ? \"check\" : \"none\"\n                const action = isCurrent ? () => undefined : () => this.doSetSlant(slant)\n                return ContextMenuData.item(icon, desc, action)\n            }\n\n            return [\n                [\"mid\", ContextMenuData.submenu(\"slanted\", s.Slant, [\n                    makeItemSetSlant(s.SlantNone, Slant.none),\n                    ContextMenuData.sep(),\n                    makeItemSetSlant(s.SlantRight, Slant.down),\n                    makeItemSetSlant(s.SlantLeft, Slant.up),\n                ])],\n            ]\n        } else {\n            return undefined\n        }\n\n    }\n\n    private doSetSlant(slant: Slant) {\n        this._slant = slant\n        this.updateNodeOffsets()\n        this.setNeedsRedraw(\"slant changed\")\n    }\n\n    private updateNodeOffsets() {\n        const n = this.n\n        switch (this._slant) {\n            case \"none\":\n                for (let i = 0; i < n; i++) {\n                    this.inputs[i].gridOffsetX = -1\n                    this.outputs[i].gridOffsetX = +1\n                }\n                this._hShift = [0, 0]\n                break\n            case \"down\": {\n                const f = n > 4 ? 1 : 2\n                for (let i = 0; i < n; i++) {\n                    const shift = f * (n - 1 - i)\n                    this.inputs[i].gridOffsetX = -1 + shift\n                    this.outputs[i].gridOffsetX = +1 + shift\n                }\n                this._hShift = [f * (n - 0.5) * GRID_STEP, -f * GRID_STEP / 2]\n                break\n            }\n            case \"up\": {\n                const f = n > 4 ? 1 : 2\n                for (let i = 0; i < n; i++) {\n                    const shift = f * i\n                    this.inputs[i].gridOffsetX = -1 + shift\n                    this.outputs[i].gridOffsetX = +1 + shift\n                }\n                this._hShift = [-f * GRID_STEP / 2, f * (n - 0.5) * GRID_STEP]\n                break\n            }\n        }\n\n    }\n\n}\n\n\n\nexport const Passthrough1Def =\n    defineComponent(1, 1, t.type({\n        type: t.literal(\"pass\"),\n        slant: typeOrUndefined(SlantRepr),\n    }, \"Passthrough1\"))\n\n\nexport type Passthrough1Repr = typeof Passthrough1Def.reprType\n\nexport class Passthrough1 extends PassthroughBase<1, Passthrough1Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Passthrough1Repr | null) {\n        super(editor, 1, savedData, {\n            ins: [\n                [undefined, -1, 0, \"w\", \"In\"],\n            ],\n            outs: [\n                [undefined, +1, 0, \"e\", \"Out\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"pass\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT_1 * GRID_STEP\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        const halfHeight = GRID_STEP\n        super.doDrawShared(g, ctx, halfHeight, halfHeight)\n    }\n\n}\n\n\n\n\n\nexport const Passthrough4Def =\n    defineComponent(4, 4, t.type({\n        type: t.literal(\"pass-4\"),\n        slant: typeOrUndefined(SlantRepr),\n    }, \"Passthrough4\"))\n\n\nexport type Passthrough4Repr = typeof Passthrough4Def.reprType\n\nexport class Passthrough4 extends PassthroughBase<4, Passthrough4Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Passthrough4Repr | null) {\n        super(editor, 4, savedData, {\n            ins: [\n                [undefined, -1, -3, \"w\", \"In\"],\n                [undefined, -1, -1, \"w\", \"In\"],\n                [undefined, -1, +1, \"w\", \"In\"],\n                [undefined, -1, +3, \"w\", \"In\"],\n            ],\n            outs: [\n                [undefined, +1, -3, \"e\", \"Out\"],\n                [undefined, +1, -1, \"e\", \"Out\"],\n                [undefined, +1, +1, \"e\", \"Out\"],\n                [undefined, +1, +3, \"e\", \"Out\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"pass-4\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT_4 * GRID_STEP\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        const halfHeight = GRID_HEIGHT_4 * GRID_STEP / 2\n        super.doDrawShared(g, ctx, halfHeight, halfHeight)\n    }\n\n}\n\n\nexport const Passthrough8Def =\n    defineComponent(8, 8, t.type({\n        type: t.literal(\"pass-8\"),\n        slant: typeOrUndefined(SlantRepr),\n    }, \"Passthrough8\"))\n\n\nexport type Passthrough8Repr = typeof Passthrough8Def.reprType\n\nexport class Passthrough8 extends PassthroughBase<8, Passthrough8Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Passthrough8Repr | null) {\n        super(editor, 8, savedData, {\n            ins: [\n                [undefined, -1, -4, \"w\", \"In\"],\n                [undefined, -1, -3, \"w\", \"In\"],\n                [undefined, -1, -2, \"w\", \"In\"],\n                [undefined, -1, -1, \"w\", \"In\"],\n                [undefined, -1, 0, \"w\", \"In\"],\n                [undefined, -1, 1, \"w\", \"In\"],\n                [undefined, -1, 2, \"w\", \"In\"],\n                [undefined, -1, 3, \"w\", \"In\"],\n            ],\n            outs: [\n                [undefined, +1, -4, \"e\", \"Out\"],\n                [undefined, +1, -3, \"e\", \"Out\"],\n                [undefined, +1, -2, \"e\", \"Out\"],\n                [undefined, +1, -1, \"e\", \"Out\"],\n                [undefined, +1, 0, \"e\", \"Out\"],\n                [undefined, +1, 1, \"e\", \"Out\"],\n                [undefined, +1, 2, \"e\", \"Out\"],\n                [undefined, +1, 3, \"e\", \"Out\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"pass-8\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get unrotatedHeight() {\n        return (GRID_UPPER_HEIGHT_8 + GRID_UPPER_HEIGHT_8) * GRID_STEP\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        super.doDrawShared(g, ctx, GRID_UPPER_HEIGHT_8 * GRID_STEP, GRID_LOWER_HEIGHT_8 * GRID_STEP)\n    }\n\n}\n", "import { Bezier, Offset } from \"bezier-js\"\nimport * as t from \"io-ts\"\nimport { colorForBoolean, COLOR_MOUSE_OVER, COLOR_UNKNOWN, COLOR_WIRE, dist, drawStraightWireLine, drawWaypoint, isOverWaypoint, NodeStyle, strokeAsWireLine, WAYPOINT_DIAMETER, WIRE_WIDTH } from \"../drawutils\"\nimport { span, style, title } from \"../htmlgen\"\nimport { DrawParams, LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { Timestamp } from \"../Timeline\"\nimport { isDefined, isNotNull, isNull, isUndefined, LogicValue, Mode, typeOrUndefined } from \"../utils\"\nimport { Component, NodeGroup, NodeID } from \"./Component\"\nimport { ContextMenuData, Drawable, DrawableWithDraggablePosition, DrawableWithPosition, DrawContext, Orientation, Orientations_, PositionSupportRepr } from \"./Drawable\"\nimport { Node, NodeIn, NodeOut, WireColor } from \"./Node\"\nimport { Passthrough1 } from \"./Passthrough\"\n\nexport type WaypointRepr = t.TypeOf<typeof Waypoint.Repr>\n\nexport class Waypoint extends DrawableWithDraggablePosition {\n\n    public static get Repr() {\n        return t.union([\n            t.tuple([t.number, t.number, t.keyof(Orientations_)]), // alternative with more fields first\n            t.tuple([t.number, t.number]),\n        ], \"Wire\")\n    }\n\n    public static toSuperRepr(saved: WaypointRepr | null): PositionSupportRepr | null {\n        if (isNull(saved)) {\n            return null\n        }\n        return {\n            pos: [saved[0], saved[1]],\n            orient: saved[2],\n            ref: undefined,\n        }\n    }\n\n    public constructor(\n        editor: LogicEditor,\n        savedData: WaypointRepr | null,\n        public readonly parent: Wire,\n    ) {\n        super(editor, Waypoint.toSuperRepr(savedData))\n    }\n\n    public toJSON(): WaypointRepr {\n        if (this.orient === Orientation.default) {\n            return [this.posX, this.posY]\n        } else {\n            return [this.posX, this.posY, this.orient]\n        }\n    }\n\n    public get unrotatedWidth(): number {\n        return WAYPOINT_DIAMETER\n    }\n\n    public get unrotatedHeight(): number {\n        return WAYPOINT_DIAMETER\n    }\n\n    public override isOver(x: number, y: number) {\n        return this.editor.mode >= Mode.CONNECT && isOverWaypoint(x, y, this.posX, this.posY)\n    }\n\n    public override get cursorWhenMouseover() {\n        return \"grab\"\n    }\n\n    public getPrevAndNextAnchors(): [DrawableWithPosition, DrawableWithPosition] {\n        const waypoints = this.parent.waypoints\n        const index = waypoints.indexOf(this)\n        const prev = index > 0 ? waypoints[index - 1] : this.parent.startNode\n        const next = index < waypoints.length - 1 ? waypoints[index + 1] : (this.parent.endNode ?? this.parent.startNode)\n        return [prev, next]\n    }\n\n    public removeFromParent() {\n        this.parent.removeWaypoint(this)\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext): void {\n        if (this.editor.mode < Mode.CONNECT) {\n            return\n        }\n\n        const neutral = this.editor.options.hideWireColors\n        drawWaypoint(g, ctx, this.posX, this.posY, NodeStyle.WAYPOINT, this.parent.startNode.value, ctx.isMouseOver, neutral, false, false, false)\n    }\n\n    public override mouseDown(e: MouseEvent | TouchEvent) {\n        if (this.editor.mode >= Mode.CONNECT) {\n            this.tryStartMoving(e)\n        }\n        return { wantsDragEvents: true }\n    }\n\n    public override mouseDragged(e: MouseEvent | TouchEvent) {\n        if (this.editor.mode >= Mode.CONNECT) {\n            this.updateWhileMoving(e)\n        }\n    }\n\n    public override mouseUp(__: MouseEvent | TouchEvent) {\n        return this.tryStopMoving()\n    }\n\n    public override makeContextMenu(): ContextMenuData {\n        return [\n            this.makeChangeOrientationContextMenuItem(),\n            ContextMenuData.sep(),\n            ContextMenuData.item(\"trash\", \"Supprimer\", () => {\n                this.removeFromParent()\n            }, true),\n        ]\n    }\n}\n\nexport const WireStyles = {\n    auto: \"auto\",\n    straight: \"straight\",\n    bezier: \"bezier\",\n} as const\n\nexport type WireStyle = keyof typeof WireStyles\n\nexport type WireRepr = t.TypeOf<typeof Wire.Repr>\n\nexport class Wire extends Drawable {\n\n    public static get Repr() {\n        const simpleRepr = t.tuple([NodeID, NodeID])\n        const fullRepr = t.tuple([\n            NodeID, NodeID,\n            // include an object specifying additional properties\n            t.type({\n                ref: typeOrUndefined(t.string),\n                via: typeOrUndefined(t.array(Waypoint.Repr)),\n                propagationDelay: typeOrUndefined(t.number),\n                style: typeOrUndefined(t.keyof(WireStyles)),\n            }),\n        ])\n        return t.union([fullRepr, simpleRepr], \"Wire\")\n    }\n\n    private _endNode: NodeIn | null = null\n    private _waypoints: Waypoint[] = []\n    private _style: WireStyle | undefined = undefined\n    private _propagatingValues: [LogicValue, Timestamp][] = []\n    private _waypointBeingDragged: Waypoint | undefined = undefined\n    public customPropagationDelay: number | undefined = undefined\n    public ribbon: Ribbon | undefined = undefined\n\n    public constructor(\n        private _startNode: Node // not NodeOut since we can start from the end\n    ) {\n        super(_startNode.editor)\n        const editor = _startNode.editor\n        const longAgo = -1 - editor.options.propagationDelay // make sure it is fully propagated no matter what\n        this._propagatingValues.push([_startNode.value, longAgo])\n    }\n\n    public toJSON(): WireRepr {\n        const endID = this._endNode?.id ?? -1\n        if (this._waypoints.length === 0 && isUndefined(this.customPropagationDelay) && isUndefined(this.ref) && isUndefined(this.style)) {\n            // no need for node options\n            return [this._startNode.id, endID]\n\n        } else {\n            // add node options\n            const waypoints = this._waypoints.map(w => w.toJSON())\n            return [this._startNode.id, endID, {\n                ref: this.ref,\n                via: (waypoints.length === 0) ? undefined : waypoints,\n                propagationDelay: this.customPropagationDelay,\n                style: this.style,\n            }]\n        }\n    }\n\n    public get startNode(): Node {\n        return this._startNode\n    }\n\n    public get endNode(): NodeIn | null {\n        return this._endNode\n    }\n\n    public isInRect(__rect: DOMRect) {\n        return false\n    }\n\n    public get waypoints(): readonly Waypoint[] {\n        return this._waypoints\n    }\n\n    public setWaypoints(reprs: WaypointRepr[]) {\n        this._waypoints = reprs.map(repr => new Waypoint(this.editor, repr, this))\n    }\n\n    public get style() {\n        return this._style\n    }\n\n    public doSetStyle(style: WireStyle | undefined) {\n        this._style = style\n        this.setNeedsRedraw(\"style changed\")\n    }\n\n    public setSecondNode(secondNode: Node | null) {\n        // not the same as setting endNode; this may change startNode as well\n        // if we need to reverse input and output\n\n        if (secondNode === null) {\n            return\n        }\n\n        if (this._endNode !== null) {\n            // clear old connection\n            this._endNode.incomingWire = null\n        }\n\n\n        if (!Node.isOutput(secondNode)) {\n            if (!Node.isOutput(this._startNode)) {\n                console.log(\"WARN connecting two input nodes\")\n                return\n            }\n            this._endNode = secondNode\n\n        } else {\n            if (Node.isOutput(this._startNode)) {\n                console.log(\"WARN connecting two output nodes\")\n                return\n            }\n\n            // switch nodes\n            const tempNode = this._startNode\n            this._startNode = secondNode\n            this._endNode = tempNode\n            const longAgo = -1 - (this.customPropagationDelay ?? this.editor.options.propagationDelay)\n            this._propagatingValues = [[secondNode.value, longAgo]]\n        }\n\n        this._startNode.addOutgoingWire(this)\n        this._endNode.incomingWire = this\n        this._endNode.value = this.startNode.value\n        this._endNode.doSetColor(this._startNode.color)\n    }\n\n    public propageNewValue(newValue: LogicValue, now: Timestamp) {\n        if (this._propagatingValues[this._propagatingValues.length - 1][0] !== newValue) {\n            this._propagatingValues.push([newValue, now])\n        }\n    }\n\n    public destroy() {\n        if (Node.isOutput(this._startNode)) {\n            this._startNode.removeOutgoingWire(this)\n        }\n        if (isNotNull(this._endNode)) {\n            this._endNode.incomingWire = null\n        }\n        // for (const waypoint of this._waypoints) {\n        //     waypoint.destroy()\n        // }\n    }\n\n    public get isAlive() {\n        // the start node should be alive and the end node\n        // should either be null (wire being drawn) or alive\n        // (wire set) for the wire to be alive\n        return this.startNode.isAlive &&\n            (isNull(this.endNode) || this.endNode.isAlive)\n    }\n\n    public addPassthroughFrom(e: MouseEvent | TouchEvent): Passthrough1 | undefined {\n        const editor = this.editor\n        const [x, y] = editor.offsetXYForContextMenu(e, true)\n        const endNode = this.endNode\n        if (isNull(endNode)) {\n            return undefined\n        }\n\n        const passthrough = new Passthrough1(editor, null)\n        editor.components.add(passthrough)\n        passthrough.setPosition(x, y)\n        editor.moveMgr.setDrawableStoppedMoving(passthrough)\n\n        // modify this wire to go to the passthrough\n        this.setSecondNode(passthrough.inputs[0])\n\n        // create a new wire from the passthrough to the end node\n        const wireMgr = editor.wireMgr\n        wireMgr.addNode(passthrough.outputs[0])\n        const newWire = wireMgr.addNode(endNode)\n        if (isUndefined(newWire)) {\n            console.log(\"WARN: couldn't create new wire\")\n            return\n        }\n        newWire.doSetStyle(this.style)\n        return passthrough\n    }\n\n    public addWaypointFrom(e: MouseEvent | TouchEvent): Waypoint {\n        const [x, y] = this.editor.offsetXYForContextMenu(e, true)\n        return this.addWaypointWith(x, y)\n    }\n\n    public addWaypointWith(x: number, y: number): Waypoint {\n        let coordData = this.indexOfNextWaypointIfMouseover(x, y)\n        if (isUndefined(coordData)) {\n            // shouldn't happen since we're calling this form a context menu\n            // which was invoked when we were in a mouseover state\n            coordData = [\n                0,\n                [this.startNode.posX, this.startNode.posY],\n                [this.endNode?.posX ?? this.startNode.posX + 20, this.endNode?.posY ?? this.startNode.posY + 20],\n            ]\n        }\n\n        // determine initial direction\n        const [i, [startX, startY], [endX, endY]] = coordData\n        const deltaX = endX - startX\n        const deltaY = endY - startY\n\n        let orient: Orientation\n        if (Math.abs(deltaX) >= Math.abs(deltaY)) {\n            // initial orientation will be horizontal\n            if (endX >= startX) {\n                orient = \"e\"\n            } else {\n                orient = \"w\"\n            }\n        } else {\n            // initial orientation will be vertical\n            if (endY >= startY) {\n                orient = \"s\"\n            } else {\n                orient = \"n\"\n            }\n        }\n\n        const waypoint = new Waypoint(this.editor, [x, y, orient], this)\n        this._waypoints.splice(i, 0, waypoint)\n        return waypoint\n    }\n\n    public removeWaypoint(waypoint: Waypoint) {\n        const i = this._waypoints.indexOf(waypoint)\n        if (i !== -1) {\n            this._waypoints.splice(i, 1)\n            this.setNeedsRedraw(\"waypoint deleted\")\n        }\n    }\n\n    private prunePropagatingValues(now: Timestamp, propagationDelay: number): LogicValue {\n        // first, prune obsolete values if needed\n        let removeBefore = 0\n        for (let i = 1; i < this._propagatingValues.length; i++) {\n            if (now >= this._propagatingValues[i][1] + propagationDelay) {\n                // item i has fully propagated\n                removeBefore = i\n            } else {\n                // item i is still propagating\n                break\n            }\n        }\n        if (removeBefore > 0) {\n            this._propagatingValues.splice(0, removeBefore)\n        }\n        return this._propagatingValues[0][0]\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        // this has to be checked _before_ we prune the list,\n        // otherwise we won't get a chance to have a next animation frame\n        // and to run the pending updates created by possibly setting\n        // the value of the end node\n        const isAnimating = this._propagatingValues.length > 1\n\n        const options = this.editor.options\n        const propagationDelay = this.customPropagationDelay ?? options.propagationDelay\n        const neutral = options.hideWireColors\n        const drawTime = ctx.drawParams.drawTime\n        const wireValue = this.prunePropagatingValues(drawTime, propagationDelay)\n\n        if (isNull(this.endNode)) {\n            // draw to mouse position\n            drawStraightWireLine(g, this.startNode.posX, this.startNode.posY, this.editor.mouseX, this.editor.mouseY, wireValue, this._startNode.color, neutral)\n\n        } else {\n            this.endNode.value = wireValue\n\n            let prevX = this.startNode.posX\n            let prevY = this.startNode.posY\n            let prevProlong = this.startNode.wireProlongDirection\n            const lastWaypointData = { posX: this.endNode.posX, posY: this.endNode.posY, orient: this.endNode.wireProlongDirection }\n            const allWaypoints = [...this._waypoints, lastWaypointData]\n            let svgPathDesc = \"M\" + prevX + \" \" + prevY + \" \"\n            const wireStyle = this.style ?? this.startNode.editor.options.wireStyle\n            for (let i = 0; i < allWaypoints.length; i++) {\n                const waypoint = allWaypoints[i]\n                const nextX = waypoint.posX\n                const nextY = waypoint.posY\n                const deltaX = nextX - prevX\n                const deltaY = nextY - prevY\n                const nextProlong = waypoint.orient\n                let x, y, x1, y1\n                if (wireStyle === WireStyles.straight || (wireStyle === WireStyles.auto && (prevX === nextX || prevY === nextY))) {\n                    // straight line\n                    if (i === 0) {\n                        [x, y] = bezierAnchorForWire(prevProlong, prevX, prevY, -WIRE_WIDTH / 2, -WIRE_WIDTH / 2)\n                        svgPathDesc += \"M\" + x + \" \" + y + \" \"\n                        svgPathDesc += \"L\" + prevX + \" \" + prevY + \" \"\n                    }\n                    svgPathDesc += \"L\" + nextX + \" \" + nextY + \" \"\n                    if (i === allWaypoints.length - 1) {\n                        [x, y] = bezierAnchorForWire(nextProlong, nextX, nextY, -WIRE_WIDTH / 2, -WIRE_WIDTH / 2)\n                        svgPathDesc += \"L\" + x + \" \" + y + \" \"\n                    }\n                } else {\n                    // bezier curve\n                    const bezierAnchorPointDistX = Math.max(25, Math.abs(deltaX) / 3)\n                    const bezierAnchorPointDistY = Math.max(25, Math.abs(deltaY) / 3);\n\n                    // first anchor point\n                    [x, y] = bezierAnchorForWire(prevProlong, prevX, prevY, bezierAnchorPointDistX, bezierAnchorPointDistY);\n                    [x1, y1] = bezierAnchorForWire(nextProlong, nextX, nextY, bezierAnchorPointDistX, bezierAnchorPointDistY)\n                    svgPathDesc += \"C\" + x + \" \" + y + \",\" + x1 + \" \" + y1 + \",\" + nextX + \" \" + nextY + \" \"\n                }\n\n                prevX = nextX\n                prevY = nextY\n                prevProlong = Orientation.invert(nextProlong)\n            }\n\n            const totalLength = this.editor.lengthOfPath(svgPathDesc)\n            const path = new Path2D(svgPathDesc) // TODO cache this?\n\n            const drawParams = ctx.drawParams\n            if (isDefined(drawParams.highlightColor) && (drawParams.highlightedItems?.wires.includes(this) ?? false)) {\n                g.lineWidth = 15\n                g.shadowColor = drawParams.highlightColor\n                g.shadowBlur = 20\n                g.shadowOffsetX = 0\n                g.shadowOffsetY = 0\n                g.strokeStyle = g.shadowColor\n                g.stroke(path)\n                g.shadowBlur = 0 // reset\n            }\n\n            const old = g.getLineDash()\n            for (const [value, timeSet] of this._propagatingValues) {\n                const frac = Math.min(1.0, (drawTime - timeSet) / propagationDelay)\n                const lengthToDraw = totalLength * frac\n                g.setLineDash([lengthToDraw, totalLength])\n                strokeAsWireLine(g, value, this._startNode.color, ctx.isMouseOver, neutral, path)\n            }\n            g.setLineDash(old)\n\n            if (isAnimating) {\n                this.setNeedsRedraw(\"propagating value\")\n            }\n        }\n    }\n\n    public isOver(x: number, y: number): boolean {\n        if (this.editor.mode < Mode.CONNECT || !this.startNode.isAlive || !this.endNode || !this.endNode.isAlive) {\n            return false\n        }\n        return isDefined(this.indexOfNextWaypointIfMouseover(x, y))\n    }\n\n    private indexOfNextWaypointIfMouseover(x: number, y: number): undefined | [number, [number, number], [number, number]] {\n        if (!this.endNode) {\n            return undefined\n        }\n        const waypoints: DrawableWithPosition[] = [this.startNode, ...this._waypoints, this.endNode]\n        const tol = WIRE_WIDTH / (10 * 2)\n        for (let i = 0; i < waypoints.length - 1; i++) {\n            const startX = waypoints[i].posX\n            const startY = waypoints[i].posY\n            const endX = waypoints[i + 1].posX\n            const endY = waypoints[i + 1].posY\n            const sumDist = dist(startX, startY, x, y) + dist(endX, endY, x, y)\n            const wireLength = dist(startX, startY, endX, endY)\n            // TODO use isPointInStroke instead to account for bezier paths\n            if (sumDist >= wireLength - tol && sumDist <= wireLength + tol) {\n                return [i, [startX, startY], [endX, endY]]\n            }\n        }\n        return undefined\n    }\n\n    public override mouseDown(e: MouseEvent | TouchEvent) {\n        if (e.altKey && this.editor.mode >= Mode.DESIGN) {\n            const passthrough = this.addPassthroughFrom(e)\n            if (isDefined(passthrough)) {\n                return passthrough.outputs[0].mouseDown(e)\n            }\n        }\n        return super.mouseDown(e)\n    }\n\n    public override mouseDragged(e: MouseEvent | TouchEvent) {\n        if (isDefined(this._waypointBeingDragged)) {\n            this._waypointBeingDragged.mouseDragged(e)\n        } else {\n            const selectionSize = this.editor.cursorMovementMgr.currentSelection?.previouslySelectedElements.size ?? 0\n            if (selectionSize === 0) {\n                const waypoint = this.addWaypointFrom(e)\n                this._waypointBeingDragged = waypoint\n                waypoint.mouseDown(e)\n                waypoint.mouseDragged(e)\n            }\n        }\n    }\n\n    public override mouseUp(e: MouseEvent | TouchEvent) {\n        if (isDefined(this._waypointBeingDragged)) {\n            this._waypointBeingDragged.mouseUp(e)\n            this._waypointBeingDragged = undefined\n            return true\n        }\n        return false\n    }\n\n    public override makeContextMenu(): ContextMenuData {\n\n        const s = S.Components.Wire.contextMenu\n        const currentPropDelayStr = isUndefined(this.customPropagationDelay) ? \"\" : ` (${this.customPropagationDelay} ms)`\n\n        const makeItemUseColor = (desc: string, color: WireColor) => {\n            const isCurrent = this._startNode.color === color\n            const icon = isCurrent ? \"check\" : \"none\"\n            const action = isCurrent ? () => undefined : () => this._startNode.doSetColor(color)\n            const cssColor = COLOR_WIRE[color]\n            return ContextMenuData.item(icon, span(title(desc), style(`display: inline-block; width: 140px; height: ${WIRE_WIDTH}px; background-color: ${cssColor}; margin-right: 8px`)), action)\n        }\n\n\n        const makeItemDisplayStyle = (desc: string, style: WireStyle | undefined) => {\n            const isCurrent = this.style === style\n            const icon = isCurrent ? \"check\" : \"none\"\n            const action = isCurrent ? () => undefined : () => this.doSetStyle(style)\n            return ContextMenuData.item(icon, desc, action)\n        }\n\n\n        const setWireOptionsItems =\n            this.editor.mode < Mode.DESIGN ? [] : [\n                ContextMenuData.sep(),\n                ContextMenuData.item(\"timer\", s.CustomPropagationDelay.expand({ current: currentPropDelayStr }), (__itemEvent) => {\n                    const currentStr = isUndefined(this.customPropagationDelay) ? \"\" : String(this.customPropagationDelay)\n                    const defaultDelay = String(this.editor.options.propagationDelay)\n                    const message = s.CustomPropagationDelayDesc.expand({ current: defaultDelay })\n                    const newValueStr = prompt(message, currentStr)\n                    if (newValueStr !== null) {\n                        if (newValueStr === \"\") {\n                            this.customPropagationDelay = undefined\n                        } else {\n                            const asInt = parseInt(newValueStr)\n                            if (!isNaN(asInt)) {\n                                this.customPropagationDelay = asInt\n                            }\n                        }\n                    }\n                }),\n                ContextMenuData.submenu(\"palette\", s.WireColor, [\n                    makeItemUseColor(s.WireColorBlack, WireColor.black),\n                    makeItemUseColor(s.WireColorRed, WireColor.red),\n                    makeItemUseColor(s.WireColorBlue, WireColor.blue),\n                    makeItemUseColor(s.WireColorYellow, WireColor.yellow),\n                    makeItemUseColor(s.WireColorGreen, WireColor.green),\n                    makeItemUseColor(s.WireColorWhite, WireColor.white),\n                ]),\n                ContextMenuData.submenu(\"wirestyle\", s.WireStyle, [\n                    makeItemDisplayStyle(s.WireStyleDefault, undefined),\n                    ContextMenuData.sep(),\n                    makeItemDisplayStyle(s.WireStyleAuto, WireStyles.auto),\n                    makeItemDisplayStyle(s.WireStyleStraight, WireStyles.straight),\n                    makeItemDisplayStyle(s.WireStyleCurved, WireStyles.bezier),\n                ]),\n            ]\n\n        const setRefItems =\n            this.editor.mode < Mode.FULL ? [] : [\n                ContextMenuData.sep(),\n                this.makeSetRefContextMenuItem(),\n            ]\n\n        return [\n            ContextMenuData.item(\"add\", s.AddMiddlePoint, (__itemEvent, contextEvent) => {\n                this.addWaypointFrom(contextEvent)\n            }),\n            ContextMenuData.item(\"add\", s.AddPassthrough, (__itemEvent, contextEvent) => {\n                this.addPassthroughFrom(contextEvent)\n            }),\n            ...setWireOptionsItems,\n            ...setRefItems,\n            ContextMenuData.sep(),\n            ContextMenuData.item(\"trash\", S.Components.Generic.contextMenu.Delete, () => {\n                this.editor.wireMgr.deleteWire(this)\n            }, true),\n        ]\n    }\n\n}\n\nfunction bezierAnchorForWire(wireProlongDirection: Orientation, x: number, y: number, distX: number, distY: number): [number, number] {\n    switch (wireProlongDirection) {\n        case \"e\": // going east, so anchor point is before on X\n            return [x - distX, y]\n        case \"w\": // going west, so anchor point is after on X\n            return [x + distX, y]\n        case \"s\":// going south, so anchor point is before on Y\n            return [x, y - distY]\n        case \"n\":// going north, so anchor point is after on Y\n            return [x, y + distY]\n    }\n}\n\nexport class Ribbon extends Drawable {\n\n    private _startGroupStartIndex = Number.MAX_SAFE_INTEGER\n    private _startGroupEndIndex = Number.MIN_SAFE_INTEGER\n    private _endGroupStartIndex = Number.MAX_SAFE_INTEGER\n    private _endGroupEndIndex = Number.MIN_SAFE_INTEGER\n    private _coveredWires: Wire[] = []\n    // private _startNodes: NodeOut[] = []\n    // private _endNodes: NodeIn[] = []\n\n    public constructor(editor: LogicEditor,\n        public readonly startNodeGroup: NodeGroup<NodeOut>,\n        public readonly endNodeGroup: NodeGroup<NodeIn>,\n    ) {\n        super(editor)\n    }\n\n    public isEmpty() {\n        return this._coveredWires.length === 0\n    }\n\n    public addCoveredWire(wire: Wire, newNodeGroupStartIndex: number, newNodeGroupEndIndex: number) {\n        this._coveredWires.push(wire)\n        this.updateIndices(newNodeGroupStartIndex, newNodeGroupEndIndex)\n    }\n\n    public wireWasDeleted(wire: Wire) {\n        // TODO check ribbons here\n        // const index = this._coveredWires.indexOf(wire)\n        // if (index >= 0) {\n        //     this._coveredWires.splice(index, 1)\n        // }\n        // // remove start node\n        // const startNode = wire.startNode as any\n        // const startNodeIndex = this._startNodes.indexOf(startNode)\n        // if (startNodeIndex >= 0) {\n        //     this._startNodes.splice(startNodeIndex, 1)\n        // }\n        // // remove end node\n        // const endNode = wire.endNode as any\n        // const endNodeIndex = this._endNodes.indexOf(endNode)\n        // if (endNodeIndex >= 0) {\n        //     this._endNodes.splice(endNodeIndex, 1)\n        // }\n        // // recalculate start and end group indices\n        // this._startGroupStartIndex = Number.MAX_SAFE_INTEGER\n        // this._startGroupEndIndex = Number.MIN_SAFE_INTEGER\n        // this._endGroupStartIndex = Number.MAX_SAFE_INTEGER\n        // this._endGroupEndIndex = Number.MIN_SAFE_INTEGER\n        // for (const coveredWire of this._coveredWires) {\n\n        //     this.updateIndices(coveredWire)\n        // }\n    }\n\n    private updateIndices(newNodeGroupStartIndex: number, newNodeGroupEndIndex: number) {\n        this._startGroupStartIndex = Math.min(this._startGroupStartIndex, newNodeGroupStartIndex)\n        this._startGroupEndIndex = Math.max(this._startGroupEndIndex, newNodeGroupStartIndex)\n        this._endGroupStartIndex = Math.min(this._endGroupStartIndex, newNodeGroupEndIndex)\n        this._endGroupEndIndex = Math.max(this._endGroupEndIndex, newNodeGroupEndIndex)\n    }\n\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext): void {\n        const [[startX, startY], startOrient] = this.drawRibbonEnd(g, ctx, this.startNodeGroup, this._startGroupStartIndex, this._startGroupEndIndex)\n        const [[endX, endY], endOrient] = this.drawRibbonEnd(g, ctx, this.endNodeGroup, this._endGroupStartIndex, this._endGroupEndIndex)\n\n        const deltaX = endX - startX\n        const deltaY = endY - startY\n        // bezier curve\n        const bezierAnchorPointDistX = Math.max(25, Math.abs(deltaX) / 3)\n        const bezierAnchorPointDistY = Math.max(25, Math.abs(deltaY) / 3)\n\n        // first anchor point\n        const [anchor1X, anchor1Y] = bezierAnchorForWire(Orientation.invert(startOrient), startX, startY, bezierAnchorPointDistX, bezierAnchorPointDistY)\n        const [anchor2X, anchor2Y] = bezierAnchorForWire(Orientation.invert(endOrient), endX, endY, bezierAnchorPointDistX, bezierAnchorPointDistY)\n\n        const b = new Bezier(startX, startY, anchor1X, anchor1Y, anchor2X, anchor2Y, endX, endY)\n\n        const values: LogicValue[] = []\n        for (let i = this._startGroupStartIndex; i <= this._startGroupEndIndex; i++) {\n            values.push(this.startNodeGroup.nodes[i].value)\n        }\n        this.strokeWireBezier(g, b, values, WireColor.black, ctx.isMouseOver, false)\n    }\n\n    private strokeWireBezier(g: CanvasRenderingContext2D, b: Bezier, values: LogicValue[], color: WireColor, isMouseOver: boolean, neutral: boolean) {\n        const numWires = values.length\n\n        const WIRE_MARGIN_OUTER = (numWires === 1) ? 1 : (numWires <= 4 || numWires > 8) ? 2 : 3\n        const WIRE_MARGIN_INNER = 1\n        const WIRE_WIDTH = (numWires <= 8) ? 2 : 1\n\n        if (numWires === 0) {\n            return\n        }\n\n        const totalWidth = 2 * WIRE_MARGIN_OUTER + numWires * WIRE_WIDTH + (numWires - 1) * WIRE_MARGIN_INNER\n\n        const addBezierToPath = (b: Bezier) => {\n            const [p0, a0, a1, p1] = b.points\n            g.moveTo(p0.x, p0.y)\n            g.bezierCurveTo(a0.x, a0.y, a1.x, a1.y, p1.x, p1.y)\n        }\n\n        const drawBezier = (b: Bezier) => {\n            g.beginPath()\n            addBezierToPath(b)\n            g.stroke()\n        }\n\n        const drawBeziers = (bs: Offset | Bezier[]) => {\n            if (Array.isArray(bs)) {\n                g.beginPath()\n                for (const bb of bs) {\n                    addBezierToPath(bb)\n                }\n                g.stroke()\n            }\n        }\n\n        const oldLineCap = g.lineCap\n        g.lineCap = \"butt\"\n\n        // margin\n        if (isMouseOver) {\n            g.lineWidth = totalWidth + 2\n            g.strokeStyle = COLOR_MOUSE_OVER\n            drawBezier(b)\n            g.lineWidth = totalWidth - 2 * WIRE_MARGIN_OUTER\n        } else {\n            g.lineWidth = totalWidth\n        }\n\n        g.strokeStyle = COLOR_WIRE[color]\n        drawBezier(b)\n\n        g.lineWidth = WIRE_WIDTH\n        let dist = -((numWires - 1) / 2) * (WIRE_WIDTH + WIRE_MARGIN_INNER)\n        for (const value of values) {\n            g.strokeStyle = neutral ? COLOR_UNKNOWN : colorForBoolean(value)\n            const b1 = b.offset(dist)\n            drawBeziers(b1)\n            dist += WIRE_WIDTH + WIRE_MARGIN_INNER\n        }\n\n        // restore\n        g.lineCap = oldLineCap\n    }\n\n    private drawRibbonEnd(g: CanvasRenderingContext2D, ctx: DrawContext, nodeGroup: NodeGroup<Node>, startIndex: number, endIndex: number): [readonly [number, number], Orientation] {\n        const nodes = nodeGroup.nodes\n        const orient = nodes[startIndex].orient\n        const numNodes = endIndex - startIndex + 1\n\n        let minX = Number.POSITIVE_INFINITY\n        let minY = Number.POSITIVE_INFINITY\n        let maxX = Number.NEGATIVE_INFINITY\n        let maxY = Number.NEGATIVE_INFINITY\n        let sumX = 0\n        let sumY = 0\n        for (let i = startIndex; i <= endIndex; i++) {\n            const node = nodes[i]\n            const x = node.posX\n            const y = node.posY\n            minX = Math.min(minX, x)\n            minY = Math.min(minY, y)\n            maxX = Math.max(maxX, x)\n            maxY = Math.max(maxY, y)\n            sumX += x\n            sumY += y\n        }\n\n        const [[startX, startY], [endX, endY], mid] = (() => {\n            switch (orient) {\n                case \"e\": return [[maxX, minY], [maxX, maxY], [maxX, sumY / numNodes]] as const\n                case \"w\": return [[minX, minY], [minX, maxY], [minX, sumY / numNodes]] as const\n                case \"s\": return [[minX, minY], [maxX, minY], [sumX / numNodes, minY]] as const\n                case \"n\": return [[minX, maxY], [maxX, maxY], [sumX / numNodes, maxY]] as const\n            }\n        })()\n\n        drawStraightWireLine(g, startX, startY, endX, endY, \"Z\", \"black\", true)\n        return [mid, orient]\n    }\n\n\n    public isOver(x: number, y: number): boolean {\n        return false // TODO\n    }\n    public isInRect(rect: DOMRect): boolean {\n        return false // TODO\n    }\n\n}\n\n\nexport class WireManager {\n\n    public readonly editor: LogicEditor\n    private readonly _wires: Wire[] = []\n    private readonly _ribbons: Ribbon[] = []\n    private _wireBeingAdded: Wire | undefined = undefined\n\n    public constructor(editor: LogicEditor) {\n        this.editor = editor\n    }\n\n    public get wires(): readonly Wire[] {\n        return this._wires\n    }\n\n    public get ribbons(): readonly Ribbon[] {\n        return this._ribbons\n    }\n\n    public get isAddingWire() {\n        return isDefined(this._wireBeingAdded)\n    }\n\n    public draw(g: CanvasRenderingContext2D, drawParams: DrawParams) {\n        this.removeDeadWires()\n        const useRibbons = this.editor.options.groupParallelWires\n        if (useRibbons) {\n            for (const ribbon of this._ribbons) {\n                ribbon.draw(g, drawParams)\n            }\n        }\n        for (const wire of this._wires) {\n            if (useRibbons && isDefined(wire.ribbon)) {\n                continue\n            }\n            wire.draw(g, drawParams)\n            for (const waypoint of wire.waypoints) {\n                waypoint.draw(g, drawParams)\n            }\n        }\n\n    }\n\n    private removeDeadWires() {\n        let i = 0\n        while (i < this._wires.length) {\n            const wire = this._wires[i]\n            if (!wire.isAlive) {\n                wire.destroy()\n                this._wires.splice(i, 1)\n            } else {\n                i++\n            }\n        }\n    }\n\n    public addNode(newNode: Node): Wire | undefined {\n        let completedWire = undefined\n        if (!this.isAddingWire) {\n            // start drawing a new wire\n            const wire = new Wire(newNode)\n            this._wires.push(wire)\n            this._wireBeingAdded = wire\n            this.editor.setToolCursor(\"crosshair\")\n\n        } else {\n            // complete the new wire\n            const currentWireIndex = this._wires.length - 1\n            const currentWire = this._wires[currentWireIndex]\n            let created = false\n            if (newNode !== currentWire.startNode) {\n                if (currentWire.startNode.isOutput !== newNode.isOutput && newNode.acceptsMoreConnections) {\n                    // normal, create\n                    currentWire.setSecondNode(newNode)\n                    created = true\n                } else if (!Node.isOutput(newNode)) {\n                    const otherStartNode = newNode.incomingWire?.startNode\n                    if (isDefined(otherStartNode)\n                        && otherStartNode.acceptsMoreConnections\n                        && otherStartNode.isOutput !== currentWire.startNode.isOutput) {\n                        // create new connection with other end of this node\n                        currentWire.setSecondNode(otherStartNode)\n                        created = true\n                    }\n                }\n            }\n\n            if (!created) {\n                delete this._wires[currentWireIndex]\n                this._wires.length--\n            } else {\n                completedWire = currentWire\n                this.offsetWireIfNecessary(completedWire)\n                this.tryMergeWire(completedWire)\n                this.editor.setDirty(\"added wire\")\n            }\n\n            this._wireBeingAdded = undefined\n            this.editor.setToolCursor(null)\n        }\n        this.editor.redrawMgr.addReason(\"started or stopped wire\", null)\n        return completedWire\n    }\n\n    private offsetWireIfNecessary(wire: Wire) {\n        const startNode = wire.startNode\n        const endNode = wire.endNode\n        if (endNode === null) {\n            return\n        }\n        const comp = startNode.parent as Component\n        if (comp !== endNode.parent) {\n            return\n        }\n        const dx2 = (endNode.posX - startNode.posX) / 2\n        const dy2 = (endNode.posY - startNode.posY) / 2\n        const midpointX = startNode.posX + dx2\n        const midpointY = startNode.posY + dy2\n        if (!comp.isOver(midpointX, midpointY)) {\n            return\n        }\n\n        const addToX = dx2 > dy2\n\n        const dir = addToX\n            ? (startNode.posX < endNode.posX ? 1 : -1)\n            : (startNode.posY < endNode.posY ? 1 : -1)\n        const calcOffsetFromDim = (dim: number) => {\n            return dir * Math.ceil(dim / 20) * 10 + 10\n        }\n\n        const isVertical = Orientation.isVertical(comp.orient)\n\n        const waypointX = midpointX + (addToX ? calcOffsetFromDim(isVertical ? comp.unrotatedHeight : comp.unrotatedWidth) : 0)\n        const waypointY = midpointY + (addToX ? 0 : calcOffsetFromDim(isVertical ? comp.unrotatedWidth : comp.unrotatedHeight))\n        wire.addWaypointWith(waypointX, waypointY)\n    }\n\n    private tryMergeWire(wire: Wire) {\n        const startNode = wire.startNode\n        const endNode = wire.endNode\n        if (endNode === null || !(startNode instanceof NodeOut)) {\n            return\n        }\n\n        const startGroup = startNode.group\n        const endGroup = endNode.group\n        if (isUndefined(startGroup) || isUndefined(endGroup)) {\n            return\n        }\n\n        const findWire = (group1: NodeGroup<NodeOut>, i1: number, group2: NodeGroup<NodeIn>, i2: number): Wire | undefined => {\n            if (i1 < 0 || i2 < 0 || i1 >= group1.nodes.length || i2 >= group2.nodes.length) {\n                return undefined\n            }\n            return group1.nodes[i1].findWireTo(group2.nodes[i2])\n        }\n\n        const indexStart = startGroup.nodes.indexOf(startNode)\n        const indexEnd = endGroup.nodes.indexOf(endNode)\n\n        const wireBefore = findWire(startGroup, indexStart - 1, endGroup, indexEnd - 1)\n        if (isDefined(wireBefore)) {\n            let ribbon = wireBefore.ribbon\n            if (isUndefined(ribbon)) {\n                ribbon = new Ribbon(startNode.editor, startGroup, endGroup)\n                this._ribbons.push(ribbon) // TODO determine when we must remove them\n                wireBefore.ribbon = ribbon\n                ribbon.addCoveredWire(wireBefore, indexStart - 1, indexEnd - 1)\n            }\n            ribbon.addCoveredWire(wire, indexStart, indexEnd)\n            wire.ribbon = ribbon\n        }\n\n        // TODO merge after, too!\n\n        // if (isDefined(wireAfter)) {\n        //     console.log(\"we have a wire after\")\n        // }\n\n\n        // const wireAfter = findWire(startGroup, indexStart + 1, endGroup, indexEnd + 1)\n    }\n\n    public deleteWire(wire: Wire) {\n        // TODO check in ribbon\n        wire.destroy()\n        const ribbon = wire.ribbon\n        if (isDefined(ribbon)) {\n            ribbon.wireWasDeleted(wire)\n            if (ribbon.isEmpty()) {\n                this._ribbons.splice(this._ribbons.indexOf(ribbon), 1)\n            }\n        }\n        // remove wire from array\n        this._wires.splice(this._wires.indexOf(wire), 1)\n        this.editor.redrawMgr.addReason(\"deleted wire\", null)\n    }\n\n    public clearAllWires() {\n        // TODO clear ribbons\n        for (const wire of this._wires) {\n            wire.destroy()\n        }\n        this._wires.splice(0, this._wires.length)\n        this.editor.redrawMgr.addReason(\"deleted wires\", null)\n    }\n\n    public tryCancelWire() {\n        const wireBeingAdded = this._wireBeingAdded\n        if (isDefined(wireBeingAdded)) {\n            // adding the start node as end node to trigger deletion\n            this.addNode(wireBeingAdded.startNode)\n        }\n    }\n\n}\n", "export var top = 'top';\nexport var bottom = 'bottom';\nexport var right = 'right';\nexport var left = 'left';\nexport var auto = 'auto';\nexport var basePlacements = [top, bottom, right, left];\nexport var start = 'start';\nexport var end = 'end';\nexport var clippingParents = 'clippingParents';\nexport var viewport = 'viewport';\nexport var popper = 'popper';\nexport var reference = 'reference';\nexport var variationPlacements = /*#__PURE__*/basePlacements.reduce(function (acc, placement) {\n  return acc.concat([placement + \"-\" + start, placement + \"-\" + end]);\n}, []);\nexport var placements = /*#__PURE__*/[].concat(basePlacements, [auto]).reduce(function (acc, placement) {\n  return acc.concat([placement, placement + \"-\" + start, placement + \"-\" + end]);\n}, []); // modifiers that need to read the DOM\n\nexport var beforeRead = 'beforeRead';\nexport var read = 'read';\nexport var afterRead = 'afterRead'; // pure-logic modifiers\n\nexport var beforeMain = 'beforeMain';\nexport var main = 'main';\nexport var afterMain = 'afterMain'; // modifier with the purpose to write to the DOM (or write into a framework state)\n\nexport var beforeWrite = 'beforeWrite';\nexport var write = 'write';\nexport var afterWrite = 'afterWrite';\nexport var modifierPhases = [beforeRead, read, afterRead, beforeMain, main, afterMain, beforeWrite, write, afterWrite];", "export default function getNodeName(element) {\n  return element ? (element.nodeName || '').toLowerCase() : null;\n}", "export default function getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (node.toString() !== '[object Window]') {\n    var ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}", "import getWindow from \"./getWindow.js\";\n\nfunction isElement(node) {\n  var OwnElement = getWindow(node).Element;\n  return node instanceof OwnElement || node instanceof Element;\n}\n\nfunction isHTMLElement(node) {\n  var OwnElement = getWindow(node).HTMLElement;\n  return node instanceof OwnElement || node instanceof HTMLElement;\n}\n\nfunction isShadowRoot(node) {\n  // IE 11 has no ShadowRoot\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  var OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\n\nexport { isElement, isHTMLElement, isShadowRoot };", "import getNodeName from \"../dom-utils/getNodeName.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // This modifier takes the styles prepared by the `computeStyles` modifier\n// and applies them to the HTMLElements such as popper and arrow\n\nfunction applyStyles(_ref) {\n  var state = _ref.state;\n  Object.keys(state.elements).forEach(function (name) {\n    var style = state.styles[name] || {};\n    var attributes = state.attributes[name] || {};\n    var element = state.elements[name]; // arrow is optional + virtual elements\n\n    if (!isHTMLElement(element) || !getNodeName(element)) {\n      return;\n    } // Flow doesn't support to extend this property, but it's the most\n    // effective way to apply styles to an HTMLElement\n    // $FlowFixMe[cannot-write]\n\n\n    Object.assign(element.style, style);\n    Object.keys(attributes).forEach(function (name) {\n      var value = attributes[name];\n\n      if (value === false) {\n        element.removeAttribute(name);\n      } else {\n        element.setAttribute(name, value === true ? '' : value);\n      }\n    });\n  });\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state;\n  var initialStyles = {\n    popper: {\n      position: state.options.strategy,\n      left: '0',\n      top: '0',\n      margin: '0'\n    },\n    arrow: {\n      position: 'absolute'\n    },\n    reference: {}\n  };\n  Object.assign(state.elements.popper.style, initialStyles.popper);\n  state.styles = initialStyles;\n\n  if (state.elements.arrow) {\n    Object.assign(state.elements.arrow.style, initialStyles.arrow);\n  }\n\n  return function () {\n    Object.keys(state.elements).forEach(function (name) {\n      var element = state.elements[name];\n      var attributes = state.attributes[name] || {};\n      var styleProperties = Object.keys(state.styles.hasOwnProperty(name) ? state.styles[name] : initialStyles[name]); // Set all values to an empty string to unset them\n\n      var style = styleProperties.reduce(function (style, property) {\n        style[property] = '';\n        return style;\n      }, {}); // arrow is optional + virtual elements\n\n      if (!isHTMLElement(element) || !getNodeName(element)) {\n        return;\n      }\n\n      Object.assign(element.style, style);\n      Object.keys(attributes).forEach(function (attribute) {\n        element.removeAttribute(attribute);\n      });\n    });\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'applyStyles',\n  enabled: true,\n  phase: 'write',\n  fn: applyStyles,\n  effect: effect,\n  requires: ['computeStyles']\n};", "import { auto } from \"../enums.js\";\nexport default function getBasePlacement(placement) {\n  return placement.split('-')[0];\n}", "export default function getBoundingClientRect(element) {\n  var rect = element.getBoundingClientRect();\n  return {\n    width: rect.width,\n    height: rect.height,\n    top: rect.top,\n    right: rect.right,\n    bottom: rect.bottom,\n    left: rect.left,\n    x: rect.left,\n    y: rect.top\n  };\n}", "import getBoundingClientRect from \"./getBoundingClientRect.js\"; // Returns the layout rect of an element relative to its offsetParent. Layout\n// means it doesn't take into account transforms.\n\nexport default function getLayoutRect(element) {\n  var clientRect = getBoundingClientRect(element); // Use the clientRect sizes if it's not been transformed.\n  // Fixes https://github.com/popperjs/popper-core/issues/1223\n\n  var width = element.offsetWidth;\n  var height = element.offsetHeight;\n\n  if (Math.abs(clientRect.width - width) <= 1) {\n    width = clientRect.width;\n  }\n\n  if (Math.abs(clientRect.height - height) <= 1) {\n    height = clientRect.height;\n  }\n\n  return {\n    x: element.offsetLeft,\n    y: element.offsetTop,\n    width: width,\n    height: height\n  };\n}", "import { isShadowRoot } from \"./instanceOf.js\";\nexport default function contains(parent, child) {\n  var rootNode = child.getRootNode && child.getRootNode(); // First, attempt with faster native method\n\n  if (parent.contains(child)) {\n    return true;\n  } // then fallback to custom implementation with Shadow DOM support\n  else if (rootNode && isShadowRoot(rootNode)) {\n      var next = child;\n\n      do {\n        if (next && parent.isSameNode(next)) {\n          return true;\n        } // $FlowFixMe[prop-missing]: need a better way to handle this...\n\n\n        next = next.parentNode || next.host;\n      } while (next);\n    } // Give up, the result is false\n\n\n  return false;\n}", "import getWindow from \"./getWindow.js\";\nexport default function getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}", "import getNodeName from \"./getNodeName.js\";\nexport default function isTableElement(element) {\n  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;\n}", "import { isElement } from \"./instanceOf.js\";\nexport default function getDocumentElement(element) {\n  // $FlowFixMe[incompatible-return]: assume body is always available\n  return ((isElement(element) ? element.ownerDocument : // $FlowFixMe[prop-missing]\n  element.document) || window.document).documentElement;\n}", "import getNodeName from \"./getNodeName.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport { isShadowRoot } from \"./instanceOf.js\";\nexport default function getParentNode(element) {\n  if (getNodeName(element) === 'html') {\n    return element;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // $FlowFixMe[incompatible-return]\n    // $FlowFixMe[prop-missing]\n    element.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    element.parentNode || ( // DOM Element detected\n    isShadowRoot(element) ? element.host : null) || // ShadowRoot detected\n    // $FlowFixMe[incompatible-call]: HTMLElement is a Node\n    getDocumentElement(element) // fallback\n\n  );\n}", "import getWindow from \"./getWindow.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport isTableElement from \"./isTableElement.js\";\nimport getParentNode from \"./getParentNode.js\";\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837\n  getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n} // `.offsetParent` reports `null` for fixed elements, while absolute elements\n// return the containing block\n\n\nfunction getContainingBlock(element) {\n  var isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') !== -1;\n  var currentNode = getParentNode(element);\n\n  while (isHTMLElement(currentNode) && ['html', 'body'].indexOf(getNodeName(currentNode)) < 0) {\n    var css = getComputedStyle(currentNode); // This is non-exhaustive but covers the most common CSS properties that\n    // create a containing block.\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n    if (css.transform !== 'none' || css.perspective !== 'none' || css.contain === 'paint' || ['transform', 'perspective'].indexOf(css.willChange) !== -1 || isFirefox && css.willChange === 'filter' || isFirefox && css.filter && css.filter !== 'none') {\n      return currentNode;\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nexport default function getOffsetParent(element) {\n  var window = getWindow(element);\n  var offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static')) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}", "export default function getMainAxisFromPlacement(placement) {\n  return ['top', 'bottom'].indexOf(placement) >= 0 ? 'x' : 'y';\n}", "export var max = Math.max;\nexport var min = Math.min;\nexport var round = Math.round;", "import { max as mathMax, min as mathMin } from \"./math.js\";\nexport default function within(min, value, max) {\n  return mathMax(min, mathMin(value, max));\n}", "export default function getFreshSideObject() {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n}", "import getFreshSideObject from \"./getFreshSideObject.js\";\nexport default function mergePaddingObject(paddingObject) {\n  return Object.assign({}, getFreshSideObject(), paddingObject);\n}", "export default function expandToHashMap(value, keys) {\n  return keys.reduce(function (hashMap, key) {\n    hashMap[key] = value;\n    return hashMap;\n  }, {});\n}", "import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport contains from \"../dom-utils/contains.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport within from \"../utils/within.js\";\nimport mergePaddingObject from \"../utils/mergePaddingObject.js\";\nimport expandToHashMap from \"../utils/expandToHashMap.js\";\nimport { left, right, basePlacements, top, bottom } from \"../enums.js\";\nimport { isHTMLElement } from \"../dom-utils/instanceOf.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar toPaddingObject = function toPaddingObject(padding, state) {\n  padding = typeof padding === 'function' ? padding(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : padding;\n  return mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n};\n\nfunction arrow(_ref) {\n  var _state$modifiersData$;\n\n  var state = _ref.state,\n      name = _ref.name,\n      options = _ref.options;\n  var arrowElement = state.elements.arrow;\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var basePlacement = getBasePlacement(state.placement);\n  var axis = getMainAxisFromPlacement(basePlacement);\n  var isVertical = [left, right].indexOf(basePlacement) >= 0;\n  var len = isVertical ? 'height' : 'width';\n\n  if (!arrowElement || !popperOffsets) {\n    return;\n  }\n\n  var paddingObject = toPaddingObject(options.padding, state);\n  var arrowRect = getLayoutRect(arrowElement);\n  var minProp = axis === 'y' ? top : left;\n  var maxProp = axis === 'y' ? bottom : right;\n  var endDiff = state.rects.reference[len] + state.rects.reference[axis] - popperOffsets[axis] - state.rects.popper[len];\n  var startDiff = popperOffsets[axis] - state.rects.reference[axis];\n  var arrowOffsetParent = getOffsetParent(arrowElement);\n  var clientSize = arrowOffsetParent ? axis === 'y' ? arrowOffsetParent.clientHeight || 0 : arrowOffsetParent.clientWidth || 0 : 0;\n  var centerToReference = endDiff / 2 - startDiff / 2; // Make sure the arrow doesn't overflow the popper if the center point is\n  // outside of the popper bounds\n\n  var min = paddingObject[minProp];\n  var max = clientSize - arrowRect[len] - paddingObject[maxProp];\n  var center = clientSize / 2 - arrowRect[len] / 2 + centerToReference;\n  var offset = within(min, center, max); // Prevents breaking syntax highlighting...\n\n  var axisProp = axis;\n  state.modifiersData[name] = (_state$modifiersData$ = {}, _state$modifiersData$[axisProp] = offset, _state$modifiersData$.centerOffset = offset - center, _state$modifiersData$);\n}\n\nfunction effect(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options;\n  var _options$element = options.element,\n      arrowElement = _options$element === void 0 ? '[data-popper-arrow]' : _options$element;\n\n  if (arrowElement == null) {\n    return;\n  } // CSS selector\n\n\n  if (typeof arrowElement === 'string') {\n    arrowElement = state.elements.popper.querySelector(arrowElement);\n\n    if (!arrowElement) {\n      return;\n    }\n  }\n\n  if (process.env.NODE_ENV !== \"production\") {\n    if (!isHTMLElement(arrowElement)) {\n      console.error(['Popper: \"arrow\" element must be an HTMLElement (not an SVGElement).', 'To use an SVG arrow, wrap it in an HTMLElement that will be used as', 'the arrow.'].join(' '));\n    }\n  }\n\n  if (!contains(state.elements.popper, arrowElement)) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(['Popper: \"arrow\" modifier\\'s `element` must be a child of the popper', 'element.'].join(' '));\n    }\n\n    return;\n  }\n\n  state.elements.arrow = arrowElement;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'arrow',\n  enabled: true,\n  phase: 'main',\n  fn: arrow,\n  effect: effect,\n  requires: ['popperOffsets'],\n  requiresIfExists: ['preventOverflow']\n};", "import { top, left, right, bottom } from \"../enums.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport getWindow from \"../dom-utils/getWindow.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport getComputedStyle from \"../dom-utils/getComputedStyle.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport { round } from \"../utils/math.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar unsetSides = {\n  top: 'auto',\n  right: 'auto',\n  bottom: 'auto',\n  left: 'auto'\n}; // Round the offsets to the nearest suitable subpixel based on the DPR.\n// Zooming can change the DPR, but it seems to report a value that will\n// cleanly divide the values into the appropriate subpixels.\n\nfunction roundOffsetsByDPR(_ref) {\n  var x = _ref.x,\n      y = _ref.y;\n  var win = window;\n  var dpr = win.devicePixelRatio || 1;\n  return {\n    x: round(round(x * dpr) / dpr) || 0,\n    y: round(round(y * dpr) / dpr) || 0\n  };\n}\n\nexport function mapToStyles(_ref2) {\n  var _Object$assign2;\n\n  var popper = _ref2.popper,\n      popperRect = _ref2.popperRect,\n      placement = _ref2.placement,\n      offsets = _ref2.offsets,\n      position = _ref2.position,\n      gpuAcceleration = _ref2.gpuAcceleration,\n      adaptive = _ref2.adaptive,\n      roundOffsets = _ref2.roundOffsets;\n\n  var _ref3 = roundOffsets === true ? roundOffsetsByDPR(offsets) : typeof roundOffsets === 'function' ? roundOffsets(offsets) : offsets,\n      _ref3$x = _ref3.x,\n      x = _ref3$x === void 0 ? 0 : _ref3$x,\n      _ref3$y = _ref3.y,\n      y = _ref3$y === void 0 ? 0 : _ref3$y;\n\n  var hasX = offsets.hasOwnProperty('x');\n  var hasY = offsets.hasOwnProperty('y');\n  var sideX = left;\n  var sideY = top;\n  var win = window;\n\n  if (adaptive) {\n    var offsetParent = getOffsetParent(popper);\n    var heightProp = 'clientHeight';\n    var widthProp = 'clientWidth';\n\n    if (offsetParent === getWindow(popper)) {\n      offsetParent = getDocumentElement(popper);\n\n      if (getComputedStyle(offsetParent).position !== 'static') {\n        heightProp = 'scrollHeight';\n        widthProp = 'scrollWidth';\n      }\n    } // $FlowFixMe[incompatible-cast]: force type refinement, we compare offsetParent with window above, but Flow doesn't detect it\n\n\n    offsetParent = offsetParent;\n\n    if (placement === top) {\n      sideY = bottom; // $FlowFixMe[prop-missing]\n\n      y -= offsetParent[heightProp] - popperRect.height;\n      y *= gpuAcceleration ? 1 : -1;\n    }\n\n    if (placement === left) {\n      sideX = right; // $FlowFixMe[prop-missing]\n\n      x -= offsetParent[widthProp] - popperRect.width;\n      x *= gpuAcceleration ? 1 : -1;\n    }\n  }\n\n  var commonStyles = Object.assign({\n    position: position\n  }, adaptive && unsetSides);\n\n  if (gpuAcceleration) {\n    var _Object$assign;\n\n    return Object.assign({}, commonStyles, (_Object$assign = {}, _Object$assign[sideY] = hasY ? '0' : '', _Object$assign[sideX] = hasX ? '0' : '', _Object$assign.transform = (win.devicePixelRatio || 1) < 2 ? \"translate(\" + x + \"px, \" + y + \"px)\" : \"translate3d(\" + x + \"px, \" + y + \"px, 0)\", _Object$assign));\n  }\n\n  return Object.assign({}, commonStyles, (_Object$assign2 = {}, _Object$assign2[sideY] = hasY ? y + \"px\" : '', _Object$assign2[sideX] = hasX ? x + \"px\" : '', _Object$assign2.transform = '', _Object$assign2));\n}\n\nfunction computeStyles(_ref4) {\n  var state = _ref4.state,\n      options = _ref4.options;\n  var _options$gpuAccelerat = options.gpuAcceleration,\n      gpuAcceleration = _options$gpuAccelerat === void 0 ? true : _options$gpuAccelerat,\n      _options$adaptive = options.adaptive,\n      adaptive = _options$adaptive === void 0 ? true : _options$adaptive,\n      _options$roundOffsets = options.roundOffsets,\n      roundOffsets = _options$roundOffsets === void 0 ? true : _options$roundOffsets;\n\n  if (process.env.NODE_ENV !== \"production\") {\n    var transitionProperty = getComputedStyle(state.elements.popper).transitionProperty || '';\n\n    if (adaptive && ['transform', 'top', 'right', 'bottom', 'left'].some(function (property) {\n      return transitionProperty.indexOf(property) >= 0;\n    })) {\n      console.warn(['Popper: Detected CSS transitions on at least one of the following', 'CSS properties: \"transform\", \"top\", \"right\", \"bottom\", \"left\".', '\\n\\n', 'Disable the \"computeStyles\" modifier\\'s `adaptive` option to allow', 'for smooth transitions, or remove these properties from the CSS', 'transition declaration on the popper element if only transitioning', 'opacity or background-color for example.', '\\n\\n', 'We recommend using the popper element as a wrapper around an inner', 'element that can have any CSS property transitioned for animations.'].join(' '));\n    }\n  }\n\n  var commonStyles = {\n    placement: getBasePlacement(state.placement),\n    popper: state.elements.popper,\n    popperRect: state.rects.popper,\n    gpuAcceleration: gpuAcceleration\n  };\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.styles.popper = Object.assign({}, state.styles.popper, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.popperOffsets,\n      position: state.options.strategy,\n      adaptive: adaptive,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  if (state.modifiersData.arrow != null) {\n    state.styles.arrow = Object.assign({}, state.styles.arrow, mapToStyles(Object.assign({}, commonStyles, {\n      offsets: state.modifiersData.arrow,\n      position: 'absolute',\n      adaptive: false,\n      roundOffsets: roundOffsets\n    })));\n  }\n\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-placement': state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'computeStyles',\n  enabled: true,\n  phase: 'beforeWrite',\n  fn: computeStyles,\n  data: {}\n};", "import getWindow from \"../dom-utils/getWindow.js\"; // eslint-disable-next-line import/no-unused-modules\n\nvar passive = {\n  passive: true\n};\n\nfunction effect(_ref) {\n  var state = _ref.state,\n      instance = _ref.instance,\n      options = _ref.options;\n  var _options$scroll = options.scroll,\n      scroll = _options$scroll === void 0 ? true : _options$scroll,\n      _options$resize = options.resize,\n      resize = _options$resize === void 0 ? true : _options$resize;\n  var window = getWindow(state.elements.popper);\n  var scrollParents = [].concat(state.scrollParents.reference, state.scrollParents.popper);\n\n  if (scroll) {\n    scrollParents.forEach(function (scrollParent) {\n      scrollParent.addEventListener('scroll', instance.update, passive);\n    });\n  }\n\n  if (resize) {\n    window.addEventListener('resize', instance.update, passive);\n  }\n\n  return function () {\n    if (scroll) {\n      scrollParents.forEach(function (scrollParent) {\n        scrollParent.removeEventListener('scroll', instance.update, passive);\n      });\n    }\n\n    if (resize) {\n      window.removeEventListener('resize', instance.update, passive);\n    }\n  };\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'eventListeners',\n  enabled: true,\n  phase: 'write',\n  fn: function fn() {},\n  effect: effect,\n  data: {}\n};", "var hash = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nexport default function getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}", "var hash = {\n  start: 'end',\n  end: 'start'\n};\nexport default function getOppositeVariationPlacement(placement) {\n  return placement.replace(/start|end/g, function (matched) {\n    return hash[matched];\n  });\n}", "import getWindow from \"./getWindow.js\";\nexport default function getWindowScroll(node) {\n  var win = getWindow(node);\n  var scrollLeft = win.pageXOffset;\n  var scrollTop = win.pageYOffset;\n  return {\n    scrollLeft: scrollLeft,\n    scrollTop: scrollTop\n  };\n}", "import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nexport default function getWindowScrollBarX(element) {\n  // If <html> has a CSS width greater than the viewport, then this will be\n  // incorrect for RTL.\n  // Popper 1 is broken in this case and never had a bug report so let's assume\n  // it's not an issue. I don't think anyone ever specifies width on <html>\n  // anyway.\n  // Browsers where the left scrollbar doesn't cause an issue report `0` for\n  // this (e.g. Edge 2019, IE11, Safari)\n  return getBoundingClientRect(getDocumentElement(element)).left + getWindowScroll(element).scrollLeft;\n}", "import getWindow from \"./getWindow.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nexport default function getViewportRect(element) {\n  var win = getWindow(element);\n  var html = getDocumentElement(element);\n  var visualViewport = win.visualViewport;\n  var width = html.clientWidth;\n  var height = html.clientHeight;\n  var x = 0;\n  var y = 0; // NB: This isn't supported on iOS <= 12. If the keyboard is open, the popper\n  // can be obscured underneath it.\n  // Also, `html.clientHeight` adds the bottom bar height in Safari iOS, even\n  // if it isn't open, so if this isn't available, the popper will be detected\n  // to overflow the bottom of the screen too early.\n\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height; // Uses Layout Viewport (like Chrome; Safari does not currently)\n    // In Chrome, it returns a value very close to 0 (+/-) but contains rounding\n    // errors due to floating point numbers, so we need to check precision.\n    // Safari returns a number <= 0, usually < -1 when pinch-zoomed\n    // Feature detection fails in mobile emulation mode in Chrome.\n    // Math.abs(win.innerWidth / visualViewport.scale - visualViewport.width) <\n    // 0.001\n    // Fallback here: \"Not Safari\" userAgent\n\n    if (!/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x + getWindowScrollBarX(element),\n    y: y\n  };\n}", "import getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getWindowScroll from \"./getWindowScroll.js\";\nimport { max } from \"../utils/math.js\"; // Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable\n\nexport default function getDocumentRect(element) {\n  var _element$ownerDocumen;\n\n  var html = getDocumentElement(element);\n  var winScroll = getWindowScroll(element);\n  var body = (_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body;\n  var width = max(html.scrollWidth, html.clientWidth, body ? body.scrollWidth : 0, body ? body.clientWidth : 0);\n  var height = max(html.scrollHeight, html.clientHeight, body ? body.scrollHeight : 0, body ? body.clientHeight : 0);\n  var x = -winScroll.scrollLeft + getWindowScrollBarX(element);\n  var y = -winScroll.scrollTop;\n\n  if (getComputedStyle(body || html).direction === 'rtl') {\n    x += max(html.clientWidth, body ? body.clientWidth : 0) - width;\n  }\n\n  return {\n    width: width,\n    height: height,\n    x: x,\n    y: y\n  };\n}", "import getComputedStyle from \"./getComputedStyle.js\";\nexport default function isScrollParent(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  var _getComputedStyle = getComputedStyle(element),\n      overflow = _getComputedStyle.overflow,\n      overflowX = _getComputedStyle.overflowX,\n      overflowY = _getComputedStyle.overflowY;\n\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}", "import getParentNode from \"./getParentNode.js\";\nimport isScrollParent from \"./isScrollParent.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nexport default function getScrollParent(node) {\n  if (['html', 'body', '#document'].indexOf(getNodeName(node)) >= 0) {\n    // $FlowFixMe[incompatible-return]: assume body is always available\n    return node.ownerDocument.body;\n  }\n\n  if (isHTMLElement(node) && isScrollParent(node)) {\n    return node;\n  }\n\n  return getScrollParent(getParentNode(node));\n}", "import getScrollParent from \"./getScrollParent.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport getWindow from \"./getWindow.js\";\nimport isScrollParent from \"./isScrollParent.js\";\n/*\ngiven a DOM element, return the list of all scroll parents, up the list of ancesors\nuntil we get to the top window object. This list is what we attach scroll listeners\nto, because if any of these parent elements scroll, we'll need to re-calculate the\nreference element's position.\n*/\n\nexport default function listScrollParents(element, list) {\n  var _element$ownerDocumen;\n\n  if (list === void 0) {\n    list = [];\n  }\n\n  var scrollParent = getScrollParent(element);\n  var isBody = scrollParent === ((_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body);\n  var win = getWindow(scrollParent);\n  var target = isBody ? [win].concat(win.visualViewport || [], isScrollParent(scrollParent) ? scrollParent : []) : scrollParent;\n  var updatedList = list.concat(target);\n  return isBody ? updatedList : // $FlowFixMe[incompatible-call]: isBody tells us target will be an HTMLElement here\n  updatedList.concat(listScrollParents(getParentNode(target)));\n}", "export default function rectToClientRect(rect) {\n  return Object.assign({}, rect, {\n    left: rect.x,\n    top: rect.y,\n    right: rect.x + rect.width,\n    bottom: rect.y + rect.height\n  });\n}", "import { viewport } from \"../enums.js\";\nimport getViewportRect from \"./getViewportRect.js\";\nimport getDocumentRect from \"./getDocumentRect.js\";\nimport listScrollParents from \"./listScrollParents.js\";\nimport getOffsetParent from \"./getOffsetParent.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport getComputedStyle from \"./getComputedStyle.js\";\nimport { isElement, isHTMLElement } from \"./instanceOf.js\";\nimport getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getParentNode from \"./getParentNode.js\";\nimport contains from \"./contains.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport rectToClientRect from \"../utils/rectToClientRect.js\";\nimport { max, min } from \"../utils/math.js\";\n\nfunction getInnerBoundingClientRect(element) {\n  var rect = getBoundingClientRect(element);\n  rect.top = rect.top + element.clientTop;\n  rect.left = rect.left + element.clientLeft;\n  rect.bottom = rect.top + element.clientHeight;\n  rect.right = rect.left + element.clientWidth;\n  rect.width = element.clientWidth;\n  rect.height = element.clientHeight;\n  rect.x = rect.left;\n  rect.y = rect.top;\n  return rect;\n}\n\nfunction getClientRectFromMixedType(element, clippingParent) {\n  return clippingParent === viewport ? rectToClientRect(getViewportRect(element)) : isHTMLElement(clippingParent) ? getInnerBoundingClientRect(clippingParent) : rectToClientRect(getDocumentRect(getDocumentElement(element)));\n} // A \"clipping parent\" is an overflowable container with the characteristic of\n// clipping (or hiding) overflowing elements with a position different from\n// `initial`\n\n\nfunction getClippingParents(element) {\n  var clippingParents = listScrollParents(getParentNode(element));\n  var canEscapeClipping = ['absolute', 'fixed'].indexOf(getComputedStyle(element).position) >= 0;\n  var clipperElement = canEscapeClipping && isHTMLElement(element) ? getOffsetParent(element) : element;\n\n  if (!isElement(clipperElement)) {\n    return [];\n  } // $FlowFixMe[incompatible-return]: https://github.com/facebook/flow/issues/1414\n\n\n  return clippingParents.filter(function (clippingParent) {\n    return isElement(clippingParent) && contains(clippingParent, clipperElement) && getNodeName(clippingParent) !== 'body';\n  });\n} // Gets the maximum area that the element is visible in due to any number of\n// clipping parents\n\n\nexport default function getClippingRect(element, boundary, rootBoundary) {\n  var mainClippingParents = boundary === 'clippingParents' ? getClippingParents(element) : [].concat(boundary);\n  var clippingParents = [].concat(mainClippingParents, [rootBoundary]);\n  var firstClippingParent = clippingParents[0];\n  var clippingRect = clippingParents.reduce(function (accRect, clippingParent) {\n    var rect = getClientRectFromMixedType(element, clippingParent);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromMixedType(element, firstClippingParent));\n  clippingRect.width = clippingRect.right - clippingRect.left;\n  clippingRect.height = clippingRect.bottom - clippingRect.top;\n  clippingRect.x = clippingRect.left;\n  clippingRect.y = clippingRect.top;\n  return clippingRect;\n}", "export default function getVariation(placement) {\n  return placement.split('-')[1];\n}", "import getBasePlacement from \"./getBasePlacement.js\";\nimport getVariation from \"./getVariation.js\";\nimport getMainAxisFromPlacement from \"./getMainAxisFromPlacement.js\";\nimport { top, right, bottom, left, start, end } from \"../enums.js\";\nexport default function computeOffsets(_ref) {\n  var reference = _ref.reference,\n      element = _ref.element,\n      placement = _ref.placement;\n  var basePlacement = placement ? getBasePlacement(placement) : null;\n  var variation = placement ? getVariation(placement) : null;\n  var commonX = reference.x + reference.width / 2 - element.width / 2;\n  var commonY = reference.y + reference.height / 2 - element.height / 2;\n  var offsets;\n\n  switch (basePlacement) {\n    case top:\n      offsets = {\n        x: commonX,\n        y: reference.y - element.height\n      };\n      break;\n\n    case bottom:\n      offsets = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n\n    case right:\n      offsets = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n\n    case left:\n      offsets = {\n        x: reference.x - element.width,\n        y: commonY\n      };\n      break;\n\n    default:\n      offsets = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n\n  var mainAxis = basePlacement ? getMainAxisFromPlacement(basePlacement) : null;\n\n  if (mainAxis != null) {\n    var len = mainAxis === 'y' ? 'height' : 'width';\n\n    switch (variation) {\n      case start:\n        offsets[mainAxis] = offsets[mainAxis] - (reference[len] / 2 - element[len] / 2);\n        break;\n\n      case end:\n        offsets[mainAxis] = offsets[mainAxis] + (reference[len] / 2 - element[len] / 2);\n        break;\n\n      default:\n    }\n  }\n\n  return offsets;\n}", "import getBoundingClientRect from \"../dom-utils/getBoundingClientRect.js\";\nimport getClippingRect from \"../dom-utils/getClippingRect.js\";\nimport getDocumentElement from \"../dom-utils/getDocumentElement.js\";\nimport computeOffsets from \"./computeOffsets.js\";\nimport rectToClientRect from \"./rectToClientRect.js\";\nimport { clippingParents, reference, popper, bottom, top, right, basePlacements, viewport } from \"../enums.js\";\nimport { isElement } from \"../dom-utils/instanceOf.js\";\nimport mergePaddingObject from \"./mergePaddingObject.js\";\nimport expandToHashMap from \"./expandToHashMap.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport default function detectOverflow(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      _options$placement = _options.placement,\n      placement = _options$placement === void 0 ? state.placement : _options$placement,\n      _options$boundary = _options.boundary,\n      boundary = _options$boundary === void 0 ? clippingParents : _options$boundary,\n      _options$rootBoundary = _options.rootBoundary,\n      rootBoundary = _options$rootBoundary === void 0 ? viewport : _options$rootBoundary,\n      _options$elementConte = _options.elementContext,\n      elementContext = _options$elementConte === void 0 ? popper : _options$elementConte,\n      _options$altBoundary = _options.altBoundary,\n      altBoundary = _options$altBoundary === void 0 ? false : _options$altBoundary,\n      _options$padding = _options.padding,\n      padding = _options$padding === void 0 ? 0 : _options$padding;\n  var paddingObject = mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));\n  var altContext = elementContext === popper ? reference : popper;\n  var referenceElement = state.elements.reference;\n  var popperRect = state.rects.popper;\n  var element = state.elements[altBoundary ? altContext : elementContext];\n  var clippingClientRect = getClippingRect(isElement(element) ? element : element.contextElement || getDocumentElement(state.elements.popper), boundary, rootBoundary);\n  var referenceClientRect = getBoundingClientRect(referenceElement);\n  var popperOffsets = computeOffsets({\n    reference: referenceClientRect,\n    element: popperRect,\n    strategy: 'absolute',\n    placement: placement\n  });\n  var popperClientRect = rectToClientRect(Object.assign({}, popperRect, popperOffsets));\n  var elementClientRect = elementContext === popper ? popperClientRect : referenceClientRect; // positive = overflowing the clipping rect\n  // 0 or negative = within the clipping rect\n\n  var overflowOffsets = {\n    top: clippingClientRect.top - elementClientRect.top + paddingObject.top,\n    bottom: elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom,\n    left: clippingClientRect.left - elementClientRect.left + paddingObject.left,\n    right: elementClientRect.right - clippingClientRect.right + paddingObject.right\n  };\n  var offsetData = state.modifiersData.offset; // Offsets can be applied only to the popper element\n\n  if (elementContext === popper && offsetData) {\n    var offset = offsetData[placement];\n    Object.keys(overflowOffsets).forEach(function (key) {\n      var multiply = [right, bottom].indexOf(key) >= 0 ? 1 : -1;\n      var axis = [top, bottom].indexOf(key) >= 0 ? 'y' : 'x';\n      overflowOffsets[key] += offset[axis] * multiply;\n    });\n  }\n\n  return overflowOffsets;\n}", "import getVariation from \"./getVariation.js\";\nimport { variationPlacements, basePlacements, placements as allPlacements } from \"../enums.js\";\nimport detectOverflow from \"./detectOverflow.js\";\nimport getBasePlacement from \"./getBasePlacement.js\";\nexport default function computeAutoPlacement(state, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _options = options,\n      placement = _options.placement,\n      boundary = _options.boundary,\n      rootBoundary = _options.rootBoundary,\n      padding = _options.padding,\n      flipVariations = _options.flipVariations,\n      _options$allowedAutoP = _options.allowedAutoPlacements,\n      allowedAutoPlacements = _options$allowedAutoP === void 0 ? allPlacements : _options$allowedAutoP;\n  var variation = getVariation(placement);\n  var placements = variation ? flipVariations ? variationPlacements : variationPlacements.filter(function (placement) {\n    return getVariation(placement) === variation;\n  }) : basePlacements;\n  var allowedPlacements = placements.filter(function (placement) {\n    return allowedAutoPlacements.indexOf(placement) >= 0;\n  });\n\n  if (allowedPlacements.length === 0) {\n    allowedPlacements = placements;\n\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(['Popper: The `allowedAutoPlacements` option did not allow any', 'placements. Ensure the `placement` option matches the variation', 'of the allowed placements.', 'For example, \"auto\" cannot be used to allow \"bottom-start\".', 'Use \"auto-start\" instead.'].join(' '));\n    }\n  } // $FlowFixMe[incompatible-type]: Flow seems to have problems with two array unions...\n\n\n  var overflows = allowedPlacements.reduce(function (acc, placement) {\n    acc[placement] = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding\n    })[getBasePlacement(placement)];\n    return acc;\n  }, {});\n  return Object.keys(overflows).sort(function (a, b) {\n    return overflows[a] - overflows[b];\n  });\n}", "import getOppositePlacement from \"../utils/getOppositePlacement.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getOppositeVariationPlacement from \"../utils/getOppositeVariationPlacement.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport computeAutoPlacement from \"../utils/computeAutoPlacement.js\";\nimport { bottom, top, start, right, left, auto } from \"../enums.js\";\nimport getVariation from \"../utils/getVariation.js\"; // eslint-disable-next-line import/no-unused-modules\n\nfunction getExpandedFallbackPlacements(placement) {\n  if (getBasePlacement(placement) === auto) {\n    return [];\n  }\n\n  var oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeVariationPlacement(placement), oppositePlacement, getOppositeVariationPlacement(oppositePlacement)];\n}\n\nfunction flip(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n\n  if (state.modifiersData[name]._skip) {\n    return;\n  }\n\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? true : _options$altAxis,\n      specifiedFallbackPlacements = options.fallbackPlacements,\n      padding = options.padding,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      _options$flipVariatio = options.flipVariations,\n      flipVariations = _options$flipVariatio === void 0 ? true : _options$flipVariatio,\n      allowedAutoPlacements = options.allowedAutoPlacements;\n  var preferredPlacement = state.options.placement;\n  var basePlacement = getBasePlacement(preferredPlacement);\n  var isBasePlacement = basePlacement === preferredPlacement;\n  var fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipVariations ? [getOppositePlacement(preferredPlacement)] : getExpandedFallbackPlacements(preferredPlacement));\n  var placements = [preferredPlacement].concat(fallbackPlacements).reduce(function (acc, placement) {\n    return acc.concat(getBasePlacement(placement) === auto ? computeAutoPlacement(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      padding: padding,\n      flipVariations: flipVariations,\n      allowedAutoPlacements: allowedAutoPlacements\n    }) : placement);\n  }, []);\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var checksMap = new Map();\n  var makeFallbackChecks = true;\n  var firstFittingPlacement = placements[0];\n\n  for (var i = 0; i < placements.length; i++) {\n    var placement = placements[i];\n\n    var _basePlacement = getBasePlacement(placement);\n\n    var isStartVariation = getVariation(placement) === start;\n    var isVertical = [top, bottom].indexOf(_basePlacement) >= 0;\n    var len = isVertical ? 'width' : 'height';\n    var overflow = detectOverflow(state, {\n      placement: placement,\n      boundary: boundary,\n      rootBoundary: rootBoundary,\n      altBoundary: altBoundary,\n      padding: padding\n    });\n    var mainVariationSide = isVertical ? isStartVariation ? right : left : isStartVariation ? bottom : top;\n\n    if (referenceRect[len] > popperRect[len]) {\n      mainVariationSide = getOppositePlacement(mainVariationSide);\n    }\n\n    var altVariationSide = getOppositePlacement(mainVariationSide);\n    var checks = [];\n\n    if (checkMainAxis) {\n      checks.push(overflow[_basePlacement] <= 0);\n    }\n\n    if (checkAltAxis) {\n      checks.push(overflow[mainVariationSide] <= 0, overflow[altVariationSide] <= 0);\n    }\n\n    if (checks.every(function (check) {\n      return check;\n    })) {\n      firstFittingPlacement = placement;\n      makeFallbackChecks = false;\n      break;\n    }\n\n    checksMap.set(placement, checks);\n  }\n\n  if (makeFallbackChecks) {\n    // `2` may be desired in some cases \u2013 research later\n    var numberOfChecks = flipVariations ? 3 : 1;\n\n    var _loop = function _loop(_i) {\n      var fittingPlacement = placements.find(function (placement) {\n        var checks = checksMap.get(placement);\n\n        if (checks) {\n          return checks.slice(0, _i).every(function (check) {\n            return check;\n          });\n        }\n      });\n\n      if (fittingPlacement) {\n        firstFittingPlacement = fittingPlacement;\n        return \"break\";\n      }\n    };\n\n    for (var _i = numberOfChecks; _i > 0; _i--) {\n      var _ret = _loop(_i);\n\n      if (_ret === \"break\") break;\n    }\n  }\n\n  if (state.placement !== firstFittingPlacement) {\n    state.modifiersData[name]._skip = true;\n    state.placement = firstFittingPlacement;\n    state.reset = true;\n  }\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'flip',\n  enabled: true,\n  phase: 'main',\n  fn: flip,\n  requiresIfExists: ['offset'],\n  data: {\n    _skip: false\n  }\n};", "import { top, bottom, left, right } from \"../enums.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\n\nfunction getSideOffsets(overflow, rect, preventedOffsets) {\n  if (preventedOffsets === void 0) {\n    preventedOffsets = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  return {\n    top: overflow.top - rect.height - preventedOffsets.y,\n    right: overflow.right - rect.width + preventedOffsets.x,\n    bottom: overflow.bottom - rect.height + preventedOffsets.y,\n    left: overflow.left - rect.width - preventedOffsets.x\n  };\n}\n\nfunction isAnySideFullyClipped(overflow) {\n  return [top, right, bottom, left].some(function (side) {\n    return overflow[side] >= 0;\n  });\n}\n\nfunction hide(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var preventedOffsets = state.modifiersData.preventOverflow;\n  var referenceOverflow = detectOverflow(state, {\n    elementContext: 'reference'\n  });\n  var popperAltOverflow = detectOverflow(state, {\n    altBoundary: true\n  });\n  var referenceClippingOffsets = getSideOffsets(referenceOverflow, referenceRect);\n  var popperEscapeOffsets = getSideOffsets(popperAltOverflow, popperRect, preventedOffsets);\n  var isReferenceHidden = isAnySideFullyClipped(referenceClippingOffsets);\n  var hasPopperEscaped = isAnySideFullyClipped(popperEscapeOffsets);\n  state.modifiersData[name] = {\n    referenceClippingOffsets: referenceClippingOffsets,\n    popperEscapeOffsets: popperEscapeOffsets,\n    isReferenceHidden: isReferenceHidden,\n    hasPopperEscaped: hasPopperEscaped\n  };\n  state.attributes.popper = Object.assign({}, state.attributes.popper, {\n    'data-popper-reference-hidden': isReferenceHidden,\n    'data-popper-escaped': hasPopperEscaped\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'hide',\n  enabled: true,\n  phase: 'main',\n  requiresIfExists: ['preventOverflow'],\n  fn: hide\n};", "import getBasePlacement from \"../utils/getBasePlacement.js\";\nimport { top, left, right, placements } from \"../enums.js\";\nexport function distanceAndSkiddingToXY(placement, rects, offset) {\n  var basePlacement = getBasePlacement(placement);\n  var invertDistance = [left, top].indexOf(basePlacement) >= 0 ? -1 : 1;\n\n  var _ref = typeof offset === 'function' ? offset(Object.assign({}, rects, {\n    placement: placement\n  })) : offset,\n      skidding = _ref[0],\n      distance = _ref[1];\n\n  skidding = skidding || 0;\n  distance = (distance || 0) * invertDistance;\n  return [left, right].indexOf(basePlacement) >= 0 ? {\n    x: distance,\n    y: skidding\n  } : {\n    x: skidding,\n    y: distance\n  };\n}\n\nfunction offset(_ref2) {\n  var state = _ref2.state,\n      options = _ref2.options,\n      name = _ref2.name;\n  var _options$offset = options.offset,\n      offset = _options$offset === void 0 ? [0, 0] : _options$offset;\n  var data = placements.reduce(function (acc, placement) {\n    acc[placement] = distanceAndSkiddingToXY(placement, state.rects, offset);\n    return acc;\n  }, {});\n  var _data$state$placement = data[state.placement],\n      x = _data$state$placement.x,\n      y = _data$state$placement.y;\n\n  if (state.modifiersData.popperOffsets != null) {\n    state.modifiersData.popperOffsets.x += x;\n    state.modifiersData.popperOffsets.y += y;\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'offset',\n  enabled: true,\n  phase: 'main',\n  requires: ['popperOffsets'],\n  fn: offset\n};", "import computeOffsets from \"../utils/computeOffsets.js\";\n\nfunction popperOffsets(_ref) {\n  var state = _ref.state,\n      name = _ref.name;\n  // Offsets are the actual position the popper needs to have to be\n  // properly positioned near its reference element\n  // This is the most basic placement, and will be adjusted by\n  // the modifiers in the next step\n  state.modifiersData[name] = computeOffsets({\n    reference: state.rects.reference,\n    element: state.rects.popper,\n    strategy: 'absolute',\n    placement: state.placement\n  });\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'popperOffsets',\n  enabled: true,\n  phase: 'read',\n  fn: popperOffsets,\n  data: {}\n};", "export default function getAltAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}", "import { top, left, right, bottom, start } from \"../enums.js\";\nimport getBasePlacement from \"../utils/getBasePlacement.js\";\nimport getMainAxisFromPlacement from \"../utils/getMainAxisFromPlacement.js\";\nimport getAltAxis from \"../utils/getAltAxis.js\";\nimport within from \"../utils/within.js\";\nimport getLayoutRect from \"../dom-utils/getLayoutRect.js\";\nimport getOffsetParent from \"../dom-utils/getOffsetParent.js\";\nimport detectOverflow from \"../utils/detectOverflow.js\";\nimport getVariation from \"../utils/getVariation.js\";\nimport getFreshSideObject from \"../utils/getFreshSideObject.js\";\nimport { max as mathMax, min as mathMin } from \"../utils/math.js\";\n\nfunction preventOverflow(_ref) {\n  var state = _ref.state,\n      options = _ref.options,\n      name = _ref.name;\n  var _options$mainAxis = options.mainAxis,\n      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,\n      _options$altAxis = options.altAxis,\n      checkAltAxis = _options$altAxis === void 0 ? false : _options$altAxis,\n      boundary = options.boundary,\n      rootBoundary = options.rootBoundary,\n      altBoundary = options.altBoundary,\n      padding = options.padding,\n      _options$tether = options.tether,\n      tether = _options$tether === void 0 ? true : _options$tether,\n      _options$tetherOffset = options.tetherOffset,\n      tetherOffset = _options$tetherOffset === void 0 ? 0 : _options$tetherOffset;\n  var overflow = detectOverflow(state, {\n    boundary: boundary,\n    rootBoundary: rootBoundary,\n    padding: padding,\n    altBoundary: altBoundary\n  });\n  var basePlacement = getBasePlacement(state.placement);\n  var variation = getVariation(state.placement);\n  var isBasePlacement = !variation;\n  var mainAxis = getMainAxisFromPlacement(basePlacement);\n  var altAxis = getAltAxis(mainAxis);\n  var popperOffsets = state.modifiersData.popperOffsets;\n  var referenceRect = state.rects.reference;\n  var popperRect = state.rects.popper;\n  var tetherOffsetValue = typeof tetherOffset === 'function' ? tetherOffset(Object.assign({}, state.rects, {\n    placement: state.placement\n  })) : tetherOffset;\n  var data = {\n    x: 0,\n    y: 0\n  };\n\n  if (!popperOffsets) {\n    return;\n  }\n\n  if (checkMainAxis || checkAltAxis) {\n    var mainSide = mainAxis === 'y' ? top : left;\n    var altSide = mainAxis === 'y' ? bottom : right;\n    var len = mainAxis === 'y' ? 'height' : 'width';\n    var offset = popperOffsets[mainAxis];\n    var min = popperOffsets[mainAxis] + overflow[mainSide];\n    var max = popperOffsets[mainAxis] - overflow[altSide];\n    var additive = tether ? -popperRect[len] / 2 : 0;\n    var minLen = variation === start ? referenceRect[len] : popperRect[len];\n    var maxLen = variation === start ? -popperRect[len] : -referenceRect[len]; // We need to include the arrow in the calculation so the arrow doesn't go\n    // outside the reference bounds\n\n    var arrowElement = state.elements.arrow;\n    var arrowRect = tether && arrowElement ? getLayoutRect(arrowElement) : {\n      width: 0,\n      height: 0\n    };\n    var arrowPaddingObject = state.modifiersData['arrow#persistent'] ? state.modifiersData['arrow#persistent'].padding : getFreshSideObject();\n    var arrowPaddingMin = arrowPaddingObject[mainSide];\n    var arrowPaddingMax = arrowPaddingObject[altSide]; // If the reference length is smaller than the arrow length, we don't want\n    // to include its full size in the calculation. If the reference is small\n    // and near the edge of a boundary, the popper can overflow even if the\n    // reference is not overflowing as well (e.g. virtual elements with no\n    // width or height)\n\n    var arrowLen = within(0, referenceRect[len], arrowRect[len]);\n    var minOffset = isBasePlacement ? referenceRect[len] / 2 - additive - arrowLen - arrowPaddingMin - tetherOffsetValue : minLen - arrowLen - arrowPaddingMin - tetherOffsetValue;\n    var maxOffset = isBasePlacement ? -referenceRect[len] / 2 + additive + arrowLen + arrowPaddingMax + tetherOffsetValue : maxLen + arrowLen + arrowPaddingMax + tetherOffsetValue;\n    var arrowOffsetParent = state.elements.arrow && getOffsetParent(state.elements.arrow);\n    var clientOffset = arrowOffsetParent ? mainAxis === 'y' ? arrowOffsetParent.clientTop || 0 : arrowOffsetParent.clientLeft || 0 : 0;\n    var offsetModifierValue = state.modifiersData.offset ? state.modifiersData.offset[state.placement][mainAxis] : 0;\n    var tetherMin = popperOffsets[mainAxis] + minOffset - offsetModifierValue - clientOffset;\n    var tetherMax = popperOffsets[mainAxis] + maxOffset - offsetModifierValue;\n\n    if (checkMainAxis) {\n      var preventedOffset = within(tether ? mathMin(min, tetherMin) : min, offset, tether ? mathMax(max, tetherMax) : max);\n      popperOffsets[mainAxis] = preventedOffset;\n      data[mainAxis] = preventedOffset - offset;\n    }\n\n    if (checkAltAxis) {\n      var _mainSide = mainAxis === 'x' ? top : left;\n\n      var _altSide = mainAxis === 'x' ? bottom : right;\n\n      var _offset = popperOffsets[altAxis];\n\n      var _min = _offset + overflow[_mainSide];\n\n      var _max = _offset - overflow[_altSide];\n\n      var _preventedOffset = within(tether ? mathMin(_min, tetherMin) : _min, _offset, tether ? mathMax(_max, tetherMax) : _max);\n\n      popperOffsets[altAxis] = _preventedOffset;\n      data[altAxis] = _preventedOffset - _offset;\n    }\n  }\n\n  state.modifiersData[name] = data;\n} // eslint-disable-next-line import/no-unused-modules\n\n\nexport default {\n  name: 'preventOverflow',\n  enabled: true,\n  phase: 'main',\n  fn: preventOverflow,\n  requiresIfExists: ['offset']\n};", "export default function getHTMLElementScroll(element) {\n  return {\n    scrollLeft: element.scrollLeft,\n    scrollTop: element.scrollTop\n  };\n}", "import getWindowScroll from \"./getWindowScroll.js\";\nimport getWindow from \"./getWindow.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getHTMLElementScroll from \"./getHTMLElementScroll.js\";\nexport default function getNodeScroll(node) {\n  if (node === getWindow(node) || !isHTMLElement(node)) {\n    return getWindowScroll(node);\n  } else {\n    return getHTMLElementScroll(node);\n  }\n}", "import getBoundingClientRect from \"./getBoundingClientRect.js\";\nimport getNodeScroll from \"./getNodeScroll.js\";\nimport getNodeName from \"./getNodeName.js\";\nimport { isHTMLElement } from \"./instanceOf.js\";\nimport getWindowScrollBarX from \"./getWindowScrollBarX.js\";\nimport getDocumentElement from \"./getDocumentElement.js\";\nimport isScrollParent from \"./isScrollParent.js\"; // Returns the composite rect of an element relative to its offsetParent.\n// Composite means it takes into account transforms as well as layout.\n\nexport default function getCompositeRect(elementOrVirtualElement, offsetParent, isFixed) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n\n  var documentElement = getDocumentElement(offsetParent);\n  var rect = getBoundingClientRect(elementOrVirtualElement);\n  var isOffsetParentAnElement = isHTMLElement(offsetParent);\n  var scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  var offsets = {\n    x: 0,\n    y: 0\n  };\n\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || // https://github.com/popperjs/popper-core/issues/1078\n    isScrollParent(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n\n    if (isHTMLElement(offsetParent)) {\n      offsets = getBoundingClientRect(offsetParent);\n      offsets.x += offsetParent.clientLeft;\n      offsets.y += offsetParent.clientTop;\n    } else if (documentElement) {\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n\n  return {\n    x: rect.left + scroll.scrollLeft - offsets.x,\n    y: rect.top + scroll.scrollTop - offsets.y,\n    width: rect.width,\n    height: rect.height\n  };\n}", "import { modifierPhases } from \"../enums.js\"; // source: https://stackoverflow.com/questions/49875255\n\nfunction order(modifiers) {\n  var map = new Map();\n  var visited = new Set();\n  var result = [];\n  modifiers.forEach(function (modifier) {\n    map.set(modifier.name, modifier);\n  }); // On visiting object, check for its dependencies and visit them recursively\n\n  function sort(modifier) {\n    visited.add(modifier.name);\n    var requires = [].concat(modifier.requires || [], modifier.requiresIfExists || []);\n    requires.forEach(function (dep) {\n      if (!visited.has(dep)) {\n        var depModifier = map.get(dep);\n\n        if (depModifier) {\n          sort(depModifier);\n        }\n      }\n    });\n    result.push(modifier);\n  }\n\n  modifiers.forEach(function (modifier) {\n    if (!visited.has(modifier.name)) {\n      // check for visited object\n      sort(modifier);\n    }\n  });\n  return result;\n}\n\nexport default function orderModifiers(modifiers) {\n  // order based on dependencies\n  var orderedModifiers = order(modifiers); // order based on phase\n\n  return modifierPhases.reduce(function (acc, phase) {\n    return acc.concat(orderedModifiers.filter(function (modifier) {\n      return modifier.phase === phase;\n    }));\n  }, []);\n}", "export default function debounce(fn) {\n  var pending;\n  return function () {\n    if (!pending) {\n      pending = new Promise(function (resolve) {\n        Promise.resolve().then(function () {\n          pending = undefined;\n          resolve(fn());\n        });\n      });\n    }\n\n    return pending;\n  };\n}", "export default function mergeByName(modifiers) {\n  var merged = modifiers.reduce(function (merged, current) {\n    var existing = merged[current.name];\n    merged[current.name] = existing ? Object.assign({}, existing, current, {\n      options: Object.assign({}, existing.options, current.options),\n      data: Object.assign({}, existing.data, current.data)\n    }) : current;\n    return merged;\n  }, {}); // IE11 does not support Object.values\n\n  return Object.keys(merged).map(function (key) {\n    return merged[key];\n  });\n}", "import getCompositeRect from \"./dom-utils/getCompositeRect.js\";\nimport getLayoutRect from \"./dom-utils/getLayoutRect.js\";\nimport listScrollParents from \"./dom-utils/listScrollParents.js\";\nimport getOffsetParent from \"./dom-utils/getOffsetParent.js\";\nimport getComputedStyle from \"./dom-utils/getComputedStyle.js\";\nimport orderModifiers from \"./utils/orderModifiers.js\";\nimport debounce from \"./utils/debounce.js\";\nimport validateModifiers from \"./utils/validateModifiers.js\";\nimport uniqueBy from \"./utils/uniqueBy.js\";\nimport getBasePlacement from \"./utils/getBasePlacement.js\";\nimport mergeByName from \"./utils/mergeByName.js\";\nimport detectOverflow from \"./utils/detectOverflow.js\";\nimport { isElement } from \"./dom-utils/instanceOf.js\";\nimport { auto } from \"./enums.js\";\nvar INVALID_ELEMENT_ERROR = 'Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.';\nvar INFINITE_LOOP_ERROR = 'Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.';\nvar DEFAULT_OPTIONS = {\n  placement: 'bottom',\n  modifiers: [],\n  strategy: 'absolute'\n};\n\nfunction areValidElements() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return !args.some(function (element) {\n    return !(element && typeof element.getBoundingClientRect === 'function');\n  });\n}\n\nexport function popperGenerator(generatorOptions) {\n  if (generatorOptions === void 0) {\n    generatorOptions = {};\n  }\n\n  var _generatorOptions = generatorOptions,\n      _generatorOptions$def = _generatorOptions.defaultModifiers,\n      defaultModifiers = _generatorOptions$def === void 0 ? [] : _generatorOptions$def,\n      _generatorOptions$def2 = _generatorOptions.defaultOptions,\n      defaultOptions = _generatorOptions$def2 === void 0 ? DEFAULT_OPTIONS : _generatorOptions$def2;\n  return function createPopper(reference, popper, options) {\n    if (options === void 0) {\n      options = defaultOptions;\n    }\n\n    var state = {\n      placement: 'bottom',\n      orderedModifiers: [],\n      options: Object.assign({}, DEFAULT_OPTIONS, defaultOptions),\n      modifiersData: {},\n      elements: {\n        reference: reference,\n        popper: popper\n      },\n      attributes: {},\n      styles: {}\n    };\n    var effectCleanupFns = [];\n    var isDestroyed = false;\n    var instance = {\n      state: state,\n      setOptions: function setOptions(options) {\n        cleanupModifierEffects();\n        state.options = Object.assign({}, defaultOptions, state.options, options);\n        state.scrollParents = {\n          reference: isElement(reference) ? listScrollParents(reference) : reference.contextElement ? listScrollParents(reference.contextElement) : [],\n          popper: listScrollParents(popper)\n        }; // Orders the modifiers based on their dependencies and `phase`\n        // properties\n\n        var orderedModifiers = orderModifiers(mergeByName([].concat(defaultModifiers, state.options.modifiers))); // Strip out disabled modifiers\n\n        state.orderedModifiers = orderedModifiers.filter(function (m) {\n          return m.enabled;\n        }); // Validate the provided modifiers so that the consumer will get warned\n        // if one of the modifiers is invalid for any reason\n\n        if (process.env.NODE_ENV !== \"production\") {\n          var modifiers = uniqueBy([].concat(orderedModifiers, state.options.modifiers), function (_ref) {\n            var name = _ref.name;\n            return name;\n          });\n          validateModifiers(modifiers);\n\n          if (getBasePlacement(state.options.placement) === auto) {\n            var flipModifier = state.orderedModifiers.find(function (_ref2) {\n              var name = _ref2.name;\n              return name === 'flip';\n            });\n\n            if (!flipModifier) {\n              console.error(['Popper: \"auto\" placements require the \"flip\" modifier be', 'present and enabled to work.'].join(' '));\n            }\n          }\n\n          var _getComputedStyle = getComputedStyle(popper),\n              marginTop = _getComputedStyle.marginTop,\n              marginRight = _getComputedStyle.marginRight,\n              marginBottom = _getComputedStyle.marginBottom,\n              marginLeft = _getComputedStyle.marginLeft; // We no longer take into account `margins` on the popper, and it can\n          // cause bugs with positioning, so we'll warn the consumer\n\n\n          if ([marginTop, marginRight, marginBottom, marginLeft].some(function (margin) {\n            return parseFloat(margin);\n          })) {\n            console.warn(['Popper: CSS \"margin\" styles cannot be used to apply padding', 'between the popper and its reference element or boundary.', 'To replicate margin, use the `offset` modifier, as well as', 'the `padding` option in the `preventOverflow` and `flip`', 'modifiers.'].join(' '));\n          }\n        }\n\n        runModifierEffects();\n        return instance.update();\n      },\n      // Sync update \u2013 it will always be executed, even if not necessary. This\n      // is useful for low frequency updates where sync behavior simplifies the\n      // logic.\n      // For high frequency updates (e.g. `resize` and `scroll` events), always\n      // prefer the async Popper#update method\n      forceUpdate: function forceUpdate() {\n        if (isDestroyed) {\n          return;\n        }\n\n        var _state$elements = state.elements,\n            reference = _state$elements.reference,\n            popper = _state$elements.popper; // Don't proceed if `reference` or `popper` are not valid elements\n        // anymore\n\n        if (!areValidElements(reference, popper)) {\n          if (process.env.NODE_ENV !== \"production\") {\n            console.error(INVALID_ELEMENT_ERROR);\n          }\n\n          return;\n        } // Store the reference and popper rects to be read by modifiers\n\n\n        state.rects = {\n          reference: getCompositeRect(reference, getOffsetParent(popper), state.options.strategy === 'fixed'),\n          popper: getLayoutRect(popper)\n        }; // Modifiers have the ability to reset the current update cycle. The\n        // most common use case for this is the `flip` modifier changing the\n        // placement, which then needs to re-run all the modifiers, because the\n        // logic was previously ran for the previous placement and is therefore\n        // stale/incorrect\n\n        state.reset = false;\n        state.placement = state.options.placement; // On each update cycle, the `modifiersData` property for each modifier\n        // is filled with the initial data specified by the modifier. This means\n        // it doesn't persist and is fresh on each update.\n        // To ensure persistent data, use `${name}#persistent`\n\n        state.orderedModifiers.forEach(function (modifier) {\n          return state.modifiersData[modifier.name] = Object.assign({}, modifier.data);\n        });\n        var __debug_loops__ = 0;\n\n        for (var index = 0; index < state.orderedModifiers.length; index++) {\n          if (process.env.NODE_ENV !== \"production\") {\n            __debug_loops__ += 1;\n\n            if (__debug_loops__ > 100) {\n              console.error(INFINITE_LOOP_ERROR);\n              break;\n            }\n          }\n\n          if (state.reset === true) {\n            state.reset = false;\n            index = -1;\n            continue;\n          }\n\n          var _state$orderedModifie = state.orderedModifiers[index],\n              fn = _state$orderedModifie.fn,\n              _state$orderedModifie2 = _state$orderedModifie.options,\n              _options = _state$orderedModifie2 === void 0 ? {} : _state$orderedModifie2,\n              name = _state$orderedModifie.name;\n\n          if (typeof fn === 'function') {\n            state = fn({\n              state: state,\n              options: _options,\n              name: name,\n              instance: instance\n            }) || state;\n          }\n        }\n      },\n      // Async and optimistically optimized update \u2013 it will not be executed if\n      // not necessary (debounced to run at most once-per-tick)\n      update: debounce(function () {\n        return new Promise(function (resolve) {\n          instance.forceUpdate();\n          resolve(state);\n        });\n      }),\n      destroy: function destroy() {\n        cleanupModifierEffects();\n        isDestroyed = true;\n      }\n    };\n\n    if (!areValidElements(reference, popper)) {\n      if (process.env.NODE_ENV !== \"production\") {\n        console.error(INVALID_ELEMENT_ERROR);\n      }\n\n      return instance;\n    }\n\n    instance.setOptions(options).then(function (state) {\n      if (!isDestroyed && options.onFirstUpdate) {\n        options.onFirstUpdate(state);\n      }\n    }); // Modifiers have the ability to execute arbitrary code before the first\n    // update cycle runs. They will be executed in the same order as the update\n    // cycle. This is useful when a modifier adds some persistent data that\n    // other modifiers need to use, but the modifier is run after the dependent\n    // one.\n\n    function runModifierEffects() {\n      state.orderedModifiers.forEach(function (_ref3) {\n        var name = _ref3.name,\n            _ref3$options = _ref3.options,\n            options = _ref3$options === void 0 ? {} : _ref3$options,\n            effect = _ref3.effect;\n\n        if (typeof effect === 'function') {\n          var cleanupFn = effect({\n            state: state,\n            name: name,\n            instance: instance,\n            options: options\n          });\n\n          var noopFn = function noopFn() {};\n\n          effectCleanupFns.push(cleanupFn || noopFn);\n        }\n      });\n    }\n\n    function cleanupModifierEffects() {\n      effectCleanupFns.forEach(function (fn) {\n        return fn();\n      });\n      effectCleanupFns = [];\n    }\n\n    return instance;\n  };\n}\nexport var createPopper = /*#__PURE__*/popperGenerator(); // eslint-disable-next-line import/no-unused-modules\n\nexport { detectOverflow };", "import { popperGenerator, detectOverflow } from \"./createPopper.js\";\nimport eventListeners from \"./modifiers/eventListeners.js\";\nimport popperOffsets from \"./modifiers/popperOffsets.js\";\nimport computeStyles from \"./modifiers/computeStyles.js\";\nimport applyStyles from \"./modifiers/applyStyles.js\";\nimport offset from \"./modifiers/offset.js\";\nimport flip from \"./modifiers/flip.js\";\nimport preventOverflow from \"./modifiers/preventOverflow.js\";\nimport arrow from \"./modifiers/arrow.js\";\nimport hide from \"./modifiers/hide.js\";\nvar defaultModifiers = [eventListeners, popperOffsets, computeStyles, applyStyles, offset, flip, preventOverflow, arrow, hide];\nvar createPopper = /*#__PURE__*/popperGenerator({\n  defaultModifiers: defaultModifiers\n}); // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper, popperGenerator, defaultModifiers, detectOverflow }; // eslint-disable-next-line import/no-unused-modules\n\nexport { createPopper as createPopperLite } from \"./popper-lite.js\"; // eslint-disable-next-line import/no-unused-modules\n\nexport * from \"./modifiers/index.js\";", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { HighImpedance, isHighImpedance, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { DrawContext } from \"./Drawable\"\n\nexport const TriStateBufferDef =\n    defineComponent(2, 1, t.type({\n        type: t.literal(\"TRI\"),\n    }, \"TriStateBuffer\"))\n\nconst enum INPUT {\n    In, Enable,\n}\n\nconst enum OUTPUT {\n    Out\n}\n\nconst GRID_WIDTH = 7\nconst GRID_HEIGHT = 4\n\nexport type TriStateBufferRepr = typeof TriStateBufferDef.reprType\n\nexport class TriStateBuffer extends ComponentBase<2, 1, TriStateBufferRepr, LogicValue> {\n\n    public constructor(editor: LogicEditor, savedData: TriStateBufferRepr | null) {\n        super(editor, HighImpedance, savedData, {\n            ins: [\n                [\"In\", -4, 0, \"w\"],\n                [\"E (Enable)\", 0, -3, \"n\"],\n            ],\n            outs: [[\"Out\", +4, 0, \"e\"]],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"TRI\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get componentType() {\n        return \"gate\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(\n            div(S.Components.TriStateBuffer.tooltip) // TODO\n        ))\n    }\n\n    protected doRecalcValue(): LogicValue {\n        const en = this.inputs[INPUT.Enable].value\n        if (isUnknown(en) || isHighImpedance(en)) {\n            return Unknown\n        }\n        if (!en) {\n            return HighImpedance\n        }\n        const i = this.inputs[INPUT.In].value\n        if (isHighImpedance(i)) {\n            return Unknown\n        }\n        return i\n    }\n\n    protected override propagateValue(newValue: LogicValue) {\n        this.outputs[OUTPUT.Out].value = newValue\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        // const right = left + width\n        const top = this.posY - height / 2\n        const bottom = top + height\n\n        if (ctx.isMouseOver) {\n            const frameWidth = 2\n            const frameMargin = 2\n            g.lineWidth = frameWidth\n            g.strokeStyle = COLOR_MOUSE_OVER\n            g.beginPath()\n            g.rect(\n                left - frameWidth - frameMargin,\n                top - frameWidth - frameMargin,\n                width + 2 * (frameWidth + frameMargin),\n                height + 2 * (frameWidth + frameMargin)\n            )\n            g.stroke()\n        }\n\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        const gateWidth = (2 * Math.max(2, this.inputs.length)) * GRID_STEP\n        const gateLeft = this.posX - gateWidth / 2\n        const gateRight = this.posX + gateWidth / 2\n\n        g.beginPath()\n        g.moveTo(gateLeft, top)\n        g.lineTo(gateRight, this.posY)\n        g.lineTo(gateLeft, bottom)\n        g.closePath()\n        g.stroke()\n\n        drawWireLineToComponent(g, this.inputs[INPUT.In], gateLeft - 1, this.inputs[INPUT.In].posYInParentTransform)\n        drawWireLineToComponent(g, this.inputs[INPUT.Enable], this.inputs[INPUT.Enable].posXInParentTransform, this.posY - height / 4 - 1)\n        drawWireLineToComponent(g, this.outputs[OUTPUT.Out], gateRight + 1, this.posY)\n    }\n\n\n}\n", "import * as t from \"io-ts\"\nimport { circle, ColorString, COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_DARK_RED, COLOR_GATE_NAMES, COLOR_MOUSE_OVER, COLOR_UNKNOWN, drawWireLineToComponent, GRID_STEP, PATTERN_STRIPED_GRAY } from \"../drawutils\"\nimport { asValue, b, cls, div, emptyMod, Modifier, ModifierObject, mods, table, tbody, td, th, thead, tooltipContent, tr } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArraySizeNonZero, isDefined, isHighImpedance, isString, isUndefined, isUnknown, LogicValue, Mode, RichStringEnum, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentRepr, defineComponent, NodeVisuals } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { TriStateBuffer, TriStateBufferDef } from \"./TriStateBuffer\"\n\n\nexport type GateProps = {\n    includeInContextMenu: boolean\n    includeInPoseAs: boolean\n    fullShortDesc: () => [string, string | undefined, string]\n}\n\n\n// Gates with one input\n\nconst Gate1Types_ = {\n    NOT: {\n        out: (in1: boolean) => !in1,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.NOT,\n    },\n    BUF: {\n        out: (in1: boolean) => in1,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.BUF,\n    },\n} as const\n\nexport const Gate1Types = RichStringEnum.withProps<GateProps & {\n    out: (in1: boolean) => boolean\n}>()(Gate1Types_)\n\nexport type Gate1Type = typeof Gate1Types.type\n\nconst Gate1MandatoryParams = t.type({\n    type: t.keyof(Gate1Types_),\n})\ntype Gate1MandatoryParams = t.TypeOf<typeof Gate1MandatoryParams>\n\n\n// Gates with two inputs\n\nexport const Gate2Types_ = {\n    // usual suspects\n    AND: {\n        out: (in1: boolean, in2: boolean) => in1 && in2,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.AND,\n    },\n    OR: {\n        out: (in1: boolean, in2: boolean) => in1 || in2,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.OR,\n    },\n    XOR: {\n        out: (in1: boolean, in2: boolean) => in1 !== in2,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.XOR,\n    },\n    NAND: {\n        out: (in1: boolean, in2: boolean) => !(in1 && in2),\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.NAND,\n    },\n    NOR: {\n        out: (in1: boolean, in2: boolean) => !(in1 || in2),\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.NOR,\n    },\n    XNOR: {\n        out: (in1: boolean, in2: boolean) => in1 === in2,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.XNOR,\n    },\n\n    // less common gates\n    IMPLY: {\n        out: (in1: boolean, in2: boolean) => !in1 || in2,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.IMPLY,\n    },\n    RIMPLY: {\n        out: (in1: boolean, in2: boolean) => in1 || !in2,\n        includeInContextMenu: false, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.RIMPLY,\n    },\n    NIMPLY: {\n        out: (in1: boolean, in2: boolean) => in1 && !in2,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.NIMPLY,\n    },\n    RNIMPLY: {\n        out: (in1: boolean, in2: boolean) => !in1 && in2,\n        includeInContextMenu: false, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.RNIMPLY,\n    },\n\n    // observing only one input\n    TXA: {\n        out: (in1: boolean, __: boolean) => in1,\n        includeInContextMenu: true, includeInPoseAs: false,\n        fullShortDesc: () => S.Components.Gate.TXA,\n    },\n    TXB: {\n        out: (__: boolean, in2: boolean) => in2,\n        includeInContextMenu: false, includeInPoseAs: false,\n        fullShortDesc: () => S.Components.Gate.TXB,\n    },\n    TXNA: {\n        out: (in1: boolean, __: boolean) => !in1,\n        includeInContextMenu: false, includeInPoseAs: false,\n        fullShortDesc: () => S.Components.Gate.TXNA,\n    },\n    TXNB: {\n        out: (__: boolean, in2: boolean) => !in2,\n        includeInContextMenu: false, includeInPoseAs: false,\n        fullShortDesc: () => S.Components.Gate.TXNB,\n    },\n} as const\n\nexport type Gate2Props = GateProps & {\n    out: (in1: boolean, in2: boolean) => boolean\n}\n\nexport const Gate2Types = RichStringEnum.withProps<Gate2Props>()(Gate2Types_)\n\nexport type Gate2Type = typeof Gate2Types.type\n\nconst Gate2MandatoryParams = t.type({\n    type: t.keyof(Gate2Types_),\n})\ntype Gate2MandatoryParams = t.TypeOf<typeof Gate2MandatoryParams>\n\n\n\n// Gates with three inputs\n\nconst Gate3Types_ = {\n    AND3: {\n        out: (in1: boolean, in2: boolean, in3: boolean) => in1 && in2 && in3,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.AND3,\n    },\n    OR3: {\n        out: (in1: boolean, in2: boolean, in3: boolean) => in1 || in2 || in3,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.OR3,\n    },\n    XOR3: {\n        out: (in1: boolean, in2: boolean, in3: boolean) => (Number(in1) + Number(in2) + Number(in3)) % 2 === 1,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.XOR3,\n    },\n    NAND3: {\n        out: (in1: boolean, in2: boolean, in3: boolean) => !(in1 && in2 && in3),\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.NAND3,\n    },\n    NOR3: {\n        out: (in1: boolean, in2: boolean, in3: boolean) => !(in1 || in2 || in3),\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.NOR3,\n    },\n    XNOR3: {\n        out: (in1: boolean, in2: boolean, in3: boolean) => (Number(in1) + Number(in2) + Number(in3)) % 2 === 0,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.XNOR3,\n    },\n} as const\n\nexport const Gate3Types = RichStringEnum.withProps<GateProps & {\n    out: (in1: boolean, in2: boolean, in3: boolean) => boolean\n}>()(Gate3Types_)\n\nexport type Gate3Type = typeof Gate3Types.type\n\nconst Gate3MandatoryParams = t.type({\n    type: t.keyof(Gate3Types_),\n})\ntype Gate3MandatoryParams = t.TypeOf<typeof Gate3MandatoryParams>\n\n\n\n// Gates with four inputs\n\nconst Gate4Types_ = {\n    AND4: {\n        out: (in1: boolean, in2: boolean, in3: boolean, in4: boolean) => in1 && in2 && in3 && in4,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.AND4,\n    },\n    OR4: {\n        out: (in1: boolean, in2: boolean, in3: boolean, in4: boolean) => in1 || in2 || in3 || in4,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.OR4,\n    },\n    XOR4: {\n        out: (in1: boolean, in2: boolean, in3: boolean, in4: boolean) => (Number(in1) + Number(in2) + Number(in3) + Number(in4)) % 2 === 1,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.XOR4,\n    },\n    NAND4: {\n        out: (in1: boolean, in2: boolean, in3: boolean, in4: boolean) => !(in1 && in2 && in3 && in4),\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.NAND4,\n    },\n    NOR4: {\n        out: (in1: boolean, in2: boolean, in3: boolean, in4: boolean) => !(in1 || in2 || in3 || in4),\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.NOR4,\n    },\n    XNOR4: {\n        out: (in1: boolean, in2: boolean, in3: boolean, in4: boolean) => (Number(in1) + Number(in2) + Number(in3) + Number(in4)) % 2 === 0,\n        includeInContextMenu: true, includeInPoseAs: true,\n        fullShortDesc: () => S.Components.Gate.XNOR4,\n    },\n} as const\n\nexport const Gate4Types = RichStringEnum.withProps<GateProps & {\n    out: (in1: boolean, in2: boolean, in3: boolean, in4: boolean) => boolean\n}>()(Gate4Types_)\n\nexport type Gate4Type = typeof Gate4Types.type\n\nconst Gate4MandatoryParams = t.type({\n    type: t.keyof(Gate4Types_),\n})\ntype Gate4MandatoryParams = t.TypeOf<typeof Gate4MandatoryParams>\n\n\n// Putting all gates together\n\nexport type GateType = Gate2Type | Gate1Type | Gate3Type | Gate4Type\nexport const GateTypes = {\n    isValue: (str: string | null | undefined): str is GateType => {\n        return Gate2Types.isValue(str) || Gate1Types.isValue(str) || Gate3Types.isValue(str) || Gate4Types.isValue(str)\n    },\n}\n\n\n\ntype GateMandatoryParams<G extends GateType> = { type: G }\n\nconst Gate2Def = defineComponent(2, 1, Gate2MandatoryParams)\nconst Gate1Def = defineComponent(1, 1, Gate1MandatoryParams)\nconst Gate3Def = defineComponent(3, 1, Gate3MandatoryParams)\nconst Gate4Def = defineComponent(4, 1, Gate4MandatoryParams)\n\nexport const GateDef = t.union([\n    Gate2Def.repr,\n    Gate1Def.repr,\n    Gate3Def.repr,\n    Gate4Def.repr,\n    TriStateBufferDef.repr,\n], \"Gate\")\n\n\ntype GateRepr<N extends FixedArraySizeNonZero, G extends GateType> = ComponentRepr<N, 1> & GateMandatoryParams<G> & {\n    poseAs?: G | undefined\n    showAsUnknown: boolean | undefined\n}\n\nconst GRID_WIDTH_1_2 = 7\nconst GRID_HEIGHT_1_2 = 4\n\nconst GRID_WIDTH_3 = 9\nconst GRID_HEIGHT_3 = 6\n\nconst GRID_WIDTH_4 = 11\nconst GRID_HEIGHT_4 = 8\n\nexport type Gate = GateBase<GateType, any, GateRepr<any, GateType>>\n\nexport abstract class GateBase<\n    G extends GateType,\n    NumInput extends FixedArraySizeNonZero,\n    Repr extends GateRepr<NumInput, G>\n    > extends ComponentBase<NumInput, 1, Repr, LogicValue> {\n\n    private _type: G\n    private _poseAs: G | undefined = undefined\n    private _showAsUnknown = false\n\n    protected constructor(editor: LogicEditor, savedData: Repr | GateMandatoryParams<G>, nodeOffsets: NodeVisuals<NumInput, 1>) {\n        super(editor, false, \"in\" in savedData ? savedData : null, nodeOffsets)\n        this._type = savedData.type\n        if (\"poseAs\" in savedData) {\n            this._poseAs = savedData.poseAs\n        }\n        if (\"showAsUnknown\" in savedData) {\n            this._showAsUnknown = savedData.showAsUnknown ?? false\n        }\n    }\n\n    protected override toJSONBase() {\n        return {\n            type: this._type,\n            ...super.toJSONBase(),\n            showAsUnknown: (this._showAsUnknown) ? true : undefined,\n            poseAs: this._poseAs,\n        }\n    }\n\n    public get componentType() {\n        return \"gate\" as const\n    }\n\n    public get type() {\n        return this._type\n    }\n\n    protected doSetType(newType: G) {\n        this._type = newType\n        this.setNeedsRecalc()\n        this.setNeedsRedraw(\"gate type changed\")\n    }\n\n    public get poseAs() {\n        return this._poseAs\n    }\n\n    public set poseAs(newPoseAs: G | undefined) {\n        if (newPoseAs !== this._poseAs) {\n            this._poseAs = newPoseAs\n            this.setNeedsRedraw(\"gate display changed\")\n        }\n    }\n\n    public get showAsUnknown() {\n        return this._showAsUnknown\n    }\n\n    private doSetShowAsUnknown(newUnknown: boolean) {\n        this._showAsUnknown = newUnknown\n        this.setNeedsRedraw(\"display as unknown changed\")\n    }\n\n    protected override toStringDetails(): string {\n        return this.type\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH_1_2 * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT_1_2 * GRID_STEP\n    }\n\n    protected override propagateValue(newValue: LogicValue) {\n        this.outputs[0].value = newValue\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        const gateType = this._showAsUnknown\n            ? Unknown\n            : this.poseAs ?? this.type\n        this.drawGate(g, gateType, gateType !== this.type && !this._showAsUnknown, ctx)\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent) {\n        if (this.editor.mode >= Mode.FULL && e.altKey) {\n            this.doSetShowAsUnknown(!this._showAsUnknown)\n            return true\n        }\n        return false\n    }\n\n    protected drawGate(g: CanvasRenderingContext2D, type: G | Unknown, isFake: boolean, ctx: DrawContext) {\n        const output = this.outputs[0]\n\n        const width = this.unrotatedWidth\n        const height = this.unrotatedHeight\n        const left = this.posX - width / 2\n        const top = this.posY - height / 2\n        const bottom = this.posY + height / 2\n        const pi2 = Math.PI / 2\n\n        if (ctx.isMouseOver) {\n            const frameWidth = 2\n            const frameMargin = 2\n            g.lineWidth = frameWidth\n            g.strokeStyle = COLOR_MOUSE_OVER\n            g.beginPath()\n            g.rect(\n                left - frameWidth - frameMargin,\n                top - frameWidth - frameMargin,\n                width + 2 * (frameWidth + frameMargin),\n                height + 2 * (frameWidth + frameMargin)\n            )\n            g.stroke()\n        }\n\n        const gateWidth = (2 * Math.max(2, this.inputs.length)) * GRID_STEP\n        let gateLeft = this.posX - gateWidth / 2\n        let gateRight = this.posX + gateWidth / 2\n        let nameDeltaX = 0\n\n        const drawRightCircle = () => {\n            gateRight += 5\n            g.beginPath()\n            circle(g, gateRight, this.posY, 8)\n            g.fillStyle = COLOR_BACKGROUND\n            g.fill()\n            g.stroke()\n            gateRight += 4\n        }\n        const drawLeftCircle = (up: boolean) => {\n            g.beginPath()\n            circle(g, gateLeft - 5, this.posY - (up ? 1 : -1) * GRID_STEP, 8)\n            g.fillStyle = COLOR_BACKGROUND\n            g.fill()\n            g.stroke()\n        }\n        const drawWireEnds = (shortUp = false, shortDown = false, isORLike = false) => {\n            const numInputs = this.inputs.length\n            for (let i = 0; i < numInputs; i++) {\n                const input = this.inputs[i]\n                const short = i === 0 ? shortUp : shortDown\n                let rightEnd = gateLeft - 1\n                if (short) {\n                    rightEnd -= 9\n                }\n                if (isORLike) {\n                    if (numInputs === 3) {\n                        rightEnd += 3\n                        if (i === 1) {\n                            rightEnd += 4\n                        }\n                    } else if (numInputs === 4) {\n                        rightEnd += 3\n                        if (i === 1 || i === 2) {\n                            rightEnd += 8\n                        }\n                    }\n                }\n                drawWireLineToComponent(g, input, rightEnd, input.posYInParentTransform)\n            }\n            drawWireLineToComponent(g, output, gateRight + 1, this.posY)\n        }\n\n        const showAsFake = isFake && this.editor.mode >= Mode.FULL\n        const gateBorderColor: ColorString = showAsFake ? COLOR_DARK_RED : COLOR_COMPONENT_BORDER\n        const gateFill = showAsFake ? PATTERN_STRIPED_GRAY : COLOR_BACKGROUND\n        g.lineWidth = 3\n        g.strokeStyle = gateBorderColor\n        g.fillStyle = gateFill\n        g.beginPath()\n\n        switch (type) {\n            case \"NOT\":\n            case \"BUF\":\n                g.moveTo(gateLeft, top)\n                g.lineTo(gateRight, this.posY)\n                g.lineTo(gateLeft, bottom)\n                g.closePath()\n                g.fill()\n                g.stroke()\n                if (type === \"NOT\") {\n                    drawRightCircle()\n                }\n                drawWireEnds()\n                nameDeltaX -= 6\n                break\n\n\n\n            case \"AND\":\n            case \"AND3\":\n            case \"AND4\":\n            case \"NAND\":\n            case \"NAND3\":\n            case \"NAND4\":\n            case \"NIMPLY\":\n            case \"RNIMPLY\": {\n                g.moveTo(this.posX, bottom)\n                g.lineTo(gateLeft, bottom)\n                g.lineTo(gateLeft, top)\n                g.lineTo(this.posX, top)\n                g.arc(this.posX, this.posY, height / 2, -pi2, pi2)\n                g.closePath()\n                g.fill()\n                g.lineWidth = 1\n                g.stroke()\n                g.strokeStyle = gateBorderColor\n                g.lineWidth = 3\n                g.stroke()\n                g.beginPath()\n                if (type.startsWith(\"NAND\")) {\n                    drawRightCircle()\n                }\n                let shortUp = false, shortDown = false\n                if (type === \"NIMPLY\") {\n                    drawLeftCircle(false)\n                    shortDown = true\n                } else if (type === \"RNIMPLY\") {\n                    drawLeftCircle(true)\n                    shortUp = true\n                }\n                drawWireEnds(shortUp, shortDown)\n                nameDeltaX -= 1\n                break\n            }\n\n\n\n            case \"OR\":\n            case \"OR3\":\n            case \"OR4\":\n            case \"NOR\":\n            case \"NOR3\":\n            case \"NOR4\":\n            case \"XOR\":\n            case \"XOR3\":\n            case \"XOR4\":\n            case \"XNOR\":\n            case \"XNOR3\":\n            case \"XNOR4\":\n            case \"IMPLY\":\n            case \"RIMPLY\": {\n                g.beginPath()\n                g.moveTo(gateLeft, top)\n                g.lineTo(this.posX - 15, top)\n                g.bezierCurveTo(this.posX + 10, top, gateRight - 5, this.posY - 8,\n                    gateRight, this.posY)\n                g.bezierCurveTo(gateRight - 5, this.posY + 8, this.posX + 10, bottom,\n                    this.posX - 15, bottom)\n                g.lineTo(gateLeft, bottom)\n                g.quadraticCurveTo(this.posX - 8, this.posY, gateLeft, top)\n                g.closePath()\n                g.fill()\n                g.stroke()\n                const savedGateLeft = gateLeft\n                gateLeft += 4\n                if (type.startsWith(\"NOR\") || type.startsWith(\"XNOR\")) {\n                    drawRightCircle()\n                }\n                let shortUp = false, shortDown = false\n                if (type === \"IMPLY\") {\n                    drawLeftCircle(true)\n                    shortUp = true\n                } else if (type === \"RIMPLY\") {\n                    drawLeftCircle(false)\n                    shortDown = true\n                }\n                if (type.startsWith(\"X\")) {\n                    gateLeft = savedGateLeft - 2\n                    g.beginPath()\n                    g.moveTo(savedGateLeft - 6, bottom)\n                    g.quadraticCurveTo(this.posX - 14, this.posY, savedGateLeft - 6, top)\n                    g.lineWidth = 3\n                    g.strokeStyle = gateBorderColor\n                    g.stroke()\n                }\n                drawWireEnds(shortUp, shortDown, true)\n                nameDeltaX -= 1\n                break\n            }\n\n            case \"TXA\":\n            case \"TXNA\": {\n                g.beginPath()\n                g.moveTo(gateLeft, bottom)\n                g.lineTo(gateLeft, top)\n                g.lineTo(gateRight, this.posY)\n                g.lineTo(gateLeft + 2, this.posY)\n                g.fill()\n                g.stroke()\n                let shortLeft = false\n                if (type === \"TXNA\") {\n                    drawLeftCircle(true)\n                    shortLeft = true\n                }\n                drawWireEnds(shortLeft, false)\n                break\n            }\n\n            case \"TXB\":\n            case \"TXNB\": {\n                g.beginPath()\n                g.moveTo(gateLeft, top)\n                g.lineTo(gateLeft, bottom)\n                g.lineTo(gateRight, this.posY)\n                g.lineTo(gateLeft + 2, this.posY)\n                g.fill()\n                g.stroke()\n                let shortLeft = false\n                if (type === \"TXNB\") {\n                    drawLeftCircle(false)\n                    shortLeft = true\n                }\n                drawWireEnds(false, shortLeft)\n                break\n            }\n\n            case \"?\":\n                g.strokeStyle = COLOR_UNKNOWN\n                g.beginPath()\n                g.moveTo(gateLeft, top)\n                g.lineTo(gateRight, top)\n                g.lineTo(gateRight, bottom)\n                g.lineTo(gateLeft, bottom)\n                g.closePath()\n                g.fill()\n                g.stroke()\n                g.lineWidth = 0\n                drawWireEnds()\n\n                ctx.inNonTransformedFrame(() => {\n                    g.fillStyle = COLOR_UNKNOWN\n                    g.textAlign = \"center\"\n                    g.font = \"bold 20px sans-serif\"\n                    g.fillText('?', this.posX, this.posY)\n                })\n                break\n        }\n\n        if (this.editor.options.showGateTypes && !isUnknown(type)) {\n            const gateShortName = this.gateTypeEnum.propsOf(type).fullShortDesc()[1]\n            if (isDefined(gateShortName)) {\n                g.fillStyle = COLOR_GATE_NAMES\n                g.textAlign = \"center\"\n                g.font = \"bold 13px sans-serif\"\n                const oldTransform = g.getTransform()\n                g.translate(this.posX + nameDeltaX, this.posY)\n                g.scale(0.65, 1)\n                g.fillText(gateShortName, 0, 0)\n                g.setTransform(oldTransform)\n            }\n        }\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            [\"start\", this.makeReplaceByMenuItem()],\n        ]\n        if (this.editor.mode >= Mode.FULL) {\n            items.push(\n                [\"mid\", this.makePoseAsMenuItem()],\n            )\n            const forceOutputItem = this.makeForceOutputsContextMenuItem()\n            if (isDefined(forceOutputItem)) {\n                items.push(\n                    [\"mid\", forceOutputItem]\n                )\n            }\n        }\n        return items\n    }\n\n    protected abstract get gateTypeEnum(): RichStringEnum<G, GateProps>\n\n    private makeReplaceByMenuItem(): ContextMenuItem {\n        const enumDef = this.gateTypeEnum\n        const s = S.Components.Gate.contextMenu\n        const otherTypes = enumDef.values.filter(t => t !== this._type && enumDef.propsOf(t).includeInContextMenu)\n        return ContextMenuData.submenu(\"replace\", s.ReplaceBy, [\n            ...otherTypes.map(newType => {\n                const gateProps = enumDef.propsOf(newType)\n                return ContextMenuData.item(undefined, s.GateTempl.expand({ type: gateProps.fullShortDesc()[0] }), () => {\n                    this.doSetType(newType)\n                })\n            }),\n            ContextMenuData.sep(),\n            ContextMenuData.text(s.VariantChangeDesc),\n        ])\n    }\n\n    private makePoseAsMenuItem(): ContextMenuItem {\n        const enumDef = this.gateTypeEnum\n        const s = S.Components.Gate.contextMenu\n        const otherTypes = enumDef.values.filter(t => t !== this._type && enumDef.propsOf(t).includeInPoseAs)\n        const currentShowAsUnknown = this._showAsUnknown\n        const currentPoseAs = this.poseAs\n        return ContextMenuData.submenu(\"questioncircled\", s.ShowAs, [\n            ContextMenuData.item(!currentShowAsUnknown && isUndefined(currentPoseAs) ? \"check\" : \"none\",\n                s.NormalGateTempl.expand({ type: enumDef.propsOf(this._type).fullShortDesc()[0] }), () => {\n                    this.poseAs = undefined\n                    this.doSetShowAsUnknown(false)\n                }),\n            ContextMenuData.item(currentShowAsUnknown ? \"check\" : \"none\",\n                s.UnknownGate, () => {\n                    this.poseAs = undefined\n                    this.doSetShowAsUnknown(true)\n                }),\n            ContextMenuData.sep(),\n            ...otherTypes.map(newType => {\n                const gateProps = enumDef.propsOf(newType)\n                return ContextMenuData.item(!currentShowAsUnknown && newType === currentPoseAs ? \"check\" : \"none\",\n                    s.GateTempl.expand({ type: gateProps.fullShortDesc()[0] }), () => {\n                        this.doSetShowAsUnknown(false)\n                        this.poseAs = newType\n                    })\n            }),\n        ])\n    }\n\n}\n\n\n\ntype Gate1Repr = GateRepr<1, Gate1Type>\nexport class Gate1 extends GateBase<Gate1Type, 1, Gate1Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Gate1Repr | Gate1MandatoryParams) {\n        super(editor, savedData, {\n            ins: [[undefined, -4, 0, \"w\"]],\n            outs: [[undefined, +4, 0, \"e\"]],\n        })\n    }\n\n    public toJSON() {\n        return super.toJSONBase()\n    }\n\n    protected get gateTypeEnum() {\n        return Gate1Types\n    }\n\n    protected doRecalcValue(): LogicValue {\n        const in0 = this.inputs[0].value\n        if (isUnknown(in0) || isHighImpedance(in0)) {\n            return Unknown\n        }\n        const gateProps = Gate1Types.propsOf(this.type)\n        return gateProps.out(in0)\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.Gate.tooltip\n        if (this.showAsUnknown) {\n            return div(s.UnknownGate)\n        }\n\n        const myIn = this.inputs[0].value\n        const myOut = this.value\n\n        const gateProps = Gate1Types.propsOf(this.type)\n\n        const genTruthTableData = () => {\n            const header = [s.Input, s.Output]\n            const rows: TruthTableRowData[] = []\n            for (const in0 of [false, true]) {\n                const matchesCurrent = myIn === in0\n                const out = gateProps.out(in0)\n                rows.push({ matchesCurrent, cells: [in0, out] })\n            }\n            return [header, rows] as const\n        }\n\n        const nodeOut = this.outputs[0].value\n        const desc = nodeOut === myOut\n            ? s.CurrentlyDelivers\n            : s.ShouldCurrentlyDeliver\n\n        const explanation = isUnknown(myIn)\n            ? mods(desc + \" \" + s.UndeterminedOutputBecauseInputUnknown)\n            : mods(desc + \" \" + s.ThisOutput + \" \", asValue(myOut), \" \" + s.BecauseInputIs + \" \", asValue(myIn), \", \" + s.AccordingToTruthTable)\n\n        const header = (() => {\n            switch (this.type) {\n                case \"NOT\": return mods(s.Inverter[0], b(S.Components.Gate.NOT[0]), s.Inverter[1])\n                case \"BUF\": return mods(s.Buffer[0], b(S.Components.Gate.BUF[0]), s.Buffer[1])\n            }\n        })()\n\n        return makeGateTooltip(1,\n            header,\n            Gate1Types.propsOf(this.type).fullShortDesc()[2],\n            explanation,\n            makeTruthTable(genTruthTableData())\n        )\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseDoubleClicked(e)) {\n            return true // already handled\n        }\n        if (this.editor.mode >= Mode.DESIGN) {\n            this.doSetType(this.type === \"BUF\" ? \"NOT\" : \"BUF\")\n            return true\n        }\n        return false\n    }\n\n}\n\ntype Gate2Repr = GateRepr<2, Gate2Type>\nexport class Gate2 extends GateBase<Gate2Type, 2, Gate2Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Gate2Repr | Gate2MandatoryParams) {\n        super(editor, savedData, {\n            ins: [\n                [undefined, -4, -1, \"w\", \"In\"],\n                [undefined, -4, +1, \"w\", \"In\"],\n            ],\n            outs: [[undefined, +4, 0, \"e\"]],\n        })\n    }\n\n    public toJSON() {\n        return super.toJSONBase()\n    }\n\n    protected get gateTypeEnum() {\n        return Gate2Types\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.Gate.tooltip\n        if (this.showAsUnknown) {\n            return div(s.UnknownGate)\n        }\n\n        const gateProps = Gate2Types.propsOf(this.type)\n        const myIn0 = this.inputs[0].value\n        const myIn1 = this.inputs[1].value\n        const myOut = this.value\n\n        const genTruthTableData = () => {\n            const header = [s.Input + \" 1\", s.Input + \" 2\", s.Output]\n            const rows: TruthTableRowData[] = []\n            for (const in0 of [false, true]) {\n                for (const in1 of [false, true]) {\n                    const matchesCurrent = myIn0 === in0 && myIn1 === in1\n                    const out = gateProps.out(in0, in1)\n                    rows.push({ matchesCurrent, cells: [in0, in1, out] })\n                }\n            }\n            return [header, rows] as const\n        }\n\n        const nodeOut = this.outputs[0].value\n        const desc = nodeOut === myOut\n            ? s.CurrentlyDelivers\n            : s.ShouldCurrentlyDeliver\n\n        const gateIsUnspecified = isUnknown(myIn0) || isUnknown(myIn1)\n        const explanation = gateIsUnspecified\n            ? mods(desc + \" \" + s.UndeterminedOutputBecauseInputsUnknown)\n            : mods(desc + \" \" + s.ThisOutput + \" \", asValue(myOut), \" \" + s.AccordingToTruthTable)\n\n        const fullShortDesc = gateProps.fullShortDesc()\n        return makeGateTooltip(2,\n            s.GateTitle(b(fullShortDesc[0])),\n            fullShortDesc[2],\n            explanation,\n            makeTruthTable(genTruthTableData())\n        )\n\n    }\n\n    protected doRecalcValue(): LogicValue {\n        const in1 = this.inputs[0].value\n        const in2 = this.inputs[1].value\n        if (isUnknown(in1) || isUnknown(in2) || isHighImpedance(in1) || isHighImpedance(in2)) {\n            return Unknown\n        }\n        const gateProps = Gate2Types.propsOf(this.type)\n        return gateProps.out(in1, in2)\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseDoubleClicked(e)) {\n            return true // already handled\n        }\n        if (this.editor.mode >= Mode.DESIGN) {\n            // switch to IMPLY / NIMPLY variant\n            const newType = (() => {\n                switch (this.type) {\n                    case \"IMPLY\": return \"RIMPLY\"\n                    case \"RIMPLY\": return \"IMPLY\"\n\n                    case \"NIMPLY\": return \"RNIMPLY\"\n                    case \"RNIMPLY\": return \"NIMPLY\"\n\n                    case \"TXA\": return \"TXB\"\n                    case \"TXB\": return \"TXNA\"\n                    case \"TXNA\": return \"TXNB\"\n                    case \"TXNB\": return \"TXA\"\n\n                    default: return undefined\n                }\n            })()\n            if (isDefined(newType)) {\n                this.doSetType(newType)\n                return true\n            }\n        }\n        return false\n    }\n\n}\n\n\n\ntype Gate3Repr = GateRepr<3, Gate3Type>\nexport class Gate3 extends GateBase<Gate3Type, 3, Gate3Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Gate3Repr | Gate3MandatoryParams) {\n        super(editor, savedData, {\n            ins: [\n                [undefined, -5, -2, \"w\", \"In\"],\n                [undefined, -5, 0, \"w\", \"In\"],\n                [undefined, -5, +2, \"w\", \"In\"],\n            ],\n            outs: [[undefined, +5, 0, \"e\"]],\n        })\n    }\n\n    public toJSON() {\n        return super.toJSONBase()\n    }\n\n    protected get gateTypeEnum() {\n        return Gate3Types\n    }\n\n    public override get unrotatedWidth() {\n        return GRID_WIDTH_3 * GRID_STEP\n    }\n\n    public override get unrotatedHeight() {\n        return GRID_HEIGHT_3 * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.Gate.tooltip\n        if (this.showAsUnknown) {\n            return div(s.UnknownGate)\n        }\n\n        const gateProps = Gate3Types.propsOf(this.type)\n        const myIn0 = this.inputs[0].value\n        const myIn1 = this.inputs[1].value\n        const myIn2 = this.inputs[2].value\n        const myOut = this.value\n\n        const genTruthTableData = () => {\n            const header = [s.Input + \" 1\", s.Input + \" 2\", s.Input + \" 3\", s.Output]\n\n            const rows: TruthTableRowData[] = []\n            for (const in0 of [false, true]) {\n                for (const in1 of [false, true]) {\n                    for (const in2 of [false, true]) {\n                        const matchesCurrent = myIn0 === in0 && myIn1 === in1 && myIn2 === in2\n                        const out = gateProps.out(in0, in1, in2)\n                        rows.push({ matchesCurrent, cells: [in0, in1, in2, out] })\n                    }\n                }\n            }\n            return [header, rows] as const\n        }\n\n        const nodeOut = this.outputs[0].value\n        const desc = nodeOut === myOut\n            ? s.CurrentlyDelivers\n            : s.ShouldCurrentlyDeliver\n\n        const gateIsUnspecified = isUnknown(myIn0) || isUnknown(myIn1)\n        const explanation = gateIsUnspecified\n            ? mods(desc + \" \" + s.UndeterminedOutputBecauseInputsUnknown)\n            : mods(desc + \" \" + s.ThisOutput + \" \", asValue(myOut), \" \" + s.AccordingToTruthTable)\n\n        const fullShortDesc = gateProps.fullShortDesc()\n        return makeGateTooltip(3,\n            s.GateTitle(b(fullShortDesc[0])),\n            fullShortDesc[2],\n            explanation,\n            makeTruthTable(genTruthTableData())\n        )\n\n    }\n\n    protected doRecalcValue(): LogicValue {\n        const in0 = this.inputs[0].value\n        const in1 = this.inputs[1].value\n        const in2 = this.inputs[2].value\n        if (isUnknown(in0) || isUnknown(in1) || isUnknown(in2) || isHighImpedance(in0) || isHighImpedance(in1) || isHighImpedance(in2)) {\n            return Unknown\n        }\n        const gateProps = Gate3Types.propsOf(this.type)\n        return gateProps.out(in0, in1, in2)\n    }\n\n}\n\n\n\ntype Gate4Repr = GateRepr<4, Gate4Type>\nexport class Gate4 extends GateBase<Gate4Type, 4, Gate4Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Gate4Repr | Gate4MandatoryParams) {\n        super(editor, savedData, {\n            ins: [\n                [undefined, -6, -3, \"w\", \"In\"],\n                [undefined, -6, -1, \"w\", \"In\"],\n                [undefined, -6, +1, \"w\", \"In\"],\n                [undefined, -6, +3, \"w\", \"In\"],\n            ],\n            outs: [[undefined, +6, 0, \"e\"]],\n        })\n    }\n\n    public toJSON() {\n        return super.toJSONBase()\n    }\n\n    protected get gateTypeEnum() {\n        return Gate4Types\n    }\n\n    public override get unrotatedWidth() {\n        return GRID_WIDTH_4 * GRID_STEP\n    }\n\n    public override get unrotatedHeight() {\n        return GRID_HEIGHT_4 * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.Gate.tooltip\n        if (this.showAsUnknown) {\n            return div(s.UnknownGate)\n        }\n\n        const gateProps = Gate4Types.propsOf(this.type)\n        const myIn0 = this.inputs[0].value\n        const myIn1 = this.inputs[1].value\n        const myIn2 = this.inputs[2].value\n        const myIn3 = this.inputs[3].value\n        const myOut = this.value\n\n        const genTruthTableData = () => {\n            const header = [s.Input + \" 1\", s.Input + \" 2\", s.Input + \" 3\", s.Input + \" 4\", s.Output]\n            const rows: TruthTableRowData[] = []\n            for (const in0 of [false, true]) {\n                for (const in1 of [false, true]) {\n                    for (const in2 of [false, true]) {\n                        for (const in3 of [false, true]) {\n                            const matchesCurrent = myIn0 === in0 && myIn1 === in1 && myIn2 === in2 && myIn3 === in3\n                            const out = gateProps.out(in0, in1, in2, in3)\n                            rows.push({ matchesCurrent, cells: [in0, in1, in2, in3, out] })\n                        }\n                    }\n                }\n            }\n            return [header, rows] as const\n        }\n\n        const nodeOut = this.outputs[0].value\n        const desc = nodeOut === myOut\n            ? s.CurrentlyDelivers\n            : s.ShouldCurrentlyDeliver\n\n        const gateIsUnspecified = isUnknown(myIn0) || isUnknown(myIn1)\n        const explanation = gateIsUnspecified\n            ? mods(desc + \" \" + s.UndeterminedOutputBecauseInputsUnknown)\n            : mods(desc + \" \" + s.ThisOutput + \" \", asValue(myOut), \" \" + s.AccordingToTruthTable)\n\n        const fullShortDesc = gateProps.fullShortDesc()\n        return makeGateTooltip(4,\n            s.GateTitle(b(fullShortDesc[0])),\n            fullShortDesc[2],\n            explanation,\n            makeTruthTable(genTruthTableData())\n        )\n    }\n\n    protected doRecalcValue(): LogicValue {\n        const in0 = this.inputs[0].value\n        const in1 = this.inputs[1].value\n        const in2 = this.inputs[2].value\n        const in3 = this.inputs[3].value\n        if (isUnknown(in0) || isUnknown(in1) || isUnknown(in2) || isUnknown(in3) || isHighImpedance(in0) || isHighImpedance(in1) || isHighImpedance(in2) || isHighImpedance(in3)) {\n            return Unknown\n        }\n        const gateProps = Gate4Types.propsOf(this.type)\n        return gateProps.out(in0, in1, in2, in3)\n    }\n\n}\n\n\n// Truth table generation helpers\n\ntype TruthTableRowData = { matchesCurrent: boolean, cells: boolean[] }\nconst makeTruthTable = ([header, rows]: readonly [string[], TruthTableRowData[]]) => {\n    const htmlRows = rows.map(({ matchesCurrent, cells }) =>\n        tr(matchesCurrent ? cls(\"current\") : emptyMod, ...cells.map(v => td(asValue(v))))\n    )\n    return table(cls(\"truth-table\"),\n        thead(tr(...header.map(title =>\n            th(title))\n        )),\n        tbody(...htmlRows)\n    )\n}\nconst makeGateTooltip = (nInput: number, title: Modifier, description: Modifier, explanation: Modifier, truthTable: Modifier): ModifierObject => {\n    const maxWidth = 200 + (Math.max(0, nInput - 2)) * 50\n    return tooltipContent(title, mods(div(description), div(explanation), div(truthTable)), maxWidth)\n}\n\nexport const GateFactory = {\n\n    make: <N extends FixedArraySizeNonZero>(editor: LogicEditor, savedDataOrType: GateRepr<N, GateType> | string | undefined) => {\n        let gateParams\n        let blank = true\n        if (isUndefined(savedDataOrType)) {\n            gateParams = { type: \"NAND\" }\n        } else if (isString(savedDataOrType)) {\n            gateParams = { type: savedDataOrType }\n        } else {\n            gateParams = savedDataOrType\n            blank = false\n        }\n        if (Gate1Types.isValue(gateParams.type)) {\n            const sameSavedDataWithBetterTyping = { ...gateParams, type: gateParams.type }\n            return new Gate1(editor, sameSavedDataWithBetterTyping)\n        } else if (Gate2Types.isValue(gateParams.type)) {\n            const sameSavedDataWithBetterTyping = { ...gateParams, type: gateParams.type }\n            return new Gate2(editor, sameSavedDataWithBetterTyping)\n        } else if (Gate3Types.isValue(gateParams.type)) {\n            const sameSavedDataWithBetterTyping = { ...gateParams, type: gateParams.type }\n            return new Gate3(editor, sameSavedDataWithBetterTyping)\n        } else if (Gate4Types.isValue(gateParams.type)) {\n            const sameSavedDataWithBetterTyping = { ...gateParams, type: gateParams.type }\n            return new Gate4(editor, sameSavedDataWithBetterTyping)\n        } else if (gateParams.type === \"TRI\") {\n            return new TriStateBuffer(editor, blank ? null : savedDataOrType as any)\n        }\n        return undefined\n    },\n\n}\n", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isHighImpedance, isUndefined, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\nconst GRID_WIDTH = 7\nconst GRID_HEIGHT = 5\n\nconst enum INPUT {\n    A, B, Cin\n}\n\nconst enum OUTPUT {\n    S, Cout\n}\n\nexport const AdderDef =\n    defineComponent(3, 2, t.type({\n        type: t.literal(\"adder\"),\n    }, \"Adder\"))\n\nexport type AdderRepr = typeof AdderDef.reprType\n\nexport class Adder extends ComponentBase<3, 2, AdderRepr, [LogicValue, LogicValue]> {\n\n    public constructor(editor: LogicEditor, savedData: AdderRepr | null) {\n        super(editor, [false, false], savedData, {\n            ins: [\n                [\"A\", -2, -4, \"n\"],\n                [\"B\", 2, -4, \"n\"],\n                [S.Components.Generic.InputCarryInDesc, 5, 0, \"e\"],\n            ],\n            outs: [\n                [S.Components.Generic.OutputSumDesc, 0, 4, \"s\"],\n                [S.Components.Generic.OutputCarryOutDesc, -5, 0, \"w\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"adder\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(S.Components.Adder.caption, mods(\n            div(S.Components.Adder.tooltip),\n        ))\n    }\n\n    protected doRecalcValue(): [LogicValue, LogicValue] {\n        const a = this.inputs[INPUT.A].value\n        const b = this.inputs[INPUT.B].value\n        const cIn = this.inputs[INPUT.Cin].value\n\n        if (isUnknown(a) || isUnknown(b) || isUnknown(cIn) || isHighImpedance(a) || isHighImpedance(b) || isHighImpedance(cIn)) {\n            return [Unknown, Unknown]\n        }\n\n        const sum = (+a) + (+b) + (+cIn)\n        switch (sum) {\n            case 0: return [false, false]\n            case 1: return [true, false]\n            case 2: return [false, true]\n            case 3: return [true, true]\n            default:\n                console.log(\"ERROR: sum of adder is > 3\")\n                return [false, false]\n        }\n    }\n\n    protected override propagateValue(newValue: [LogicValue, LogicValue]) {\n        this.outputs[OUTPUT.S].value = newValue[OUTPUT.S]\n        this.outputs[OUTPUT.Cout].value = newValue[OUTPUT.Cout]\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.lineWidth = 3\n        if (ctx.isMouseOver) {\n            g.strokeStyle = COLOR_MOUSE_OVER\n        } else {\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n        }\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        drawWireLineToComponent(g, this.inputs[INPUT.A], this.inputs[INPUT.A].posXInParentTransform, this.posY - height / 2 - 2, true)\n        drawWireLineToComponent(g, this.inputs[INPUT.B], this.inputs[INPUT.B].posXInParentTransform, this.posY - height / 2 - 2, true)\n        drawWireLineToComponent(g, this.inputs[INPUT.Cin], this.posX + width / 2 + 2, this.inputs[INPUT.Cin].posYInParentTransform, true)\n\n\n        drawWireLineToComponent(g, this.outputs[OUTPUT.S], this.outputs[OUTPUT.S].posXInParentTransform, this.posY + height / 2 + 2, true)\n        drawWireLineToComponent(g, this.outputs[OUTPUT.Cout], this.posX - width / 2 - 2, this.outputs[OUTPUT.Cout].posYInParentTransform, true)\n\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.textAlign = \"center\"\n            g.font = \"11px sans-serif\"\n\n            const top = this.posY - height / 2\n            const bottom = this.posY + height / 2\n            const right = this.posX + width / 2\n            const left = this.posX - width / 2\n\n            drawLabel(ctx, this.orient, \"A\", \"n\", this.inputs[INPUT.A], top)\n            drawLabel(ctx, this.orient, \"B\", \"n\", this.inputs[INPUT.B], top)\n            drawLabel(ctx, this.orient, \"Cin\", \"e\", right, this.inputs[INPUT.Cin])\n\n            drawLabel(ctx, this.orient, \"S\", \"s\", this.outputs[OUTPUT.S], bottom)\n            drawLabel(ctx, this.orient, \"Cout\", \"w\", left, this.outputs[OUTPUT.Cout])\n\n            g.fillStyle = COLOR_COMPONENT_BORDER\n            g.font = \"bold 30px sans-serif\"\n            g.textAlign = \"center\"\n            g.textBaseline = \"middle\"\n            g.fillText(\"+\", this.posX, this.posY - 2)\n        })\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isUndefined(forceOutputItem)) {\n            return []\n        }\n        return [\n            [\"mid\", forceOutputItem],\n        ]\n    }\n\n\n}", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedReadonlyArray, HighImpedance, isBoolean, isDefined, isHighImpedance, isNotNull, isUndefined, isUnknown, LogicValue, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext, Orientation } from \"./Drawable\"\n\nconst GRID_WIDTH = 6\nconst GRID_HEIGHT = 19\n\nconst INPUT = {\n    A: [0, 1, 2, 3] as const,\n    B: [4, 5, 6, 7] as const,\n    Op: [8, 9] as const,\n    Cin: 10,\n}\n\nconst OUTPUT = {\n    S: [0, 1, 2, 3] as const,\n    V: 4,\n    Z: 5,\n    Cout: 6,\n}\n\n\nexport const ALUDef =\n    defineComponent(11, 7, t.type({\n        type: t.literal(\"alu\"),\n        showOp: typeOrUndefined(t.boolean),\n    }, \"ALU\"))\n\nexport type ALURepr = typeof ALUDef.reprType\n\nexport type ALUOp = \"add\" | \"sub\" | \"and\" | \"or\"\nexport const ALUOp = {\n    shortName(op: ALUOp): string {\n        return S.Components.ALU[op][0]\n    },\n    fullName(op: ALUOp): string {\n        return S.Components.ALU[op][1]\n    },\n}\n\nconst ALUDefaults = {\n    showOp: true,\n}\n\nexport class ALU extends ComponentBase<11, 7, ALURepr, [FixedArray<LogicValue, 4>, LogicValue, LogicValue, LogicValue]> {\n\n    private _showOp = ALUDefaults.showOp\n\n    public constructor(editor: LogicEditor, savedData: ALURepr | null) {\n        super(editor, [[false, false, false, false], false, true, false], savedData, {\n            ins: [\n                // A\n                [\"A0\", -4, -8, \"w\", \"A\"],\n                [\"A1\", -4, -6, \"w\", \"A\"],\n                [\"A2\", -4, -4, \"w\", \"A\"],\n                [\"A3\", -4, -2, \"w\", \"A\"],\n                // B\n                [\"B0\", -4, 2, \"w\", \"B\"],\n                [\"B1\", -4, 4, \"w\", \"B\"],\n                [\"B2\", -4, 6, \"w\", \"B\"],\n                [\"B3\", -4, 8, \"w\", \"B\"],\n                [\"Op0\", 2, -10, \"n\", \"Op\"],\n                [\"Op1\", 0, -10, \"n\", \"Op\"],\n                [`Cin (${S.Components.ALU.InputCinDesc})`, -2, -10, \"n\"],\n            ],\n            outs: [\n                [\"S0\", 4, -3, \"e\", \"S\"],\n                [\"S1\", 4, -1, \"e\", \"S\"],\n                [\"S2\", 4, 1, \"e\", \"S\"],\n                [\"S3\", 4, 3, \"e\", \"S\"],\n                [\"V (oVerflow)\", 0, 10, \"s\"],\n                [\"Z (Zero)\", 2, 10, \"s\"],\n                [`Cout (${S.Components.ALU.OutputCoutDesc})`, -2, 10, \"s\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._showOp = savedData.showOp ?? ALUDefaults.showOp\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"alu\" as const,\n            ...this.toJSONBase(),\n            showOp: (this._showOp !== ALUDefaults.showOp) ? this._showOp : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        const op = this.op\n        const s = S.Components.ALU.tooltip\n        const opDesc = isUnknown(op) ? s.SomeUnknownOperation : s.ThisOperation + \" \" + ALUOp.fullName(op)\n        return tooltipContent(s.title, mods(\n            div(`${s.CurrentlyCarriesOut} ${opDesc}.`)\n        ))\n    }\n\n    public get op(): ALUOp | Unknown {\n        const op1 = this.inputs[INPUT.Op[1]].value\n        const op0 = this.inputs[INPUT.Op[0]].value\n        switch (op1) {\n            case false: // arithmetic\n                switch (op0) {\n                    case false: // 00\n                        return \"add\"\n                    case true: // 01\n                        return \"sub\"\n                    case Unknown:\n                    case HighImpedance:\n                        return Unknown\n                }\n                break\n            case true: // logic\n                switch (op0) {\n                    case false: // 10\n                        return \"or\" // opcode logic: \"only one 1 needed\"\n                    case true: // 11\n                        return \"and\"// opcode logic: \"two 1s needed\"\n                    case Unknown:\n                    case HighImpedance:\n                        return Unknown\n                }\n                break\n            case Unknown:\n            case HighImpedance:\n                return Unknown\n        }\n    }\n\n    protected doRecalcValue(): [FixedArray<LogicValue, 4>, LogicValue, LogicValue, LogicValue] {\n        const op = this.op\n\n        if (isUnknown(op)) {\n            return [[Unknown, Unknown, Unknown, Unknown], Unknown, Unknown, Unknown]\n        }\n\n        const a = this.inputValues<4>(INPUT.A)\n        const b = this.inputValues<4>(INPUT.B)\n        const cin = this.inputs[INPUT.Cin].value\n\n        return doALUOp(op, a, b, cin)\n    }\n\n    protected override propagateValue(newValue: [FixedArray<LogicValue, 4>, LogicValue, LogicValue, LogicValue]) {\n        for (let i = 0; i < OUTPUT.S.length; i++) {\n            this.outputs[OUTPUT.S[i]].value = newValue[0][i]\n        }\n        this.outputs[OUTPUT.V].value = newValue[1]\n        this.outputs[OUTPUT.Z].value = newValue[2]\n        this.outputs[OUTPUT.Cout].value = newValue[3]\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = this.posX + width / 2\n        const top = this.posY - height / 2\n        const bottom = this.posY + height / 2\n\n        // inputs\n        for (let i = 0; i < INPUT.A.length; i++) {\n            const inputi = this.inputs[INPUT.A[i]]\n            drawWireLineToComponent(g, inputi, left, inputi.posYInParentTransform)\n        }\n        for (let i = 0; i < INPUT.B.length; i++) {\n            const inputi = this.inputs[INPUT.B[i]]\n            drawWireLineToComponent(g, inputi, left, inputi.posYInParentTransform)\n        }\n        drawWireLineToComponent(g, this.inputs[INPUT.Op[1]], this.inputs[INPUT.Op[1]].posXInParentTransform, top + 9)\n        drawWireLineToComponent(g, this.inputs[INPUT.Op[0]], this.inputs[INPUT.Op[0]].posXInParentTransform, top + 17)\n        drawWireLineToComponent(g, this.inputs[INPUT.Cin], this.inputs[INPUT.Cin].posXInParentTransform, top + 3)\n\n        // outputs\n        for (let i = 0; i < OUTPUT.S.length; i++) {\n            const outputi = this.outputs[OUTPUT.S[i]]\n            drawWireLineToComponent(g, outputi, right, outputi.posYInParentTransform)\n        }\n        drawWireLineToComponent(g, this.outputs[OUTPUT.Z], this.outputs[OUTPUT.Z].posXInParentTransform, bottom - 17)\n        drawWireLineToComponent(g, this.outputs[OUTPUT.V], this.outputs[OUTPUT.V].posXInParentTransform, bottom - 9)\n        drawWireLineToComponent(g, this.outputs[OUTPUT.Cout], this.outputs[OUTPUT.Cout].posXInParentTransform, bottom - 3)\n\n\n        // outline\n        g.fillStyle = COLOR_BACKGROUND\n        g.lineWidth = 3\n        if (ctx.isMouseOver) {\n            g.strokeStyle = COLOR_MOUSE_OVER\n        } else {\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n        }\n\n        g.beginPath()\n        g.moveTo(left, top)\n        g.lineTo(right, top + 2 * GRID_STEP)\n        g.lineTo(right, bottom - 2 * GRID_STEP)\n        g.lineTo(left, bottom)\n        g.lineTo(left, this.posY + 1 * GRID_STEP)\n        g.lineTo(left + 2 * GRID_STEP, this.posY)\n        g.lineTo(left, this.posY - 1 * GRID_STEP)\n        g.closePath()\n        g.fill()\n        g.stroke()\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            // bottom outputs\n            const carryHOffsetF = Orientation.isVertical(this.orient) ? 0 : 1\n            drawLabel(ctx, this.orient, \"Z\", \"s\", this.outputs[OUTPUT.Z], bottom - 17)\n            drawLabel(ctx, this.orient, \"V\", \"s\", this.outputs[OUTPUT.V].posXInParentTransform + carryHOffsetF * 2, bottom - 11, this.outputs[OUTPUT.V])\n            drawLabel(ctx, this.orient, \"Cout\", \"s\", this.outputs[OUTPUT.Cout].posXInParentTransform + carryHOffsetF * 4, bottom - 8, this.outputs[OUTPUT.Cout])\n\n            // top inputs\n            drawLabel(ctx, this.orient, \"Cin\", \"n\", this.inputs[INPUT.Cin].posXInParentTransform + carryHOffsetF * 2, top + 5, this.inputs[INPUT.Cin])\n\n            g.font = \"bold 12px sans-serif\"\n            drawLabel(ctx, this.orient, \"Op\", \"n\", this.inputs[INPUT.Op[0]].posXInParentTransform - GRID_STEP, top + 15, this.inputs[INPUT.Op[0]])\n\n            // left inputs\n            g.font = \"bold 14px sans-serif\"\n            drawLabel(ctx, this.orient, \"A\", \"w\", left, top + 4 * GRID_STEP + 6, this.inputs[INPUT.A[0]])\n            drawLabel(ctx, this.orient, \"B\", \"w\", left, bottom - 4 * GRID_STEP - 6, this.inputs[INPUT.B[0]])\n\n            // right outputs\n            drawLabel(ctx, this.orient, \"S\", \"e\", right, this.posY, this.outputs[OUTPUT.S[0]])\n\n            if (this._showOp) {\n                const opName = isUnknown(this.op) ? \"??\" : ALUOp.shortName(this.op)\n                const size = opName.length === 1 ? 25 : 13\n                g.font = `bold ${size}px sans-serif`\n                g.fillStyle = COLOR_COMPONENT_BORDER\n                g.textAlign = \"center\"\n                g.textBaseline = \"middle\"\n                g.fillText(opName, ...ctx.rotatePoint(this.posX + 4, this.posY))\n            }\n        })\n    }\n\n    private doSetShowOp(showOp: boolean) {\n        this._showOp = showOp\n        this.setNeedsRedraw(\"show op changed\")\n    }\n\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        const icon = this._showOp ? \"check\" : \"none\"\n        const toggleShowOpItem = ContextMenuData.item(icon, S.Components.ALU.contextMenu.toggleShowOp, () => {\n            this.doSetShowOp(!this._showOp)\n        })\n\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            [\"mid\", toggleShowOpItem],\n        ]\n\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isDefined(forceOutputItem)) {\n            items.push(\n                [\"mid\", forceOutputItem]\n            )\n        }\n\n        return items\n    }\n\n}\n\n\nexport function doALUOp(op: string, a: FixedReadonlyArray<LogicValue, 4>, b: FixedReadonlyArray<LogicValue, 4>, cin: LogicValue): [FixedArray<LogicValue, 4>, LogicValue, LogicValue, LogicValue] {\n\n    function allZeros(vals: LogicValue[]): LogicValue {\n        for (const v of vals) {\n            if (isUnknown(v) || isHighImpedance(v)) {\n                return Unknown\n            }\n            if (v === true) {\n                return false\n            }\n        }\n        return true\n    }\n\n    const y: LogicValue[] = [Unknown, Unknown, Unknown, Unknown]\n    let v: LogicValue = Unknown\n    let cout: LogicValue = Unknown\n\n    switch (op) {\n        case \"add\": {\n            const sum3bits = (a: LogicValue, b: LogicValue, c: LogicValue): [LogicValue, LogicValue] => {\n                const asNumber = (v: LogicValue) => v === true ? 1 : 0\n                const numUnset = (isUnknown(a) || isHighImpedance(a) ? 1 : 0) + (isUnknown(b) || isHighImpedance(a) ? 1 : 0) + (isUnknown(c) || isHighImpedance(a) ? 1 : 0)\n                const sum = asNumber(a) + asNumber(b) + asNumber(c)\n\n                if (numUnset === 0) {\n                    // we know exactly\n                    return [sum % 2 === 1, sum >= 2]\n                }\n                if (numUnset === 1 && sum >= 2) {\n                    // carry will always be set\n                    return [Unknown, true]\n                }\n                // At this point, could be anything\n                return [Unknown, Unknown]\n\n            }\n            const cins: FixedArray<LogicValue, 5> = [cin, Unknown, Unknown, Unknown, Unknown]\n            for (let i = 0; i < a.length; i++) {\n                const [s, cout] = sum3bits(cins[i], a[i], b[i])\n                y[i] = s\n                cins[i + 1] = cout\n            }\n            cout = cins[4]\n            if (isBoolean(cout) && isBoolean(cins[2])) {\n                v = cout !== cins[3]\n            }\n            break\n        }\n\n        case \"sub\": {\n            // TODO set oVerflow for subtraction!\n            // TODO use Cin as borrow in!\n            const toInt = (vs: readonly LogicValue[]): number | undefined => {\n                let s = 0\n                let col = 1\n                for (const v of vs) {\n                    if (isUnknown(v)) {\n                        return undefined\n                    }\n                    s += Number(v) * col\n                    col *= 2\n                }\n                return s\n            }\n\n            const aInt = toInt(a)\n            const bInt = toInt(b)\n            if (!isUndefined(aInt) && !isUndefined(bInt) && isBoolean(cin)) {\n                // otherwise, stick with default Unset values everywhere\n                let yInt = aInt - bInt - (cin ? 1 : 0)\n                // console.log(`${aInt} - ${bInt} = ${yInt}`)\n                // we can get anything from (max - (-min)) = 7 - (-8) = 15\n                // to (min - max) = -8 - 7 = -15\n                if (yInt < 0) {\n                    yInt += 16\n                }\n                // now we have everything between 0 and 15\n                const yBinStr = (yInt >>> 0).toString(2).padStart(4, '0')\n                for (let i = 0; i < 4; i++) {\n                    y[i] = yBinStr[3 - i] === '1'\n                }\n\n                cout = bInt > (aInt - (cin ? 1 : 0))\n\n                const aNeg = a[3] === true // NOT redundant comparison\n                const bNeg = b[3] === true\n                const yNeg = y[3] === true\n\n                // see https://stackoverflow.com/a/34547815/390581\n                // Signed integer overflow of the expression x-y-c (where c is again 0 or 1)\n                // occurs if and only if x and y have opposite signs, and the sign of the \n                // result is opposite to that of x (or, equivalently, the same as that of y).\n                v = aNeg !== bNeg && aNeg !== yNeg\n            }\n            break\n        }\n\n        // below, we need the '=== true' and '=== false' parts\n        // to distinguish also the Unset case\n        case \"and\": {\n            for (let i = 0; i < a.length; i++) {\n                if (a[i] === false || b[i] === false) {\n                    y[i] = false\n                } else if (a[i] === true && b[i] === true) {\n                    y[i] = true\n                } else {\n                    y[i] = Unknown\n                }\n            }\n            cout = false\n            v = false\n            break\n        }\n\n        case \"or\": {\n            for (let i = 0; i < a.length; i++) {\n                if (a[i] === true || b[i] === true) {\n                    y[i] = true\n                } else if (a[i] === false && b[i] === false) {\n                    y[i] = false\n                } else {\n                    y[i] = Unknown\n                }\n            }\n            cout = false\n            v = false\n            break\n        }\n    }\n\n    const z = allZeros(y)\n    return [y as any as FixedArray<LogicValue, 4>, v, z, cout]\n}", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isHighImpedance, isUndefined, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\nconst GRID_WIDTH = 5\nconst GRID_HEIGHT = 7\n\nconst enum INPUT {\n    A, B, E\n}\n\nconst enum OUTPUT {\n    G, Eq\n}\n\nexport const ComparatorDef =\n    defineComponent(3, 2, t.type({\n        type: t.literal(\"comparator\"),\n    }, \"Compatator\"))\n\nexport type ComparatorRepr = typeof ComparatorDef.reprType\n\nexport class Comparator extends ComponentBase<3, 2, ComparatorRepr, [LogicValue, LogicValue]> {\n\n    public constructor(editor: LogicEditor, savedData: ComparatorRepr | null) {\n        super(editor, [false, false], savedData, {\n            ins: [\n                [\"A\", -4, 2, \"w\"],\n                [\"B\", -4, -2, \"w\"],\n                [\"E\", 0, 5, \"s\"],\n            ],\n            outs: [\n                [\"G\", 4, 0, \"e\"],\n                [\"Eq\", 0, -5, \"n\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"comparator\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(S.Components.Comparator.caption, mods(\n            div(S.Components.Comparator.tooltip),\n        ))\n    }\n\n    protected doRecalcValue(): [LogicValue, LogicValue] {\n        const a = this.inputs[INPUT.A].value\n        const b = this.inputs[INPUT.B].value\n        const e = this.inputs[INPUT.E].value\n\n        if (isUnknown(a) || isUnknown(b) || isUnknown(e) || isHighImpedance(a) || isHighImpedance(b) || isHighImpedance(e)) {\n            return [Unknown, Unknown]\n        }\n\n        if ((+e) === 0) {\n            return [false, false]\n        }\n\n        const g = ((+a) > (+b))\n        const eq = ((+a) === (+b))\n\n        return [g, eq]\n    }\n\n    protected override propagateValue(newValue: [LogicValue, LogicValue]) {\n        this.outputs[OUTPUT.G].value = newValue[OUTPUT.G]\n        this.outputs[OUTPUT.Eq].value = newValue[OUTPUT.Eq]\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.lineWidth = 3\n        if (ctx.isMouseOver) {\n            g.strokeStyle = COLOR_MOUSE_OVER\n        } else {\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n        }\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        drawWireLineToComponent(g, this.inputs[INPUT.A], this.posX - width / 2 - 2, this.inputs[INPUT.A].posYInParentTransform, true)\n        drawWireLineToComponent(g, this.inputs[INPUT.B], this.posX - width / 2 - 2, this.inputs[INPUT.B].posYInParentTransform, true)\n        drawWireLineToComponent(g, this.inputs[INPUT.E], this.inputs[INPUT.E].posXInParentTransform, this.posY + height / 2 + 6, true)\n\n\n        drawWireLineToComponent(g, this.outputs[OUTPUT.G], this.posX + width / 2 + 2, this.outputs[OUTPUT.G].posYInParentTransform, true)\n        drawWireLineToComponent(g, this.outputs[OUTPUT.Eq], this.outputs[OUTPUT.Eq].posXInParentTransform, this.posY - height / 2 - 2, true)\n\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.textAlign = \"center\"\n            g.font = \"11px sans-serif\"\n\n            const top = this.posY - height / 2\n            const bottom = this.posY + height / 2\n            const right = this.posX + width / 2\n            const left = this.posX - width / 2\n\n            drawLabel(ctx, this.orient, \"A\", \"w\", left, this.inputs[INPUT.A])\n            drawLabel(ctx, this.orient, \"B\", \"w\", left, this.inputs[INPUT.B])\n            drawLabel(ctx, this.orient, \"E\", \"s\", this.inputs[INPUT.E], bottom)\n\n            drawLabel(ctx, this.orient, \">\", \"e\", right, this.outputs[OUTPUT.G])\n            drawLabel(ctx, this.orient, \"=\", \"n\", this.outputs[OUTPUT.Eq], top)\n\n            g.fillStyle = COLOR_COMPONENT_BORDER\n            g.font = \"bold 11px sans-serif\"\n            g.textAlign = \"center\"\n            g.textBaseline = \"middle\"\n            g.fillText(\"CMP\", this.posX, this.posY)\n        })\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isUndefined(forceOutputItem)) {\n            return []\n        }\n        return [\n            [\"mid\", forceOutputItem],\n        ]\n    }\n\n\n}\n", "import * as t from \"io-ts\"\nimport { colorForBoolean, COLOR_BACKGROUND, COLOR_BACKGROUND_INVALID, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, drawLabel, drawRoundValue, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArraySize, FixedArraySizeNonZero, isDefined, isNotNull, isNull, LogicValue, LogicValueRepr, Plus3, toLogicValue, toLogicValueRepr, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentRepr, defineComponent, NodeVisuals } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { NodeIn } from \"./Node\"\n\nconst GRID_WIDTH = 5\nconst GRID_HEIGHT = 7\n\nexport function defineFlipflopOrLatch<NumInputs extends FixedArraySize, N extends string, P extends t.Props>(numInputs: NumInputs, jsonName: N, className: string, props: P) {\n    return defineComponent(numInputs, 2, t.type({\n        type: t.literal(jsonName),\n        state: typeOrUndefined(LogicValueRepr),\n        showContent: typeOrUndefined(t.boolean),\n        ...props,\n    }, className))\n}\n\nexport type FlipflopOrLatchRepr<NumInputs extends FixedArraySize> =\n    ComponentRepr<NumInputs, 2> & {\n    state: LogicValueRepr | undefined\n    showContent: boolean | undefined\n}\n\nconst FlipflorOrLatchDefaults = {\n    showContent: true,\n}\n\nexport const enum OUTPUT {\n    Q, Qb\n}\n\nexport abstract class FlipflopOrLatch<\n    NumInputs extends FixedArraySize,\n    Repr extends FlipflopOrLatchRepr<NumInputs>,\n> extends ComponentBase<NumInputs, 2, Repr, [LogicValue, LogicValue]> {\n\n    private static savedStateFrom(savedData: { state: LogicValueRepr | undefined } | null): [LogicValue, LogicValue] {\n        if (isNull(savedData)) {\n            return [false, true]\n        }\n        const state = toLogicValue(savedData.state ?? 0)\n        return [state, LogicValue.invert(state)]\n    }\n\n    protected _showContent: boolean = FlipflorOrLatchDefaults.showContent\n    protected _isInInvalidState = false\n\n    protected constructor(editor: LogicEditor, savedData: Repr | null, nodeInOffsets: NodeVisuals<NumInputs, 0>) {\n        super(editor, FlipflopOrLatch.savedStateFrom(savedData), savedData, {\n            ins: (nodeInOffsets as any).ins,\n            outs: [\n                [S.Components.Generic.OutputQDesc, +4, -2, \"e\"],\n                [S.Components.Generic.OutputQBarDesc, +4, 2, \"e\"],\n            ],\n        } as any)\n        if (isNotNull(savedData)) {\n            this._showContent = savedData.showContent ?? FlipflorOrLatchDefaults.showContent\n        }\n    }\n\n    protected override toJSONBase() {\n        return {\n            ...super.toJSONBase(),\n            state: toLogicValueRepr(this.value[0]),\n            showContent: (this._showContent !== FlipflorOrLatchDefaults.showContent) ? this._showContent : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    protected override propagateValue(newValue: [LogicValue, LogicValue]) {\n        this.outputs[OUTPUT.Q].value = newValue[OUTPUT.Q]\n        this.outputs[OUTPUT.Qb].value = newValue[OUTPUT.Qb]\n    }\n\n    protected doSetShowContent(showContent: boolean) {\n        this._showContent = showContent\n        this.setNeedsRedraw(\"show content changed\")\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = this.unrotatedWidth\n        const height = this.unrotatedHeight\n        const left = this.posX - width / 2\n        const right = this.posX + width / 2\n\n        g.fillStyle = this._isInInvalidState ? COLOR_BACKGROUND_INVALID : COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        g.beginPath()\n        g.rect(left, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n        g.fillStyle = COLOR_BACKGROUND\n\n        drawWireLineToComponent(g, this.outputs[OUTPUT.Q], right + 2, this.outputs[OUTPUT.Q].posYInParentTransform, false)\n        drawWireLineToComponent(g, this.outputs[OUTPUT.Qb], right + 2, this.outputs[OUTPUT.Qb].posYInParentTransform, false)\n\n        this.doDrawLatchOrFlipflop(g, ctx, width, height, left, right)\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (this._showContent && !this.editor.options.hideMemoryContent) {\n                FlipflopOrLatch.drawStoredValue(g, this.value[OUTPUT.Q], this.posX, this.posY, 26)\n            }\n\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"Q\", \"e\", right, this.outputs[OUTPUT.Q])\n            drawLabel(ctx, this.orient, \"Q\u0305\", \"e\", right, this.outputs[OUTPUT.Qb])\n\n            // TODO bar placement is not great\n            // const [qbarCenterX, qbarCenterY] = ctx.rotatePoint(right - 7, this.outputs[OUTPUT.Qb].posYInParentTransform)\n            // const barY = qbarCenterY - 8\n            // g.strokeStyle = g.fillStyle\n            // strokeSingleLine(g, qbarCenterX - 4, barY, qbarCenterX + 3, barY)\n        })\n\n    }\n\n    protected abstract doDrawLatchOrFlipflop(g: CanvasRenderingContext2D, ctx: DrawContext, width: number, height: number, left: number, right: number): void\n\n\n    public static drawStoredValueFrame(g: CanvasRenderingContext2D, x: number, y: number, width: number, height: number) {\n        g.strokeStyle = COLOR_COMPONENT_BORDER\n        g.lineWidth = 2\n        g.beginPath()\n        g.rect(x - width / 2, y - height / 2, width, height)\n        g.fill()\n        g.stroke()\n    }\n\n    public static drawStoredValue(g: CanvasRenderingContext2D, value: LogicValue, x: number, y: number, cellHeight: number) {\n        g.fillStyle = colorForBoolean(value)\n        FlipflopOrLatch.drawStoredValueFrame(g, x, y, 20, cellHeight)\n        drawRoundValue(g, value, x, y)\n    }\n\n}\n\n\n// Flip-flop base class\n\nexport const EdgeTrigger = {\n    rising: \"rising\",\n    falling: \"falling\",\n} as const\nexport type EdgeTrigger = keyof typeof EdgeTrigger\n\nexport function defineFlipflop<NumInputs extends FixedArraySize, N extends string, P extends t.Props>(numExtraInputs: NumInputs, jsonName: N, className: string, props: P) {\n    return defineFlipflopOrLatch(3 + numExtraInputs as Plus3<NumInputs>, jsonName, className, {\n        trigger: typeOrUndefined(t.keyof(EdgeTrigger)),\n        ...props,\n    })\n}\n\nexport type FlipflopRepr<NumInputs extends FixedArraySize> =\n    FlipflopOrLatchRepr<NumInputs> & {\n    trigger: keyof typeof EdgeTrigger | undefined\n}\n\nconst FlipflopDefaults = {\n    trigger: EdgeTrigger.rising,\n}\n\nconst enum INPUT {\n    Clock,\n    Preset,\n    Clear,\n}\n\ninterface SyncComponent<State> {\n    trigger: EdgeTrigger\n    value: State\n    makeInvalidState(): State\n    makeStateFromMainValue(val: LogicValue): State\n    makeStateAfterClock(): State\n}\n\nexport function makeTriggerItems(currentTrigger: EdgeTrigger, handler: (trigger: EdgeTrigger) => void): [ContextMenuItemPlacement, ContextMenuItem][] {\n    const s = S.Components.Generic.contextMenu\n\n    const makeTriggerItem = (trigger: EdgeTrigger, desc: string) => {\n        const isCurrent = currentTrigger === trigger\n        const icon = isCurrent ? \"check\" : \"none\"\n        const caption = s.TriggerOn + \" \" + desc\n        const action = isCurrent ? () => undefined :\n            () => handler(trigger)\n        return ContextMenuData.item(icon, caption, action)\n    }\n\n    return [\n        [\"mid\", makeTriggerItem(EdgeTrigger.rising, s.TriggerRisingEdge)],\n        [\"mid\", makeTriggerItem(EdgeTrigger.falling, s.TriggerFallingEdge)],\n    ]\n}\n\nexport abstract class Flipflop<\n    NumInputs extends FixedArraySizeNonZero,\n    Repr extends FlipflopRepr<Plus3<NumInputs>>,\n> extends FlipflopOrLatch<Plus3<NumInputs>, Repr> implements SyncComponent<[LogicValue, LogicValue]> {\n\n    protected _lastClock: LogicValue = Unknown\n    protected _trigger: EdgeTrigger = FlipflopDefaults.trigger\n\n    protected constructor(editor: LogicEditor, savedData: Repr | null, nodeInOffsets: NodeVisuals<NumInputs, 0> & { clockYOffset: number }) {\n        super(editor, savedData, {\n            ins: [\n                [S.Components.Generic.InputClockDesc, -4, nodeInOffsets.clockYOffset, \"w\"], // Clock\n                [S.Components.Generic.InputPresetDesc, 0, -4, \"n\"], // Preset\n                [S.Components.Generic.InputClearDesc, 0, +4, \"s\"], // Clear\n                ...nodeInOffsets.ins, // subclass\n            ],\n        } as any)\n        if (isNotNull(savedData)) {\n            this._trigger = savedData.trigger ?? FlipflopDefaults.trigger\n        }\n        this.setInputsPreferSpike(INPUT.Clock, INPUT.Preset, INPUT.Clear)\n    }\n\n    protected override toJSONBase() {\n        return {\n            ...super.toJSONBase(),\n            trigger: (this._trigger !== FlipflopDefaults.trigger) ? this._trigger : undefined,\n        }\n    }\n\n    public get trigger() {\n        return this._trigger\n    }\n\n    public static doRecalcValueForSyncComponent<State>(comp: SyncComponent<State>, prevClock: LogicValue, clock: LogicValue, preset: LogicValue, clear: LogicValue): { isInInvalidState: boolean, newState: State } {\n        // handle set and reset signals\n        if (preset === true) {\n            if (clear === true) {\n                return { isInInvalidState: true, newState: comp.makeInvalidState() }\n            } else {\n                // preset is true, clear is false, set output to 1\n                return { isInInvalidState: false, newState: comp.makeStateFromMainValue(true) }\n            }\n        }\n        if (clear === true) {\n            // clear is true, preset is false, set output to 0\n            return { isInInvalidState: false, newState: comp.makeStateFromMainValue(false) }\n        }\n\n        // handle normal operation\n        if (!Flipflop.isClockTrigger(comp.trigger, prevClock, clock)) {\n            return { isInInvalidState: false, newState: comp.value }\n        } else {\n            return { isInInvalidState: false, newState: comp.makeStateAfterClock() }\n        }\n    }\n\n    public static isClockTrigger(trigger: EdgeTrigger, prevClock: LogicValue, clock: LogicValue): boolean {\n        return (trigger === EdgeTrigger.rising && prevClock === false && clock === true)\n            || (trigger === EdgeTrigger.falling && prevClock === true && clock === false)\n    }\n\n    protected doRecalcValue(): [LogicValue, LogicValue] {\n        const prevClock = this._lastClock\n        const clock = this._lastClock = this.inputs[INPUT.Clock].value\n        const { isInInvalidState, newState } =\n            Flipflop.doRecalcValueForSyncComponent(this, prevClock, clock,\n                this.inputs[INPUT.Preset].value,\n                this.inputs[INPUT.Clear].value)\n        this._isInInvalidState = isInInvalidState\n        return newState\n    }\n\n    public makeInvalidState(): [LogicValue, LogicValue] {\n        return [false, false]\n    }\n\n    public makeStateFromMainValue(val: LogicValue): [LogicValue, LogicValue] {\n        return [val, LogicValue.invert(val)]\n    }\n\n    public makeStateAfterClock(): [LogicValue, LogicValue] {\n        return this.makeStateFromMainValue(this.doRecalcValueAfterClock())\n    }\n\n    protected abstract doRecalcValueAfterClock(): LogicValue\n\n    protected doSetTrigger(trigger: EdgeTrigger) {\n        this._trigger = trigger\n        this.setNeedsRedraw(\"trigger changed\")\n    }\n\n    public static drawClockInput(g: CanvasRenderingContext2D, left: number, clockNode: NodeIn, trigger: EdgeTrigger) {\n        const clockY = clockNode.posYInParentTransform\n        const clockLineOffset = 1\n        g.strokeStyle = COLOR_COMPONENT_BORDER\n        g.lineWidth = 2\n\n        // if (trigger === EdgeTrigger.falling) {\n        //     clockLineOffset += 7\n        //     g.beginPath()\n        //     circle(g, left - 5, clockY, 6)\n        //     g.fillStyle = COLOR_BACKGROUND\n        //     g.fill()\n        //     g.stroke()\n        // }\n        g.beginPath()\n        g.moveTo(left + 1, clockY - 4)\n        g.lineTo(left + 9, clockY)\n        g.lineTo(left + 1, clockY + 4)\n        g.stroke()\n        if (trigger === EdgeTrigger.falling) {\n            g.fillStyle = COLOR_COMPONENT_BORDER\n            g.closePath()\n            g.fill()\n        }\n\n        drawWireLineToComponent(g, clockNode, left - clockLineOffset, clockY, false)\n    }\n\n    protected override doDrawLatchOrFlipflop(g: CanvasRenderingContext2D, ctx: DrawContext, width: number, height: number, left: number, __right: number) {\n\n        const top = this.posY - height / 2\n        const bottom = this.posY + height / 2\n\n        Flipflop.drawClockInput(g, left, this.inputs[INPUT.Clock], this._trigger)\n\n        drawWireLineToComponent(g, this.inputs[INPUT.Preset], this.inputs[INPUT.Preset].posXInParentTransform, top - 2, false)\n        drawWireLineToComponent(g, this.inputs[INPUT.Clear], this.inputs[INPUT.Clear].posXInParentTransform, bottom + 2, false)\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"11px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"Pre\", \"n\", this.inputs[INPUT.Preset], top)\n            drawLabel(ctx, this.orient, \"Clr\", \"s\", this.inputs[INPUT.Clear], bottom)\n        })\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        const icon = this._showContent ? \"check\" : \"none\"\n        const toggleShowOpItem = ContextMenuData.item(icon, S.Components.Generic.contextMenu.ShowContent,\n            () => this.doSetShowContent(!this._showContent))\n\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            ...makeTriggerItems(this._trigger, this.doSetTrigger.bind(this)),\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", toggleShowOpItem],\n        ]\n\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isDefined(forceOutputItem)) {\n            items.push(\n                [\"mid\", forceOutputItem]\n            )\n        }\n\n        return items\n    }\n\n}", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_EMPTY, COLOR_LABEL_OFF, COLOR_MOUSE_OVER, displayValuesFromArray, drawLabel, drawWireLineToComponent, formatWithRadix, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedArrayFill, isDefined, isNotNull, isNull, isUndefined, isUnknown, LogicValue, typeOrNull, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { EdgeTrigger, Flipflop, FlipflopOrLatch, makeTriggerItems } from \"./FlipflopOrLatch\"\n\nconst GRID_WIDTH = 5\nconst GRID_HEIGHT = 11\n\nconst enum INPUT { Clock, Clear }\n\nconst OUTPUT = {\n    Q: [0, 1, 2, 3] as const,\n    V: 4,\n}\n\nconst COUNTER_WIDTH = OUTPUT.Q.length\nconst COUNTER_RESET_VALUE = Math.pow(2, COUNTER_WIDTH)\n\nexport const CounterDef =\n    defineComponent(2, 5, t.type({\n        type: t.literal(\"counter\"),\n        count: typeOrUndefined(t.number),\n        trigger: typeOrUndefined(t.keyof(EdgeTrigger)),\n        displayRadix: typeOrUndefined(typeOrNull(t.number)), // undefined means default, null means no display\n    }, \"Counter\"))\n\nexport type CounterRepr = typeof CounterDef.reprType\n\nconst CounterDefaults = {\n    trigger: EdgeTrigger.rising,\n    displayRadix: 10,\n}\n\nexport class Counter extends ComponentBase<2, 5, CounterRepr, [FixedArray<LogicValue, 4>, LogicValue]> {\n\n    private _trigger: EdgeTrigger = CounterDefaults.trigger\n    private _lastClock: LogicValue = Unknown\n    private _displayRadix: number | undefined = CounterDefaults.displayRadix\n\n    private static savedStateFrom(savedData: { count: number | undefined } | null): [FixedArray<LogicValue, 4>, LogicValue] {\n        if (isNull(savedData) || isUndefined(savedData.count)) {\n            return [[false, false, false, false], false]\n        }\n        return [Counter.decimalToFourBits(savedData.count), false]\n    }\n\n    private static decimalToFourBits(value: number): FixedArray<LogicValue, 4> {\n        value = value % COUNTER_RESET_VALUE\n        const binStr = value.toString(2).padStart(COUNTER_WIDTH, \"0\")\n        const fourBits = FixedArrayFill(false, COUNTER_WIDTH)\n        for (let i = 0; i < COUNTER_WIDTH; i++) {\n            fourBits[i] = binStr[COUNTER_WIDTH - i - 1] === \"1\"\n        }\n        return fourBits\n    }\n\n    public constructor(editor: LogicEditor, savedData: CounterRepr | null) {\n        super(editor, Counter.savedStateFrom(savedData), savedData, {\n            ins: [\n                [S.Components.Generic.InputClockDesc, -4, +4, \"w\"],\n                [S.Components.Generic.InputClearDesc, 0, +6, \"s\"],\n            ],\n            outs: [\n                [\"Q0\", +4, -4, \"e\", \"Q\"],\n                [\"Q1\", +4, -2, \"e\", \"Q\"],\n                [\"Q2\", +4, 0, \"e\", \"Q\"],\n                [\"Q3\", +4, +2, \"e\", \"Q\"],\n                [\"V (oVerflow)\", +4, +4, \"e\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._trigger = savedData.trigger ?? CounterDefaults.trigger\n            this._displayRadix = isUndefined(savedData.displayRadix) ? CounterDefaults.displayRadix :\n                (savedData.displayRadix === null ? undefined : savedData.displayRadix) // convert null in the repr to undefined\n        }\n        this.setInputsPreferSpike(INPUT.Clock, INPUT.Clear)\n    }\n\n    public toJSON() {\n        const [__, currentCountOrUnknown] = displayValuesFromArray(this.value[0], false)\n        const currentCount = isUnknown(currentCountOrUnknown) ? 0 : currentCountOrUnknown\n        const displayRadix = isUndefined(this._displayRadix) ? null : this._displayRadix\n        return {\n            type: \"counter\" as const,\n            ...this.toJSONBase(),\n            count: currentCount === 0 ? undefined : currentCount,\n            trigger: (this._trigger !== CounterDefaults.trigger) ? this._trigger : undefined,\n            displayRadix: (displayRadix !== CounterDefaults.displayRadix) ? displayRadix : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public get trigger() {\n        return this._trigger\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.Counter.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc) // TODO more info\n        ))\n    }\n\n    protected doRecalcValue(): [FixedArray<LogicValue, 4>, LogicValue] {\n        const clear = this.inputs[INPUT.Clear].value\n        if (clear === true) {\n            return [FixedArrayFill(false, COUNTER_WIDTH), false]\n        }\n\n        const prevClock = this._lastClock\n        const clock = this._lastClock = this.inputs[INPUT.Clock].value\n        const activeOverflowValue = this._trigger === EdgeTrigger.rising ? true : false\n\n        if (Flipflop.isClockTrigger(this._trigger, prevClock, clock)) {\n            const [__, value] = displayValuesFromArray(this.value[0], false)\n            if (isUnknown(value)) {\n                return [[Unknown, Unknown, Unknown, Unknown], Unknown]\n            }\n            const newValue = value + 1\n            if (newValue >= COUNTER_RESET_VALUE) {\n                return [FixedArrayFill(false, COUNTER_WIDTH), activeOverflowValue]\n            }\n\n            return [Counter.decimalToFourBits(newValue), !activeOverflowValue]\n\n        } else {\n            return [this.value[0], !activeOverflowValue]\n        }\n    }\n\n    protected override propagateValue(newValue: [FixedArray<LogicValue, 4>, LogicValue]) {\n        for (let i = 0; i < newValue[0].length; i++) {\n            this.outputs[OUTPUT.Q[i]].value = newValue[0][i]\n        }\n        this.outputs[OUTPUT.V].value = newValue[1]\n    }\n\n    protected doSetTrigger(trigger: EdgeTrigger) {\n        this._trigger = trigger\n        this.setNeedsRedraw(\"trigger changed\")\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = this.unrotatedWidth\n        const height = this.unrotatedHeight\n        const left = this.posX - width / 2\n        const right = this.posX + width / 2\n        const top = this.posY - height / 2\n        const bottom = this.posY + height / 2\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n        g.fillStyle = COLOR_BACKGROUND\n\n        Flipflop.drawClockInput(g, left, this.inputs[INPUT.Clock], this._trigger)\n        drawWireLineToComponent(g, this.inputs[INPUT.Clear], this.inputs[INPUT.Clear].posXInParentTransform, bottom + 2, false)\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 2, output.posYInParentTransform, false)\n        }\n\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"Clr\", \"s\", this.inputs[INPUT.Clear], bottom)\n\n            drawLabel(ctx, this.orient, \"V\", \"e\", right, this.outputs[OUTPUT.V])\n            g.font = \"bold 12px sans-serif\"\n\n            const offsetY = (this.outputs[OUTPUT.Q[1]].posYInParentTransform + this.outputs[OUTPUT.Q[2]].posYInParentTransform) / 2\n            drawLabel(ctx, this.orient, \"Q\", \"e\", right, offsetY, this.outputs[OUTPUT.Q[0]])\n\n            if (isDefined(this._displayRadix)) {\n                g.font = \"bold 20px sans-serif\"\n                const [__, currentCount] = displayValuesFromArray(this.value[0], false)\n                const stringRep = formatWithRadix(currentCount, this._displayRadix, 1, false)\n                const valueCenter = ctx.rotatePoint(this.posX - 5, offsetY)\n\n                g.fillStyle = COLOR_EMPTY\n                FlipflopOrLatch.drawStoredValueFrame(g, ...valueCenter, 28, 28)\n\n                g.textAlign = \"center\"\n                g.textBaseline = \"middle\"\n                g.fillStyle = COLOR_LABEL_OFF\n                g.fillText(stringRep, ...valueCenter)\n            }\n\n        })\n    }\n\n    private doSetDisplayRadix(displayRadix: number | undefined) {\n        this._displayRadix = displayRadix\n        this.setNeedsRedraw(\"display radix changed\")\n    }\n\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        const s = S.Components.Counter.contextMenu\n        const makeItemShowRadix = (displayRadix: number | undefined, desc: string) => {\n            const icon = this._displayRadix === displayRadix ? \"check\" : \"none\"\n            const caption = s.DisplayTempl.expand({ desc })\n            const action = () => this.doSetDisplayRadix(displayRadix)\n            return ContextMenuData.item(icon, caption, action)\n        }\n\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            ...makeTriggerItems(this._trigger, this.doSetTrigger.bind(this)),\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", makeItemShowRadix(undefined, s.DisplayNone)],\n            [\"mid\", makeItemShowRadix(10, s.DisplayDecimal)],\n            [\"mid\", makeItemShowRadix(16, s.DisplayHex)],\n        ]\n\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isDefined(forceOutputItem)) {\n            items.push(\n                [\"mid\", ContextMenuData.sep()],\n                [\"mid\", forceOutputItem],\n            )\n        }\n\n        return items\n    }\n\n}", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, displayValuesFromArray, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArrayFill, FixedReadonlyArray, isUndefined, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\nexport const Decoder16SegDef =\n    defineComponent(7, 17, t.type({\n        type: t.literal(\"decoder-16seg\"),\n    }, \"Decoder16Seg\"))\n\nconst INPUT = {\n    I: [0, 1, 2, 3, 4, 5, 6] as const,\n}\n\n// const enum OUTPUT {\n//     a1, a2, b, c, d2, d1, e, f, g1, g2, h, i, j, k, l, m, p\n// }\n\nconst GRID_WIDTH = 4\nconst GRID_HEIGHT = 10\n\nexport type Decoder16SegRepr = typeof Decoder16SegDef.reprType\n\nexport class Decoder16Seg extends ComponentBase<7, 17, Decoder16SegRepr, FixedReadonlyArray<LogicValue, 17>> {\n\n    public constructor(editor: LogicEditor, savedData: Decoder16SegRepr | null) {\n        super(editor, FixedArrayFill(false, 17), savedData, {\n            ins: [\n                [\"I0\", -3, -3, \"w\", \"In\"],\n                [\"I1\", -3, -2, \"w\", \"In\"],\n                [\"I2\", -3, -1, \"w\", \"In\"],\n                [\"I3\", -3, 0, \"w\", \"In\"],\n                [\"I4\", -3, +1, \"w\", \"In\"],\n                [\"I5\", -3, +2, \"w\", \"In\"],\n                [\"I6\", -3, +3, \"w\", \"In\"],\n            ],\n            outs: [\n                [\"a1\", +4, -4, \"e\", \"Out\"],\n                [\"a2\", +3, -3.5, \"e\", \"Out\"],\n                [\"b\", +4, -3, \"e\", \"Out\"],\n                [\"c\", +3, -2.5, \"e\", \"Out\"],\n                [\"d2\", +4, -2, \"e\", \"Out\"],\n                [\"d1\", +3, -1.5, \"e\", \"Out\"],\n                [\"e\", +4, -1, \"e\", \"Out\"],\n                [\"f\", +3, -0.5, \"e\", \"Out\"],\n                [\"g1\", +4, 0, \"e\", \"Out\"],\n                [\"g2\", +3, 0.5, \"e\", \"Out\"],\n                [\"h\", +4, +1, \"e\", \"Out\"],\n                [\"i\", +3, +1.5, \"e\", \"Out\"],\n                [\"j\", +4, +2, \"e\", \"Out\"],\n                [\"k\", +3, +2.5, \"e\", \"Out\"],\n                [\"l\", +4, +3, \"e\", \"Out\"],\n                [\"m\", +3, +3.5, \"e\", \"Out\"],\n                [\"p\", +4, +4, \"e\", \"Out\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"decoder-16seg\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(\n            div(S.Components.Decoder16Seg.tooltip) // TODO better tooltip\n        ))\n    }\n\n    protected doRecalcValue(): FixedReadonlyArray<LogicValue, 17> {\n        const input = this.inputValues<7>(INPUT.I)\n        const [__, value] = displayValuesFromArray(input, false)\n\n        let output\n        if (isUnknown(value)) {\n            output = FixedArrayFill(Unknown, 17)\n        } else if (value < 32) {\n            // control chars\n            output = FixedArrayFill(false, 17)\n        } else {\n            const line = DECODER_MAPPING[value - 32]\n            output = FixedArrayFill<LogicValue, 17>(false, 17)\n            for (let i = 0; i < line.length; i++) {\n                output[i] = line.charAt(i) === \"1\"\n            }\n        }\n\n        return output\n    }\n\n    protected override propagateValue(newValue: FixedReadonlyArray<LogicValue, 17>) {\n        for (let i = 0; i < 17; i++) {\n            this.outputs[i].value = newValue[i]\n        }\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = left + width\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, left - 2, input.posYInParentTransform)\n        }\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 2, output.posYInParentTransform)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"bold 12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"C\", \"w\", left, this.posY, this.inputs[0])\n\n            g.font = \"7px sans-serif\"\n            this.outputs.forEach(output => {\n                drawLabel(ctx, this.orient, output.name, \"e\", right, output)\n            })\n\n        })\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isUndefined(forceOutputItem)) {\n            return []\n        }\n        return [\n            [\"mid\", forceOutputItem],\n        ]\n    }\n\n\n}\n\n// Taken and modified from https://github.com/dmadison/LED-Segment-ASCII\nconst DECODER_MAPPING = [\n    \"00000000000000000\", /* (space) */\n    \"00110000000000001\", /* ! */\n    \"00100000000100000\", /* \" */\n    \"00111100110100100\", /* # */\n    \"11011101110100100\", /* $ */\n    \"10011001110111100\", /* % */\n    \"10001110101100010\", /* & */\n    \"00000000000100000\", /* ' */\n    \"00000000000010010\", /* ( */\n    \"00000000001001000\", /* ) */\n    \"00000000111111110\", /* * */\n    \"00000000110100100\", /* + */\n    \"00000000000001000\", /* , */\n    \"00000000110000000\", /* - */\n    \"00000000000000001\", /* . */\n    \"00000000000011000\", /* / */\n    \"11111111000011000\", /* 0 */\n    \"00110000000010000\", /* 1 */\n    \"11101110110000000\", /* 2 */\n    \"11111100010000000\", /* 3 */\n    \"00110001110000000\", /* 4 */\n    \"11001101100000010\", /* 5 */\n    \"11011111110000000\", /* 6 */\n    \"11110000000000000\", /* 7 */\n    \"11111111110000000\", /* 8 */\n    \"11111101110000000\", /* 9 */\n    \"00000000000100100\", /* : */\n    \"00000000000101000\", /* ; */\n    \"00000000100010010\", /* < */\n    \"00001100110000000\", /* = */\n    \"00000000011001000\", /* > */\n    \"11100000010000101\", /* ? */\n    \"11101111010100000\", /* @ */\n    \"11110011110000000\", /* A */\n    \"11111100010100100\", /* B */\n    \"11001111000000000\", /* C */\n    \"11111100000100100\", /* D */\n    \"11001111100000000\", /* E */\n    \"11000011100000000\", /* F */\n    \"11011111010000000\", /* G */\n    \"00110011110000000\", /* H */\n    \"11001100000100100\", /* I */\n    \"00111110000000000\", /* J */\n    \"00000011100010010\", /* K */\n    \"00001111000000000\", /* L */\n    \"00110011001010000\", /* M */\n    \"00110011001000010\", /* N */\n    \"11111111000000000\", /* O */\n    \"11100011110000000\", /* P */\n    \"11111111000000010\", /* Q */\n    \"11100011110000010\", /* R */\n    \"11011101110000000\", /* S */\n    \"11000000000100100\", /* T */\n    \"00111111000000000\", /* U */\n    \"00000011000011000\", /* V */\n    \"00110011000001010\", /* W */\n    \"00000000001011010\", /* X */\n    \"00111101110000000\", /* Y */\n    \"11001100000011000\", /* Z */\n    \"01001000000100100\", /* [ */\n    \"00000000001000010\", /* \\ */\n    \"10000100000100100\", /* ] */\n    \"00000000000001010\", /* ^ */\n    \"00001100000000000\", /* _ */\n    \"00000000001000000\", /* ` */\n    \"00001110100000100\", /* a */\n    \"00000111100000100\", /* b */\n    \"00000110100000000\", /* c */\n    \"00000110100100100\", /* d */\n    \"00000110100001000\", /* e */\n    \"10000011100000000\", /* f */\n    \"10000101100100100\", /* g */\n    \"00000011100000100\", /* h */\n    \"00000000000000100\", /* i */\n    \"00000100000100100\", /* j */\n    \"00000000000110110\", /* k */\n    \"00000000000100100\", /* l */\n    \"00010010110000100\", /* m */\n    \"00000010100000100\", /* n */\n    \"00000110100000100\", /* o */\n    \"10000011100100000\", /* p */\n    \"10000001100100100\", /* q */\n    \"00000010100000000\", /* r */\n    \"10000101100000100\", /* s */\n    \"00000111100000000\", /* t */\n    \"00000110000000100\", /* u */\n    \"00000010000001000\", /* v */\n    \"00010010000001010\", /* w */\n    \"00000000001011010\", /* x */\n    \"00000101100100100\", /* y */\n    \"00000100100001000\", /* z */\n    \"01001000100100100\", /* { */\n    \"00000000000100100\", /* | */\n    \"10000100010100100\", /* } */\n    \"00000000110011000\", /* ~ */\n    \"00000000000000000\", /* (del) */\n]", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, displayValuesFromArray, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArrayFill, FixedReadonlyArray, isUndefined, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\nexport const Decoder7SegDef =\n    defineComponent(4, 7, t.type({\n        type: t.literal(\"decoder-7seg\"),\n    }, \"Decoder7Seg\"))\n\nconst INPUT = {\n    I: [0, 1, 2, 3] as const,\n}\n\nconst enum OUTPUT {\n    a, b, c, d, e, f, g\n}\n\nconst GRID_WIDTH = 4\nconst GRID_HEIGHT = 8\n\nexport type Decoder7SegRepr = typeof Decoder7SegDef.reprType\n\nexport class Decoder7Seg extends ComponentBase<4, 7, Decoder7SegRepr, FixedReadonlyArray<LogicValue, 7>> {\n\n    public constructor(editor: LogicEditor, savedData: Decoder7SegRepr | null) {\n        super(editor, FixedArrayFill(false, 7), savedData, {\n            ins: [\n                [\"A\", -3, -3, \"w\", \"In\"],\n                [\"B\", -3, -1, \"w\", \"In\"],\n                [\"C\", -3, +1, \"w\", \"In\"],\n                [\"D\", -3, +3, \"w\", \"In\"],\n            ],\n            outs: [\n                [\"a\", +3, -3, \"e\", \"Out\"],\n                [\"b\", +3, -2, \"e\", \"Out\"],\n                [\"c\", +3, -1, \"e\", \"Out\"],\n                [\"d\", +3, 0, \"e\", \"Out\"],\n                [\"e\", +3, +1, \"e\", \"Out\"],\n                [\"f\", +3, +2, \"e\", \"Out\"],\n                [\"g\", +3, +3, \"e\", \"Out\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"decoder-7seg\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(\n            div(S.Components.Decoder7Seg.tooltip) // TODO better info\n        ))\n    }\n\n    protected doRecalcValue(): FixedReadonlyArray<LogicValue, 7> {\n        const input = this.inputValues<4>(INPUT.I)\n        const [__, value] = displayValuesFromArray(input, false)\n\n        let output\n        if (isUnknown(value)) {\n            output = FixedArrayFill(Unknown, 7)\n        } else {\n            output = (() => {\n                switch (value) {\n                    case 0: return [true, true, true, true, true, true, false] as const\n                    case 1: return [false, true, true, false, false, false, false] as const\n                    case 2: return [true, true, false, true, true, false, true] as const\n                    case 3: return [true, true, true, true, false, false, true] as const\n                    case 4: return [false, true, true, false, false, true, true] as const\n                    case 5: return [true, false, true, true, false, true, true] as const\n                    case 6: return [true, false, true, true, true, true, true] as const\n                    case 7: return [true, true, true, false, false, false, false] as const\n                    case 8: return [true, true, true, true, true, true, true] as const\n                    case 9: return [true, true, true, true, false, true, true] as const\n                    case 10: return [true, true, true, false, true, true, true] as const\n                    case 11: return [false, false, true, true, true, true, true] as const\n                    case 12: return [true, false, false, true, true, true, false] as const\n                    case 13: return [false, true, true, true, true, false, true] as const\n                    case 14: return [true, false, false, true, true, true, true] as const\n                    case 15: return [true, false, false, false, true, true, true] as const\n                    default: return FixedArrayFill(Unknown, 7)\n                }\n            })()\n        }\n\n        return output\n    }\n\n    protected override propagateValue(newValue: FixedReadonlyArray<LogicValue, 7>) {\n        this.outputs[OUTPUT.a].value = newValue[0]\n        this.outputs[OUTPUT.b].value = newValue[1]\n        this.outputs[OUTPUT.c].value = newValue[2]\n        this.outputs[OUTPUT.d].value = newValue[3]\n        this.outputs[OUTPUT.e].value = newValue[4]\n        this.outputs[OUTPUT.f].value = newValue[5]\n        this.outputs[OUTPUT.g].value = newValue[6]\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = left + width\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, left - 2, input.posYInParentTransform)\n        }\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 2, output.posYInParentTransform)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            this.inputs.forEach(input => {\n                drawLabel(ctx, this.orient, input.name, \"w\", left, input)\n            })\n            this.outputs.forEach(output => {\n                drawLabel(ctx, this.orient, output.name, \"e\", right, output)\n            })\n\n        })\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isUndefined(forceOutputItem)) {\n            return []\n        }\n        return [\n            [\"mid\", forceOutputItem],\n        ]\n    }\n\n\n}", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, displayValuesFromArray, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArrayFill, FixedReadonlyArray, isUndefined, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\nexport const DecoderBCD4Def =\n    defineComponent(4, 5, t.type({\n        type: t.literal(\"decoder-bcd4\"),\n    }, \"DecoderBCD4\"))\n\nconst INPUT = {\n    I: [0, 1, 2, 3] as const,\n}\n\n// const OUTPUT = {\n//     B: [0, 1, 2, 3, 5] as const,\n// }\n\nconst GRID_WIDTH = 5\nconst GRID_HEIGHT = 12\n\nexport type DecoderBCD4Repr = typeof DecoderBCD4Def.reprType\n\nexport class DecoderBCD4 extends ComponentBase<4, 5, DecoderBCD4Repr, FixedReadonlyArray<LogicValue, 5>> {\n\n    public constructor(editor: LogicEditor, savedData: DecoderBCD4Repr | null) {\n        super(editor, FixedArrayFill(false, 5), savedData, {\n            ins: [\n                [\"D\", -4, -3, \"w\", \"In\"],\n                [\"C\", -4, -1, \"w\", \"In\"],\n                [\"B\", -4, +1, \"w\", \"In\"],\n                [\"A\", -4, +3, \"w\", \"In\"],\n            ],\n            outs: [\n                [\"Z0\", +4, -5, \"e\", \"Z\"],\n                [\"Z1\", +4, -3, \"e\", \"Z\"],\n                [\"Z2\", +4, -1, \"e\", \"Z\"],\n                [\"Z3\", +4, +1, \"e\", \"Z\"],\n                [\"Z4\", +4, +5, \"e\", \"Z\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"decoder-bcd4\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(\n            div(S.Components.DecoderBCD4.tooltip)\n        ))\n    }\n\n    protected doRecalcValue(): FixedReadonlyArray<LogicValue, 5> {\n        const input = this.inputValues<4>(INPUT.I)\n        const [__, value] = displayValuesFromArray(input, false)\n\n        let output\n        if (isUnknown(value)) {\n            output = FixedArrayFill(Unknown, 5)\n        } else {\n            output = (() => {\n                switch (value) {\n                    case 0: return [false, false, false, false, false] as const\n                    case 1: return [false, false, false, false, true] as const\n                    case 2: return [false, false, false, true, false] as const\n                    case 3: return [false, false, false, true, true] as const\n                    case 4: return [false, false, true, false, false] as const\n                    case 5: return [false, false, true, false, true] as const\n                    case 6: return [false, false, true, true, false] as const\n                    case 7: return [false, false, true, true, true] as const\n                    case 8: return [false, true, false, false, false] as const\n                    case 9: return [false, true, false, false, true] as const\n                    case 10: return [true, false, false, false, false] as const\n                    case 11: return [true, false, false, false, true] as const\n                    case 12: return [true, false, false, true, false] as const\n                    case 13: return [true, false, false, true, true] as const\n                    case 14: return [true, false, true, false, false] as const\n                    case 15: return [true, false, true, false, true] as const\n                    default: return FixedArrayFill(Unknown, 5)\n                }\n            })()\n        }\n\n        return output\n    }\n\n    protected override propagateValue(newValue: FixedReadonlyArray<LogicValue, 5>) {\n        this.outputs.forEach((output, i) => {\n            output.value = newValue[5 - i - 1]\n        })\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = left + width\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, left - 2, input.posYInParentTransform)\n        }\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 2, output.posYInParentTransform)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            this.inputs.forEach(input => {\n                drawLabel(ctx, this.orient, input.name, \"w\", left, input)\n            })\n            this.outputs.forEach(output => {\n                drawLabel(ctx, this.orient, output.name, \"e\", right, output)\n            })\n\n        })\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isUndefined(forceOutputItem)) {\n            return []\n        }\n        return [\n            [\"mid\", forceOutputItem],\n        ]\n    }\n\n\n}", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, displayValuesFromArray, drawWireLineToComponent, GRID_STEP, strokeAsWireLine } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { IconName } from \"../images\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedArrayFill, FixedArraySize, FixedReadonlyArray, HighImpedance, isDefined, isNotNull, isUnknown, LogicValue, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBaseWithSubclassDefinedNodes, ComponentRepr, defineComponent, NodeVisual, NodeVisuals } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { WireStyles } from \"./Wire\"\n\n\ntype DemuxInputIndices<NumInputs extends FixedArraySize> = {\n    I: FixedReadonlyArray<number, NumInputs>, // array of input indices\n    S: ReadonlyArray<number>, // array of indices of selectors\n}\n\ntype DemuxOutputIndices<NumOutputs extends FixedArraySize> = {\n    Z: ReadonlyArray<FixedReadonlyArray<number, NumOutputs>>, // array of arrays of output indices\n}\n\nexport function defineDemux<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize, N extends string>(numInputs: NumInputs, numOutputs: NumOutputs, jsonName: N, className: string) {\n    return defineComponent(numInputs, numOutputs, t.type({\n        type: t.literal(jsonName),\n        showWiring: typeOrUndefined(t.boolean),\n        disconnectedAsHighZ: typeOrUndefined(t.boolean),\n    }, className))\n}\n\ntype DemuxRepr<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize> =\n    ComponentRepr<NumInputs, NumOutputs> & {\n        showWiring: boolean | undefined,\n        disconnectedAsHighZ: boolean | undefined,\n    }\n\nconst DemuxDefaults = {\n    showWiring: true,\n    disconnectedAsHighZ: false,\n}\n\nexport abstract class Demux<\n    NumInputs extends FixedArraySize,\n    NumOutputs extends FixedArraySize,\n    Repr extends DemuxRepr<NumInputs, NumOutputs>\n>\n    extends ComponentBaseWithSubclassDefinedNodes<\n        DemuxInputIndices<NumInputs>,\n        DemuxOutputIndices<NumOutputs>,\n        NumInputs, NumOutputs, Repr, FixedArray<LogicValue, NumOutputs>\n    > {\n\n    private static generateInOffsets(numFrom: number, numSel: number, numTo: number): NodeVisual[] {\n        const offsets: NodeVisual[] = []\n\n        // left inputs\n        const compact = numTo >= 7\n        const spacing = compact ? 1 : 2\n        const numGroups = numTo / numFrom\n        const addByGroupSep = numFrom > 1 ? 1 : 0\n        const numLeftSlots = (numTo * spacing) / 2 + (numGroups - 1) * addByGroupSep\n        const topOffset = spacing === 1 ? -Math.round(numFrom / 2) : -(numFrom - 1) / 2 * spacing\n        const left = -1 - numSel\n        const y = -(numLeftSlots - 1)\n        const selY = y - 2\n        for (let i = 0; i < numFrom; i++) {\n            offsets.push([`A${i}`, left, topOffset + spacing * i, \"w\", \"A\"])\n        }\n\n        // top input selectors\n        const topRight = numSel - 1\n        for (let s = 0; s < numSel; s++) {\n            offsets.push([`S${s}`, topRight - 2 * s, selY, \"n\", \"S\"])\n        }\n        return offsets\n    }\n\n    private static generateOutOffsets<NumOutputs extends FixedArraySize>(numFrom: number, numSel: number, numTo: NumOutputs): FixedArray<NodeVisual, NumOutputs> {\n        const offsets: NodeVisual[] = []\n\n        const compact = numTo >= 7\n        const spacing = compact ? 1 : 2\n        const numGroups = numTo / numFrom\n        const addByGroupSep = numFrom > 1 ? 1 : 0\n        const numLeftSlots = (numTo * spacing) / 2 + (numGroups - 1) * addByGroupSep\n\n        const x = 1 + numSel\n        let y = -(numLeftSlots - 1)\n\n        // right outputs\n        let groupLetter = \"B\"\n        for (let i = 0; i < numTo; i++) {\n            if (i !== 0 && i % numFrom === 0) {\n                y += addByGroupSep * spacing\n                groupLetter = String.fromCharCode(groupLetter.charCodeAt(0) + 1)\n            }\n            offsets.push([groupLetter + (i % numFrom), x, y, \"e\", groupLetter])\n            y += spacing\n        }\n        return offsets as FixedArray<NodeVisual, NumOutputs>\n    }\n\n    protected static generateInputIndices<NumInputs extends FixedArraySize>(numFrom: NumInputs, numSel: number): DemuxInputIndices<NumInputs> {\n        let ind = 0\n\n        const I: Array<number> = []\n        for (let o = 0; o < numFrom; o++) {\n            I.push(ind++)\n        }\n\n        const S: Array<number> = []\n        for (let s = 0; s < numSel; s++) {\n            S.push(ind++)\n        }\n        return { I: I as FixedArray<number, NumInputs>, S }\n    }\n\n    protected static generateOutputIndices<NumOutputs extends FixedArraySize>(numFrom: number, numTo: NumOutputs): DemuxOutputIndices<NumOutputs> {\n        let ind = 0\n        const Z: Array<FixedArray<number, NumOutputs>> = []\n\n        const numGroups = numTo / numFrom\n        for (let g = 0; g < numGroups; g++) {\n            const inds: Array<number> = []\n            for (let o = 0; o < numFrom; o++) {\n                inds.push(ind++)\n            }\n            Z.push(inds as FixedArray<number, NumOutputs>)\n        }\n        return { Z }\n    }\n\n    private static gridWidth(numSel: number): number {\n        return 2 * numSel\n    }\n\n    private static gridHeight(numFrom: number, numTo: number): number {\n        const compact = numTo >= 7\n        const spacing = compact ? 1 : 2\n        const numGroups = numTo / numFrom\n        const addByGroupSep = numFrom > 1 ? 1 : 0\n        const numLeftSlots = numTo + (numGroups - 1) * addByGroupSep\n        return 1 + spacing * numLeftSlots\n    }\n\n    public readonly numGroups: number\n\n    private _showWiring = DemuxDefaults.showWiring\n    private _disconnectedAsHighZ = DemuxDefaults.disconnectedAsHighZ\n\n    protected constructor(editor: LogicEditor, savedData: Repr | null,\n        public readonly numFrom: FixedArraySize,\n        public readonly numSel: FixedArraySize,\n        public readonly numTo: NumOutputs,\n    ) {\n        super(editor,\n            Demux.gridWidth(numSel), Demux.gridHeight(numFrom, numTo),\n            Demux.generateInputIndices(numFrom, numSel),\n            Demux.generateOutputIndices(numFrom, numTo),\n            FixedArrayFill(false as LogicValue, numTo), savedData, {\n                ins: Demux.generateInOffsets(numFrom, numSel, numTo),\n                outs: Demux.generateOutOffsets(numFrom, numSel, numTo),\n            } as unknown as NodeVisuals<NumInputs, NumOutputs>)\n        this.numGroups = this.numTo / this.numFrom\n        if (isNotNull(savedData)) {\n            this._showWiring = savedData.showWiring ?? DemuxDefaults.showWiring\n            this._disconnectedAsHighZ = savedData.disconnectedAsHighZ ?? DemuxDefaults.disconnectedAsHighZ\n        }\n    }\n\n    protected override toJSONBase() {\n        return {\n            ...super.toJSONBase(),\n            showWiring: (this._showWiring !== DemuxDefaults.showWiring) ? this._showWiring : undefined,\n            disconnectedAsHighZ: (this._disconnectedAsHighZ !== DemuxDefaults.disconnectedAsHighZ) ? this._disconnectedAsHighZ : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(\n            div(S.Components.Demux.tooltip.expand({ from: this.numFrom, to: this.numTo })) // TODO better tooltip\n        ))\n    }\n\n    protected doRecalcValue(): FixedArray<LogicValue, NumOutputs> {\n        const sels = this.inputValues(this.INPUT.S as any)\n        const sel = displayValuesFromArray(sels, false)[1]\n\n        if (isUnknown(sel)) {\n            return FixedArrayFill(Unknown, this.numTo)\n        }\n\n        const values: Array<LogicValue> = []\n        const disconnected = this._disconnectedAsHighZ ? HighImpedance : false\n        for (let g = 0; g < this.numGroups; g++) {\n            if (g === sel) {\n                const inputs = this.inputValues(this.INPUT.I)\n                for (const input of inputs) {\n                    values.push(input)\n                }\n            } else {\n                for (let i = 0; i < this.numFrom; i++) {\n                    values.push(disconnected)\n                }\n            }\n        }\n\n        return values as FixedArray<LogicValue, NumOutputs>\n    }\n\n    protected override propagateValue(newValues: FixedArray<LogicValue, NumOutputs>) {\n        for (let i = 0; i < newValues.length; i++) {\n            this.outputs[i].value = newValues[i]\n        }\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = this.gridWidth * GRID_STEP\n        const height = this.gridHeight * GRID_STEP\n        const left = this.posX - width / 2\n        const right = this.posX + width / 2\n        const top = this.posY - height / 2\n        const bottom = this.posY + height / 2\n\n        // inputs\n        for (let i = 0; i < this.INPUT.I.length; i++) {\n            const inputi = this.inputs[this.INPUT.I[i]]\n            drawWireLineToComponent(g, inputi, left, inputi.posYInParentTransform)\n        }\n\n        // selectors\n        for (let i = 0; i < this.INPUT.S.length; i++) {\n            const seli = this.inputs[this.INPUT.S[i]]\n            drawWireLineToComponent(g, seli, seli.posXInParentTransform, top + 20)\n        }\n\n\n        // outputs\n        for (const GROUP of this.OUTPUT.Z) {\n            for (let i = 0; i < GROUP.length; i++) {\n                const outputi = this.outputs[GROUP[i]]\n                drawWireLineToComponent(g, outputi, right, outputi.posYInParentTransform)\n            }\n        }\n\n        // background\n        const outlinePath = new Path2D()\n        const dy = (right - left) / 3\n        outlinePath.moveTo(left, top + dy)\n        outlinePath.lineTo(right, top)\n        outlinePath.lineTo(right, bottom)\n        outlinePath.lineTo(left, bottom - dy)\n        outlinePath.closePath()\n        g.fillStyle = COLOR_BACKGROUND\n        g.fill(outlinePath)\n\n        // wiring\n        if (this._showWiring) {\n            const neutral = this.editor.options.hideWireColors\n            const sels = this.inputValues(this.INPUT.S as any)\n            const sel = displayValuesFromArray(sels, false)[1]\n            if (!isUnknown(sel)) {\n                const from = this.INPUT.I\n                const to = this.OUTPUT.Z[sel]\n                const anchorDiffX = (right - left) / 3\n                const wireStyleStraight = this.editor.options.wireStyle === WireStyles.straight\n\n                for (let i = 0; i < from.length; i++) {\n                    g.beginPath()\n                    const fromNode = this.inputs[from[i]]\n                    const fromY = fromNode.posYInParentTransform\n                    const toY = this.outputs[to[i]].posYInParentTransform\n                    g.moveTo(left + 1, fromY)\n                    if (wireStyleStraight) {\n                        g.lineTo(left + 3, fromY)\n                        g.lineTo(right - 3, toY)\n                        g.lineTo(right - 1, toY)\n                    } else {\n                        g.bezierCurveTo(\n                            left + anchorDiffX, fromY, // anchor left\n                            right - anchorDiffX, toY, // anchor right\n                            right - 1, toY,\n                        )\n                    }\n                    strokeAsWireLine(g, this.inputs[from[i]].value, fromNode.color, false, neutral)\n                }\n            }\n        }\n\n        // outline\n        g.lineWidth = 3\n        if (ctx.isMouseOver) {\n            g.strokeStyle = COLOR_MOUSE_OVER\n        } else {\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n        }\n        g.stroke(outlinePath)\n\n    }\n\n    private doSetShowWiring(showWiring: boolean) {\n        this._showWiring = showWiring\n        this.setNeedsRedraw(\"show wiring changed\")\n    }\n\n    private doSetDisconnectedAsHighZ(disconnectedAsHighZ: boolean) {\n        this._disconnectedAsHighZ = disconnectedAsHighZ\n        this.setNeedsRecalc()\n    }\n\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        const s = S.Components.Demux.contextMenu\n        let icon: IconName = this._showWiring ? \"check\" : \"none\"\n        const toggleShowWiringItem = ContextMenuData.item(icon, S.Components.Mux.contextMenu.ShowWiring, () => {\n            this.doSetShowWiring(!this._showWiring)\n        })\n\n        icon = this._disconnectedAsHighZ ? \"check\" : \"none\"\n        const toggleUseHighZItem = ContextMenuData.item(icon, s.UseZForDisconnected, () => {\n            this.doSetDisconnectedAsHighZ(!this._disconnectedAsHighZ)\n        })\n\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            [\"mid\", toggleShowWiringItem],\n            [\"mid\", toggleUseHighZItem],\n        ]\n\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isDefined(forceOutputItem)) {\n            items.push(\n                [\"mid\", ContextMenuData.sep()],\n                [\"mid\", forceOutputItem]\n            )\n        }\n\n        return items\n    }\n\n}\n\n\n\nexport const Demux1To2Def = defineDemux(2, 2, \"demux-1to2\", \"Demux1To2\")\nexport type Demux1To2Repr = typeof Demux1To2Def.reprType\nexport class Demux1To2 extends Demux<2, 2, Demux1To2Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Demux1To2Repr | null) {\n        super(editor, savedData, 1, 1, 2)\n    }\n\n    public toJSON() {\n        return {\n            type: \"demux-1to2\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Demux1To4Def = defineDemux(3, 4, \"demux-1to4\", \"Demux1To4\")\nexport type Demux1To4Repr = typeof Demux1To4Def.reprType\nexport class Demux1To4 extends Demux<3, 4, Demux1To4Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Demux1To4Repr | null) {\n        super(editor, savedData, 1, 2, 4)\n    }\n\n    public toJSON() {\n        return {\n            type: \"demux-1to4\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Demux1To8Def = defineDemux(4, 8, \"demux-1to8\", \"Demux1To8\")\nexport type Demux1To8Repr = typeof Demux1To8Def.reprType\nexport class Demux1To8 extends Demux<4, 8, Demux1To8Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Demux1To8Repr | null) {\n        super(editor, savedData, 1, 3, 8)\n    }\n\n    public toJSON() {\n        return {\n            type: \"demux-1to8\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Demux2To4Def = defineDemux(3, 4, \"demux-2to4\", \"Demux2To4\")\nexport type Demux2To4Repr = typeof Demux2To4Def.reprType\nexport class Demux2To4 extends Demux<3, 4, Demux2To4Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Demux2To4Repr | null) {\n        super(editor, savedData, 2, 1, 4)\n    }\n\n    public toJSON() {\n        return {\n            type: \"demux-2to4\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Demux2To8Def = defineDemux(4, 8, \"demux-2to8\", \"Demux2To8\")\nexport type Demux2To8Repr = typeof Demux2To8Def.reprType\nexport class Demux2To8 extends Demux<4, 8, Demux2To8Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Demux2To8Repr | null) {\n        super(editor, savedData, 2, 2, 8)\n    }\n\n    public toJSON() {\n        return {\n            type: \"demux-2to8\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Demux4To8Def = defineDemux(5, 8, \"demux-4to8\", \"Demux4To8\")\nexport type Demux4To8Repr = typeof Demux4To8Def.reprType\nexport class Demux4To8 extends Demux<5, 8, Demux4To8Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Demux4To8Repr | null) {\n        super(editor, savedData, 4, 1, 8)\n    }\n\n    public toJSON() {\n        return {\n            type: \"demux-4to8\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Demux8To16Def = defineDemux(9, 16, \"demux-8to16\", \"Demux8To16\")\nexport type Demux8To16Repr = typeof Demux8To16Def.reprType\nexport class Demux8To16 extends Demux<9, 16, Demux8To16Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Demux8To16Repr | null) {\n        super(editor, savedData, 8, 1, 16)\n    }\n\n    public toJSON() {\n        return {\n            type: \"demux-8to16\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n", "import { COLOR_COMPONENT_INNER_LABELS, drawLabel, drawWireLineToComponent } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { LogicValue } from \"../utils\"\nimport { DrawContext } from \"./Drawable\"\nimport { defineFlipflop, Flipflop } from \"./FlipflopOrLatch\"\n\n\nconst enum INPUT {\n    Clock,\n    Preset,\n    Clear,\n    D,\n}\n\nexport const FlipflopDDef =\n    defineFlipflop(1, \"flipflop-d\", \"FlipflopD\", {})\n\nexport type FlipflopDRepr = typeof FlipflopDDef.reprType\n\nexport class FlipflopD extends Flipflop<1, FlipflopDRepr> {\n\n    public constructor(editor: LogicEditor, savedData: FlipflopDRepr | null) {\n        super(editor, savedData, {\n            ins: [[S.Components.Generic.InputDataDesc, -4, -2, \"w\"]],\n            clockYOffset: 2,\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"flipflop-d\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.FlipflopD.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc) // TODO more info\n        ))\n    }\n\n    protected doRecalcValueAfterClock(): LogicValue {\n        return this.inputs[INPUT.D].value\n    }\n\n    protected override doDrawLatchOrFlipflop(g: CanvasRenderingContext2D, ctx: DrawContext, width: number, height: number, left: number, right: number) {\n        super.doDrawLatchOrFlipflop(g, ctx, width, height, left, right)\n\n        drawWireLineToComponent(g, this.inputs[INPUT.D], left - 2, this.inputs[INPUT.D].posYInParentTransform, false)\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"D\", \"w\", left, this.inputs[INPUT.D])\n        })\n    }\n\n}", "import { COLOR_COMPONENT_INNER_LABELS, drawLabel, drawWireLineToComponent } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { LogicValue } from \"../utils\"\nimport { DrawContext } from \"./Drawable\"\nimport { defineFlipflop, Flipflop, OUTPUT } from \"./FlipflopOrLatch\"\n\nconst enum INPUT {\n    Clock,\n    Preset,\n    Clear,\n    J,\n    K,\n}\n\nexport const FlipflopJKDef =\n    defineFlipflop(2, \"flipflop-jk\", \"FlipflopJK\", {})\n\nexport type FlipflopJKRepr = typeof FlipflopJKDef.reprType\n\nexport class FlipflopJK extends Flipflop<2, FlipflopJKRepr> {\n\n    public constructor(editor: LogicEditor, savedData: FlipflopJKRepr | null) {\n        super(editor, savedData, {\n            ins: [\n                [S.Components.FlipflopJK.InputJDesc, -4, -2, \"w\"],\n                [S.Components.FlipflopJK.InputKDesc, -4, 2, \"w\"],\n            ],\n            clockYOffset: 0,\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"flipflop-jk\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.FlipflopJK.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc) // TODO more info\n        ))\n    }\n\n    protected doRecalcValueAfterClock(): LogicValue {\n        const j = this.inputs[INPUT.J].value\n        const k = this.inputs[INPUT.K].value\n        const q = this.outputs[OUTPUT.Q].value\n\n        if (j === true) {\n            if (k === true) {\n                return LogicValue.invert(q)\n            } else {\n                return true\n            }\n        }\n        if (k === true) {\n            return false\n        } else {\n            return q\n        }\n    }\n\n    protected override doDrawLatchOrFlipflop(g: CanvasRenderingContext2D, ctx: DrawContext, width: number, height: number, left: number, right: number) {\n        super.doDrawLatchOrFlipflop(g, ctx, width, height, left, right)\n\n        drawWireLineToComponent(g, this.inputs[INPUT.J], left - 2, this.inputs[INPUT.J].posYInParentTransform, false)\n        drawWireLineToComponent(g, this.inputs[INPUT.K], left - 2, this.inputs[INPUT.K].posYInParentTransform, false)\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"J\", \"w\", left, this.inputs[INPUT.J])\n            drawLabel(ctx, this.orient, \"K\", \"w\", left, this.inputs[INPUT.K])\n        })\n    }\n\n}", "import { COLOR_COMPONENT_INNER_LABELS, drawLabel, drawWireLineToComponent } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isHighImpedance, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { DrawContext } from \"./Drawable\"\nimport { defineFlipflop, Flipflop, OUTPUT } from \"./FlipflopOrLatch\"\n\n\nconst enum INPUT {\n    Clock,\n    Preset,\n    Clear,\n    T,\n}\n\nexport const FlipflopTDef =\n    defineFlipflop(1, \"flipflop-t\", \"FlipflopT\", {})\n\nexport type FlipflopTRepr = typeof FlipflopTDef.reprType\n\nexport class FlipflopT extends Flipflop<1, FlipflopTRepr> {\n\n    public constructor(editor: LogicEditor, savedData: FlipflopTRepr | null) {\n        super(editor, savedData, {\n            ins: [[S.Components.FlipflopT.InputTDesc, -4, -2, \"w\"]],\n            clockYOffset: 2,\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"flipflop-t\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.FlipflopT.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc) // TODO more info\n        ))\n    }\n\n    protected doRecalcValueAfterClock(): LogicValue {\n        const t = this.inputs[INPUT.T].value\n        if (isUnknown(t) || isHighImpedance(t)) {\n            return Unknown\n        }\n        const q = this.outputs[OUTPUT.Q].value\n        return t ? LogicValue.invert(q) : q\n    }\n\n    protected override doDrawLatchOrFlipflop(g: CanvasRenderingContext2D, ctx: DrawContext, width: number, height: number, left: number, right: number) {\n        super.doDrawLatchOrFlipflop(g, ctx, width, height, left, right)\n\n        drawWireLineToComponent(g, this.inputs[INPUT.T], left - 2, this.inputs[INPUT.T].posYInParentTransform, false)\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"T\", \"w\", left, this.inputs[INPUT.T])\n        })\n    }\n\n}", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isHighImpedance, isUndefined, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\nconst GRID_WIDTH = 4\nconst GRID_HEIGHT = 6\n\nconst enum INPUT {\n    A, B,\n}\n\nconst enum OUTPUT {\n    S, C\n}\n\nexport const HalfAdderDef =\n    defineComponent(2, 2, t.type({\n        type: t.literal(\"halfadder\"),\n    }, \"HalfAdder\"))\n\nexport type HalfAdderRepr = typeof HalfAdderDef.reprType\n\nexport class HalfAdder extends ComponentBase<2, 2, HalfAdderRepr, [LogicValue, LogicValue]> {\n\n    public constructor(editor: LogicEditor, savedData: HalfAdderRepr | null) {\n        super(editor, [false, false], savedData, {\n            ins: [\n                [\"A\", -4, -2, \"w\"],\n                [\"B\", -4, 2, \"w\"],\n            ],\n            outs: [\n                [S.Components.Generic.OutputSumDesc, 4, -2, \"e\"],\n                [S.Components.Generic.OutputCarryDesc, 4, 2, \"e\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"halfadder\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.HalfAdder.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc)\n        ))\n    }\n\n    protected doRecalcValue(): [LogicValue, LogicValue] {\n        const a = this.inputs[INPUT.A].value\n        const b = this.inputs[INPUT.B].value\n\n        if (isUnknown(a) || isUnknown(b) || isHighImpedance(a) || isHighImpedance(b)) {\n            return [Unknown, Unknown]\n        }\n\n        const sum = (+a) + (+b)\n        switch (sum) {\n            case 0: return [false, false]\n            case 1: return [true, false]\n            case 2: return [false, true]\n            default:\n                console.log(\"ERROR: sum of halfadder is > 2\")\n                return [false, false]\n        }\n    }\n\n    protected override propagateValue(newValue: [LogicValue, LogicValue]) {\n        this.outputs[OUTPUT.S].value = newValue[OUTPUT.S]\n        this.outputs[OUTPUT.C].value = newValue[OUTPUT.C]\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n\n        const left = this.posX - width / 2\n        const right = left + width\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.lineWidth = 3\n        if (ctx.isMouseOver) {\n            g.strokeStyle = COLOR_MOUSE_OVER\n        } else {\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n        }\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        drawWireLineToComponent(g, this.inputs[INPUT.A], left - 2, this.inputs[INPUT.A].posYInParentTransform, true)\n        drawWireLineToComponent(g, this.inputs[INPUT.B], left - 2, this.inputs[INPUT.B].posYInParentTransform, true)\n\n        drawWireLineToComponent(g, this.outputs[OUTPUT.S], right + 2, this.outputs[OUTPUT.S].posYInParentTransform, true)\n        drawWireLineToComponent(g, this.outputs[OUTPUT.C], right + 2, this.outputs[OUTPUT.C].posYInParentTransform, true)\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"11px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"A\", \"w\", left, this.inputs[INPUT.A])\n            drawLabel(ctx, this.orient, \"B\", \"w\", left, this.inputs[INPUT.B])\n\n            drawLabel(ctx, this.orient, \"S\", \"e\", right, this.outputs[OUTPUT.S])\n            drawLabel(ctx, this.orient, \"C\", \"e\", right, this.outputs[OUTPUT.C])\n\n            g.fillStyle = COLOR_COMPONENT_BORDER\n            g.font = \"26px sans-serif\"\n            g.textAlign = \"center\"\n            g.textBaseline = \"middle\"\n            g.fillText(\"+\", this.posX, this.posY - 2)\n        })\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isUndefined(forceOutputItem)) {\n            return []\n        }\n        return [\n            [\"mid\", forceOutputItem],\n        ]\n    }\n\n\n}\n", "import { COLOR_COMPONENT_BORDER, drawLabel, drawWireLineToComponent } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isDefined, LogicValue } from \"../utils\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { defineFlipflopOrLatch, FlipflopOrLatch, OUTPUT } from \"./FlipflopOrLatch\"\n\nconst enum INPUT {\n    Set,\n    Reset,\n}\n\nexport const LatchSRDef =\n    defineFlipflopOrLatch(2, \"latch-sr\", \"LatchSR\", {})\n\nexport type LatchSRRepr = typeof LatchSRDef.reprType\n\nexport class LatchSR extends FlipflopOrLatch<2, LatchSRRepr> {\n\n    public constructor(editor: LogicEditor, savedData: LatchSRRepr | null) {\n        super(editor, savedData, {\n            ins: [\n                [S.Components.Generic.InputSetDesc, -4, -2, \"w\"],\n                [S.Components.Generic.InputResetDesc, -4, 2, \"w\"],\n            ],\n        })\n        this.setInputsPreferSpike(INPUT.Set, INPUT.Reset)\n    }\n\n    public toJSON() {\n        return {\n            type: \"latch-sr\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.LatchSR.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc) // TODO more info\n        ))\n    }\n\n    protected doRecalcValue(): [LogicValue, LogicValue] {\n        const s = this.inputs[INPUT.Set].value\n        const r = this.inputs[INPUT.Reset].value\n\n        // assume this state is valid\n        this._isInInvalidState = false\n\n        // handle set and reset signals\n        if (s === true) {\n            if (r === true) {\n                this._isInInvalidState = true\n                return [false, false]\n            } else {\n                // set is true, reset is false, set output to 1\n                return [true, false]\n            }\n        }\n        if (r === true) {\n            // set is false, reset is true, set output to 0\n            return [false, true]\n        }\n\n        // no change\n        const q = this.outputs[OUTPUT.Q].value\n        return [q, LogicValue.invert(q)]\n    }\n\n    protected doDrawLatchOrFlipflop(g: CanvasRenderingContext2D, ctx: DrawContext, width: number, height: number, left: number, __right: number) {\n\n        drawWireLineToComponent(g, this.inputs[INPUT.Set], left - 2, this.inputs[INPUT.Set].posYInParentTransform, false)\n        drawWireLineToComponent(g, this.inputs[INPUT.Reset], left - 2, this.inputs[INPUT.Reset].posYInParentTransform, false)\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_BORDER\n            g.font = \"12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"S\", \"w\", left, this.inputs[INPUT.Set])\n            drawLabel(ctx, this.orient, \"R\", \"w\", left, this.inputs[INPUT.Reset])\n        })\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const icon = this._showContent ? \"check\" : \"none\"\n        const toggleShowOpItem = ContextMenuData.item(icon, S.Components.Generic.contextMenu.ShowContent, () => {\n            this.doSetShowContent(!this._showContent)\n        })\n\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            [\"mid\", toggleShowOpItem],\n        ]\n\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isDefined(forceOutputItem)) {\n            items.push(\n                [\"mid\", forceOutputItem]\n            )\n        }\n\n        return items\n\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, displayValuesFromArray, drawWireLineToComponent, GRID_STEP, strokeAsWireLine } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedArrayFill, FixedArraySize, FixedReadonlyArray, isDefined, isNotNull, isUnknown, LogicValue, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBaseWithSubclassDefinedNodes, ComponentRepr, defineComponent, NodeVisual, NodeVisuals } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { WireStyles } from \"./Wire\"\n\n\nfunction defineMux<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize, N extends string>(numInputs: NumInputs, numOutputs: NumOutputs, jsonName: N, className: string) {\n    return defineComponent(numInputs, numOutputs, t.type({\n        type: t.literal(jsonName),\n        showWiring: typeOrUndefined(t.boolean),\n    }, className))\n}\n\ntype MuxRepr<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize> =\n    ComponentRepr<NumInputs, NumOutputs> & {\n        showWiring: boolean | undefined,\n    }\n\nconst MuxDefaults = {\n    showWiring: true,\n}\n\ntype MuxInputIndices<NumInputs extends FixedArraySize> = {\n    I: ReadonlyArray<FixedReadonlyArray<number, NumInputs>>, // array of arrays of input indices\n    S: ReadonlyArray<number>, // array of indices of selectors\n}\n\ntype MuxOutputIndices<NumOutputs extends FixedArraySize> = {\n    Z: FixedReadonlyArray<number, NumOutputs>, // array of output indices\n}\n\nabstract class Mux<\n    NumInputs extends FixedArraySize,\n    NumOutputs extends FixedArraySize,\n    Repr extends MuxRepr<NumInputs, NumOutputs>\n    >\n    extends ComponentBaseWithSubclassDefinedNodes<\n    MuxInputIndices<NumOutputs>,\n    MuxOutputIndices<NumOutputs>,\n    NumInputs, NumOutputs, Repr, FixedArray<LogicValue, NumOutputs>\n    > {\n\n    private static generateInOffsets(numFrom: number, numSel: number, numTo: number): NodeVisual[] {\n        const offsets: NodeVisual[] = []\n\n        const compact = numTo >= 7\n        const spacing = compact ? 1 : 2\n\n        // left inputs\n        const numGroups = numFrom / numTo\n        const addByGroupSep = numTo > 1 ? 1 : 0\n        const numLeftSlots = (numFrom * spacing) / 2 + (numGroups - 1) * addByGroupSep\n        let x = -1 - numSel\n        let y = -(numLeftSlots - 1)\n        const selY = y - 2\n        let groupLetter = \"A\"\n        for (let i = 0; i < numFrom; i++) {\n            if (i !== 0 && i % numTo === 0) {\n                y += addByGroupSep * spacing\n                groupLetter = String.fromCharCode(groupLetter.charCodeAt(0) + 1)\n            }\n            offsets.push([groupLetter + (i % numTo), x, y, \"w\", groupLetter])\n            y += spacing\n        }\n\n        // top input selectors\n        x = (numSel - 1)\n        for (let s = 0; s < numSel; s++) {\n            offsets.push([`S${s}`, x - 2 * s, selY, \"n\", \"S\"])\n        }\n        return offsets\n    }\n\n    private static generateOutOffsets<NumOutputs extends FixedArraySize>(numSel: number, numTo: NumOutputs): FixedArray<NodeVisual, NumOutputs> {\n        const offsets: NodeVisual[] = []\n\n        // right outputs\n        const compact = numTo >= 7\n        const spacing = compact ? 1 : 2\n        const topOffset = spacing === 1 ? -Math.round(numTo / 2) : -(numTo - 1) / 2 * spacing\n        const x = 1 + numSel\n        for (let i = 0; i < numTo; i++) {\n            offsets.push([`Z${i}`, x, topOffset + spacing * i, \"e\", \"Z\"])\n        }\n        return offsets as FixedArray<NodeVisual, NumOutputs>\n    }\n\n    protected static generateInputIndices<NumOutputs extends FixedArraySize>(numFrom: number, numSel: number, numTo: NumOutputs): MuxInputIndices<NumOutputs> {\n        let ind = 0\n        const I: Array<FixedArray<number, NumOutputs>> = []\n        const numGroups = Math.ceil(numFrom / numTo)\n        for (let g = 0; g < numGroups; g++) {\n            const inds: Array<number> = []\n            for (let o = 0; o < numTo; o++) {\n                inds.push(ind++)\n            }\n            I.push(inds as FixedArray<number, NumOutputs>)\n        }\n        const S: Array<number> = []\n        for (let s = 0; s < numSel; s++) {\n            S.push(ind++)\n        }\n        return { I, S }\n    }\n\n    protected static generateOutputIndices<NumOutputs extends FixedArraySize>(numTo: NumOutputs): MuxOutputIndices<NumOutputs> {\n        let ind = 0\n        const Z: Array<number> = []\n        for (let o = 0; o < numTo; o++) {\n            Z.push(ind++)\n        }\n        return { Z: Z as FixedArray<number, NumOutputs> }\n    }\n\n    private static gridWidth(numSel: number): number {\n        return 2 * numSel\n    }\n\n    private static gridHeight(numFrom: number, numTo: number): number {\n        const compact = numTo >= 7\n        const spacing = compact ? 1 : 2\n        const numGroups = numFrom / numTo\n        const addByGroupSep = numTo > 1 ? 1 : 0\n        const numLeftSlots = numFrom + (numGroups - 1) * addByGroupSep\n        return 1 + spacing * numLeftSlots\n    }\n\n    private _showWiring = MuxDefaults.showWiring\n\n    protected constructor(editor: LogicEditor, savedData: Repr | null,\n        public readonly numFrom: FixedArraySize,\n        public readonly numSel: FixedArraySize,\n        public readonly numTo: NumOutputs,\n    ) {\n        super(editor, Mux.gridWidth(numSel), Mux.gridHeight(numFrom, numTo),\n            Mux.generateInputIndices(numFrom, numSel, numTo),\n            Mux.generateOutputIndices(numTo),\n            FixedArrayFill(false as LogicValue, numTo),\n            savedData, {\n                ins: Mux.generateInOffsets(numFrom, numSel, numTo),\n                outs: Mux.generateOutOffsets(numSel, numTo),\n            } as unknown as NodeVisuals<NumInputs, NumOutputs>)\n        if (isNotNull(savedData)) {\n            this._showWiring = savedData.showWiring ?? MuxDefaults.showWiring\n        }\n    }\n\n    protected override toJSONBase() {\n        return {\n            ...super.toJSONBase(),\n            showWiring: (this._showWiring !== MuxDefaults.showWiring) ? this._showWiring : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(\n            div(S.Components.Mux.tooltip.expand({ from: this.numFrom, to: this.numTo }))\n        ))\n    }\n\n    protected doRecalcValue(): FixedArray<LogicValue, NumOutputs> {\n        const sels = this.inputValues(this.INPUT.S as any)\n        const sel = displayValuesFromArray(sels, false)[1]\n\n        if (isUnknown(sel)) {\n            return FixedArrayFill(Unknown, this.numTo)\n        }\n        return this.inputValues<NumOutputs>(this.INPUT.I[sel])\n    }\n\n    protected override propagateValue(newValues: FixedArray<LogicValue, NumOutputs>) {\n        const Z = this.OUTPUT.Z\n        for (let i = 0; i < Z.length; i++) {\n            this.outputs[Z[i]].value = newValues[i]\n        }\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = this.gridWidth * GRID_STEP\n        const height = this.gridHeight * GRID_STEP\n        const left = this.posX - width / 2\n        const right = this.posX + width / 2\n        const top = this.posY - height / 2\n        const bottom = this.posY + height / 2\n\n        // inputs\n        for (const GROUP of this.INPUT.I) {\n            for (let i = 0; i < GROUP.length; i++) {\n                const inputi = this.inputs[GROUP[i]]\n                drawWireLineToComponent(g, inputi, left, inputi.posYInParentTransform)\n            }\n        }\n\n        // selectors\n        for (let i = 0; i < this.INPUT.S.length; i++) {\n            const seli = this.inputs[this.INPUT.S[i]]\n            drawWireLineToComponent(g, seli, seli.posXInParentTransform, top + 20)\n        }\n\n        // outputs\n        for (let i = 0; i < this.OUTPUT.Z.length; i++) {\n            const outputi = this.outputs[this.OUTPUT.Z[i]]\n            drawWireLineToComponent(g, outputi, right, outputi.posYInParentTransform)\n        }\n\n        // background\n        g.fillStyle = COLOR_BACKGROUND\n        const outlinePath = new Path2D()\n        const dy = (right - left) / 3\n        outlinePath.moveTo(left, top)\n        outlinePath.lineTo(right, top + dy)\n        outlinePath.lineTo(right, bottom - dy)\n        outlinePath.lineTo(left, bottom)\n        outlinePath.closePath()\n        g.fill(outlinePath)\n\n        // wiring\n        if (this._showWiring) {\n            const sels = this.inputValues(this.INPUT.S as any)\n            const sel = displayValuesFromArray(sels, false)[1]\n            if (!isUnknown(sel)) {\n                const neutral = this.editor.options.hideWireColors\n                const from = this.INPUT.I[sel]\n                const to = this.OUTPUT.Z\n                const anchorDiffX = (right - left) / 3\n                const wireStyleStraight = this.editor.options.wireStyle === WireStyles.straight\n\n                for (let i = 0; i < from.length; i++) {\n                    this.editor.options.wireStyle\n                    g.beginPath()\n                    const fromY = this.inputs[from[i]].posYInParentTransform\n                    const toNode = this.outputs[to[i]]\n                    const toY = toNode.posYInParentTransform\n                    g.moveTo(left + 1, fromY)\n                    if (wireStyleStraight) {\n                        g.lineTo(left + 3, fromY)\n                        g.lineTo(right - 3, toY)\n                        g.lineTo(right - 1, toY)\n                    } else {\n                        g.bezierCurveTo(\n                            left + anchorDiffX, fromY, // anchor left\n                            right - anchorDiffX, toY, // anchor right\n                            right - 1, toY,\n                        )\n                    }\n                    strokeAsWireLine(g, this.inputs[from[i]].value, toNode.color, false, neutral)\n                }\n            }\n        }\n\n        // outline\n        g.lineWidth = 3\n        if (ctx.isMouseOver) {\n            g.strokeStyle = COLOR_MOUSE_OVER\n        } else {\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n        }\n        g.stroke(outlinePath)\n\n    }\n\n    private doSetShowWiring(showWiring: boolean) {\n        this._showWiring = showWiring\n        this.setNeedsRedraw(\"show wiring changed\")\n    }\n\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const icon = this._showWiring ? \"check\" : \"none\"\n        const toggleShowWiringItem = ContextMenuData.item(icon, S.Components.Mux.contextMenu.ShowWiring, () => {\n            this.doSetShowWiring(!this._showWiring)\n        })\n\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            [\"mid\", toggleShowWiringItem],\n        ]\n\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isDefined(forceOutputItem)) {\n            items.push(\n                [\"mid\", forceOutputItem]\n            )\n        }\n\n        return items\n    }\n\n}\n\n\nexport const Mux2To1Def = defineMux(3, 1, \"mux-2to1\", \"Mux2To1\")\nexport type Mux2To1Repr = typeof Mux2To1Def.reprType\nexport class Mux2To1 extends Mux<3, 1, Mux2To1Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Mux2To1Repr | null) {\n        super(editor, savedData, 2, 1, 1)\n    }\n\n    public toJSON() {\n        return {\n            type: \"mux-2to1\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Mux4To1Def = defineMux(6, 1, \"mux-4to1\", \"Mux4To1\")\nexport type Mux4To1Repr = typeof Mux4To1Def.reprType\nexport class Mux4To1 extends Mux<6, 1, Mux4To1Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Mux4To1Repr | null) {\n        super(editor, savedData, 4, 2, 1)\n    }\n\n    public toJSON() {\n        return {\n            type: \"mux-4to1\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Mux8To1Def = defineMux(11, 1, \"mux-8to1\", \"Mux8To1\")\nexport type Mux8To1Repr = typeof Mux8To1Def.reprType\nexport class Mux8To1 extends Mux<11, 1, Mux8To1Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Mux8To1Repr | null) {\n        super(editor, savedData, 8, 3, 1)\n    }\n\n    public toJSON() {\n        return {\n            type: \"mux-8to1\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Mux4To2Def = defineMux(5, 2, \"mux-4to2\", \"Mux4To2\")\nexport type Mux4To2Repr = typeof Mux4To2Def.reprType\nexport class Mux4To2 extends Mux<5, 2, Mux4To2Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Mux4To2Repr | null) {\n        super(editor, savedData, 4, 1, 2)\n    }\n\n    public toJSON() {\n        return {\n            type: \"mux-4to2\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Mux8To2Def = defineMux(10, 2, \"mux-8to2\", \"Mux8To2\")\nexport type Mux8To2Repr = typeof Mux8To2Def.reprType\nexport class Mux8To2 extends Mux<10, 2, Mux8To2Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Mux8To2Repr | null) {\n        super(editor, savedData, 8, 2, 2)\n    }\n\n    public toJSON() {\n        return {\n            type: \"mux-8to2\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\nexport const Mux8To4Def = defineMux(9, 4, \"mux-8to4\", \"Mux8To4\")\nexport type Mux8To4Repr = typeof Mux8To4Def.reprType\nexport class Mux8To4 extends Mux<9, 4, Mux8To4Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Mux8To4Repr | null) {\n        super(editor, savedData, 8, 1, 4)\n    }\n\n    public toJSON() {\n        return {\n            type: \"mux-8to4\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n\n\nexport const Mux16To8Def = defineMux(17, 8, \"mux-16to8\", \"Mux16To8\")\nexport type Mux16To8Repr = typeof Mux16To8Def.reprType\nexport class Mux16To8 extends Mux<17, 8, Mux16To8Repr> {\n\n    public constructor(editor: LogicEditor, savedData: Mux16To8Repr | null) {\n        super(editor, savedData, 16, 1, 8)\n    }\n\n    public toJSON() {\n        return {\n            type: \"mux-16to8\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n}\n", "import * as t from \"io-ts\"\nimport { circle, COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, COLOR_UNKNOWN, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedArrayFill, isDefined, isNotNull, LogicValue, Mode, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { Gate2Type, Gate2Types_ } from \"./Gate\"\n\nconst GRID_WIDTH = 4\nconst GRID_HEIGHT = 19\n\nconst INPUT = {\n    A: [0, 1, 2, 3] as const,\n    B: [4, 5, 6, 7] as const,\n}\n\nconst OUTPUT = {\n    S: [0, 1, 2, 3] as const,\n}\n\n\nexport const QuadGateDef =\n    defineComponent(8, 4, t.type({\n        type: t.literal(\"quad-gate\"),\n        subtype: t.keyof(Gate2Types_),\n        showAsUnknown: typeOrUndefined(t.boolean),\n    }, \"QuadGate\"))\n\nexport type QuadGateRepr = typeof QuadGateDef.reprType\n\nconst QuadGateDefaults = {\n    subtype: \"AND\",\n    showAsUnknown: false,\n} as const\n\nexport class QuadGate extends ComponentBase<8, 4, QuadGateRepr, FixedArray<LogicValue, 4>> {\n\n    private _subtype: Gate2Type\n    private _showAsUnknown: boolean\n\n    public constructor(editor: LogicEditor, savedData: QuadGateRepr | null) {\n        super(editor, FixedArrayFill(false, 4), savedData, {\n            ins: [\n                // A\n                [\"A0\", -3, -8, \"w\", \"A\"],\n                [\"A1\", -3, -6, \"w\", \"A\"],\n                [\"A2\", -3, -4, \"w\", \"A\"],\n                [\"A3\", -3, -2, \"w\", \"A\"],\n                // B\n                [\"B0\", -3, 2, \"w\", \"B\"],\n                [\"B1\", -3, 4, \"w\", \"B\"],\n                [\"B2\", -3, 6, \"w\", \"B\"],\n                [\"B3\", -3, 8, \"w\", \"B\"],\n            ],\n            outs: [\n                [\"S0\", 3, -3, \"e\", \"S\"],\n                [\"S1\", 3, -1, \"e\", \"S\"],\n                [\"S2\", 3, 1, \"e\", \"S\"],\n                [\"S3\", 3, 3, \"e\", \"S\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._subtype = savedData.subtype\n            this._showAsUnknown = savedData.showAsUnknown ?? QuadGateDefaults.showAsUnknown\n        } else {\n            this._subtype = QuadGateDefaults.subtype\n            this._showAsUnknown = QuadGateDefaults.showAsUnknown\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"quad-gate\" as const,\n            subtype: this._subtype,\n            ...this.toJSONBase(),\n            showAsUnknown: this._showAsUnknown === QuadGateDefaults.showAsUnknown ? undefined : this._showAsUnknown,\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.QuadGate.tooltip\n        const opDesc = S.Components.Gate[this._subtype][0]\n        return tooltipContent(s.title, mods(\n            div(s.desc.expand({ op: opDesc })),\n        ))\n    }\n\n    protected doRecalcValue(): FixedArray<LogicValue, 4> {\n        const out = Gate2Types_[this._subtype].out\n\n        const a = this.inputValues<4>(INPUT.A)\n        const b = this.inputValues<4>(INPUT.B)\n\n        const s = FixedArrayFill(Unknown as LogicValue, 4)\n        for (let i = 0; i < 4; i++) {\n            const ai = a[i]\n            const bi = b[i]\n            if (typeof ai === \"boolean\" && typeof bi === \"boolean\") {\n                s[i] = out(ai, bi)\n            }\n        }\n        return s\n    }\n\n    protected override propagateValue(newValue: FixedArray<LogicValue, 4>) {\n        for (let i = 0; i < OUTPUT.S.length; i++) {\n            this.outputs[OUTPUT.S[i]].value = newValue[i]\n        }\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = this.posX + width / 2\n        let top = this.posY - height / 2\n        let bottom = this.posY + height / 2\n\n        // inputs\n        for (let i = 0; i < INPUT.A.length; i++) {\n            const inputi = this.inputs[INPUT.A[i]]\n            drawWireLineToComponent(g, inputi, left, inputi.posYInParentTransform)\n        }\n        for (let i = 0; i < INPUT.B.length; i++) {\n            const inputi = this.inputs[INPUT.B[i]]\n            drawWireLineToComponent(g, inputi, left, inputi.posYInParentTransform)\n        }\n        // outputs\n        for (let i = 0; i < OUTPUT.S.length; i++) {\n            const outputi = this.outputs[OUTPUT.S[i]]\n            drawWireLineToComponent(g, outputi, right, outputi.posYInParentTransform)\n        }\n\n\n        // outline\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n\n        if (this._showAsUnknown) {\n            ctx.inNonTransformedFrame(() => {\n                g.fillStyle = COLOR_UNKNOWN\n                g.textAlign = \"center\"\n                g.font = \"bold 20px sans-serif\"\n                g.fillText('?', this.posX, this.posY)\n            })\n        } else {\n            // draw gate type\n            g.lineWidth = 2\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n            g.beginPath()\n\n            top = this.posY - GRID_STEP\n            bottom = this.posY + GRID_STEP\n            let gateLeft = left + 10\n            const gateRight = right - 10\n            const pi2 = Math.PI / 2\n            const type = this._subtype\n\n            const drawRightCircle = () => {\n                g.beginPath()\n                circle(g, gateRight + 3, this.posY, 5)\n                g.stroke()\n            }\n            const drawLeftCircle = (up: boolean) => {\n                g.beginPath()\n                circle(g, gateLeft - 3, this.posY - (up ? 1 : -1) * 4, 5)\n                g.stroke()\n            }\n\n\n            switch (type) {\n                case \"AND\":\n                case \"NAND\":\n                case \"NIMPLY\":\n                case \"RNIMPLY\": {\n                    g.moveTo(this.posX, bottom)\n                    g.lineTo(gateLeft, bottom)\n                    g.lineTo(gateLeft, top)\n                    g.lineTo(this.posX, top)\n                    g.arc(this.posX, this.posY, GRID_STEP, -pi2, pi2)\n                    g.closePath()\n                    g.stroke()\n                    g.beginPath()\n                    if (type.startsWith(\"NAND\")) {\n                        drawRightCircle()\n                    }\n                    if (type === \"NIMPLY\") {\n                        drawLeftCircle(false)\n                    } else if (type === \"RNIMPLY\") {\n                        drawLeftCircle(true)\n                    }\n                    break\n                }\n\n\n\n                case \"OR\":\n                case \"NOR\":\n                case \"XOR\":\n                case \"XNOR\":\n                case \"IMPLY\":\n                case \"RIMPLY\": {\n                    g.beginPath()\n                    g.moveTo(gateLeft, top)\n                    g.lineTo(this.posX - 5, top)\n                    g.bezierCurveTo(this.posX + 2, top, gateRight - 5, this.posY - 8,\n                        gateRight, this.posY)\n                    g.bezierCurveTo(gateRight - 5, this.posY + 8, this.posX + 2, bottom,\n                        this.posX - 5, bottom)\n                    g.lineTo(gateLeft, bottom)\n                    g.quadraticCurveTo(this.posX - 4, this.posY, gateLeft, top)\n                    g.closePath()\n                    g.stroke()\n                    const savedGateLeft = gateLeft\n                    gateLeft += 2\n                    if (type.startsWith(\"NOR\") || type.startsWith(\"XNOR\")) {\n                        drawRightCircle()\n                    }\n                    if (type === \"IMPLY\") {\n                        drawLeftCircle(true)\n                    } else if (type === \"RIMPLY\") {\n                        drawLeftCircle(false)\n                    }\n                    if (type.startsWith(\"X\")) {\n                        g.beginPath()\n                        g.moveTo(savedGateLeft - 4, bottom)\n                        g.quadraticCurveTo(this.posX - 8, this.posY, savedGateLeft - 4, top)\n                        g.stroke()\n                    }\n                    break\n                }\n\n                case \"TXA\":\n                case \"TXNA\": {\n                    g.beginPath()\n                    g.moveTo(gateLeft, bottom)\n                    g.lineTo(gateLeft, top)\n                    g.lineTo(gateRight, this.posY)\n                    g.lineTo(gateLeft + 2, this.posY)\n                    g.stroke()\n                    if (type === \"TXNA\") {\n                        drawLeftCircle(true)\n                    }\n                    break\n                }\n\n                case \"TXB\":\n                case \"TXNB\": {\n                    g.beginPath()\n                    g.moveTo(gateLeft, top)\n                    g.lineTo(gateLeft, bottom)\n                    g.lineTo(gateRight, this.posY)\n                    g.lineTo(gateLeft + 2, this.posY)\n                    g.stroke()\n                    if (type === \"TXNB\") {\n                        drawLeftCircle(false)\n                    }\n                    break\n                }\n            }\n        }\n\n    }\n\n    private doSetSubtype(newSubtype: Gate2Type) {\n        this._subtype = newSubtype\n        this.setNeedsRecalc()\n        this.setNeedsRedraw(\"quad gate type changed\")\n    }\n\n    private doSetShowAsUnknown(showAsUnknown: boolean) {\n        this._showAsUnknown = showAsUnknown\n        this.setNeedsRedraw(\"display as unknown changed\")\n    }\n\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const s = S.Components.QuadGate.contextMenu\n\n        const typeItems: ContextMenuData = []\n        for (const subtype of [\"AND\", \"OR\", \"XOR\", \"NAND\", \"NOR\", \"XNOR\"] as const) {\n            const icon = this._subtype === subtype ? \"check\" : \"none\"\n            typeItems.push(ContextMenuData.item(icon, subtype, () => {\n                this.doSetSubtype(subtype)\n            }))\n        }\n\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            [\"mid\", ContextMenuData.submenu(\"settings\", s.Type, typeItems)],\n        ]\n\n        if (this.editor.mode >= Mode.FULL) {\n            const showAsUnknownItem = ContextMenuData.item(this._showAsUnknown ? \"check\" : \"none\", s.ShowAsUnknown, () => {\n                this.doSetShowAsUnknown(!this._showAsUnknown)\n            })\n\n            items.push(\n                [\"mid\", showAsUnknownItem],\n            )\n        }\n\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isDefined(forceOutputItem)) {\n            items.push(\n                [\"mid\", ContextMenuData.sep()],\n                [\"mid\", forceOutputItem]\n            )\n        }\n\n        return items\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { colorForBoolean, COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArrayFill, FixedReadonlyArray, HighImpedance, isHighImpedance, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { DrawContext } from \"./Drawable\"\n\nexport const QuadTriStateDef =\n    defineComponent(5, 4, t.type({\n        type: t.literal(\"quad-tristate\"),\n    }, \"QuadTriState\"))\n\nconst INPUT = {\n    I: [0, 1, 2, 3] as const,\n    E: 4 as const,\n}\n\nconst GRID_WIDTH = 4\nconst GRID_HEIGHT = 8\n\nexport type QuadTriStateRepr = typeof QuadTriStateDef.reprType\n\nexport class QuadTriState extends ComponentBase<5, 4, QuadTriStateRepr, FixedReadonlyArray<LogicValue, 4>> {\n\n    public constructor(editor: LogicEditor, savedData: QuadTriStateRepr | null) {\n        super(editor, FixedArrayFill(HighImpedance, 4), savedData, {\n            ins: [\n                [\"I0\", -3, -3, \"w\", \"In\"],\n                [\"I1\", -3, -1, \"w\", \"In\"],\n                [\"I2\", -3, +1, \"w\", \"In\"],\n                [\"I3\", -3, +3, \"w\", \"In\"],\n                [\"E (Enable)\", 0, -5, \"n\"],\n            ],\n            outs: [\n                [\"O0\", +3, -3, \"e\", \"Out\"],\n                [\"O1\", +3, -1, \"e\", \"Out\"],\n                [\"O2\", +3, +1, \"e\", \"Out\"],\n                [\"O3\", +3, +3, \"e\", \"Out\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"quad-tristate\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.QuadTriState.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc)\n        ))\n    }\n\n    protected doRecalcValue(): FixedReadonlyArray<LogicValue, 4> {\n        const input = this.inputValues<4>(INPUT.I)\n        const enable = this.inputs[INPUT.E].value\n\n        if (isUnknown(enable) || isHighImpedance(enable)) {\n            return FixedArrayFill(Unknown, 4)\n        }\n\n        if (!enable) {\n            return FixedArrayFill(HighImpedance, 4)\n        }\n\n        return input\n    }\n\n    protected override propagateValue(newValue: FixedReadonlyArray<LogicValue, 4>) {\n        for (let i = 0; i < 4; i++) {\n            this.outputs[i].value = newValue[i]\n        }\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        const enable = this.inputs[INPUT.E].value\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = left + width\n        const top = this.posY - height / 2\n        // const bottom = top + height\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        g.lineWidth = 2\n        g.strokeStyle = colorForBoolean(enable)\n        g.beginPath()\n        g.moveTo(this.posX, top + 3)\n        g.lineTo(this.posX, this.posY - 4)\n        g.stroke()\n\n        g.strokeStyle = COLOR_COMPONENT_BORDER\n        g.beginPath()\n        g.moveTo(left + 12, this.posY - 8)\n        g.lineTo(right - 13, this.posY)\n        g.lineTo(left + 12, this.posY + 8)\n        g.closePath()\n        g.stroke()\n\n\n        for (const i of INPUT.I) {\n            const input = this.inputs[i]\n            drawWireLineToComponent(g, input, left - 2, input.posYInParentTransform)\n        }\n\n        drawWireLineToComponent(g, this.inputs[INPUT.E], this.inputs[INPUT.E].posXInParentTransform, top - 2)\n\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 2, output.posYInParentTransform)\n        }\n    }\n}\n", "import * as t from \"io-ts\"\nimport { colorForBoolean, COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_EMPTY, COLOR_MOUSE_OVER, displayValuesFromArray, drawLabel, drawWireLineToComponent, strokeSingleLine } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedArrayFill, FixedArrayFillFactory, FixedArraySize, FixedReadonlyArray, isDefined, isNotNull, isNull, isUndefined, isUnknown, LogicValue, toLogicValueFromChar, toLogicValueRepr, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBaseWithSubclassDefinedNodes, ComponentRepr, defineComponent, NodeVisual, NodeVisuals } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext, Orientation } from \"./Drawable\"\nimport { EdgeTrigger, Flipflop, makeTriggerItems } from \"./FlipflopOrLatch\"\n\nfunction defineRAM<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize, N extends string>(numInputs: NumInputs, numOutputs: NumOutputs, jsonName: N, className: string) {\n    return defineComponent(numInputs, numOutputs, t.type({\n        type: t.literal(jsonName),\n        showContent: typeOrUndefined(t.boolean),\n        trigger: typeOrUndefined(t.keyof(EdgeTrigger)),\n        content: typeOrUndefined(t.union([t.string, t.array(t.string)])),\n    }, className))\n}\n\ntype RAMRepr<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize> =\n    ComponentRepr<NumInputs, NumOutputs> & {\n    showContent: boolean | undefined,\n    trigger: EdgeTrigger | undefined,\n    content: string | string[] | undefined,\n}\n\n\nconst RAMDefaults = {\n    showContent: true,\n    trigger: EdgeTrigger.rising,\n}\n\ntype RAMValue<BitWidth extends FixedArraySize> = {\n    mem: Array<FixedArray<LogicValue, BitWidth>>\n    out: FixedReadonlyArray<LogicValue, BitWidth>\n}\n\ntype RAMInputIndices<NumDataBits extends FixedArraySize, NumAddressBits extends FixedArraySize> = {\n    Clock: number,\n    WriteEnable: number,\n    Clear: number,\n    Data: FixedArray<number, NumDataBits>,\n    Address: FixedArray<number, NumAddressBits>,\n}\n\ntype RAMOutputIndices<NumDataBits extends FixedArraySize> = {\n    Q: FixedArray<number, NumDataBits>,\n}\n\nabstract class RAM<NumInputs extends FixedArraySize,\n    NumOutputs extends FixedArraySize,\n    NumAddressBits extends FixedArraySize,\n    Repr extends RAMRepr<NumInputs, NumOutputs>\n>\n    extends ComponentBaseWithSubclassDefinedNodes<\n        RAMInputIndices<NumOutputs, NumAddressBits>,\n        RAMOutputIndices<NumOutputs>,\n        NumInputs, NumOutputs, Repr, RAMValue<NumOutputs>\n    > {\n\n    private static generateInOffsets(numWords: number, wordWidth: number, numAddressBits: number): NodeVisual[] {\n        const gridHeight = RAM.gridHeight(numWords)\n        const bottomOffset = Math.floor((gridHeight + 1) / 2)\n        const topOffset = -bottomOffset\n        const clockYOffset = bottomOffset - 2\n\n        const ins: NodeVisual[] = [\n            [S.Components.Generic.InputClockDesc, -7, clockYOffset, \"w\"], // Clock\n            [S.Components.Generic.InputWriteEnableDesc, -2, bottomOffset, \"s\"], // WriteEnable\n            [S.Components.Generic.InputClearDesc, +2, bottomOffset, \"s\"], // Clear\n        ]\n\n        // Data in\n        const spacing = wordWidth >= 7 ? 1 : 2\n        const topInOffset = spacing === 1 ? -Math.round(wordWidth / 2) : -(wordWidth - 1) / 2 * spacing\n        for (let i = 0; i < wordWidth; i++) {\n            ins.push([`D${i}`, -7, topInOffset + i * spacing, \"w\", \"D\"])\n        }\n\n        // Address\n        const rightAddrOffset = numAddressBits - 1\n        for (let i = 0; i < numAddressBits; i++) {\n            ins.push([`Addr${i}`, rightAddrOffset - i * 2, topOffset, \"n\", \"Addr\"])\n        }\n        return ins\n    }\n\n    private static generateOutOffsets<NumOutputs extends FixedArraySize>(wordWidth: NumOutputs): FixedArray<NodeVisual, NumOutputs> {\n        const spacing = wordWidth >= 7 ? 1 : 2\n        const topOffset = spacing === 1 ? -Math.round(wordWidth / 2) : -(wordWidth - 1) / 2 * spacing\n        return FixedArrayFillFactory(i => [`Q${i}`, +7, topOffset + i * spacing, \"e\", \"Q\"], wordWidth)\n    }\n\n    protected static generateInputIndices<NumDataBits extends FixedArraySize, NumAddressBits extends FixedArraySize>(numDataBits: NumDataBits, numAdressBits: NumAddressBits): RAMInputIndices<NumDataBits, NumAddressBits> {\n        const numFixedInputs = 3\n        const Data = FixedArrayFillFactory(i => i + numFixedInputs, numDataBits)\n        const Address = FixedArrayFillFactory(i => i + numFixedInputs + numDataBits, numAdressBits)\n        return {\n            Clock: 0,\n            WriteEnable: 1,\n            Clear: 2,\n            Data,\n            Address,\n        }\n    }\n\n    protected static generateOutputIndices<NumDataBits extends FixedArraySize>(numDataBits: NumDataBits): RAMOutputIndices<NumDataBits> {\n        return {\n            Q: FixedArrayFillFactory(i => i, numDataBits),\n        }\n    }\n\n    private static gridHeight(numWords: number): number {\n        return numWords <= 16 ? 15 : 21\n    }\n\n    private static valueFilledWith<NumOutputs extends FixedArraySize>(v: LogicValue, numWords: number, wordWidth: NumOutputs): RAMValue<NumOutputs> {\n        const mem: Array<FixedArray<LogicValue, NumOutputs>> = new Array(numWords)\n        for (let i = 0; i < numWords; i++) {\n            mem[i] = FixedArrayFill(v, wordWidth)\n        }\n        const out = FixedArrayFill(v, wordWidth)\n        return { mem, out }\n    }\n\n    private static savedStateFrom<NumInputs extends FixedArraySize, NumOutputs extends FixedArraySize>(savedData: RAMRepr<NumInputs, NumOutputs> | null, numWords: number, wordWidth: NumOutputs): RAMValue<NumOutputs> {\n        if (isNull(savedData) || isUndefined(savedData.content)) {\n            return RAM.valueFilledWith(false, numWords, wordWidth)\n        }\n        const mem: Array<FixedArray<LogicValue, NumOutputs>> = new Array(numWords)\n        const savedContent = Array.isArray(savedData.content) ? savedData.content : savedData.content.split(\" \")\n        for (let i = 0; i < numWords; i++) {\n            const row = FixedArrayFill<LogicValue, NumOutputs>(false, wordWidth)\n            if (i < savedContent.length) {\n                const savedWordRepr = savedContent[i]\n                const len = savedWordRepr.length\n                const isBinary = len === wordWidth\n                const savedBits = isBinary ? savedWordRepr : parseInt(savedWordRepr, 16).toString(2).padStart(wordWidth, \"0\")\n\n                console.log(savedBits)\n\n                for (let j = 0; j < wordWidth; j++) {\n                    const jj = wordWidth - j - 1\n                    if (jj >= 0) {\n                        row[j] = toLogicValueFromChar(savedBits[jj])\n                    } else {\n                        break\n                    }\n                }\n            }\n            mem[i] = row\n        }\n        const out = [...mem[0]] as FixedArray<LogicValue, NumOutputs>\n        return { mem, out }\n    }\n\n    private _numWords: number\n    private _wordWidth: NumOutputs\n    private _showContent: boolean = RAMDefaults.showContent\n    private _trigger: EdgeTrigger = RAMDefaults.trigger\n    private _lastClock: LogicValue = Unknown\n\n    protected constructor(editor: LogicEditor, savedData: Repr | null, numWords: number, wordWidth: NumOutputs, numAddressBits: NumAddressBits) {\n        super(editor, 11, RAM.gridHeight(numWords),\n            RAM.generateInputIndices(wordWidth, numAddressBits),\n            RAM.generateOutputIndices(wordWidth),\n            RAM.savedStateFrom<NumInputs, NumOutputs>(savedData, numWords, wordWidth),\n            savedData, {\n                ins: RAM.generateInOffsets(numWords, wordWidth, numAddressBits),\n                outs: RAM.generateOutOffsets(wordWidth),\n            } as unknown as NodeVisuals<NumInputs, NumOutputs>)\n        this._numWords = numWords\n        this._wordWidth = wordWidth\n        if (isNotNull(savedData)) {\n            this._showContent = savedData.showContent ?? RAMDefaults.showContent\n            this._trigger = savedData.trigger ?? RAMDefaults.trigger\n        }\n        const INPUT = this.INPUT\n        this.setInputsPreferSpike(INPUT.Clock, INPUT.Clear)\n    }\n\n    protected override toJSONBase() {\n        return {\n            ...super.toJSONBase(),\n            showContent: (this._showContent !== RAMDefaults.showContent) ? this._showContent : undefined,\n            trigger: (this._trigger !== RAMDefaults.trigger) ? this._trigger : undefined,\n            content: this.contentRepr(),\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get trigger() {\n        return this._trigger\n    }\n\n    private contentRepr(): string | undefined {\n        const cells: string[] = []\n        const useHex = this._wordWidth >= 8\n        const hexWidth = Math.ceil(this._wordWidth / 4)\n        for (let addr = 0; addr < this._numWords; addr++) {\n            let wordRepr = this.value.mem[addr].map(toLogicValueRepr).reverse().join(\"\")\n            if (useHex) {\n                wordRepr = parseInt(wordRepr, 2).toString(16).toUpperCase().padStart(hexWidth, \"0\")\n            }\n            cells.push(wordRepr)\n        }\n        let numToSkip = 0\n        for (let addr = this._numWords - 1; addr >= 0; addr--) {\n            if (isAllZeros(cells[addr])) {\n                numToSkip++\n            } else {\n                if (numToSkip > 0) {\n                    cells.splice(addr + 1, numToSkip)\n                }\n                break\n            }\n        }\n        return cells.length === 0 ? undefined : cells.join(\" \")\n    }\n\n\n    protected doRecalcValue(): RAMValue<NumOutputs> {\n        const INPUT = this.INPUT\n        const clear = this.inputs[INPUT.Clear].value\n        const numWords = this._numWords\n        if (clear === true) {\n            // clear is true, preset is false, set output to 0\n            return RAM.valueFilledWith(false, numWords, this._wordWidth)\n        }\n\n        // first, determine output\n        const addr = this.currentAddress()\n\n        const prevClock = this._lastClock\n        const clock = this._lastClock = this.inputs[INPUT.Clock].value\n\n        // handle normal operation\n        const oldState = this.value\n        const we = this.inputs[INPUT.WriteEnable].value\n        if (we !== true || !Flipflop.isClockTrigger(this.trigger, prevClock, clock)) {\n            // nothing to write, just update output\n            const out = isUnknown(addr) ? FixedArrayFill(Unknown, this._wordWidth) : oldState.mem[addr]\n            return { mem: oldState.mem, out }\n        }\n\n        // we write\n        if (isUnknown(addr)) {\n            return RAM.valueFilledWith(Unknown, numWords, this._wordWidth)\n        }\n\n        // build new state\n        const newData = this.inputValues<NumOutputs>(INPUT.Data)\n        const newState: Array<FixedArray<LogicValue, NumOutputs>> = new Array(numWords)\n        for (let i = 0; i < numWords; i++) {\n            if (i === addr) {\n                newState[i] = newData\n            } else {\n                newState[i] = oldState.mem[i]\n            }\n        }\n        return { mem: newState, out: newData }\n    }\n\n    private currentAddress(): number | Unknown {\n        const addrBits = this.inputValues<NumAddressBits>(this.INPUT.Address)\n        const [__, addr] = displayValuesFromArray(addrBits, false)\n        return addr\n    }\n\n    protected override propagateValue(newValue: RAMValue<NumOutputs>) {\n        const OUTPUT = this.OUTPUT\n        for (let i = 0; i < OUTPUT.Q.length; i++) {\n            this.outputs[OUTPUT.Q[i]].value = newValue.out[i]\n        }\n    }\n\n    protected doSetShowContent(showContent: boolean) {\n        this._showContent = showContent\n        this.setNeedsRedraw(\"show content changed\")\n    }\n\n    protected doSetTrigger(trigger: EdgeTrigger) {\n        this._trigger = trigger\n        this.setNeedsRedraw(\"trigger changed\")\n    }\n\n\n    public override makeTooltip() {\n        const s = S.Components.RAM.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc.expand({ numWords: this._numWords, wordWidth: this._wordWidth }))\n            // TODO more info\n        ))\n    }\n\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const INPUT = this.INPUT\n        const OUTPUT = this.OUTPUT\n\n        const width = this.unrotatedWidth\n        const height = this.unrotatedHeight\n        const left = this.posX - width / 2\n        const right = this.posX + width / 2\n        const top = this.posY - height / 2\n        const bottom = this.posY + height / 2\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n        g.fillStyle = COLOR_BACKGROUND\n\n        Flipflop.drawClockInput(g, left, this.inputs[INPUT.Clock], this._trigger)\n        drawWireLineToComponent(g, this.inputs[INPUT.WriteEnable], this.inputs[INPUT.WriteEnable].posXInParentTransform, bottom + 2, false)\n        drawWireLineToComponent(g, this.inputs[INPUT.Clear], this.inputs[INPUT.Clear].posXInParentTransform, bottom + 2, false)\n        for (const i of INPUT.Data) {\n            drawWireLineToComponent(g, this.inputs[i], left - 1, this.inputs[i].posYInParentTransform, false)\n        }\n        for (const i of INPUT.Address) {\n            drawWireLineToComponent(g, this.inputs[i], this.inputs[i].posXInParentTransform, top, false)\n        }\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 1, output.posYInParentTransform, false)\n        }\n\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (!this._showContent || this.editor.options.hideMemoryContent) {\n                g.font = `bold 18px sans-serif`\n                g.fillStyle = COLOR_COMPONENT_BORDER\n                g.textAlign = \"center\"\n                g.textBaseline = \"middle\"\n                g.fillText(\"RAM\", this.posX, this.posY - 6)\n                g.font = `11px sans-serif`\n                g.fillText(`${this._numWords} \u00D7 ${this._wordWidth} bits`, this.posX, this.posY + 12)\n            } else {\n                const mem = this.value.mem\n                const addr = this.currentAddress()\n                const numWords = this._numWords\n                const wordWidth = this._wordWidth\n                const showSingleVerticalBlock = numWords <= 16 || !Orientation.isVertical(this.orient)\n                const cellHeight = numWords <= 16\n                    ? Orientation.isVertical(this.orient) ? 4.5 : 6\n                    : 2.5\n\n                // Modification CMN for bigger wordWith\n                if (showSingleVerticalBlock) {\n                    const cellWidth = wordWidth <= 4 ? 10 : wordWidth <= 8 ? 8 : 6\n                    drawMemoryCells(g, mem, wordWidth, addr, 0, numWords, this.posX + 2, this.posY, cellWidth, cellHeight)\n                } else {\n                    const cellWidth = wordWidth <= 8 ? 6.5 : 4\n                    drawMemoryCells(g, mem, wordWidth, addr, 0, numWords / 2, this.posX + 2 - 38, this.posY, cellWidth, cellHeight)\n                    drawMemoryCells(g, mem, wordWidth, addr, numWords / 2, numWords, this.posX + 2 + 38, this.posY, cellWidth, cellHeight)\n                }\n\n            }\n\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"WE\", \"s\", this.inputs[INPUT.WriteEnable], bottom)\n            drawLabel(ctx, this.orient, \"Clr\", \"s\", this.inputs[INPUT.Clear], bottom)\n\n            g.font = \"bold 12px sans-serif\"\n            const zero = 0 as number\n            drawLabel(ctx, this.orient, \"Addr\", \"n\", this.posX, top, this.inputs[INPUT.Address[zero]])\n            drawLabel(ctx, this.orient, \"D\", \"w\", left, this.posY, this.inputs[INPUT.Data[zero]])\n            drawLabel(ctx, this.orient, \"Q\", \"e\", right, this.posY, this.outputs[OUTPUT.Q[zero]])\n        })\n\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const icon = this._showContent ? \"check\" : \"none\"\n        const toggleShowOpItem = ContextMenuData.item(icon, S.Components.Generic.contextMenu.ShowContent,\n            () => this.doSetShowContent(!this._showContent))\n\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            ...makeTriggerItems(this._trigger, this.doSetTrigger.bind(this)),\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", toggleShowOpItem]]\n\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isDefined(forceOutputItem)) {\n            items.push(\n                [\"mid\", forceOutputItem]\n            )\n        }\n\n        return items\n    }\n\n\n}\n\n\n\nexport const RAM16x4Def =\n    defineRAM(11, 4, \"ram-16x4\", \"RAM16x4\")\n\nexport type RAM16x4Repr = typeof RAM16x4Def.reprType\n\nexport class RAM16x4 extends RAM<11, 4, 4, RAM16x4Repr> {\n\n    public constructor(editor: LogicEditor, savedData: RAM16x4Repr | null) {\n        super(editor, savedData, 16, 4, 4)\n    }\n\n    public toJSON() {\n        return {\n            type: \"ram-16x4\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n}\n\n\n\nexport const RAM16x8Def =\n    defineRAM(15, 8, \"ram-16x8\", \"RAM16x8\")\n\nexport type RAM16x8Repr = typeof RAM16x8Def.reprType\n\nexport class RAM16x8 extends RAM<15, 8, 4, RAM16x8Repr> {\n\n    public constructor(editor: LogicEditor, savedData: RAM16x8Repr | null) {\n        super(editor, savedData, 16, 8, 4)\n    }\n\n    public toJSON() {\n        return {\n            type: \"ram-16x8\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n}\n\nexport const RAM64x8Def =\n    defineRAM(17, 8, \"ram-64x8\", \"RAM64x8\")\n\nexport type RAM64x8Repr = typeof RAM64x8Def.reprType\n\nexport class RAM64x8 extends RAM<17, 8, 6, RAM64x8Repr> {\n\n    public constructor(editor: LogicEditor, savedData: RAM64x8Repr | null) {\n        super(editor, savedData, 64, 8, 6)\n    }\n\n    public toJSON() {\n        return {\n            type: \"ram-64x8\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n}\n\nexport const RAM32x12Def =\n    defineRAM(20, 12, \"ram-32x12\", \"RAM32x12\")\n\nexport type RAM32x12Repr = typeof RAM32x12Def.reprType\n\nexport class RAM32x12 extends RAM<20, 12, 5, RAM32x12Repr> {\n\n    protected static INPUT = RAM.generateInputIndices(12, 5)\n    protected static OUTPUT = RAM.generateOutputIndices(12)\n\n\n    public constructor(editor: LogicEditor, savedData: RAM32x12Repr | null) {\n        super(editor, savedData, 32, 12, 5)\n    }\n\n    public toJSON() {\n        return {\n            type: \"ram-32x12\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n}\n\nfunction isAllZeros(s: string) {\n    for (let i = 0; i < s.length; i++) {\n        if (s[i] !== \"0\") {\n            return false\n        }\n    }\n    return true\n}\n\nexport function drawMemoryCells<N extends FixedArraySize>(g: CanvasRenderingContext2D, mem: Array<FixedReadonlyArray<LogicValue, N>>, wordWidth: N, addr: number | Unknown, start: number, end: number, centerX: number, centerY: number, cellWidth: number, cellHeight: number,) {\n    const numCellsToDraw = end - start\n    const contentTop = centerY - numCellsToDraw / 2 * cellHeight\n    const contentLeft = centerX - wordWidth / 2 * cellWidth\n    const contentRight = contentLeft + wordWidth * cellWidth\n    const contentBottom = contentTop + numCellsToDraw * cellHeight\n\n    // by default, paint everything as zero\n    g.fillStyle = COLOR_EMPTY\n    g.fillRect(contentLeft, contentTop, contentRight - contentLeft, contentBottom - contentTop)\n\n    for (let i = start; i < end; i++) {\n        for (let j = 0; j < wordWidth; j++) {\n            const v = mem[i][wordWidth - j - 1]\n            if (v !== false) {\n                g.fillStyle = colorForBoolean(v)\n                g.fillRect(contentLeft + j * cellWidth, contentTop + i * cellHeight, cellWidth, cellHeight)\n            }\n        }\n    }\n\n    g.strokeStyle = COLOR_COMPONENT_BORDER\n    g.lineWidth = 0.5\n    for (let i = 1; i < numCellsToDraw; i++) {\n        const y = contentTop + i * cellHeight\n        strokeSingleLine(g, contentLeft, y, contentRight, y)\n    }\n    for (let j = 1; j < wordWidth; j++) {\n        const x = contentLeft + j * cellWidth\n        strokeSingleLine(g, x, contentTop, x, contentBottom)\n    }\n    const borderLineWidth = 2\n    g.lineWidth = borderLineWidth\n    g.strokeRect(contentLeft - borderLineWidth / 2, contentTop - borderLineWidth / 2, contentRight - contentLeft + borderLineWidth, contentBottom - contentTop + borderLineWidth)\n    if (!isUnknown(addr) && addr >= start && addr < end) {\n        const arrowY = contentTop + (addr - start) * cellHeight + cellHeight / 2\n        const arrowRight = contentLeft - 3\n        const arrowWidth = 8\n        const arrowHalfHeight = 3\n        g.beginPath()\n        g.moveTo(arrowRight, arrowY)\n        g.lineTo(arrowRight - arrowWidth, arrowY + arrowHalfHeight)\n        g.lineTo(arrowRight - arrowWidth + 2, arrowY)\n        g.lineTo(arrowRight - arrowWidth, arrowY - arrowHalfHeight)\n        g.closePath()\n        g.fillStyle = COLOR_COMPONENT_BORDER\n        g.fill()\n    }\n}", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_BACKGROUND_INVALID, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, isDefined, isNotNull, isNull, isUndefined, LogicValue, LogicValueRepr, toLogicValue, toLogicValueRepr, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { EdgeTrigger, Flipflop, FlipflopOrLatch, makeTriggerItems } from \"./FlipflopOrLatch\"\n\nconst GRID_WIDTH = 7\nconst GRID_HEIGHT = 15\n\nconst INPUT = {\n    Clock: 0,\n    Preset: 1,\n    Clear: 2,\n    Data: [3, 4, 5, 6],\n} as const\n\nconst OUTPUT = {\n    Q: [0, 1, 2, 3],\n}\n\nexport const RegisterDef =\n    defineComponent(7, 4, t.type({\n        type: t.literal(\"register\"),\n        state: typeOrUndefined(t.tuple([LogicValueRepr, LogicValueRepr, LogicValueRepr, LogicValueRepr])),\n        showContent: typeOrUndefined(t.boolean),\n        trigger: typeOrUndefined(t.keyof(EdgeTrigger)),\n    }, \"Register\"))\n\nexport type RegisterRepr = typeof RegisterDef.reprType\n\nconst RegisterDefaults = {\n    showContent: true,\n    trigger: EdgeTrigger.rising,\n}\n\nexport class Register extends ComponentBase<7, 4, RegisterRepr, FixedArray<LogicValue, 4>> {\n\n    protected _showContent: boolean = RegisterDefaults.showContent\n    protected _trigger: EdgeTrigger = RegisterDefaults.trigger\n    protected _isInInvalidState = false\n    protected _lastClock: LogicValue = Unknown\n\n    private static savedStateFrom(savedData: { state: FixedArray<LogicValueRepr, 4> | undefined } | null): FixedArray<LogicValue, 4> {\n        if (isNull(savedData) || isUndefined(savedData.state)) {\n            return [false, false, false, false]\n        }\n        return savedData.state.map(toLogicValue) as unknown as FixedArray<LogicValue, 4>\n    }\n\n    public constructor(editor: LogicEditor, savedData: RegisterRepr | null) {\n        super(editor, Register.savedStateFrom(savedData), savedData, {\n            ins: [\n                [S.Components.Generic.InputClockDesc, -5, +6, \"w\"], // Clock\n                [S.Components.Generic.InputPresetDesc, 0, -8, \"n\"], // Preset\n                [S.Components.Generic.InputClearDesc, 0, +8, \"s\"], // Clear\n                // Data in\n                [\"D0\", -5, -3, \"w\", \"D\"],\n                [\"D0\", -5, -1, \"w\", \"D\"],\n                [\"D0\", -5, +1, \"w\", \"D\"],\n                [\"D0\", -5, 3, \"w\", \"D\"],\n            ],\n            outs: [\n                // Data out\n                [\"Q0\", +5, -3, \"e\", \"Q\"],\n                [\"Q1\", +5, -1, \"e\", \"Q\"],\n                [\"Q2\", +5, +1, \"e\", \"Q\"],\n                [\"Q3\", +5, 3, \"e\", \"Q\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._showContent = savedData.showContent ?? RegisterDefaults.showContent\n            this._trigger = savedData.trigger ?? RegisterDefaults.trigger\n        }\n        this.setInputsPreferSpike(INPUT.Clock, INPUT.Preset, INPUT.Clear)\n    }\n\n    public toJSON() {\n        return {\n            type: \"register\" as const,\n            ...this.toJSONBase(),\n            state: this.value.map(toLogicValueRepr) as unknown as FixedArray<LogicValueRepr, 4>,\n            showContent: (this._showContent !== RegisterDefaults.showContent) ? this._showContent : undefined,\n            trigger: (this._trigger !== RegisterDefaults.trigger) ? this._trigger : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public get trigger() {\n        return this._trigger\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.Register.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc) // TODO more info\n        ))\n    }\n\n    protected doRecalcValue(): FixedArray<LogicValue, 4> {\n        const prevClock = this._lastClock\n        const clock = this._lastClock = this.inputs[INPUT.Clock].value\n        const { isInInvalidState, newState } =\n            Flipflop.doRecalcValueForSyncComponent(this, prevClock, clock,\n                this.inputs[INPUT.Preset].value,\n                this.inputs[INPUT.Clear].value)\n        this._isInInvalidState = isInInvalidState\n        return newState\n    }\n\n    public makeInvalidState(): FixedArray<LogicValue, 4> {\n        return [false, false, false, false]\n    }\n\n    public makeStateFromMainValue(val: LogicValue): FixedArray<LogicValue, 4> {\n        return [val, val, val, val]\n    }\n\n    public makeStateAfterClock(): FixedArray<LogicValue, 4> {\n        return INPUT.Data.map(i => this.inputs[i].value) as FixedArray<LogicValue, 4>\n    }\n\n    protected override propagateValue(newValue: FixedArray<LogicValue, 4>) {\n        for (let i = 0; i < newValue.length; i++) {\n            this.outputs[OUTPUT.Q[i]].value = newValue[i]\n        }\n    }\n\n    protected doSetShowContent(showContent: boolean) {\n        this._showContent = showContent\n        this.setNeedsRedraw(\"show content changed\")\n    }\n\n    protected doSetTrigger(trigger: EdgeTrigger) {\n        this._trigger = trigger\n        this.setNeedsRedraw(\"trigger changed\")\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = this.unrotatedWidth\n        const height = this.unrotatedHeight\n        const left = this.posX - width / 2\n        const right = this.posX + width / 2\n        const top = this.posY - height / 2\n        const bottom = this.posY + height / 2\n\n        g.fillStyle = this._isInInvalidState ? COLOR_BACKGROUND_INVALID : COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n        g.fillStyle = COLOR_BACKGROUND\n\n        Flipflop.drawClockInput(g, left, this.inputs[INPUT.Clock], this._trigger)\n        drawWireLineToComponent(g, this.inputs[INPUT.Preset], this.inputs[INPUT.Preset].posXInParentTransform, top - 2, false)\n        drawWireLineToComponent(g, this.inputs[INPUT.Clear], this.inputs[INPUT.Clear].posXInParentTransform, bottom + 2, false)\n        for (const i of INPUT.Data) {\n            drawWireLineToComponent(g, this.inputs[i], left - 2, this.inputs[i].posYInParentTransform, false)\n        }\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 2, output.posYInParentTransform, false)\n        }\n\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (this._showContent && !this.editor.options.hideMemoryContent) {\n                for (const output of this.outputs) {\n                    FlipflopOrLatch.drawStoredValue(g, output.value, this.posX, output.posYInParentTransform, 20)\n                }\n            } else {\n                g.font = `bold 14px sans-serif`\n                g.fillStyle = COLOR_COMPONENT_BORDER\n                g.textAlign = \"center\"\n                g.textBaseline = \"middle\"\n                g.fillText(\"Reg.\", this.posX, this.posY)\n            }\n\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"Pre\", \"n\", this.inputs[INPUT.Preset], top)\n            drawLabel(ctx, this.orient, \"Clr\", \"s\", this.inputs[INPUT.Clear], bottom)\n\n            g.font = \"bold 12px sans-serif\"\n            drawLabel(ctx, this.orient, \"Q\", \"e\", right, this.posY, this.outputs[OUTPUT.Q[0]])\n            drawLabel(ctx, this.orient, \"D\", \"w\", left, this.posY, this.inputs[INPUT.Data[0]])\n        })\n\n    }\n\n\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const icon = this._showContent ? \"check\" : \"none\"\n        const toggleShowOpItem = ContextMenuData.item(icon, S.Components.Generic.contextMenu.ShowContent,\n            () => this.doSetShowContent(!this._showContent))\n\n        const items: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            ...makeTriggerItems(this._trigger, this.doSetTrigger.bind(this)),\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", toggleShowOpItem],\n        ]\n\n        const forceOutputItem = this.makeForceOutputsContextMenuItem()\n        if (isDefined(forceOutputItem)) {\n            items.push(\n                [\"mid\", forceOutputItem]\n            )\n        }\n\n        return items\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { circle, colorForBoolean, COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, COLOR_UNKNOWN, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArrayFill, FixedReadonlyArray, isHighImpedance, isUnknown, LogicValue, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { DrawContext } from \"./Drawable\"\n\nexport const SwitchedInverterDef =\n    defineComponent(5, 4, t.type({\n        type: t.literal(\"switched-inverter\"),\n    }, \"SwitchedInverter\"))\n\nconst INPUT = {\n    I: [0, 1, 2, 3] as const,\n    S: 4 as const,\n}\n\nconst GRID_WIDTH = 4\nconst GRID_HEIGHT = 8\n\nexport type SwitchedInverterRepr = typeof SwitchedInverterDef.reprType\n\nexport class SwitchedInverter extends ComponentBase<5, 4, SwitchedInverterRepr, FixedReadonlyArray<LogicValue, 4>> {\n\n    public constructor(editor: LogicEditor, savedData: SwitchedInverterRepr | null) {\n        super(editor, FixedArrayFill(false, 4), savedData, {\n            ins: [\n                [\"I0\", -3, -3, \"w\", \"In\"],\n                [\"I1\", -3, -1, \"w\", \"In\"],\n                [\"I2\", -3, +1, \"w\", \"In\"],\n                [\"I3\", -3, +3, \"w\", \"In\"],\n                [\"S\", 0, -5, \"n\"],\n            ],\n            outs: [\n                [\"O0\", +3, -3, \"e\", \"Out\"],\n                [\"O1\", +3, -1, \"e\", \"Out\"],\n                [\"O2\", +3, +1, \"e\", \"Out\"],\n                [\"O3\", +3, +3, \"e\", \"Out\"],\n            ],\n        })\n    }\n\n    public toJSON() {\n        return {\n            type: \"switched-inverter\" as const,\n            ...this.toJSONBase(),\n        }\n    }\n\n    public get componentType() {\n        return \"ic\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.SwitchedInverter.tooltip\n        return tooltipContent(s.title, mods(\n            div(s.desc)\n        ))\n    }\n\n    protected doRecalcValue(): FixedReadonlyArray<LogicValue, 4> {\n        const input = this.inputValues<4>(INPUT.I)\n        const switch_ = this.inputs[INPUT.S].value\n\n        if (isUnknown(switch_) || isHighImpedance(switch_)) {\n            return FixedArrayFill(Unknown, 4)\n        }\n\n        if (!switch_) {\n            return input\n        }\n\n        return input.map(LogicValue.invert) as unknown as FixedReadonlyArray<LogicValue, 4>\n    }\n\n    protected override propagateValue(newValue: FixedReadonlyArray<LogicValue, 4>) {\n        for (let i = 0; i < 4; i++) {\n            this.outputs[i].value = newValue[i]\n        }\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const invert = this.inputs[INPUT.S].value\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = left + width\n        const top = this.posY - height / 2\n        // const bottom = top + height\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        g.lineWidth = 2\n        g.strokeStyle = colorForBoolean(invert)\n        g.beginPath()\n        g.moveTo(this.posX, top + 3)\n        g.lineTo(this.posX, this.posY - 4)\n        g.stroke()\n\n        g.strokeStyle = invert === true ? COLOR_COMPONENT_BORDER : COLOR_UNKNOWN\n        g.beginPath()\n        g.moveTo(left + 12, this.posY - 8)\n        g.lineTo(right - 13, this.posY)\n        g.lineTo(left + 12, this.posY + 8)\n        g.closePath()\n        g.stroke()\n        g.beginPath()\n        circle(g, right - 10, this.posY, 5)\n        g.stroke()\n\n\n        for (const i of INPUT.I) {\n            const input = this.inputs[i]\n            drawWireLineToComponent(g, input, left - 2, input.posYInParentTransform)\n        }\n\n        drawWireLineToComponent(g, this.inputs[INPUT.S], this.inputs[INPUT.S].posXInParentTransform, top - 2)\n\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 2, output.posYInParentTransform)\n        }\n    }\n}\n", "import * as t from \"io-ts\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { isString, isUndefined } from \"../utils\"\nimport { Adder, AdderDef } from \"./Adder\"\nimport { ALU, ALUDef } from \"./ALU\"\nimport { Comparator, ComparatorDef } from \"./Comparator\"\nimport { Counter, CounterDef } from \"./Counter\"\nimport { Decoder16Seg, Decoder16SegDef } from \"./Decoder16Seg\"\nimport { Decoder7Seg, Decoder7SegDef } from \"./Decoder7Seg\"\nimport { DecoderBCD4, DecoderBCD4Def } from \"./DecoderBCD4\"\nimport { Demux1To2, Demux1To2Def, Demux1To4, Demux1To4Def, Demux1To8, Demux1To8Def, Demux2To4, Demux2To4Def, Demux2To8, Demux2To8Def, Demux4To8, Demux4To8Def, Demux8To16, Demux8To16Def } from \"./Demux\"\nimport { FlipflopD, FlipflopDDef } from \"./FlipflopD\"\nimport { FlipflopJK, FlipflopJKDef } from \"./FlipflopJK\"\nimport { FlipflopT, FlipflopTDef } from \"./FlipflopT\"\nimport { HalfAdder, HalfAdderDef } from \"./HalfAdder\"\nimport { LatchSR, LatchSRDef } from \"./LatchSR\"\nimport { Mux16To8, Mux16To8Def, Mux2To1, Mux2To1Def, Mux4To1, Mux4To1Def, Mux4To2, Mux4To2Def, Mux8To1, Mux8To1Def, Mux8To2, Mux8To2Def, Mux8To4, Mux8To4Def } from \"./Mux\"\nimport { QuadGate, QuadGateDef } from \"./QuadGate\"\nimport { QuadTriState, QuadTriStateDef } from \"./QuadTriState\"\nimport { RAM16x4, RAM16x4Def, RAM16x8, RAM16x8Def, RAM64x8, RAM64x8Def, RAM32x12, RAM32x12Def  } from \"./RAM\"\nimport { Register, RegisterDef } from \"./Register\"\nimport { SwitchedInverter, SwitchedInverterDef } from \"./SwitchedInverter\"\n\nexport type IC = Adder\n\nexport const ICDef = t.union([\n    SwitchedInverterDef.repr,\n    QuadGateDef.repr,\n    QuadTriStateDef.repr,\n    HalfAdderDef.repr,\n    AdderDef.repr,\n    ALUDef.repr,\n    Mux2To1Def.repr,\n    Mux4To1Def.repr,\n    Mux8To1Def.repr,\n    Mux4To2Def.repr,\n    Mux8To2Def.repr,\n    Mux8To4Def.repr,\n    Mux16To8Def.repr,\n    Demux1To2Def.repr,\n    Demux1To4Def.repr,\n    Demux1To8Def.repr,\n    Demux2To4Def.repr,\n    Demux2To8Def.repr,\n    Demux4To8Def.repr,\n    Demux8To16Def.repr,\n    LatchSRDef.repr,\n    FlipflopJKDef.repr,\n    FlipflopTDef.repr,\n    FlipflopDDef.repr,\n    RegisterDef.repr,\n    RAM16x4Def.repr,\n    RAM16x8Def.repr,\n    RAM64x8Def.repr,\n    RAM32x12Def.repr,\n    CounterDef.repr,\n    Decoder7SegDef.repr,\n    Decoder16SegDef.repr,\n    DecoderBCD4Def.repr,\n    ComparatorDef.repr,\n], \"IC\")\n\ntype ICRepr = t.TypeOf<typeof ICDef>\n\nexport const ICFactory = {\n\n    make: (editor: LogicEditor, savedDataOrType: ICRepr | string | undefined) => {\n        if (isUndefined(savedDataOrType)) {\n            return undefined\n        }\n\n        let blank\n        let savedData: ICRepr\n        if (isString(savedDataOrType)) {\n            blank = true\n            savedData = { type: savedDataOrType } as ICRepr\n        } else {\n            blank = false\n            savedData = savedDataOrType\n        }\n\n        switch (savedData.type) {\n            case \"switched-inverter\":\n                return new SwitchedInverter(editor, blank ? null : savedData)\n            case \"quad-gate\":\n                return new QuadGate(editor, blank ? null : savedData)\n            case \"quad-tristate\":\n                return new QuadTriState(editor, blank ? null : savedData)\n            case \"halfadder\":\n                return new HalfAdder(editor, blank ? null : savedData)\n            case \"adder\":\n                return new Adder(editor, blank ? null : savedData)\n            case \"alu\":\n                return new ALU(editor, blank ? null : savedData)\n            case \"mux-2to1\":\n                return new Mux2To1(editor, blank ? null : savedData)\n            case \"mux-4to1\":\n                return new Mux4To1(editor, blank ? null : savedData)\n            case \"mux-8to1\":\n                return new Mux8To1(editor, blank ? null : savedData)\n            case \"mux-4to2\":\n                return new Mux4To2(editor, blank ? null : savedData)\n            case \"mux-8to2\":\n                return new Mux8To2(editor, blank ? null : savedData)\n            case \"mux-8to4\":\n                return new Mux8To4(editor, blank ? null : savedData)\n            case \"mux-16to8\":\n                return new Mux16To8(editor, blank ? null : savedData)\n            case \"demux-1to2\":\n                return new Demux1To2(editor, blank ? null : savedData)\n            case \"demux-1to4\":\n                return new Demux1To4(editor, blank ? null : savedData)\n            case \"demux-1to8\":\n                return new Demux1To8(editor, blank ? null : savedData)\n            case \"demux-2to4\":\n                return new Demux2To4(editor, blank ? null : savedData)\n            case \"demux-2to8\":\n                return new Demux2To8(editor, blank ? null : savedData)\n            case \"demux-4to8\":\n                return new Demux4To8(editor, blank ? null : savedData)\n            case \"demux-8to16\":\n                return new Demux8To16(editor, blank ? null : savedData)\n            case \"latch-sr\":\n                return new LatchSR(editor, blank ? null : savedData)\n            case \"flipflop-jk\":\n                return new FlipflopJK(editor, blank ? null : savedData)\n            case \"flipflop-t\":\n                return new FlipflopT(editor, blank ? null : savedData)\n            case \"flipflop-d\":\n                return new FlipflopD(editor, blank ? null : savedData)\n            case \"register\":\n                return new Register(editor, blank ? null : savedData)\n            case \"ram-16x4\":\n                return new RAM16x4(editor, blank ? null : savedData)\n            case \"ram-16x8\":\n                return new RAM16x8(editor, blank ? null : savedData)\n            case \"ram-64x8\":\n                return new RAM64x8(editor, blank ? null : savedData)\n            case \"ram-32x12\":\n                return new RAM32x12(editor, blank ? null : savedData)\n            case \"counter\":\n                return new Counter(editor, blank ? null : savedData)\n            case \"decoder-7seg\":\n                return new Decoder7Seg(editor, blank ? null : savedData)\n            case \"decoder-16seg\":\n                return new Decoder16Seg(editor, blank ? null : savedData)\n            case \"decoder-bcd4\":\n                return new DecoderBCD4(editor, blank ? null : savedData)\n            case \"comparator\":\n                return new Comparator(editor, blank ? null : savedData)\n        }\n    },\n\n}\n", "import * as t from \"io-ts\"\nimport { circle, colorForBoolean, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, dist, drawComponentName, drawRoundValueCentered, drawWireLineToComponent, GRID_STEP, INPUT_OUTPUT_DIAMETER, triangle } from \"../drawutils\"\nimport { emptyMod, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { HighImpedance, isDefined, isNotNull, isUndefined, isUnknown, LogicValue, LogicValueRepr, Mode, toLogicValue, toLogicValueRepr, typeOrUndefined, Unknown } from \"../utils\"\nimport { Component, ComponentBase, ComponentName, ComponentNameRepr, defineComponent, extendComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext, Orientation } from \"./Drawable\"\nimport { Node, NodeIn } from \"./Node\"\n\nexport const InputBitBaseDef =\n    defineComponent(0, 1, t.type({\n        name: ComponentNameRepr,\n    }, \"InputBitBase\"))\n\nexport type InputBitBaseRepr = typeof InputBitBaseDef.reprType\n\nexport abstract class InputBitBase<Repr extends InputBitBaseRepr> extends ComponentBase<0, 1, Repr, LogicValue> {\n\n    private _name: ComponentName = undefined\n\n    protected constructor(editor: LogicEditor, initialValue: LogicValue, savedData: Repr | null) {\n        super(editor, initialValue, savedData, { outs: [[undefined, +3, 0, \"e\"]] })\n        if (isNotNull(savedData)) {\n            this._name = savedData.name\n        }\n    }\n\n    protected override toJSONBase() {\n        return {\n            ...super.toJSONBase(),\n            name: this._name,\n        }\n    }\n\n    protected override toStringDetails(): string {\n        return \"\" + this.value\n    }\n\n    public get unrotatedWidth() {\n        return INPUT_OUTPUT_DIAMETER\n    }\n\n    public get unrotatedHeight() {\n        return INPUT_OUTPUT_DIAMETER\n    }\n\n    public override isOver(x: number, y: number) {\n        return dist(x, y, this.posX, this.posY) < INPUT_OUTPUT_DIAMETER / 2\n    }\n\n    public override get allowsForcedOutputs() {\n        return false\n    }\n\n    protected override propagateValue(newValue: LogicValue) {\n        this.outputs[0].value = newValue\n    }\n\n    protected shouldDrawBorder() {\n        return true\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        drawWireLineToComponent(g, this.outputs[0], this.posX + 8, this.posY)\n\n        const displayValue = this.editor.options.hideInputColors ? Unknown : this.value\n\n        const shouldDrawBorder = this.shouldDrawBorder()\n        if (shouldDrawBorder) {\n            const drawMouseOver = ctx.isMouseOver && this.editor.mode !== Mode.STATIC\n\n            if (drawMouseOver) {\n                g.strokeStyle = COLOR_MOUSE_OVER\n                g.fillStyle = COLOR_MOUSE_OVER\n            } else {\n                g.strokeStyle = COLOR_COMPONENT_BORDER\n                g.fillStyle = COLOR_COMPONENT_BORDER\n            }\n            g.lineWidth = 3\n            g.beginPath()\n            triangle(g,\n                this.posX + INPUT_OUTPUT_DIAMETER / 2 - 1, this.posY - 7,\n                this.posX + INPUT_OUTPUT_DIAMETER / 2 - 1, this.posY + 7,\n                this.posX + INPUT_OUTPUT_DIAMETER / 2 + 5, this.posY,\n            )\n            g.fill()\n            g.stroke()\n\n            g.fillStyle = colorForBoolean(displayValue)\n            g.lineWidth = 4\n            g.beginPath()\n            circle(g, this.posX, this.posY, INPUT_OUTPUT_DIAMETER)\n            g.fill()\n            g.stroke()\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (isDefined(this._name)) {\n                drawComponentName(g, ctx, this._name, toLogicValueRepr(displayValue), this, false)\n            }\n            const forcedFillStyle = !shouldDrawBorder ? g.fillStyle = COLOR_COMPONENT_BORDER : undefined\n            drawRoundValueCentered(g, displayValue, this, { fillStyle: forcedFillStyle })\n        })\n    }\n\n    protected override autoConnected(newLinks: [Node, Component, Node][]) {\n        if (newLinks.length !== 1) {\n            return\n        }\n        const [outNode, comp, inNode] = newLinks[0]\n        if (inNode instanceof NodeIn && this instanceof InputBit) {\n            if (inNode._prefersSpike) {\n                this.doSetIsPushButton(true)\n            }\n            if (isUndefined(this._name) && isDefined(inNode.name)) {\n                this.doSetName(inNode.name)\n            }\n        }\n        if (outNode.orient !== \"e\") {\n            return\n        }\n        switch (Orientation.add(comp.orient, inNode.orient)) {\n            case \"w\":\n                // nothing to do\n                return\n            case \"e\":\n                this.doSetOrient(\"w\")\n                this.setPosition(this.posX + GRID_STEP * 6, this.posY)\n                return\n            case \"s\":\n                this.doSetOrient(\"n\")\n                this.setPosition(this.posX + GRID_STEP * 3, this.posY + GRID_STEP * 3)\n                return\n            case \"n\":\n                this.doSetOrient(\"s\")\n                this.setPosition(this.posX + GRID_STEP * 3, this.posY - GRID_STEP * 3)\n                return\n        }\n    }\n\n    protected doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        return [\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n\n\nexport const InputBitDef =\n    extendComponent(InputBitBaseDef, t.type({\n        val: LogicValueRepr,\n        isPushButton: typeOrUndefined(t.boolean),\n        isConstant: typeOrUndefined(t.boolean),\n    }, \"InputBit\"))\n\nexport type InputBitRepr = typeof InputBitDef.reprType\n\nconst InputBitDefaults = {\n    isPushButton: false,\n    isConstant: false,\n}\n\n\nexport class InputBit extends InputBitBase<InputBitRepr> {\n\n    public static nextValue(value: LogicValue, mode: Mode, altKey: boolean): LogicValue {\n        switch (value) {\n            case true: return (mode >= Mode.FULL && altKey) ? Unknown : false\n            case false: return (mode >= Mode.FULL && altKey) ? Unknown : true\n            case Unknown: return mode >= Mode.FULL ? (altKey ? HighImpedance : false) : Unknown\n            case HighImpedance: return mode >= Mode.FULL ? (altKey ? Unknown : false) : HighImpedance\n        }\n    }\n\n    private _isPushButton = InputBitDefaults.isPushButton\n    private _isConstant = InputBitDefaults.isConstant\n\n    public constructor(editor: LogicEditor, savedData: InputBitRepr | null) {\n        super(\n            editor,\n            // initial value may be given by saved data\n            isNotNull(savedData) ? toLogicValue(savedData.val) : false,\n            savedData,\n        )\n        if (isNotNull(savedData)) {\n            this._isPushButton = savedData.isPushButton ?? InputBitDefaults.isPushButton\n            this._isConstant = savedData.isConstant ?? InputBitDefaults.isConstant\n        }\n\n    }\n\n    public toJSON() {\n        return {\n            ...super.toJSONBase(),\n            val: toLogicValueRepr(this.value),\n            isPushButton: (this._isPushButton !== InputBitDefaults.isPushButton) ? this._isPushButton : undefined,\n            isConstant: (this._isConstant !== InputBitDefaults.isConstant) ? this._isConstant : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"in\" as const\n    }\n\n    public override get cursorWhenMouseover() {\n        const mode = this.editor.mode\n        if (mode === Mode.STATIC) {\n            // signal we can't switch it here\n            return \"not-allowed\"\n        }\n        if (this._isConstant) {\n            if (mode >= Mode.DESIGN) {\n                // we can still move it\n                return \"grab\"\n            } else {\n                // no special pointer change, it's constant and static\n                return undefined\n            }\n        }\n        // we can switch it\n        return \"pointer\"\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.InputBit.tooltip\n        return tooltipContent(undefined, mods(s.title, isUnknown(this.value) ? \" \" + s.WhoseValueIsUnknown : emptyMod))\n    }\n\n    protected doRecalcValue(): LogicValue {\n        // this never changes on its own, just upon user interaction\n        return this.value\n    }\n\n    protected override shouldDrawBorder() {\n        return !this._isConstant\n    }\n\n    public override mouseClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseClicked(e)) {\n            return true\n        }\n\n        if (this.editor.mode === Mode.STATIC || this._isPushButton || this._isConstant) {\n            // do nothing for normal push button\n            return false\n        }\n        this.doSetValue(InputBit.nextValue(this.value, this.editor.mode, e.altKey))\n        return true\n    }\n\n    public override mouseDown(e: MouseEvent | TouchEvent) {\n        if (this.editor.mode !== Mode.STATIC && this._isPushButton && !this._isConstant) {\n            this.doSetValue(true)\n        }\n        return super.mouseDown(e)\n    }\n\n    public override mouseUp(e: MouseEvent | TouchEvent) {\n        const result = super.mouseUp(e)\n        if (this.editor.mode !== Mode.STATIC && this._isPushButton && !this._isConstant) {\n            this.doSetValue(false)\n        }\n        return result\n    }\n\n\n    public doSetIsPushButton(isPushButton: boolean) {\n        this._isPushButton = isPushButton\n        if (isPushButton) {\n            this.doSetValue(false)\n        }\n    }\n\n    private doSetIsConstant(isConstant: boolean) {\n        this._isConstant = isConstant\n        this.setNeedsRedraw(\"constant changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const s = S.Components.InputBit.contextMenu\n\n        const makeItemBehaveAs = (desc: string, value: boolean) => {\n            const isCurrent = this._isPushButton === value\n            const icon = isCurrent ? \"check\" : \"none\"\n            const action = isCurrent ? () => undefined : () => this.doSetIsPushButton(value)\n            return ContextMenuData.item(icon, desc, action)\n        }\n\n        const makeToggleConstantItem = () => {\n            const icon = this._isConstant ? \"check\" : \"none\"\n            const action = () => this.doSetIsConstant(!this._isConstant)\n            return ContextMenuData.item(icon, s.LockValue + ` (${toLogicValueRepr(this.value)})`, action)\n        }\n\n        const newItems: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            [\"mid\", makeItemBehaveAs(s.ToggleButton, false)],\n            [\"mid\", makeItemBehaveAs(s.PushButton, true)],\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", makeToggleConstantItem()],\n            [\"mid\", ContextMenuData.sep()],\n        ]\n\n        const superItems = super.makeComponentSpecificContextMenuItems()\n        if (isDefined(superItems)) {\n            newItems.push(...superItems)\n        }\n\n        return newItems\n    }\n\n\n}\n", "import * as t from \"io-ts\"\nimport { COLOR_COMPONENT_BORDER } from \"../drawutils\"\nimport { br, emptyMod, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isDefined, isNotNull, LogicValue, typeOrUndefined } from \"../utils\"\nimport { ComponentState, extendComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { InputBitBase, InputBitBaseDef } from \"./InputBit\"\n\n\nexport const ClockDef =\n    extendComponent(InputBitBaseDef, t.type({\n        type: t.literal(\"clock\"),\n        period: t.number,\n        dutycycle: typeOrUndefined(t.number),\n        phase: typeOrUndefined(t.number),\n        showLabel: typeOrUndefined(t.boolean),\n    }, \"Clock\"))\n\nexport type ClockRepr = typeof ClockDef.reprType\n\nconst ClockDefaults = {\n    period: 2000,\n    dutycycle: 50,\n    phase: 0,\n    showLabel: true,\n}\n\nexport class Clock extends InputBitBase<ClockRepr> {\n\n    private _period: number = ClockDefaults.period\n    private _dutycycle: number = ClockDefaults.dutycycle\n    private _phase: number = ClockDefaults.phase\n    private _showLabel: boolean = ClockDefaults.showLabel\n\n    public constructor(editor: LogicEditor, savedData: ClockRepr | null) {\n        super(editor, false, savedData)\n        if (isNotNull(savedData)) {\n            this._period = savedData.period\n            if (isDefined(savedData.dutycycle)) {\n                this._dutycycle = savedData.dutycycle % 100\n            }\n            if (isDefined(savedData.phase)) {\n                this._phase = savedData.phase % savedData.period\n            }\n            this._showLabel = savedData.showLabel ?? ClockDefaults.showLabel\n        }\n        // sets the value and schedules the next tick\n        this.tickCallback(editor.timeline.adjustedTime())\n    }\n\n    public toJSON() {\n        return {\n            type: \"clock\" as const,\n            ...this.toJSONBase(),\n            period: this._period,\n            dutycycle: (this._dutycycle === ClockDefaults.dutycycle) ? undefined : this._dutycycle,\n            phase: (this._phase === ClockDefaults.phase) ? undefined : this._phase,\n            showLabel: (this._showLabel === ClockDefaults.showLabel) ? undefined : this._showLabel,\n        }\n    }\n\n    public get componentType() {\n        return \"in\" as const\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.Clock.tooltip\n        return tooltipContent(s.title,\n            mods(s.period[0] + this._period + s.period[1], br,\n                s.dutycycle[0] + this._dutycycle + s.dutycycle[1],\n                this._phase === 0\n                    ? emptyMod\n                    : mods(br, s.phase[0] + this._phase + s.phase[1])\n            ))\n    }\n\n    private currentClockValue(time: number): [boolean, number] {\n        const myTime = time - this._phase\n        let timeOverPeriod = myTime % this._period\n        if (timeOverPeriod < 0) {\n            timeOverPeriod += this._period\n        }\n        const onDuration = this._period * this._dutycycle / 100\n        const offDuration = this._period - onDuration\n        let value: boolean\n        let timeOverLastTick: number\n        if (timeOverPeriod < onDuration) {\n            value = true\n            timeOverLastTick = timeOverPeriod\n        } else {\n            value = false\n            timeOverLastTick = timeOverPeriod - onDuration\n        }\n        const lastTick = time - timeOverLastTick\n        const nextTick = lastTick + (value ? onDuration : offDuration)\n\n        return [value, nextTick]\n    }\n\n    protected doRecalcValue(): LogicValue {\n        // nothing special to recalc, will change automatically on next tick,\n        // so until further notice, we keep this same value\n        return this.value\n    }\n\n    private tickCallback(theoreticalTime: number) {\n        const [value, nextTick] = this.currentClockValue(theoreticalTime)\n        this.doSetValue(value)\n        if (this.state !== ComponentState.DEAD) {\n            this.editor.timeline.scheduleAt(nextTick, \"next tick for clock value \" + (!value), time => this.tickCallback(time))\n        }\n    }\n\n    protected override doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        super.doDraw(g, ctx)\n\n        if (!this._showLabel) {\n            return\n        }\n\n        ctx.inNonTransformedFrame(() => {\n            const w = 40\n            const h = 10\n            const offsetY = this.orient === \"s\" ? -36 : 26\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n            g.lineWidth = 1\n            const left = this.posX - w / 2\n            const mid1 = left + w * this._phase / this._period\n            const mid2 = mid1 + w * this._dutycycle / 100\n            const right = this.posX + w / 2\n            const bottom = this.posY + offsetY + h / 2\n            const top = this.posY + offsetY - h / 2\n            g.beginPath()\n            g.moveTo(left, bottom)\n            g.lineTo(mid1, bottom)\n            g.lineTo(mid1, top)\n            g.lineTo(mid2, top)\n            g.lineTo(mid2, bottom)\n            g.lineTo(right, bottom)\n            g.stroke()\n\n            g.fillStyle = COLOR_COMPONENT_BORDER\n            g.textAlign = \"center\"\n            g.font = \"10px sans-serif\"\n            const periodStr = this._period >= 1000\n                ? (this._period / 1000) + \" s\"\n                : this._period + \" ms\"\n            g.fillText(periodStr, this.posX, bottom + 8)\n        })\n    }\n\n    private doSetPeriod(period: number) {\n        this._period = period\n        this.setNeedsRedraw(\"period changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const newItems: [ContextMenuItemPlacement, ContextMenuItem][] = []\n        const s = S.Components.Clock.contextMenu\n\n        const superItems = super.makeComponentSpecificContextMenuItems()\n        if (isDefined(superItems)) {\n            newItems.push(...superItems)\n        }\n\n        const periodPresets: [number, string][] = [\n            [100, \"100 ms (10 Hz)\"],\n            [250, \"250 ms (4 Hz)\"],\n            [500, \"500 ms (2 Hz)\"],\n            [1000, \"1 s (1 Hz)\"],\n            [2000, \"2 s (0.5 Hz)\"],\n            [4000, \"4 s (0.25 Hz)\"],\n            [8000, \"8 s (0.125 Hz)\"],\n        ]\n\n        const makeItemSetPeriod = (data: [number, string]) => {\n            const [period, desc] = data\n            const isCurrent = this._period === period\n            const icon = isCurrent ? \"check\" : \"none\"\n            return ContextMenuData.item(icon, desc, () => this.doSetPeriod(period))\n        }\n\n        const myItems: [ContextMenuItemPlacement, ContextMenuItem][] = [\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", ContextMenuData.submenu(\"timer\", s.Period, periodPresets.map(makeItemSetPeriod))],\n        ]\n\n        newItems.push(...myItems)\n        return newItems\n    }\n\n\n}", "import * as t from \"io-ts\"\nimport { colorForBoolean, COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, drawComponentName, drawRoundValue, drawWireLineToComponent, GRID_STEP, inRect } from \"../drawutils\"\nimport { mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedArrayFill, isDefined, isNotNull, isNull, isUndefined, LogicValue, Mode, toLogicValueFromChar, toLogicValueRepr, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { InputBit } from \"./InputBit\"\n\nconst GRID_WIDTH = 2\nconst GRID_UPPER_HEIGHT = 4.5\nconst GRID_LOWER_HEIGHT = 3.5\n\nexport const InputByteDef =\n    defineComponent(0, 8, t.type({\n        type: t.literal(\"byte\"),\n        val: typeOrUndefined(t.string),\n        name: ComponentNameRepr,\n        // radix: typeOrUndefined(t.number),\n    }, \"InputByte\"))\n\ntype InputByteRepr = typeof InputByteDef.reprType\n\n// TODO merge with InputNibble\nexport class InputByte extends ComponentBase<0, 8, InputByteRepr, FixedArray<LogicValue, 8>> {\n\n    private static savedStateFrom(savedData: { val: string | undefined } | null): FixedArray<LogicValue, 8> {\n        const inputs = FixedArrayFill(false as LogicValue, 8)\n        if (isNull(savedData) || isUndefined(savedData.val)) {\n            return inputs\n        }\n        const rep = savedData.val\n        const lastIndex = rep.length - 1\n        for (let i = 0; i < 8; i++) {\n            const index = lastIndex - i\n            if (index < 0) {\n                break\n            }\n            inputs[i] = toLogicValueFromChar(rep[index])\n        }\n        return inputs\n    }\n\n\n    private _name: ComponentName = undefined\n    // private _radix = DEFAULT_RADIX\n\n    public constructor(editor: LogicEditor, savedData: InputByteRepr | null) {\n        super(editor, InputByte.savedStateFrom(savedData), savedData, {\n            outs: [\n                [undefined, 2, -4, \"e\", \"Out\"],\n                [undefined, 2, -3, \"e\", \"Out\"],\n                [undefined, 2, -2, \"e\", \"Out\"],\n                [undefined, 2, -1, \"e\", \"Out\"],\n                [undefined, 2, 0, \"e\", \"Out\"],\n                [undefined, 2, 1, \"e\", \"Out\"],\n                [undefined, 2, 2, \"e\", \"Out\"],\n                [undefined, 2, 3, \"e\", \"Out\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._name = savedData.name\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"byte\" as const,\n            ...this.toJSONBase(),\n            val: this.contentRepr(),\n            name: this._name,\n        }\n    }\n\n    private contentRepr(): string | undefined {\n        const value = this.value\n        let nontrivial = false\n        for (let i = 0; i < 8; i++) {\n            if (value[i] !== false) {\n                nontrivial = true\n                break\n            }\n        }\n        if (!nontrivial) {\n            return undefined\n        }\n\n        return this.value.map(toLogicValueRepr).reverse().join(\"\")\n    }\n\n\n    public get componentType() {\n        return \"in\" as const\n    }\n\n    public override get cursorWhenMouseover() {\n        return this.editor.mode === Mode.STATIC ? \"not-allowed\" : \"pointer\"\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return (GRID_UPPER_HEIGHT + GRID_UPPER_HEIGHT) * GRID_STEP\n    }\n\n    public override isOver(x: number, y: number) {\n        return inRect(this.posX, this.posY, this.width, this.height, x, y)\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(S.Components.InputNibble.tooltip))\n    }\n\n    protected doRecalcValue(): FixedArray<LogicValue, 8> {\n        // this never changes on its own, just upon user interaction\n        return this.value\n    }\n\n    protected override propagateValue(newValue: FixedArray<LogicValue, 8>) {\n        for (let i = 0; i < 8; i++) {\n            this.outputs[i].value = newValue[i]\n        }\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        g.fillStyle = COLOR_BACKGROUND\n        const drawMouseOver = ctx.isMouseOver && this.editor.mode !== Mode.STATIC\n        g.strokeStyle = drawMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const width = GRID_WIDTH * GRID_STEP\n        const left = this.posX - width / 2\n        const right = left + width\n        const top = this.posY - GRID_UPPER_HEIGHT * GRID_STEP\n        const bottom = this.posY + GRID_LOWER_HEIGHT * GRID_STEP\n        const height = bottom - top\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n\n        const displayValues = this.editor.options.hideInputColors ? FixedArrayFill(Unknown, 8) : this.value\n\n        g.lineWidth = 1\n        const cellHeight = GRID_STEP\n        for (let i = 0; i < 8; i++) {\n            const y = top + i * cellHeight\n            g.fillStyle = colorForBoolean(displayValues[i])\n            g.beginPath()\n            g.rect(left, y, width, cellHeight)\n            g.fill()\n            g.stroke()\n        }\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 2, output.posYInParentTransform, true)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (isDefined(this._name)) {\n                const valueString = displayValues.map(toLogicValueRepr).join(\"\")\n                drawComponentName(g, ctx, this._name, valueString, this, false)\n            }\n\n            for (let i = 0; i < 8; i++) {\n                const y = top + cellHeight / 2 + i * cellHeight\n                drawRoundValue(g, displayValues[i], ...ctx.rotatePoint(this.posX, y), { small: true })\n            }\n        })\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        return [\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n    public override mouseClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseClicked(e)) {\n            return true\n        }\n\n        // TODO rotate coordinates here\n        const editor = this.editor\n        if (editor.mode === Mode.STATIC) {\n            return false\n        }\n        const y = editor.offsetXYForComponent(e, this)[1] - this.posY + GRID_UPPER_HEIGHT * GRID_STEP\n        const i = Math.floor(y / GRID_STEP)\n\n        if (i >= 0 && i < 8) {\n            const newValues = [...this.value]\n            newValues[i] = InputBit.nextValue(newValues[i], editor.mode, e.altKey)\n            this.doSetValue(newValues as unknown as FixedArray<LogicValue, 8>)\n        }\n\n        return true\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { colorForBoolean, COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, drawComponentName, drawRoundValue, drawWireLineToComponent, GRID_STEP, inRect } from \"../drawutils\"\nimport { mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedArrayFill, isDefined, isNotNull, isNull, LogicValue, LogicValueRepr, Mode, toLogicValue, toLogicValueRepr, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { InputBit } from \"./InputBit\"\n\nconst GRID_WIDTH = 2\nconst GRID_HEIGHT = 8\n\nexport const InputNibbleDef =\n    defineComponent(0, 4, t.type({\n        type: t.literal(\"nibble\"),\n        val: t.tuple([LogicValueRepr, LogicValueRepr, LogicValueRepr, LogicValueRepr]),\n        name: ComponentNameRepr,\n        // radix: typeOrUndefined(t.number),\n    }, \"InputNibble\"))\n\ntype InputNibbleRepr = typeof InputNibbleDef.reprType\n\nexport class InputNibble extends ComponentBase<0, 4, InputNibbleRepr, FixedArray<LogicValue, 4>> {\n\n    private static savedStateFrom(savedData: { val: FixedArray<LogicValueRepr, 4> } | null): FixedArray<LogicValue, 4> {\n        if (isNull(savedData)) {\n            return [false, false, false, false]\n        }\n        return savedData.val.map(v => toLogicValue(v)) as unknown as FixedArray<LogicValue, 4>\n    }\n\n\n    private _name: ComponentName = undefined\n    // private _radix = DEFAULT_RADIX\n\n    public constructor(editor: LogicEditor, savedData: InputNibbleRepr | null) {\n        super(editor, InputNibble.savedStateFrom(savedData), savedData, {\n            outs: [\n                [undefined, 2, -3, \"e\", \"Out\"],\n                [undefined, 2, -1, \"e\", \"Out\"],\n                [undefined, 2, +1, \"e\", \"Out\"],\n                [undefined, 2, +3, \"e\", \"Out\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._name = savedData.name\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"nibble\" as const,\n            ...this.toJSONBase(),\n            val: this.value.map(v => toLogicValueRepr(v)) as unknown as FixedArray<LogicValueRepr, 4>,\n            name: this._name,\n        }\n    }\n\n    public get componentType() {\n        return \"in\" as const\n    }\n\n    public override get cursorWhenMouseover() {\n        return this.editor.mode === Mode.STATIC ? \"not-allowed\" : \"pointer\"\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override isOver(x: number, y: number) {\n        return inRect(this.posX, this.posY, this.width, this.height, x, y)\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(S.Components.InputNibble.tooltip))\n    }\n\n    protected doRecalcValue(): FixedArray<LogicValue, 4> {\n        // this never changes on its own, just upon user interaction\n        return this.value\n    }\n\n    protected override propagateValue(newValue: FixedArray<LogicValue, 4>) {\n        for (let i = 0; i < 4; i++) {\n            this.outputs[i].value = newValue[i]\n        }\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        g.fillStyle = COLOR_BACKGROUND\n        const drawMouseOver = ctx.isMouseOver && this.editor.mode !== Mode.STATIC\n        g.strokeStyle = drawMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = left + width\n        const top = this.posY - height / 2\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n\n        const displayValues = this.editor.options.hideInputColors ? FixedArrayFill(Unknown, 4) : this.value\n\n        g.lineWidth = 1\n        const cellHeight = height / 4\n        for (let i = 0; i < 4; i++) {\n            const y = top + i * cellHeight\n            g.fillStyle = colorForBoolean(displayValues[i])\n            g.beginPath()\n            g.rect(left, y, width, cellHeight)\n            g.fill()\n            g.stroke()\n        }\n\n        for (const output of this.outputs) {\n            drawWireLineToComponent(g, output, right + 2, output.posYInParentTransform, true)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (isDefined(this._name)) {\n                const valueString = displayValues.map(toLogicValueRepr).join(\"\")\n                drawComponentName(g, ctx, this._name, valueString, this, false)\n            }\n\n            for (let i = 0; i < 4; i++) {\n                const y = top + cellHeight / 2 + i * cellHeight\n                drawRoundValue(g, displayValues[i], ...ctx.rotatePoint(this.posX, y))\n            }\n        })\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        return [\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n    public override mouseClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseClicked(e)) {\n            return true\n        }\n\n        // TODO rotate coordinates here\n        const editor = this.editor\n        if (editor.mode === Mode.STATIC) {\n            return false\n        }\n        const h = this.unrotatedHeight\n        const y = editor.offsetXYForComponent(e, this)[1] - this.posY + h / 2\n        const i = Math.floor(y * 4 / h)\n\n        const newValues = [...this.value]\n        newValues[i] = InputBit.nextValue(newValues[i], editor.mode, e.altKey)\n\n        this.doSetValue(newValues as unknown as FixedArray<LogicValue, 4>)\n        return true\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, drawComponentName, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isDefined, isNotNull, LogicValue, toLogicValueRepr, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext, Orientation } from \"./Drawable\"\nimport { EdgeTrigger, Flipflop, FlipflopOrLatch } from \"./FlipflopOrLatch\"\n\nexport const InputRandomDef =\n    defineComponent(1, 1, t.type({\n        type: t.literal(\"random\"),\n        prob1: typeOrUndefined(t.number),\n        showProb: typeOrUndefined(t.boolean),\n        trigger: typeOrUndefined(t.keyof(EdgeTrigger)),\n        name: ComponentNameRepr,\n    }, \"InputRandom\"))\n\n\nexport type InputRandomRepr = typeof InputRandomDef.reprType\n\nconst InputRandomDefaults = {\n    prob1: 0.5,\n    showProb: false,\n    trigger: EdgeTrigger.rising,\n}\n\nconst GRID_WIDTH = 4\nconst GRID_HEIGHT = 6\n\nconst enum INPUT { Clock }\nconst enum OUTPUT { Out }\n\nexport class InputRandom extends ComponentBase<1, 1, InputRandomRepr, LogicValue> {\n\n    private _prob1: number = InputRandomDefaults.prob1\n    private _showProb: boolean = InputRandomDefaults.showProb\n    private _lastClock: LogicValue = Unknown\n    private _trigger: EdgeTrigger = InputRandomDefaults.trigger\n    private _name: ComponentName = undefined\n\n    public constructor(editor: LogicEditor, savedData: InputRandomRepr | null) {\n        super(editor, false, savedData, {\n            ins: [[\"Next\", -3, +2, \"w\"]],\n            outs: [[undefined, +3, 0, \"e\"]],\n        })\n        if (isNotNull(savedData)) {\n            if (isDefined(savedData.prob1)) {\n                this._prob1 = Math.max(0, Math.min(1, savedData.prob1))\n            }\n            this._showProb = savedData.showProb ?? InputRandomDefaults.showProb\n            this._trigger = savedData.trigger ?? InputRandomDefaults.trigger\n            this._name = savedData.name\n        }\n        this.setInputsPreferSpike(INPUT.Clock)\n    }\n\n    public override toJSON() {\n        return {\n            type: \"random\" as const,\n            ...super.toJSONBase(),\n            name: this._name,\n            prob1: (this._prob1 !== InputRandomDefaults.prob1) ? this._prob1 : undefined,\n            showProb: (this._showProb !== InputRandomDefaults.showProb) ? this._showProb : undefined,\n            trigger: (this._trigger !== InputRandomDefaults.trigger) ? this._trigger : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"in\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override get allowsForcedOutputs() {\n        return false\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.InputRandom.tooltip\n        return tooltipContent(s.title,\n            s.desc[0] + this._prob1 + s.desc[1]\n        )\n    }\n\n    protected doRecalcValue(): LogicValue {\n        const prevClock = this._lastClock\n        const clock = this._lastClock = this.inputs[INPUT.Clock].value\n        if (!Flipflop.isClockTrigger(this._trigger, prevClock, clock)) {\n            // no change\n            return this.value\n        }\n        const r = Math.random()\n        return r < this._prob1\n    }\n\n    protected override propagateValue(newValue: LogicValue) {\n        this.outputs[OUTPUT.Out].value = newValue\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        const width = this.unrotatedWidth\n        const height = this.unrotatedHeight\n        const left = this.posX - width / 2\n        const right = this.posX + width / 2\n        const top = this.posY - height / 2\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n\n\n        drawWireLineToComponent(g, this.outputs[OUTPUT.Out], right, this.outputs[OUTPUT.Out].posYInParentTransform, false)\n        drawWireLineToComponent(g, this.inputs[INPUT.Clock], left, this.inputs[INPUT.Clock].posYInParentTransform, false)\n\n        Flipflop.drawClockInput(g, left, this.inputs[INPUT.Clock], this._trigger)\n\n\n        ctx.inNonTransformedFrame(ctx => {\n            const outputValue = this.outputs[0].value\n            FlipflopOrLatch.drawStoredValue(g, outputValue, this.posX, this.posY, 26)\n\n            if (this._showProb) {\n                const isVertical = Orientation.isVertical(this.orient)\n\n                g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n                g.font = \"9px sans-serif\"\n                g.textAlign = \"center\"\n                g.textBaseline = \"middle\"\n                const probTextLastPart = String(Math.round(this._prob1 * 100) / 100).substring(1)\n                const probTextParts = [\"P(1)\", \"=\", probTextLastPart]\n                if (isVertical) {\n                    let currentOffset = -10\n                    let offset = Math.abs(currentOffset)\n                    if (this.orient === \"s\") {\n                        currentOffset = -currentOffset\n                        offset = -offset\n                    }\n                    for (const part of probTextParts) {\n                        drawLabel(ctx, this.orient, part, \"n\", this.posX - currentOffset, top - 1, undefined)\n                        currentOffset += offset\n                    }\n                } else {\n                    const probText = probTextParts.join(\"\u202F\")\n                    drawLabel(ctx, this.orient, probText, \"n\", this.posX, top, undefined)\n                }\n            }\n\n\n            if (isDefined(this._name)) {\n                drawComponentName(g, ctx, this._name, toLogicValueRepr(outputValue), this, false)\n            }\n        })\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    private doSetShowProb(showProb: boolean) {\n        this._showProb = showProb\n        this.setNeedsRedraw(\"show probability changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const s = S.Components.InputRandom.contextMenu\n        const icon = this._showProb ? \"check\" : \"none\"\n        const toggleShowProbItem = ContextMenuData.item(icon, s.ShowProb,\n            () => this.doSetShowProb(!this._showProb))\n\n        return [\n            [\"mid\", toggleShowProbItem],\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { isString, isUndefined } from \"../utils\"\nimport { Clock, ClockDef } from \"./Clock\"\nimport { InputBit, InputBitDef } from \"./InputBit\"\nimport { InputByte, InputByteDef } from \"./InputByte\"\nimport { InputNibble, InputNibbleDef } from \"./InputNibble\"\nimport { InputRandom, InputRandomDef } from \"./InputRandom\"\n\nexport type Input = InputBit | Clock | InputNibble\n\nexport const InputDef = t.union([\n    InputBitDef.repr,\n    ClockDef.repr,\n    InputNibbleDef.repr,\n    InputByteDef.repr,\n    InputRandomDef.repr,\n], \"Input\")\n\ntype InputRepr = t.TypeOf<typeof InputDef>\n\nexport const InputFactory = {\n\n    make: (editor: LogicEditor, savedDataOrType: InputRepr | string | undefined) => {\n        let blank\n        let savedData: InputRepr\n\n        if (isUndefined(savedDataOrType)) {\n            // default, typeless option\n            blank = true\n            savedData = {} as InputRepr\n        } else if (isString(savedDataOrType)) {\n            // specific subtype\n            blank = true\n            savedData = { type: savedDataOrType } as InputRepr\n        } else {\n            // as saved\n            blank = false\n            savedData = savedDataOrType\n        }\n\n        if (!(\"type\" in savedData)) {\n            return new InputBit(editor, blank ? null : savedData)\n        }\n        switch (savedData.type) {\n            case \"clock\":\n                return new Clock(editor, blank ? null : savedData)\n            case \"nibble\":\n                return new InputNibble(editor, blank ? null : savedData)\n            case \"byte\":\n                return new InputByte(editor, blank ? null : savedData)\n            case \"random\":\n                return new InputRandom(editor, blank ? null : savedData)\n        }\n    },\n\n}\n\n", "import * as t from \"io-ts\"\nimport { DrawZIndex } from \"../ComponentList\"\nimport { COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, COLOR_RECTANGLE_BACKGROUND, COLOR_RECTANGLE_BORDER, FONT_LABEL_DEFAULT, GRID_STEP } from \"../drawutils\"\nimport { span, style, title } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isDefined, isNotNull, isUndefined, typeOrUndefined } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, Drawable, DrawableWithPosition, DrawContext } from \"./Drawable\"\n\nexport const RectangleColor = {\n    grey: \"grey\",\n    red: \"red\",\n    blue: \"blue\",\n    yellow: \"yellow\",\n    green: \"green\",\n    turquoise: \"turquoise\",\n} as const\n\nexport type RectangleColor = keyof typeof RectangleColor\n\nexport const CaptionPosition = {\n    n: \"n\",\n    ne: \"ne\",\n    e: \"e\",\n    se: \"se\",\n    s: \"s\",\n    sw: \"sw\",\n    w: \"w\",\n    nw: \"nw\",\n    c: \"c\",\n} as const\n\nexport type CaptionPosition = keyof typeof CaptionPosition\n\n\nexport const LabelRectDef =\n    defineComponent(0, 0, t.type({\n        type: t.literal(\"rect\"),\n        w: t.number,\n        h: t.number,\n        color: typeOrUndefined(t.keyof(RectangleColor)),\n        strokeWidth: typeOrUndefined(t.number),\n        noFill: typeOrUndefined(t.boolean),\n        rounded: typeOrUndefined(t.boolean),\n        caption: typeOrUndefined(t.string),\n        captionPos: typeOrUndefined(t.keyof(CaptionPosition)),\n        captionInside: typeOrUndefined(t.boolean),\n        font: typeOrUndefined(t.string),\n    }, \"Rectangle\"))\n\nexport type LabelRectRepr = typeof LabelRectDef.reprType\n\nconst LabelRectDefaults = {\n    width: 10 * GRID_STEP,\n    height: 10 * GRID_STEP,\n    color: RectangleColor.yellow,\n    strokeWidth: 2,\n    noFill: false,\n    rounded: false,\n    caption: undefined as string | undefined,\n    captionPos: CaptionPosition.n,\n    captionInside: false,\n    font: FONT_LABEL_DEFAULT,\n}\n\nexport class LabelRect extends ComponentBase<0, 0, LabelRectRepr, undefined> {\n\n    private _w: number\n    private _h: number\n    private _color: RectangleColor\n    private _strokeWidth: number\n    private _noFill: boolean\n    private _rounded: boolean\n    private _caption: string | undefined\n    private _captionPos: CaptionPosition\n    private _captionInside: boolean\n    private _font: string\n\n    public constructor(editor: LogicEditor, savedData: LabelRectRepr | null) {\n        super(editor, undefined, savedData, {})\n        if (isNotNull(savedData)) {\n            this._w = savedData.w\n            this._h = savedData.h\n            this._color = savedData.color ?? LabelRectDefaults.color\n            this._strokeWidth = savedData.strokeWidth ?? LabelRectDefaults.strokeWidth\n            this._noFill = savedData.noFill ?? LabelRectDefaults.noFill\n            this._rounded = savedData.rounded ?? LabelRectDefaults.rounded\n            this._caption = savedData.caption ?? LabelRectDefaults.caption\n            this._captionPos = savedData.captionPos ?? LabelRectDefaults.captionPos\n            this._captionInside = savedData.captionInside ?? LabelRectDefaults.captionInside\n            this._font = savedData.font ?? LabelRectDefaults.font\n        } else {\n            this._w = LabelRectDefaults.width\n            this._h = LabelRectDefaults.height\n            this._color = LabelRectDefaults.color\n            this._strokeWidth = LabelRectDefaults.strokeWidth\n            this._noFill = LabelRectDefaults.noFill\n            this._rounded = LabelRectDefaults.rounded\n            this._caption = LabelRectDefaults.caption\n            this._captionPos = LabelRectDefaults.captionPos\n            this._captionInside = LabelRectDefaults.captionInside\n            this._font = LabelRectDefaults.font\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"rect\" as const,\n            ...this.toJSONBase(),\n            w: this._w,\n            h: this._h,\n            color: this._color,\n            strokeWidth: this._strokeWidth,\n            noFill: this._noFill === LabelRectDefaults.noFill ? undefined : this._noFill,\n            rounded: this._rounded === LabelRectDefaults.rounded ? undefined : this._rounded,\n            caption: this._caption === LabelRectDefaults.caption ? undefined : this._caption,\n            captionPos: this._captionPos === LabelRectDefaults.captionPos ? undefined : this._captionPos,\n            captionInside: this._captionInside === LabelRectDefaults.captionInside ? undefined : this._captionInside,\n            font: this._font === LabelRectDefaults.font ? undefined : this._font,\n        }\n    }\n\n    public get componentType() {\n        return \"label\" as const\n    }\n\n    public override canRotate() {\n        return false\n    }\n\n    public get unrotatedWidth() {\n        return this._w\n    }\n\n    public get unrotatedHeight() {\n        return this._h\n    }\n\n    protected doRecalcValue(): undefined {\n        return undefined\n    }\n\n    public override get drawZIndex(): DrawZIndex {\n        return 0\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        const width = this._w\n        const height = this._h\n        const left = this.posX - width / 2\n        const top = this.posY - height / 2\n\n        g.beginPath()\n        if (this._rounded) {\n            const r = 3 * this._strokeWidth\n            g.moveTo(left + r, top)\n            g.lineTo(left + width - r, top)\n            g.quadraticCurveTo(left + width, top, left + width, top + r)\n            g.lineTo(left + width, top + height - r)\n            g.quadraticCurveTo(left + width, top + height, left + width - r, top + height)\n            g.lineTo(left + r, top + height)\n            g.quadraticCurveTo(left, top + height, left, top + height - r)\n            g.lineTo(left, top + r)\n            g.quadraticCurveTo(left, top, left + r, top)\n        } else {\n            g.rect(left, top, width, height)\n        }\n        g.closePath()\n\n        if (!this._noFill) {\n            g.fillStyle = COLOR_RECTANGLE_BACKGROUND[this._color]\n            g.fill()\n        }\n\n        if (isDefined(this._caption)) {\n            g.fillStyle = COLOR_COMPONENT_BORDER\n            g.font = this._font\n            g.textAlign = \"center\"\n            g.textBaseline = \"middle\"\n\n            const metrics = g.measureText(this._caption)\n            const offsetV = (metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent + this._strokeWidth) / 2 + 2\n            const margin = 2\n            const offsetH = (metrics.width + this._strokeWidth) / 2 + margin\n\n            const captionY = (() => {\n                switch (this._captionPos) {\n                    case \"c\":\n                    case \"w\":\n                    case \"e\":\n                        return this.posY\n                    case \"n\":\n                    case \"nw\":\n                    case \"ne\":\n                        return this.posY - this.height / 2 + (this._captionInside ? 1 : -1) * offsetV\n                    case \"s\":\n                    case \"se\":\n                    case \"sw\":\n                        return this.posY + this.height / 2 + (this._captionInside ? -1 : 1) * offsetV\n                }\n            })()\n\n            const captionX = (() => {\n                switch (this._captionPos) {\n                    case \"c\":\n                    case \"n\":\n                    case \"s\":\n                        return this.posX\n\n                    case \"w\":\n                        return this.posX - this.width / 2 + (this._captionInside ? 1 : -1) * offsetH\n                    case \"nw\":\n                    case \"sw\":\n                        return this.posX - this.width / 2 + offsetH - (this._captionInside ? 0 : 1) * (margin + this._strokeWidth)\n\n                    case \"e\":\n                        return this.posX + this.width / 2 + (this._captionInside ? -1 : 1) * offsetH\n                    case \"ne\":\n                    case \"se\":\n                        return this.posX + this.width / 2 - offsetH + (this._captionInside ? 0 : 1) * (margin + this._strokeWidth)\n                }\n            })()\n\n            g.fillText(this._caption, captionX, captionY)\n        }\n\n        if (ctx.isMouseOver) {\n            g.lineWidth = Math.max(3, this._strokeWidth)\n            g.strokeStyle = COLOR_MOUSE_OVER\n            g.stroke()\n        } else if (this._strokeWidth > 0) {\n            g.lineWidth = this._strokeWidth\n            g.strokeStyle = COLOR_RECTANGLE_BORDER[this._color]\n            g.stroke()\n        }\n    }\n\n    private doSetColor(color: RectangleColor) {\n        this._color = color\n        this.setNeedsRedraw(\"color changed\")\n    }\n\n    private doSetStrokeWidth(strokeWidth: number) {\n        this._strokeWidth = strokeWidth\n        this.setNeedsRedraw(\"stroke width changed\")\n    }\n\n    private doSetCaption(caption: string | undefined) {\n        this._caption = caption\n        this.setNeedsRedraw(\"caption changed\")\n    }\n\n    private doSetCaptionPos(captionPos: CaptionPosition) {\n        this._captionPos = captionPos\n        this.setNeedsRedraw(\"caption position changed\")\n    }\n\n    private doSetFont(font: string) {\n        this._font = font\n        this.setNeedsRedraw(\"font changed\")\n    }\n\n    private makeCurrentSizeString() {\n        return `${this._w} \u00D7 ${this._h}`\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const s = S.Components.LabelRect.contextMenu\n        const currentSizeStr = this.makeCurrentSizeString()\n        const setSizeItem = ContextMenuData.item(\"dimensions\", s.Size + ` (${currentSizeStr})\u2026`, () => this.runSetSizeDialog(currentSizeStr))\n\n        const makeSetStrokeWidthItem = (strokeWidth: number, desc: string) => {\n            const isCurrent = this._strokeWidth === strokeWidth\n            const icon = isCurrent ? \"check\" : \"none\"\n            return ContextMenuData.item(icon, desc, () => this.doSetStrokeWidth(strokeWidth))\n        }\n\n        const makeItemUseColor = (desc: string, color: RectangleColor) => {\n            const isCurrent = this._color === color\n            const icon = isCurrent ? \"check\" : \"none\"\n            const action = isCurrent ? () => undefined : () => this.doSetColor(color)\n            if (isDefined(color)) {\n                const fillColorProp = this._noFill ? \"\" : `background-color: ${COLOR_RECTANGLE_BACKGROUND[color]}; `\n                const roundedProp = !this._rounded ? \"\" : \"border-radius: 4px; \"\n                const borderColor = COLOR_RECTANGLE_BORDER[color]\n                return ContextMenuData.item(icon, span(title(desc), style(`display: inline-block; width: 140px; height: 18px; ${fillColorProp}${roundedProp}margin-right: 8px; border: 2px solid ${borderColor}`)), action)\n            } else {\n                return ContextMenuData.item(icon, desc, action)\n            }\n        }\n\n        const toggleRoundedItem = ContextMenuData.item(this._rounded ? \"check\" : \"none\", s.Rounded, () => {\n            this._rounded = !this._rounded\n            this.setNeedsRedraw(\"rounded changed\")\n        })\n\n        const toggleNoFillItem = ContextMenuData.item(!this._noFill ? \"check\" : \"none\", s.WithBackgroundColor, () => {\n            this._noFill = !this._noFill\n            this.setNeedsRedraw(\"nofill changed\")\n        })\n\n        const setCaptionItemName = isDefined(this._caption) ? s.ChangeTitle : s.SetTitle\n        const setCaptionItem = ContextMenuData.item(\"pen\", setCaptionItemName, () => this.runSetCaptionDialog())\n\n        const makeItemSetPlacement = (desc: string, placement: CaptionPosition) => {\n            const isCurrent = this._captionPos === placement\n            const icon = isCurrent ? \"check\" : \"none\"\n            const action = isCurrent ? () => undefined : () => this.doSetCaptionPos(placement)\n            return ContextMenuData.item(icon, desc, action)\n        }\n\n        const toggleCaptionInsideItems = this._captionPos === \"c\" ? [] : [\n            ContextMenuData.item(this._captionInside ? \"check\" : \"none\", s.InsideFrame, () => {\n                this._captionInside = !this._captionInside\n                this.setNeedsRedraw(\"caption inside changed\")\n            }),\n            ContextMenuData.sep(),\n        ]\n\n        const setFontItem = ContextMenuData.item(\"font\", s.Font, () => {\n            this.runSetFontDialog(this._font, LabelRectDefaults.font, this.doSetFont.bind(this))\n        })\n\n\n        return [\n            [\"mid\", setSizeItem],\n            [\"mid\", ContextMenuData.submenu(\"palette\", s.Color, [\n                toggleNoFillItem,\n                ContextMenuData.sep(),\n                makeItemUseColor(s.ColorYellow, RectangleColor.yellow),\n                makeItemUseColor(s.ColorRed, RectangleColor.red),\n                makeItemUseColor(s.ColorGreen, RectangleColor.green),\n                makeItemUseColor(s.ColorBlue, RectangleColor.blue),\n                makeItemUseColor(s.ColorTurquoise, RectangleColor.turquoise),\n                makeItemUseColor(s.ColorGrey, RectangleColor.grey),\n            ])],\n            [\"mid\", ContextMenuData.submenu(\"strokewidth\", s.Border, [\n                makeSetStrokeWidthItem(0, s.BorderNone),\n                ContextMenuData.sep(),\n                makeSetStrokeWidthItem(1, s.Border1px),\n                makeSetStrokeWidthItem(2, s.Border2px),\n                makeSetStrokeWidthItem(3, s.Border3px),\n                makeSetStrokeWidthItem(5, s.Border5px),\n                makeSetStrokeWidthItem(10, s.Border10px),\n            ])],\n            [\"mid\", toggleRoundedItem],\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", setCaptionItem],\n            [\"mid\", setFontItem],\n            [\"mid\", ContextMenuData.submenu(\"placement\", s.TitlePlacement, [\n                ...toggleCaptionInsideItems,\n                makeItemSetPlacement(s.PlacementTop, CaptionPosition.n),\n                makeItemSetPlacement(s.PlacementTopLeft, CaptionPosition.nw),\n                makeItemSetPlacement(s.PlacementTopRight, CaptionPosition.ne),\n                makeItemSetPlacement(s.PlacementBottom, CaptionPosition.s),\n                makeItemSetPlacement(s.PlacementBottomLeft, CaptionPosition.sw),\n                makeItemSetPlacement(s.PlacementBottomRight, CaptionPosition.se),\n                makeItemSetPlacement(s.PlacementLeft, CaptionPosition.w),\n                makeItemSetPlacement(s.PlacementRight, CaptionPosition.e),\n                makeItemSetPlacement(s.PlacementCenter, CaptionPosition.c),\n            ])],\n        ]\n    }\n\n    private runSetSizeDialog(currentSizeStr: string) {\n        const promptReturnValue = window.prompt(S.Components.LabelRect.contextMenu.SizePrompt, currentSizeStr)\n        if (promptReturnValue !== null) {\n            let match\n            if ((match = /^(?<w>\\d*)(?:(?:\\s+|(?: *[\u00D7x,;] *))(?<h>\\d*))?$/.exec(promptReturnValue)) !== null) {\n                const parse = (s: string | undefined, dflt: number) => {\n                    if (isUndefined(s)) {\n                        return dflt\n                    }\n                    const n = parseInt(s)\n                    if (isNaN(n) || n <= 0) {\n                        return dflt\n                    }\n                    return n\n                }\n                const w = parse(match.groups?.w, this._w)\n                const h = parse(match.groups?.h, this._h)\n                this.doSetDimensions(w, h)\n            }\n        }\n    }\n\n    private doSetDimensions(w: number, h: number) {\n        this._w = w\n        this._h = h\n        this.setNeedsRedraw(\"size changed\")\n    }\n\n    public wrapContents(selectedComps: Set<Drawable>) {\n        if (selectedComps.size === 0) {\n            return\n        }\n\n        let left = Number.POSITIVE_INFINITY\n        let top = Number.POSITIVE_INFINITY\n        let right = Number.NEGATIVE_INFINITY\n        let bottom = Number.NEGATIVE_INFINITY\n        for (const comp of selectedComps) {\n            if (comp instanceof DrawableWithPosition) {\n                left = Math.min(left, comp.posX - comp.width / 2)\n                top = Math.min(top, comp.posY - comp.height / 2)\n                right = Math.max(right, comp.posX + comp.width / 2)\n                bottom = Math.max(bottom, comp.posY + comp.height / 2)\n            }\n        }\n\n        const tryX = (left + right) / 2\n        const tryY = (top + bottom) / 2\n        const [x, y] = this.trySetPosition(tryX, tryY, true) ?? [tryX, tryY]\n\n        left = Math.floor((left + Math.max(0, tryX - x)) / GRID_STEP) * GRID_STEP\n        top = Math.floor((top + Math.max(0, tryY - y)) / GRID_STEP) * GRID_STEP\n        right = Math.ceil((right + Math.max(0, x - tryX)) / GRID_STEP) * GRID_STEP\n        bottom = Math.ceil((bottom + Math.max(0, y - tryY)) / GRID_STEP) * GRID_STEP\n        const w = right - left + 4 * GRID_STEP\n        const h = bottom - top + 4 * GRID_STEP\n        this.doSetDimensions(w, h)\n    }\n\n    private runSetCaptionDialog() {\n        const promptReturnValue = window.prompt(S.Components.LabelRect.contextMenu.SetTitlePrompt, this._caption)\n        if (promptReturnValue !== null) {\n            // OK button pressed\n            const newCaption = promptReturnValue.length === 0 ? undefined : promptReturnValue\n            this.doSetCaption(newCaption)\n        }\n    }\n\n    public override mouseDoubleClicked(__e: MouseEvent | TouchEvent): boolean {\n        // TODO: implement dragging for resizing the rectangle\n        // don't call super, which would rotate the rectangle, this is useless here\n        this.runSetSizeDialog(this.makeCurrentSizeString())\n        return true\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetCaptionDialog()\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { DrawZIndex } from \"../ComponentList\"\nimport { COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, FONT_LABEL_DEFAULT, GRID_STEP } from \"../drawutils\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isNotNull, isUndefined, typeOrUndefined } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\nexport const LabelStringDef =\n    defineComponent(0, 0, t.type({\n        text: t.string,\n        // align: typeOrUndefined(t.string), \n        font: typeOrUndefined(t.string),\n    }, \"Label\"))\n\nexport type LabelStringRepr = typeof LabelStringDef.reprType\n\nconst LabelStringDefaults = {\n    text: \"Label\",\n    // align: \"center\" as const,\n    font: FONT_LABEL_DEFAULT,\n}\nexport class LabelString extends ComponentBase<0, 0, LabelStringRepr, undefined> {\n\n    private _text: string\n    // private _align: CanvasTextAlign // causes issues with mouseovers and stuff\n    private _font: string\n    private _cachedTextMetrics: TextMetrics | undefined = undefined\n\n    public constructor(editor: LogicEditor, savedData: LabelStringRepr | null) {\n        super(editor, undefined, savedData, {})\n        if (isNotNull(savedData)) {\n            this._text = savedData.text\n            // this._align = (savedData.align as CanvasTextAlign) ?? LabelStringDefaults.align\n            this._font = savedData.font ?? LabelStringDefaults.font\n        } else {\n            this._text = LabelStringDefaults.text\n            // this._align = LabelStringDefaults.align\n            this._font = LabelStringDefaults.font\n        }\n    }\n\n    public toJSON() {\n        return {\n            ...this.toJSONBase(),\n            text: this._text,\n            // align: this._align === LabelStringDefaults.align ? undefined : this._align,\n            font: this._font === LabelStringDefaults.font ? undefined : this._font,\n        }\n    }\n\n    public get componentType() {\n        return \"label\" as const\n    }\n\n    public get unrotatedWidth() {\n        return this._cachedTextMetrics?.width ?? GRID_STEP * this._text.length\n    }\n\n    public get unrotatedHeight() {\n        const metrics = this._cachedTextMetrics\n        if (isUndefined(metrics)) {\n            return 2 * GRID_STEP\n        }\n        return metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent\n    }\n\n    protected doRecalcValue(): undefined {\n        return undefined\n    }\n\n    public override get drawZIndex(): DrawZIndex {\n        return 2\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        g.font = this._font\n        g.lineWidth = 3\n\n        if (ctx.isMouseOver) {\n            if (isUndefined(this._cachedTextMetrics)) {\n                this._cachedTextMetrics = g.measureText(this._text)\n            }\n            const width = this.unrotatedWidth\n            const height = this.unrotatedHeight\n            g.strokeStyle = COLOR_MOUSE_OVER\n            g.beginPath()\n            g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n            g.stroke()\n        }\n\n        g.fillStyle = COLOR_COMPONENT_BORDER\n        g.textAlign = \"center\"\n        g.textBaseline = \"middle\"\n        g.fillText(this._text, this.posX, this.posY)\n    }\n\n    private doSetText(text: string) {\n        this._text = text\n        this._cachedTextMetrics = undefined\n        this.setNeedsRedraw(\"text changed\")\n    }\n\n    private doSetFont(font: string) {\n        this._font = font\n        this._cachedTextMetrics = undefined\n        this.setNeedsRedraw(\"font changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const s = S.Components.LabelString.contextMenu\n        const setTextItem = ContextMenuData.item(\"pen\", s.ChangeText, this.runSetTextDialog.bind(this))\n\n        const setFontItem = ContextMenuData.item(\"font\", s.Font, () => {\n            this.runSetFontDialog(this._font, LabelStringDefaults.font, this.doSetFont.bind(this))\n        })\n\n        return [\n            [\"mid\", setTextItem],\n            [\"mid\", setFontItem],\n        ]\n    }\n\n    private runSetTextDialog() {\n        const promptReturnValue = window.prompt(S.Components.LabelString.contextMenu.ChangeTextPrompt, this._text)\n        if (promptReturnValue !== null) {\n            // OK button pressed\n            const newText = promptReturnValue.length === 0 ? LabelStringDefaults.text : promptReturnValue\n            this.doSetText(newText)\n        }\n    }\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetTextDialog()\n        }\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseDoubleClicked(e)) {\n            return true // already handled\n        }\n        this.runSetTextDialog()\n        return true\n    }\n\n\n}\n", "import * as t from \"io-ts\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { isString, isUndefined } from \"../utils\"\nimport { LabelRect, LabelRectDef } from \"./LabelRect\"\nimport { LabelString, LabelStringDef } from \"./LabelString\"\n\nexport type Label = LabelString | LabelRect\n\nexport const LabelDef = t.union([\n    LabelStringDef.repr,\n    LabelRectDef.repr,\n], \"Label\")\n\ntype LabelRepr = t.TypeOf<typeof LabelDef>\n\nexport const LabelFactory = {\n\n    make: (editor: LogicEditor, savedDataOrType: LabelRepr | string | undefined) => {\n        let blank\n        let savedData: LabelRepr\n\n        if (isUndefined(savedDataOrType)) {\n            // default, typeless option\n            blank = true\n            savedData = {} as LabelRepr\n        } else if (isString(savedDataOrType)) {\n            // specific subtype\n            blank = true\n            savedData = { type: savedDataOrType } as LabelRepr\n        } else {\n            // as saved\n            blank = false\n            savedData = savedDataOrType\n        }\n\n        if (!(\"type\" in savedData)) {\n            return new LabelString(editor, blank ? null : savedData)\n        }\n        switch (savedData.type) {\n            case \"rect\":\n                return new LabelRect(editor, blank ? null : savedData)\n        }\n\n    },\n\n}\n\n", "import * as t from \"io-ts\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { isString, isUndefined } from \"../utils\"\nimport { Passthrough1, Passthrough1Def, Passthrough4, Passthrough4Def, Passthrough8, Passthrough8Def } from \"./Passthrough\"\n\nexport type Passthrough = Passthrough1 | Passthrough4 | Passthrough8\n\nexport const LayoutDef = t.union([\n    Passthrough1Def.repr,\n    Passthrough4Def.repr,\n    Passthrough8Def.repr,\n], \"Layout\")\n\ntype LayoutRepr = t.TypeOf<typeof LayoutDef>\n\nexport const LayoutFactory = {\n\n    make: (editor: LogicEditor, savedDataOrType: LayoutRepr | string | undefined) => {\n\n        if (isUndefined(savedDataOrType)) {\n            return undefined\n        }\n\n        let blank\n        let savedData: LayoutRepr\n        if (isString(savedDataOrType)) {\n            // specific subtype\n            blank = true\n            savedData = { type: savedDataOrType } as LayoutRepr\n        } else {\n            // as saved\n            blank = false\n            savedData = savedDataOrType\n        }\n\n        switch (savedData.type) {\n            case \"pass\":\n                return new Passthrough1(editor, blank ? null : savedData)\n            case \"pass-4\":\n                return new Passthrough4(editor, blank ? null : savedData)\n            case \"pass-8\":\n                return new Passthrough8(editor, blank ? null : savedData)\n        }\n\n    },\n\n}\n\n", "import * as t from \"io-ts\"\nimport { COLOR_COMPONENT_BORDER, COLOR_HIGH_IMPEDANCE, COLOR_LED_ON, COLOR_MOUSE_OVER, COLOR_UNKNOWN, COLOR_WIRE_BORDER, drawComponentName, drawWireLineToComponent, GRID_STEP, pxToGrid } from \"../drawutils\"\nimport { asValue, Modifier, mods, span, style, title, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { HighImpedance, isDefined, isHighImpedance, isNotNull, isUnknown, LogicValue, toLogicValueRepr, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\n\nexport const OutputBarTypes = {\n    v: null,\n    h: null,\n    px: null,\n    PX: null,\n} as const\n\ntype OutputBarType = keyof typeof OutputBarTypes\n\n\nexport const LedColors = {\n    green: null,\n    red: null,\n    yellow: null,\n} as const\n\nexport type LedColor = keyof typeof LedColors\n\nexport function ledColorForLogicValue(v: LogicValue, onColor: LedColor) {\n    return isUnknown(v) ? COLOR_UNKNOWN :\n        isHighImpedance(v) ? COLOR_HIGH_IMPEDANCE :\n            v ? COLOR_LED_ON[onColor] : COLOR_WIRE_BORDER\n}\n\nexport const OutputBarDef =\n    defineComponent(1, 0, t.type({\n        type: t.literal(\"bar\"),\n        display: t.keyof(OutputBarTypes, \"OutputBarType\"),\n        color: typeOrUndefined(t.keyof(LedColors, \"LedColor\")),\n        transparent: typeOrUndefined(t.boolean),\n        name: ComponentNameRepr,\n    }, \"OutputBar\"))\n\ntype OutputBarRepr = typeof OutputBarDef.reprType\n\nconst OutputBarDefaults = {\n    display: \"h\" as OutputBarType,\n    color: \"green\" as LedColor,\n    transparent: false,\n}\nconst GRID_WIDTH = 10\nconst GRID_HEIGHT = 2\n\n\nexport class OutputBar extends ComponentBase<1, 0, OutputBarRepr, LogicValue> {\n\n    private _display = OutputBarDefaults.display\n    private _color = OutputBarDefaults.color\n    private _transparent = OutputBarDefaults.transparent\n    private _name: ComponentName = undefined\n\n    public constructor(editor: LogicEditor, savedData: OutputBarRepr | null) {\n        super(editor, false, savedData, { ins: [[undefined, 0, 0, \"w\"]] })\n        if (isNotNull(savedData)) {\n            this.doSetDisplay(savedData.display)\n            this._color = savedData.color ?? OutputBarDefaults.color\n            this._transparent = savedData.transparent ?? OutputBarDefaults.transparent\n            this._name = savedData.name\n        } else {\n            this.updateInputOffsetX()\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"bar\" as const,\n            ...super.toJSONBase(),\n            display: this._display,\n            color: this._color === OutputBarDefaults.color ? undefined : this._color,\n            transparent: this._transparent === OutputBarDefaults.transparent ? undefined : this._transparent,\n            name: this._name,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    public get unrotatedWidth() {\n        return this.getWidthAndHeight()[0]\n    }\n\n    public get unrotatedHeight() {\n        return this.getWidthAndHeight()[1]\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.OutputBar.tooltip\n        const expl: Modifier = (() => {\n            switch (this.value) {\n                case Unknown: return s.ValueUnknown\n                case HighImpedance: return s.ValueUnknown\n                case true: return mods(s.Value1[0], asValue(this.value), s.Value1[1])\n                case false: return mods(s.Value0[0], asValue(this.value), s.Value0[1])\n            }\n        })()\n        return tooltipContent(s.title, expl)\n    }\n\n    public get display() {\n        return this._display\n    }\n\n    protected doRecalcValue(): LogicValue {\n        return this.inputs[0].value\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        const input = this.inputs[0]\n        const valueToShow = this.editor.options.hideOutputColors ? Unknown : this.value\n\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const backColor = ledColorForLogicValue(valueToShow, this._color)\n\n        g.fillStyle = backColor\n        const [w, h] = this.getWidthAndHeight()\n        g.beginPath()\n        g.rect(this.posX - w / 2, this.posY - h / 2, w, h)\n        g.closePath()\n        if (!this._transparent || valueToShow !== false) {\n            g.fill()\n        }\n        g.stroke()\n\n        drawWireLineToComponent(g, input, this.posX - w / 2 - 2, this.posY)\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (isDefined(this._name)) {\n                drawComponentName(g, ctx, this._name, toLogicValueRepr(valueToShow), this, true)\n            }\n        })\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    public getWidthAndHeight() {\n        switch (this._display) {\n            case \"h\":\n                return [GRID_WIDTH * GRID_STEP, GRID_HEIGHT * GRID_STEP] as const\n            case \"v\":\n                return [GRID_HEIGHT * GRID_STEP, GRID_WIDTH * GRID_STEP] as const\n            case \"px\":\n                return [GRID_HEIGHT * GRID_STEP, GRID_HEIGHT * GRID_STEP] as const\n            case \"PX\":\n                return [GRID_WIDTH * GRID_STEP, GRID_WIDTH * GRID_STEP] as const\n        }\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseDoubleClicked(e)) {\n            return true // already handled\n        }\n        this.doSetDisplay((() => {\n            switch (this.display) {\n                case \"h\":\n                    return \"v\"\n                case \"v\":\n                    return \"px\"\n                case \"px\":\n                    return \"PX\"\n                case \"PX\":\n                    return \"h\"\n            }\n        })())\n        return true\n    }\n\n    private doSetDisplay(newDisplay: OutputBarType) {\n        this._display = newDisplay\n        this.updateInputOffsetX()\n        this.setNeedsRedraw(\"display mode changed\")\n    }\n\n    private doSetColor(color: LedColor) {\n        this._color = color\n        this.setNeedsRedraw(\"color changed\")\n    }\n\n    private doSetTransparent(transparent: boolean) {\n        this._transparent = transparent\n        this.setNeedsRedraw(\"transparent changed\")\n    }\n\n    private updateInputOffsetX() {\n        const width = this.getWidthAndHeight()[0]\n        this.inputs[0].gridOffsetX = -pxToGrid(width / 2) - 2\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        const s = S.Components.OutputBar.contextMenu\n\n        const makeItemShowAs = (desc: string, display: OutputBarType) => {\n            const isCurrent = this._display === display\n            const icon = isCurrent ? \"check\" : \"none\"\n            const action = isCurrent ? () => undefined : () => this.doSetDisplay(display)\n            return ContextMenuData.item(icon, desc, action)\n        }\n\n        const makeItemUseColor = (desc: string, color: LedColor) => {\n            const isCurrent = this._color === color\n            const icon = isCurrent ? \"check\" : \"none\"\n            const action = isCurrent ? () => undefined : () => this.doSetColor(color)\n            const cssColor = COLOR_LED_ON[color]\n            return ContextMenuData.item(icon, span(title(desc), style(`display: inline-block; width: 140px; height: 16px; background-color: ${cssColor}; margin-right: 8px`)), action)\n        }\n\n        const itemTransparent = ContextMenuData.item(\n            this._transparent ? \"check\" : \"none\",\n            s.TransparentWhenOff,\n            () => this.doSetTransparent(!this._transparent)\n        )\n\n        return [\n            [\"mid\", ContextMenuData.submenu(\"eye\", s.Display, [\n                makeItemShowAs(s.DisplayVerticalBar, \"v\"),\n                makeItemShowAs(s.DisplayHorizontalBar, \"h\"),\n                makeItemShowAs(s.DisplaySmallSquare, \"px\"),\n                makeItemShowAs(s.DisplayLargeSquare, \"PX\"),\n                ContextMenuData.sep(),\n                ContextMenuData.text(s.DisplayChangeDesc),\n            ])],\n            [\"mid\", ContextMenuData.submenu(\"palette\", s.Color, [\n                makeItemUseColor(s.ColorGreen, \"green\"),\n                makeItemUseColor(s.ColorRed, \"red\"),\n                makeItemUseColor(s.ColorYellow, \"yellow\"),\n                ContextMenuData.sep(),\n                itemTransparent,\n            ])],\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_LED_ON, COLOR_MOUSE_OVER, COLOR_OFF_BACKGROUND, drawComponentName, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, span, style, title, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArrayFill, FixedReadonlyArray, isDefined, isNotNull, LogicValue, toLogicValueRepr, typeOrUndefined } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { LedColor, ledColorForLogicValue, LedColors } from \"./OutputBar\"\n\n\nexport const Output16SegDef =\n    defineComponent(17, 0, t.type({\n        type: t.literal(\"16seg\"),\n        color: typeOrUndefined(t.keyof(LedColors, \"LedColor\")),\n        transparent: typeOrUndefined(t.boolean),\n        name: ComponentNameRepr,\n    }, \"Ouput16Seg\"))\n\nconst enum INPUT {\n    a1, a2, b, c, d2, d1, e, f, g1, g2, h, i, j, k, l, m, p\n}\n\nconst Output16SegDefaults = {\n    color: \"green\" as LedColor,\n    transparent: true,\n}\n\nconst GRID_WIDTH = 8\nconst GRID_HEIGHT = 10\n\nexport type Output16SegRepr = typeof Output16SegDef.reprType\n\nexport class Output16Seg extends ComponentBase<17, 0, Output16SegRepr, FixedReadonlyArray<LogicValue, 17>> {\n\n    private _color = Output16SegDefaults.color\n    private _transparent = Output16SegDefaults.transparent\n    private _name: ComponentName = undefined\n\n    public constructor(editor: LogicEditor, savedData: Output16SegRepr | null) {\n        super(editor, FixedArrayFill(false, 17), savedData, {\n            ins: [\n                [\"a1\", -5, -4, \"w\", \"In\"],\n                [\"a2\", -6, -3.5, \"w\", \"In\"],\n                [\"b\", -5, -3, \"w\", \"In\"],\n                [\"c\", -6, -2.5, \"w\", \"In\"],\n                [\"d2\", -5, -2, \"w\", \"In\"],\n                [\"d1\", -6, -1.5, \"w\", \"In\"],\n                [\"e\", -5, -1, \"w\", \"In\"],\n                [\"f\", -6, -0.5, \"w\", \"In\"],\n                [\"g1\", -5, 0, \"w\", \"In\"],\n                [\"g2\", -6, 0.5, \"w\", \"In\"],\n                [\"h\", -5, +1, \"w\", \"In\"],\n                [\"i\", -6, +1.5, \"w\", \"In\"],\n                [\"j\", -5, +2, \"w\", \"In\"],\n                [\"k\", -6, +2.5, \"w\", \"In\"],\n                [\"l\", -5, +3, \"w\", \"In\"],\n                [\"m\", -6, +3.5, \"w\", \"In\"],\n                [\"p\", -5, +4, \"w\", \"In\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._color = savedData.color ?? Output16SegDefaults.color\n            this._transparent = savedData.transparent ?? Output16SegDefaults.transparent\n            this._name = savedData.name\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"16seg\" as const,\n            ...this.toJSONBase(),\n            color: this._color === Output16SegDefaults.color ? undefined : this._color,\n            transparent: this._transparent === Output16SegDefaults.transparent ? undefined : this._transparent,\n            name: this._name,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(\n            div(S.Components.Output16Seg.tooltip),\n        ))\n    }\n\n    protected doRecalcValue(): FixedReadonlyArray<LogicValue, 17> {\n        return this.inputValues<17>([INPUT.a1, INPUT.a2, INPUT.b, INPUT.c, INPUT.d2, INPUT.d1, INPUT.e, INPUT.f, INPUT.g1, INPUT.g2, INPUT.h, INPUT.i, INPUT.j, INPUT.k, INPUT.l, INPUT.m, INPUT.p])\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = left + width\n        const top = this.posY - height / 2\n        const bottom = top + height\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, this.posX - width / 2 - 2, input.posYInParentTransform)\n        }\n\n        const [a1, a2, b, c, d2, d1, e, f, g1, g2, h, i, j, k, l, m, p] = this.value\n\n        const vMargin = 10\n        const strokeHalfWidth = 3\n        const drawLeft = left + 18\n        const drawRight = right - 10\n        const drawCenterX = (drawLeft + drawRight) / 2\n        const drawTop = top + vMargin\n        const drawBottom = bottom - vMargin\n\n        const doFill = (v: LogicValue) => {\n            if (!this._transparent || v !== false) {\n                g.fillStyle = ledColorForLogicValue(v, this._color)\n                g.fill()\n            }\n        }\n\n        const drawH = (v: LogicValue, xLeft: number, xRight: number, y: number) => {\n            g.beginPath()\n            g.moveTo(xLeft, y)\n            g.lineTo(xLeft + strokeHalfWidth, y - strokeHalfWidth)\n            g.lineTo(xRight - strokeHalfWidth, y - strokeHalfWidth)\n            g.lineTo(xRight, y)\n            g.lineTo(xRight - strokeHalfWidth, y + strokeHalfWidth)\n            g.lineTo(xLeft + strokeHalfWidth, y + strokeHalfWidth)\n            g.closePath()\n            g.stroke()\n            doFill(v)\n        }\n\n        const drawV = (v: LogicValue, x: number, yTop: number, yBottom: number) => {\n            g.beginPath()\n            g.moveTo(x, yTop)\n            g.lineTo(x + strokeHalfWidth, yTop + strokeHalfWidth)\n            g.lineTo(x + strokeHalfWidth, yBottom - strokeHalfWidth)\n            g.lineTo(x, yBottom)\n            g.lineTo(x - strokeHalfWidth, yBottom - strokeHalfWidth)\n            g.lineTo(x - strokeHalfWidth, yTop + strokeHalfWidth)\n            g.closePath()\n            g.stroke()\n            doFill(v)\n        }\n\n        const dx = strokeHalfWidth * 1.41\n        const dy = strokeHalfWidth * 1.41\n\n        const drawBackslash = (v: LogicValue, xLeft: number, yTop: number, xRight: number, yBottom: number) => {\n            g.beginPath()\n            g.moveTo(xLeft, yTop)\n            g.lineTo(xLeft + dx, yTop)\n            g.lineTo(xRight, yBottom - dy)\n            g.lineTo(xRight, yBottom)\n            g.lineTo(xRight - dx, yBottom)\n            g.lineTo(xLeft, yTop + dy)\n            g.closePath()\n            g.stroke()\n            doFill(v)\n        }\n\n        const drawSlash = (v: LogicValue, xLeft: number, yBottom: number, xRight: number, yTop: number) => {\n            g.beginPath()\n            g.moveTo(xLeft, yBottom)\n            g.lineTo(xLeft, yBottom - dy)\n            g.lineTo(xRight - dx, yTop)\n            g.lineTo(xRight, yTop)\n            g.lineTo(xRight, yTop + dy)\n            g.lineTo(xLeft + dx, yBottom)\n            g.closePath()\n            g.stroke()\n            doFill(v)\n        }\n\n        g.strokeStyle = COLOR_OFF_BACKGROUND\n        g.lineWidth = 1\n        drawH(a1, drawLeft + strokeHalfWidth, drawCenterX, drawTop + strokeHalfWidth)\n        drawH(a2, drawCenterX, drawRight - strokeHalfWidth, drawTop + strokeHalfWidth)\n        drawV(b, drawRight - strokeHalfWidth, drawTop + strokeHalfWidth, this.posY)\n        drawV(c, drawRight - strokeHalfWidth, this.posY, drawBottom - strokeHalfWidth)\n        drawH(d1, drawLeft + strokeHalfWidth, drawCenterX, drawBottom - strokeHalfWidth)\n        drawH(d2, drawCenterX, drawRight - strokeHalfWidth, drawBottom - strokeHalfWidth)\n        drawV(e, drawLeft + strokeHalfWidth, this.posY, drawBottom - strokeHalfWidth)\n        drawV(f, drawLeft + strokeHalfWidth, drawTop + strokeHalfWidth, this.posY)\n        drawH(g1, drawLeft + strokeHalfWidth, drawCenterX, this.posY)\n        drawH(g2, drawCenterX, drawRight - strokeHalfWidth, this.posY)\n        drawV(i, drawCenterX, drawTop + strokeHalfWidth, this.posY)\n        drawV(l, drawCenterX, this.posY, drawBottom - strokeHalfWidth)\n        const slashTop = drawTop + strokeHalfWidth + strokeHalfWidth\n        const slashBottom = drawBottom - strokeHalfWidth - strokeHalfWidth\n        drawBackslash(h, drawLeft + strokeHalfWidth + strokeHalfWidth, slashTop, drawCenterX - strokeHalfWidth, this.posY - strokeHalfWidth)\n        drawSlash(j, drawCenterX + strokeHalfWidth, this.posY - strokeHalfWidth, drawRight - strokeHalfWidth - strokeHalfWidth, slashTop)\n        drawSlash(k, drawLeft + strokeHalfWidth + strokeHalfWidth, slashBottom, drawCenterX - strokeHalfWidth, this.posY + strokeHalfWidth)\n        drawBackslash(m, drawCenterX + strokeHalfWidth, this.posY + strokeHalfWidth, drawRight - strokeHalfWidth - strokeHalfWidth, slashBottom)\n\n        g.beginPath()\n        const radius = 1.3 * strokeHalfWidth\n        g.arc(right - 8, bottom - 7 - radius / 2, radius, 0, 2 * Math.PI)\n        g.stroke()\n        doFill(p)\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"7px sans-serif\"\n\n            this.inputs.forEach(input => {\n                drawLabel(ctx, this.orient, input.name, \"w\", left, input)\n            })\n\n            if (isDefined(this._name)) {\n                const valueString = this.value.map(toLogicValueRepr).join(\"\")\n                drawComponentName(g, ctx, this._name, valueString, this, true)\n            }\n        })\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    private doSetColor(color: LedColor) {\n        this._color = color\n        this.setNeedsRedraw(\"color changed\")\n    }\n\n    private doSetTransparent(transparent: boolean) {\n        this._transparent = transparent\n        this.setNeedsRedraw(\"transparent changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        // TODO merge with OutputBar\n        const s = S.Components.OutputBar.contextMenu // same between 16 and 7 seg; merge?\n\n        const makeItemUseColor = (desc: string, color: LedColor) => {\n            const isCurrent = this._color === color\n            const icon = isCurrent ? \"check\" : \"none\"\n            const action = isCurrent ? () => undefined : () => this.doSetColor(color)\n            const cssColor = COLOR_LED_ON[color]\n            return ContextMenuData.item(icon, span(title(desc), style(`display: inline-block; width: 140px; height: 16px; background-color: ${cssColor}; margin-right: 8px`)), action)\n        }\n\n        const itemTransparent = ContextMenuData.item(\n            this._transparent ? \"check\" : \"none\",\n            s.TransparentWhenOff,\n            () => this.doSetTransparent(!this._transparent)\n        )\n\n        return [\n            [\"mid\", ContextMenuData.submenu(\"palette\", s.Color, [\n                makeItemUseColor(s.ColorGreen, \"green\"),\n                makeItemUseColor(s.ColorRed, \"red\"),\n                makeItemUseColor(s.ColorYellow, \"yellow\"), ContextMenuData.sep(),\n                itemTransparent,\n\n            ])],\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_LED_ON, COLOR_MOUSE_OVER, COLOR_OFF_BACKGROUND, drawComponentName, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, span, style, title, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArrayFill, FixedReadonlyArray, isDefined, isNotNull, LogicValue, toLogicValueRepr, typeOrUndefined } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { LedColor, ledColorForLogicValue, LedColors } from \"./OutputBar\"\n\n\nexport const Output7SegDef =\n    defineComponent(8, 0, t.type({\n        type: t.literal(\"7seg\"),\n        color: typeOrUndefined(t.keyof(LedColors, \"LedColor\")),\n        transparent: typeOrUndefined(t.boolean),\n        name: ComponentNameRepr,\n    }, \"Ouput7Seg\"))\n\nconst enum INPUT {\n    a, b, c, d, e, f, g, p\n}\n\nconst Output7SegDefaults = {\n    color: \"green\" as LedColor,\n    transparent: true,\n}\n\nconst GRID_WIDTH = 8\nconst GRID_HEIGHT = 10\n\nexport type Output7SegRepr = typeof Output7SegDef.reprType\n\nexport class Output7Seg extends ComponentBase<8, 0, Output7SegRepr, FixedReadonlyArray<LogicValue, 8>> {\n\n    private _color = Output7SegDefaults.color\n    private _transparent = Output7SegDefaults.transparent\n    private _name: ComponentName = undefined\n\n    public constructor(editor: LogicEditor, savedData: Output7SegRepr | null) {\n        super(editor, FixedArrayFill(false, 8), savedData, {\n            ins: [\n                [\"a\", -5, -4, \"w\", \"In\"],\n                [\"b\", -5, -3, \"w\", \"In\"],\n                [\"c\", -5, -2, \"w\", \"In\"],\n                [\"d\", -5, -1, \"w\", \"In\"],\n                [\"e\", -5, 0, \"w\", \"In\"],\n                [\"f\", -5, +1, \"w\", \"In\"],\n                [\"g\", -5, +2, \"w\", \"In\"],\n                [\"p\", -5, +4, \"w\", \"In\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._color = savedData.color ?? Output7SegDefaults.color\n            this._transparent = savedData.transparent ?? Output7SegDefaults.transparent\n            this._name = savedData.name\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"7seg\" as const,\n            ...this.toJSONBase(),\n            color: this._color === Output7SegDefaults.color ? undefined : this._color,\n            transparent: this._transparent === Output7SegDefaults.transparent ? undefined : this._transparent,\n            name: this._name,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(\n            div(S.Components.Output7Seg.tooltip)\n        ))\n    }\n\n    protected doRecalcValue(): FixedReadonlyArray<LogicValue, 8> {\n        return this.inputValues<8>([INPUT.a, INPUT.b, INPUT.c, INPUT.d, INPUT.e, INPUT.f, INPUT.g, INPUT.p])\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        const right = left + width\n        const top = this.posY - height / 2\n        const bottom = top + height\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, this.posX - width / 2 - 2, input.posYInParentTransform)\n        }\n\n        const [a, b, c, d, e, f, gg, p] = this.value\n\n        const hMargin = 20\n        const vMargin = 10\n        const strokeHalfWidth = 4\n        const drawLeft = left + hMargin\n        const drawRight = right - hMargin\n        const drawTop = top + vMargin\n        const drawBottom = bottom - vMargin\n\n        const doFill = (v: LogicValue) => {\n            if (!this._transparent || v !== false) {\n                g.fillStyle = ledColorForLogicValue(v, this._color)\n                g.fill()\n            }\n        }\n\n        const drawH = (v: LogicValue, y: number) => {\n            g.beginPath()\n            g.moveTo(drawLeft + strokeHalfWidth, y)\n            g.lineTo(drawLeft + strokeHalfWidth + strokeHalfWidth, y - strokeHalfWidth)\n            g.lineTo(drawRight - strokeHalfWidth - strokeHalfWidth, y - strokeHalfWidth)\n            g.lineTo(drawRight - strokeHalfWidth, y)\n            g.lineTo(drawRight - strokeHalfWidth - strokeHalfWidth, y + strokeHalfWidth)\n            g.lineTo(drawLeft + strokeHalfWidth + strokeHalfWidth, y + strokeHalfWidth)\n            g.closePath()\n            g.stroke()\n            doFill(v)\n        }\n\n        const drawV = (v: LogicValue, x: number, yTop: number, yBottom: number) => {\n            g.beginPath()\n            g.moveTo(x, yTop)\n            g.lineTo(x + strokeHalfWidth, yTop + strokeHalfWidth)\n            g.lineTo(x + strokeHalfWidth, yBottom - strokeHalfWidth)\n            g.lineTo(x, yBottom)\n            g.lineTo(x - strokeHalfWidth, yBottom - strokeHalfWidth)\n            g.lineTo(x - strokeHalfWidth, yTop + strokeHalfWidth)\n            g.closePath()\n            g.stroke()\n            doFill(v)\n        }\n\n        g.strokeStyle = COLOR_OFF_BACKGROUND\n        g.lineWidth = 1\n        drawH(a, drawTop + strokeHalfWidth)\n        drawV(b, drawRight - strokeHalfWidth, drawTop + strokeHalfWidth, this.posY)\n        drawV(c, drawRight - strokeHalfWidth, this.posY, drawBottom - strokeHalfWidth)\n        drawH(d, drawBottom - strokeHalfWidth)\n        drawV(e, drawLeft + strokeHalfWidth, this.posY, drawBottom - strokeHalfWidth)\n        drawV(f, drawLeft + strokeHalfWidth, drawTop + strokeHalfWidth, this.posY)\n        drawH(gg, this.posY)\n\n        g.beginPath()\n        const radius = 1.3 * strokeHalfWidth\n        g.arc(right - hMargin / 2, bottom - vMargin - radius / 2, radius, 0, 2 * Math.PI)\n        g.stroke()\n        doFill(p)\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            this.inputs.forEach(input => {\n                drawLabel(ctx, this.orient, input.name, \"w\", left, input)\n            })\n\n            if (isDefined(this._name)) {\n                const valueString = this.value.map(toLogicValueRepr).join(\"\")\n                drawComponentName(g, ctx, this._name, valueString, this, true)\n            }\n        })\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    private doSetColor(color: LedColor) {\n        this._color = color\n        this.setNeedsRedraw(\"color changed\")\n    }\n\n    private doSetTransparent(transparent: boolean) {\n        this._transparent = transparent\n        this.setNeedsRedraw(\"transparent changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        // TODO merge with OutputBar\n        const s = S.Components.OutputBar.contextMenu\n        const makeItemUseColor = (desc: string, color: LedColor) => {\n            const isCurrent = this._color === color\n            const icon = isCurrent ? \"check\" : \"none\"\n            const action = isCurrent ? () => undefined : () => this.doSetColor(color)\n            const cssColor = COLOR_LED_ON[color]\n            return ContextMenuData.item(icon, span(title(desc), style(`display: inline-block; width: 140px; height: 16px; background-color: ${cssColor}; margin-right: 8px`)), action)\n        }\n\n        const itemTransparent = ContextMenuData.item(\n            this._transparent ? \"check\" : \"none\",\n            s.TransparentWhenOff,\n            () => this.doSetTransparent(!this._transparent)\n        )\n\n        return [\n            [\"mid\", ContextMenuData.submenu(\"palette\", s.Color, [\n                makeItemUseColor(s.ColorGreen, \"green\"),\n                makeItemUseColor(s.ColorRed, \"red\"),\n                makeItemUseColor(s.ColorYellow, \"yellow\"), ContextMenuData.sep(),\n                itemTransparent,\n\n            ])],\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, COLOR_UNKNOWN, displayValuesFromArray, drawComponentName, drawWireLineToComponent, formatWithRadix, GRID_STEP } from \"../drawutils\"\nimport { b, div, emptyMod, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isDefined, isNotNull, isUnknown, Mode, typeOrUndefined } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext, Orientation } from \"./Drawable\"\n\nconst GRID_WIDTH = 4\nconst GRID_HEIGHT = 8\n\n\nexport const OutputAsciiDef =\n    defineComponent(7, 0, t.type({\n        type: t.literal(\"ascii\"),\n        name: ComponentNameRepr,\n        additionalReprRadix: typeOrUndefined(t.number),\n        showAsUnknown: typeOrUndefined(t.boolean),\n    }, \"OutputAscii\"))\n\ntype OutputAsciiRepr = typeof OutputAsciiDef.reprType\n\nexport class OutputAscii extends ComponentBase<7, 0, OutputAsciiRepr, [string, number | \"?\"]> {\n\n    private _name: ComponentName = undefined\n    private _additionalReprRadix: number | undefined = undefined\n    private _showAsUnknown = false\n\n    public constructor(editor: LogicEditor, savedData: OutputAsciiRepr | null) {\n        super(editor, [\"0000000\", 0], savedData, {\n            ins: [\n                [\"Z0\", -3, -3, \"w\", \"Z\"],\n                [\"Z1\", -3, -2, \"w\", \"Z\"],\n                [\"Z2\", -3, -1, \"w\", \"Z\"],\n                [\"Z3\", -3, 0, \"w\", \"Z\"],\n                [\"Z4\", -3, +1, \"w\", \"Z\"],\n                [\"Z5\", -3, +2, \"w\", \"Z\"],\n                [\"Z6\", -3, +3, \"w\", \"Z\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._name = savedData.name\n            this._additionalReprRadix = savedData.additionalReprRadix\n            this._showAsUnknown = savedData.showAsUnknown ?? false\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"ascii\" as const,\n            ...this.toJSONBase(),\n            name: this._name,\n            additionalReprRadix: this._additionalReprRadix,\n            showAsUnknown: (this._showAsUnknown) ? true : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    private get showAsUnknown() {\n        return this._showAsUnknown || this.editor.options.hideOutputColors\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.OutputAscii.tooltip\n        const [binaryStringRep, value] = this.value\n\n        return tooltipContent(s.title, mods(\n            div(s.desc[0], b(binaryStringRep), s.desc[1]),\n            this.showAsUnknown\n                ? emptyMod\n                : isUnknown(value)\n                    ? div(s.CurrentlyUndefined)\n                    : mods(s.CurrentlyThisCharacter + \" \", b(\"\" + value),\n                        (value < 32)\n                            ? s.WhichIsNotPrintable\n                            : mods(\", \u2018\", b(String.fromCharCode(value)), \"\u2019.\")\n                    )\n        ))\n    }\n\n    protected doRecalcValue() {\n        return displayValuesFromArray(this.inputs.map(i => i.value), false)\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n        const [binaryStringRep, value] = this.value\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, this.posX - width / 2 - 2, input.posYInParentTransform)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n\n            const isVertical = Orientation.isVertical(this.orient)\n            const hasAdditionalRepresentation = isDefined(this._additionalReprRadix)\n            let mainTextPosY = this.posY + (isVertical ? 4 : 0)\n\n            g.font = \"9px sans-serif\"\n            g.fillStyle = COLOR_COMPONENT_BORDER\n\n            if (!this.showAsUnknown) {\n                if (isVertical && hasAdditionalRepresentation) {\n                    // upper left corner\n                    g.textAlign = \"start\"\n                    g.fillText(binaryStringRep, this.posX - height / 2 + 3, this.posY - width / 2 + 8)\n                    g.textAlign = \"center\"\n                } else {\n                    // upper center\n                    g.textAlign = \"center\"\n                    g.fillText(binaryStringRep, this.posX, this.posY + (isVertical ? -width / 2 + 8 : -height / 2 + 10))\n                }\n\n                if (hasAdditionalRepresentation) {\n                    const additionalRepr = formatWithRadix(value, this._additionalReprRadix ?? 10, 7)\n                    g.font = \"bold 11px sans-serif\"\n                    if (isVertical) {\n                        // upper right\n                        g.textAlign = \"end\"\n                        g.fillText(additionalRepr, this.posX + height / 2 - 3, this.posY - width / 2 + 9)\n                        g.textAlign = \"center\"\n                    } else {\n                        // center, below bin repr\n                        g.fillText(additionalRepr, this.posX, this.posY - height / 2 + 22)\n                        mainTextPosY += 8 // shift main repr a bit\n                    }\n                }\n            }\n\n            let mainText: string\n            if (isUnknown(value) || this.showAsUnknown) {\n                g.font = \"bold 18px sans-serif\"\n                if (this.showAsUnknown) {\n                    g.fillStyle = COLOR_UNKNOWN\n                }\n                mainText = \"?\"\n            } else {\n                mainText = OutputAscii.numberToAscii(value)\n                if (value < 32) {\n                    // non-printable\n                    g.font = \"16px sans-serif\"\n                } else {\n                    g.font = \"bold 18px sans-serif\"\n                }\n            }\n            g.fillText(mainText, this.posX, mainTextPosY)\n\n\n            if (isDefined(this._name)) {\n                drawComponentName(g, ctx, this._name, mainText, this, true)\n            }\n        })\n    }\n\n    public static numberToAscii(n: number): string {\n        if (n < 32) {\n            // non-printable\n            return \"\\\\\" + n\n        }\n        return String.fromCharCode(n)\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseDoubleClicked(e)) {\n            return true // already handled\n        }\n        const mode = this.editor.mode\n        if (mode >= Mode.FULL && e.altKey) {\n            this.doSetShowAsUnknown(!this._showAsUnknown)\n            return true\n        } else if (mode >= Mode.DESIGN) {\n            this.doSetAdditionalDisplayRadix((() => {\n                switch (this._additionalReprRadix) {\n                    case undefined: return 10\n                    case 10: return 16\n                    case 16: return undefined\n                    default: return undefined\n                }\n            })())\n            return true\n        }\n        return false\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    private doSetShowAsUnknown(showAsUnknown: boolean) {\n        this._showAsUnknown = showAsUnknown\n        this.setNeedsRedraw(\"display as unknown changed\")\n    }\n\n    private doSetAdditionalDisplayRadix(additionalReprRadix: number | undefined) {\n        this._additionalReprRadix = additionalReprRadix\n        this.setNeedsRedraw(\"additional display radix changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        const s = S.Components.OutputAscii.contextMenu\n\n        const makeItemShowAs = (desc: string, handler: () => void, isCurrent: boolean,) => {\n            const icon = isCurrent ? \"check\" : \"none\"\n            return ContextMenuData.item(icon, desc, handler)\n        }\n\n        const makeItemShowRadix = (radix: number | undefined, desc: string) => {\n            return makeItemShowAs(desc,\n                () => this.doSetAdditionalDisplayRadix(radix),\n                this._additionalReprRadix === radix\n            )\n        }\n\n        return [\n            [\"mid\", ContextMenuData.submenu(\"eye\", s.AdditionalDisplay, [\n                makeItemShowRadix(undefined, s.DisplayNone),\n                makeItemShowRadix(10, s.DisplayDecimal),\n                makeItemShowRadix(16, s.DisplayHex),\n                ContextMenuData.sep(),\n                ContextMenuData.text(s.ChangeDisplayDesc),\n\n            ])],\n            [\"mid\", makeItemShowAs(S.Components.Generic.contextMenu.ShowAsUnknown, () => this.doSetShowAsUnknown(!this._showAsUnknown), this._showAsUnknown)],\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n\n}\n", "import * as t from \"io-ts\"\nimport { circle, colorForBoolean, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, dist, drawComponentName, drawRoundValueCentered, drawWireLineToComponent, GRID_STEP, INPUT_OUTPUT_DIAMETER, triangle } from \"../drawutils\"\nimport { emptyMod, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isDefined, isNotNull, isUndefined, isUnknown, LogicValue, Mode, toLogicValueRepr, Unknown } from \"../utils\"\nimport { Component, ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext, Orientation } from \"./Drawable\"\nimport { Node, NodeOut } from \"./Node\"\n\nexport const OutputBitDef =\n    defineComponent(1, 0, t.type({\n        name: ComponentNameRepr,\n    }, \"OutputBit\"))\n\ntype OutputBitRepr = typeof OutputBitDef.reprType\n\nexport class OutputBit extends ComponentBase<1, 0, OutputBitRepr, LogicValue> {\n\n    private _name: ComponentName = undefined\n\n    public constructor(editor: LogicEditor, savedData: OutputBitRepr | null) {\n        super(editor, false, savedData, { ins: [[undefined, -3, 0, \"w\"]] })\n        if (isNotNull(savedData)) {\n            this._name = savedData.name\n        }\n    }\n\n    public toJSON() {\n        return {\n            ...this.toJSONBase(),\n            name: this._name,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    protected override toStringDetails(): string {\n        return \"\" + this.value\n    }\n\n    public get unrotatedWidth() {\n        return INPUT_OUTPUT_DIAMETER\n    }\n\n    public get unrotatedHeight() {\n        return INPUT_OUTPUT_DIAMETER\n    }\n\n    public override isOver(x: number, y: number) {\n        return this.editor.mode >= Mode.CONNECT && dist(x, y, this.posX, this.posY) < INPUT_OUTPUT_DIAMETER / 2\n    }\n\n    public override makeTooltip() {\n        const s = S.Components.OutputBit.tooltip\n        return tooltipContent(undefined, mods(s.title, isUnknown(this.value) ? \" \" + s.WhoseValueIsUndefined : emptyMod))\n    }\n\n    protected doRecalcValue(): LogicValue {\n        return this.inputs[0].value\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const input = this.inputs[0]\n        drawWireLineToComponent(g, input, this.posX, this.posY)\n\n        if (ctx.isMouseOver) {\n            g.strokeStyle = COLOR_MOUSE_OVER\n            g.fillStyle = COLOR_MOUSE_OVER\n        } else {\n            g.strokeStyle = COLOR_COMPONENT_BORDER\n            g.fillStyle = COLOR_COMPONENT_BORDER\n        }\n        g.beginPath()\n        triangle(g,\n            this.posX - INPUT_OUTPUT_DIAMETER / 2 - 5, this.posY - 5,\n            this.posX - INPUT_OUTPUT_DIAMETER / 2 - 5, this.posY + 5,\n            this.posX - INPUT_OUTPUT_DIAMETER / 2 - 1, this.posY,\n        )\n        g.fill()\n        g.stroke()\n\n        const valueToShow = this.editor.options.hideOutputColors ? Unknown : this.value\n        g.fillStyle = colorForBoolean(valueToShow)\n        g.lineWidth = 4\n        g.beginPath()\n        circle(g, this.posX, this.posY, INPUT_OUTPUT_DIAMETER)\n        g.fill()\n        g.stroke()\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (isDefined(this._name)) {\n                drawComponentName(g, ctx, this._name, toLogicValueRepr(valueToShow), this, true)\n            }\n            drawRoundValueCentered(g, valueToShow, this)\n        })\n    }\n\n    protected override autoConnected(newLinks: [Node, Component, Node][]) {\n        if (newLinks.length !== 1) {\n            return\n        }\n\n        const [inNode, comp, outNode] = newLinks[0]\n        if (outNode instanceof NodeOut) {\n            if (isUndefined(this._name) && isDefined(outNode.name)) {\n                this.doSetName(outNode.name)\n            }\n        }\n\n        if (outNode.orient !== \"w\") {\n            return\n        }\n        switch (Orientation.add(comp.orient, inNode.orient)) {\n            case \"e\":\n                // nothing to do\n                return\n            case \"w\":\n                this.doSetOrient(\"w\")\n                this.setPosition(this.posX - GRID_STEP * 6, this.posY)\n                return\n            case \"s\":\n                this.doSetOrient(\"s\")\n                this.setPosition(this.posX - GRID_STEP * 3, this.posY + GRID_STEP * 3)\n                return\n            case \"n\":\n                this.doSetOrient(\"n\")\n                this.setPosition(this.posX - GRID_STEP * 3, this.posY - GRID_STEP * 3)\n                return\n        }\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n        return [\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { colorForBoolean, COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, drawComponentName, drawRoundValue, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedArrayFill, isDefined, isNotNull, LogicValue, Mode, toLogicValueRepr, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\nconst GRID_WIDTH = 2\nconst GRID_UPPER_HEIGHT = 4.5\nconst GRID_LOWER_HEIGHT = 3.5\n\nexport const OutputByteDef =\n    defineComponent(8, 0, t.type({\n        type: t.literal(\"byte\"),\n        name: ComponentNameRepr,\n    }, \"OutputByte\"))\n\ntype OutputByteRepr = typeof OutputByteDef.reprType\n\nexport class OutputByte extends ComponentBase<8, 0, OutputByteRepr, FixedArray<LogicValue, 8>> {\n\n    private _name: ComponentName = undefined\n\n    public constructor(editor: LogicEditor, savedData: OutputByteRepr | null) {\n        super(editor, FixedArrayFill(false, 8), savedData, {\n            ins: [\n                [undefined, -2, -4, \"w\", \"In\"],\n                [undefined, -2, -3, \"w\", \"In\"],\n                [undefined, -2, -2, \"w\", \"In\"],\n                [undefined, -2, -1, \"w\", \"In\"],\n                [undefined, -2, 0, \"w\", \"In\"],\n                [undefined, -2, 1, \"w\", \"In\"],\n                [undefined, -2, 2, \"w\", \"In\"],\n                [undefined, -2, 3, \"w\", \"In\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._name = savedData.name\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"byte\" as const,\n            ...this.toJSONBase(),\n            name: this._name,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return (GRID_UPPER_HEIGHT + GRID_UPPER_HEIGHT) * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(S.Components.OutputByte.tooltip))\n    }\n\n    protected doRecalcValue(): FixedArray<LogicValue, 8> {\n        // this never changes on its own, just upon user interaction\n        return this.inputValues<8>([0, 1, 2, 3, 4, 5, 6, 7])\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        g.fillStyle = COLOR_BACKGROUND\n        const drawMouseOver = ctx.isMouseOver && this.editor.mode !== Mode.STATIC\n        g.strokeStyle = drawMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const width = GRID_WIDTH * GRID_STEP\n        const left = this.posX - width / 2\n        const top = this.posY - GRID_UPPER_HEIGHT * GRID_STEP\n        const bottom = this.posY + GRID_LOWER_HEIGHT * GRID_STEP\n        const height = bottom - top\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n\n        const displayValues = this.editor.options.hideOutputColors ? FixedArrayFill(Unknown, 8) : this.value\n\n        g.lineWidth = 1\n        const cellHeight = GRID_STEP\n        for (let i = 0; i < 8; i++) {\n            const y = top + i * cellHeight\n            g.fillStyle = colorForBoolean(displayValues[i])\n            g.beginPath()\n            g.rect(left, y, width, cellHeight)\n            g.fill()\n            g.stroke()\n        }\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, left - 2, input.posYInParentTransform, true)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (isDefined(this._name)) {\n                const valueString = displayValues.map(toLogicValueRepr).join(\"\")\n                drawComponentName(g, ctx, this._name, valueString, this, true)\n            }\n\n            for (let i = 0; i < 8; i++) {\n                const y = top + cellHeight / 2 + i * cellHeight\n                drawRoundValue(g, displayValues[i], ...ctx.rotatePoint(this.posX, y), { small: true })\n            }\n        })\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        return [\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { colorComps, colorForFraction, ColorString, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, COLOR_UNKNOWN, displayValuesFromArray, drawComponentName, drawWireLineToComponent, formatWithRadix, GRID_STEP } from \"../drawutils\"\nimport { b, div, emptyMod, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isDefined, isNotNull, isUnknown, Mode, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext, Orientation } from \"./Drawable\"\n\nconst GRID_WIDTH = 6\nconst GRID_UPPER_HEIGHT = 4.5\nconst GRID_LOWER_HEIGHT = 3.5\nconst DEFAULT_RADIX = 10\n\nexport const OutputByteDisplayDef =\n    defineComponent(8, 0, t.type({\n        type: t.literal(\"byte-display\"),\n        name: ComponentNameRepr,\n        radix: typeOrUndefined(t.number),\n        showAsUnknown: typeOrUndefined(t.boolean),\n    }, \"OutputByteDisplay\"))\n\ntype OutputByteDisplayRepr = typeof OutputByteDisplayDef.reprType\n\n// TODO this should be an easy merge with OutputNibbleDisplay\nexport class OutputByteDisplay extends ComponentBase<8, 0, OutputByteDisplayRepr, [string, number | Unknown]> {\n\n    private _name: ComponentName = undefined\n    private _radix = DEFAULT_RADIX\n    private _showAsUnknown = false\n\n    public constructor(editor: LogicEditor, savedData: OutputByteDisplayRepr | null) {\n        super(editor, [\"0000000\", 0], savedData, {\n            ins: [\n                [\"I0\", -4, -4, \"w\", \"In\"],\n                [\"I1\", -4, -3, \"w\", \"In\"],\n                [\"I2\", -4, -2, \"w\", \"In\"],\n                [\"I3\", -4, -1, \"w\", \"In\"],\n                [\"I4\", -4, 0, \"w\", \"In\"],\n                [\"I5\", -4, 1, \"w\", \"In\"],\n                [\"I6\", -4, 2, \"w\", \"In\"],\n                [\"I7\", -4, 3, \"w\", \"In\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._name = savedData.name\n            this._radix = savedData.radix ?? DEFAULT_RADIX\n            this._showAsUnknown = savedData.showAsUnknown ?? false\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"byte-display\" as const,\n            ...this.toJSONBase(),\n            name: this._name,\n            radix: this._radix === DEFAULT_RADIX ? undefined : this._radix,\n            showAsUnknown: (this._showAsUnknown) ? true : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return (GRID_UPPER_HEIGHT + GRID_UPPER_HEIGHT) * GRID_STEP\n    }\n\n    private get showAsUnknown() {\n        return this._showAsUnknown || this.editor.options.hideOutputColors\n    }\n\n    public override makeTooltip() {\n        const ss = S.Components.OutputDisplayShared.tooltip\n        const s = S.Components.OutputByteDisplay.tooltip\n        const radixStr = (() => {\n            switch (this._radix) {\n                case 2: return ss.RadixBinary\n                case 10: return ss.RadixDecimal\n                case -10: return ss.RadixSignedDecimal\n                case 16: return ss.RadixHexadecimal\n                default: return ss.RadixGeneric.expand({ radix: this._radix })\n            }\n        })()\n        const [binaryStringRep, value] = this.value\n\n        return tooltipContent(s.title, mods(\n            div(s.desc[0].expand({ radixStr }) + \" \", b(binaryStringRep), s.desc[1]),\n            !isUnknown(value) || this.showAsUnknown\n                ? emptyMod\n                : div(ss.CurrentlyUndefined)\n        ))\n    }\n\n    protected doRecalcValue() {\n        return displayValuesFromArray(this.inputs.map(i => i.value), false)\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const [binaryStringRep, value] = this.value\n\n        const maxValue = (1 << this.inputs.length) - 1\n        const backColor = isUnknown(value) || this.showAsUnknown ? COLOR_UNKNOWN : colorForFraction(value / maxValue)\n        g.fillStyle = backColor\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const width = GRID_WIDTH * GRID_STEP\n        const top = this.posY - GRID_UPPER_HEIGHT * GRID_STEP\n        const bottom = this.posY + GRID_LOWER_HEIGHT * GRID_STEP\n        const height = bottom - top\n        g.beginPath()\n        g.rect(this.posX - width / 2, top, width, height)\n        g.fill()\n        g.stroke()\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, this.posX - width / 2 - 2, input.posYInParentTransform)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (isDefined(this._name)) {\n                drawComponentName(g, ctx, this._name, value, this, true)\n            }\n\n            const isVertical = Orientation.isVertical(this.orient)\n\n            const backColorComps = colorComps(backColor)\n            const textColor = ColorString(backColorComps[0] + backColorComps[1] + backColorComps[2] > 3 * 127 ? 0 : 0xFF)\n            g.fillStyle = textColor\n\n            g.textAlign = \"center\"\n\n            if (!this.showAsUnknown) {\n                g.font = \"10px sans-serif\"\n                g.fillText(binaryStringRep, this.posX, this.posY + (isVertical ? -width / 2 + 7 : -height / 2 + 8))\n            }\n\n            g.font = \"bold 18px sans-serif\"\n\n            let stringRep: string\n            if (this.showAsUnknown) {\n                stringRep = \"?\"\n                // if (!isUnset(value)) {\n                //     // otherwise we get the same color for background and text\n                //     g.fillStyle = COLOR_UNSET\n                // }\n            } else {\n                stringRep = formatWithRadix(value, this._radix, 8)\n            }\n            g.fillText(stringRep, this.posX, this.posY + (isVertical ? 6 : 0))\n        })\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseDoubleClicked(e)) {\n            return true // already handled\n        }\n        const mode = this.editor.mode\n        if (mode >= Mode.FULL && e.altKey) {\n            this.doSetShowAsUnknown(!this._showAsUnknown)\n            return true\n        } else if (mode >= Mode.DESIGN) {\n            this.doSetRadix(this._radix === 10 ? 16 : 10)\n            return true\n        }\n        return false\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    private doSetShowAsUnknown(showAsUnknown: boolean) {\n        this._showAsUnknown = showAsUnknown\n        this.setNeedsRedraw(\"display as unknown changed\")\n    }\n\n    private doSetRadix(radix: number) {\n        this._radix = radix\n        this.setNeedsRedraw(\"radix changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        const s = S.Components.OutputDisplayShared.contextMenu\n        const makeItemShowAs = (desc: string, handler: () => void, isCurrent: boolean,) => {\n            const icon = isCurrent ? \"check\" : \"none\"\n            const caption = s.DisplayAs + \" \" + desc\n            const action = isCurrent ? () => undefined : handler\n            return ContextMenuData.item(icon, caption, action)\n        }\n\n        const makeItemShowRadix = (radix: number, desc: string) => {\n            return makeItemShowAs(desc, () => {\n                if (this._showAsUnknown) {\n                    this.doSetShowAsUnknown(false)\n                }\n                this.doSetRadix(radix)\n            }, !this._showAsUnknown && this._radix === radix)\n        }\n\n        return [\n            [\"mid\", makeItemShowRadix(10, s.DisplayAsDecimal)],\n            [\"mid\", makeItemShowRadix(-10, s.DisplayAsSignedDecimal)],\n            [\"mid\", makeItemShowRadix(16, s.DisplayAsHexadecimal)],\n            [\"mid\", makeItemShowAs(s.DisplayAsUnknown, () => this.doSetShowAsUnknown(!this._showAsUnknown), this._showAsUnknown)],\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { colorForBoolean, COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, drawComponentName, drawRoundValue, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { FixedArray, FixedArrayFill, isDefined, isNotNull, LogicValue, Mode, toLogicValueRepr, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\n\nconst GRID_WIDTH = 2\nconst GRID_HEIGHT = 8\n\nexport const OutputNibbleDef =\n    defineComponent(4, 0, t.type({\n        type: t.literal(\"nibble\"),\n        name: ComponentNameRepr,\n    }, \"OutputNibble\"))\n\ntype OutputNibbleRepr = typeof OutputNibbleDef.reprType\n\nexport class OutputNibble extends ComponentBase<4, 0, OutputNibbleRepr, FixedArray<LogicValue, 4>> {\n\n    private _name: ComponentName = undefined\n\n    public constructor(editor: LogicEditor, savedData: OutputNibbleRepr | null) {\n        super(editor, FixedArrayFill(false, 4), savedData, {\n            ins: [\n                [undefined, -2, -3, \"w\", \"In\"],\n                [undefined, -2, -1, \"w\", \"In\"],\n                [undefined, -2, +1, \"w\", \"In\"],\n                [undefined, -2, +3, \"w\", \"In\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._name = savedData.name\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"nibble\" as const,\n            ...this.toJSONBase(),\n            name: this._name,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(undefined, mods(S.Components.OutputNibble.tooltip))\n    }\n    \n    protected doRecalcValue(): FixedArray<LogicValue, 4> {\n        // this never changes on its own, just upon user interaction\n        return this.inputValues<4>([0, 1, 2, 3])\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        g.fillStyle = COLOR_BACKGROUND\n        const drawMouseOver = ctx.isMouseOver && this.editor.mode !== Mode.STATIC\n        g.strokeStyle = drawMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        const left = this.posX - width / 2\n        // const right = left + width\n        const top = this.posY - height / 2\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n\n        const displayValues = this.editor.options.hideOutputColors ? FixedArrayFill(Unknown, 4) : this.value\n\n        g.lineWidth = 1\n        const cellHeight = height / 4\n        for (let i = 0; i < 4; i++) {\n            const y = top + i * cellHeight\n            g.fillStyle = colorForBoolean(displayValues[i])\n            g.beginPath()\n            g.rect(left, y, width, cellHeight)\n            g.fill()\n            g.stroke()\n        }\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, left - 2, input.posYInParentTransform, true)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (isDefined(this._name)) {\n                const valueString = displayValues.map(toLogicValueRepr).join(\"\")\n                drawComponentName(g, ctx, this._name, valueString, this, true)\n            }\n\n            for (let i = 0; i < 4; i++) {\n                const y = top + cellHeight / 2 + i * cellHeight\n                drawRoundValue(g, displayValues[i], ...ctx.rotatePoint(this.posX, y))\n            }\n        })\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        return [\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { colorComps, colorForFraction, ColorString, COLOR_COMPONENT_BORDER, COLOR_MOUSE_OVER, COLOR_UNKNOWN, displayValuesFromArray, drawComponentName, drawWireLineToComponent, formatWithRadix, GRID_STEP } from \"../drawutils\"\nimport { b, div, emptyMod, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isDefined, isNotNull, isUnknown, Mode, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, ComponentName, ComponentNameRepr, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext, Orientation } from \"./Drawable\"\n\nconst GRID_WIDTH = 4\nconst GRID_HEIGHT = 8\nconst DEFAULT_RADIX = 10\n\nexport const OutputNibbleDisplayDef =\n    defineComponent(4, 0, t.type({\n        type: t.literal(\"nibble-display\"),\n        name: ComponentNameRepr,\n        radix: typeOrUndefined(t.number),\n        showAsUnknown: typeOrUndefined(t.boolean),\n    }, \"OutputNibbleDisplay\"))\n\ntype OutputNibbleDisplayRepr = typeof OutputNibbleDisplayDef.reprType\n\nexport class OutputNibbleDisplay extends ComponentBase<4, 0, OutputNibbleDisplayRepr, [string, number | Unknown]> {\n\n    private _name: ComponentName = undefined\n    private _radix = DEFAULT_RADIX\n    private _showAsUnknown = false\n\n    public constructor(editor: LogicEditor, savedData: OutputNibbleDisplayRepr | null) {\n        super(editor, [\"0000\", 0], savedData, {\n            ins: [\n                [\"I0\", -3, -3, \"w\", \"I\"],\n                [\"I1\", -3, -1, \"w\", \"I\"],\n                [\"I2\", -3, +1, \"w\", \"I\"],\n                [\"I3\", -3, +3, \"w\", \"I\"],\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._name = savedData.name\n            this._radix = savedData.radix ?? DEFAULT_RADIX\n            this._showAsUnknown = savedData.showAsUnknown ?? false\n        }\n    }\n\n    public toJSON() {\n        return {\n            type: \"nibble-display\" as const,\n            ...this.toJSONBase(),\n            name: this._name,\n            radix: this._radix === DEFAULT_RADIX ? undefined : this._radix,\n            showAsUnknown: (this._showAsUnknown) ? true : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    private get showAsUnknown() {\n        return this._showAsUnknown || this.editor.options.hideOutputColors\n    }\n\n    public override makeTooltip() {\n        const ss = S.Components.OutputDisplayShared.tooltip\n        const s = S.Components.OutputNibbleDisplay.tooltip\n        const radixStr = (() => {\n            switch (this._radix) {\n                case 2: return ss.RadixBinary\n                case 10: return ss.RadixDecimal\n                case -10: return ss.RadixSignedDecimal\n                case 16: return ss.RadixHexadecimal\n                default: return ss.RadixGeneric.expand({ radix: this._radix })\n            }\n        })()\n        const [binaryStringRep, value] = this.value\n\n        return tooltipContent(s.title, mods(\n            div(s.desc[0].expand({ radixStr }) + \" \", b(binaryStringRep), s.desc[1]),\n            !isUnknown(value) || this.showAsUnknown\n                ? emptyMod\n                : div(ss.CurrentlyUndefined)\n        ))\n    }\n\n\n    protected doRecalcValue() {\n        return displayValuesFromArray(this.inputs.map(i => i.value), false)\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const [binaryStringRep, value] = this.value\n\n        const maxValue = (1 << this.inputs.length) - 1\n        const backColor = isUnknown(value) || this.showAsUnknown ? COLOR_UNKNOWN : colorForFraction(value / maxValue)\n        g.fillStyle = backColor\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 4\n\n        const width = GRID_WIDTH * GRID_STEP\n        const height = GRID_HEIGHT * GRID_STEP\n        g.beginPath()\n        g.rect(this.posX - width / 2, this.posY - height / 2, width, height)\n        g.fill()\n        g.stroke()\n\n        for (const input of this.inputs) {\n            drawWireLineToComponent(g, input, this.posX - width / 2 - 2, input.posYInParentTransform)\n        }\n\n        ctx.inNonTransformedFrame(ctx => {\n            if (isDefined(this._name)) {\n                drawComponentName(g, ctx, this._name, value, this, true)\n            }\n\n            const isVertical = Orientation.isVertical(this.orient)\n\n            const backColorComps = colorComps(backColor)\n            const textColor = ColorString(backColorComps[0] + backColorComps[1] + backColorComps[2] > 3 * 127 ? 0 : 0xFF)\n            g.fillStyle = textColor\n\n            g.textAlign = \"center\"\n\n            if (!this.showAsUnknown) {\n                g.font = \"10px sans-serif\"\n                g.fillText(binaryStringRep, this.posX, this.posY + (isVertical ? -width / 2 + 7 : -height / 2 + 8))\n            }\n\n            g.font = \"bold 18px sans-serif\"\n\n            let stringRep: string\n            if (this.showAsUnknown) {\n                stringRep = \"?\"\n                // if (!isUnset(value)) {\n                //     // otherwise we get the same color for background and text\n                //     g.fillStyle = COLOR_UNSET\n                // }\n            } else {\n                stringRep = formatWithRadix(value, this._radix, 4)\n            }\n            g.fillText(stringRep, this.posX, this.posY + (isVertical ? 6 : 0))\n        })\n    }\n\n    public override mouseDoubleClicked(e: MouseEvent | TouchEvent) {\n        if (super.mouseDoubleClicked(e)) {\n            return true // already handled\n        }\n        const mode = this.editor.mode\n        if (mode >= Mode.FULL && e.altKey) {\n            this.doSetShowAsUnknown(!this._showAsUnknown)\n            return true\n        } else if (mode >= Mode.DESIGN) {\n            this.doSetRadix(this._radix === 10 ? 16 : 10)\n            return true\n        }\n        return false\n    }\n\n    private doSetName(name: ComponentName) {\n        this._name = name\n        this.setNeedsRedraw(\"name changed\")\n    }\n\n    private doSetShowAsUnknown(showAsUnknown: boolean) {\n        this._showAsUnknown = showAsUnknown\n        this.setNeedsRedraw(\"display as unknown changed\")\n    }\n\n    private doSetRadix(radix: number) {\n        this._radix = radix\n        this.setNeedsRedraw(\"radix changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        const s = S.Components.OutputDisplayShared.contextMenu\n        const makeItemShowAs = (desc: string, handler: () => void, isCurrent: boolean,) => {\n            const icon = isCurrent ? \"check\" : \"none\"\n            const caption = s.DisplayAs + \" \" + desc\n            const action = isCurrent ? () => undefined : handler\n            return ContextMenuData.item(icon, caption, action)\n        }\n\n        const makeItemShowRadix = (radix: number, desc: string) => {\n            return makeItemShowAs(desc, () => {\n                if (this._showAsUnknown) {\n                    this.doSetShowAsUnknown(false)\n                }\n                this.doSetRadix(radix)\n            }, !this._showAsUnknown && this._radix === radix)\n        }\n\n        return [\n            [\"mid\", makeItemShowRadix(10, s.DisplayAsDecimal)],\n            [\"mid\", makeItemShowRadix(-10, s.DisplayAsSignedDecimal)],\n            [\"mid\", makeItemShowRadix(16, s.DisplayAsHexadecimal)],\n            [\"mid\", makeItemShowAs(s.DisplayAsUnknown, () => this.doSetShowAsUnknown(!this._showAsUnknown), this._showAsUnknown)],\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", this.makeSetNameContextMenuItem(this._name, this.doSetName.bind(this))],\n        ]\n    }\n\n\n    public override keyDown(e: KeyboardEvent): void {\n        if (e.key === \"Enter\") {\n            this.runSetNameDialog(this._name, this.doSetName.bind(this))\n        }\n    }\n\n}\n", "import * as t from \"io-ts\"\nimport { COLOR_BACKGROUND, COLOR_COMPONENT_BORDER, COLOR_COMPONENT_INNER_LABELS, COLOR_MOUSE_OVER, displayValuesFromArray, drawLabel, drawWireLineToComponent, GRID_STEP } from \"../drawutils\"\nimport { div, mods, tooltipContent } from \"../htmlgen\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { S } from \"../strings\"\nimport { isNotNull, isNull, isUndefined, isUnknown, LogicValue, repeatString, RichStringEnum, toLogicValueRepr, typeOrUndefined, Unknown } from \"../utils\"\nimport { ComponentBase, defineComponent } from \"./Component\"\nimport { ContextMenuData, ContextMenuItem, ContextMenuItemPlacement, DrawContext } from \"./Drawable\"\nimport { EdgeTrigger, Flipflop, makeTriggerItems } from \"./FlipflopOrLatch\"\nimport { OutputAscii } from \"./OutputAscii\"\n\nconst GRID_WIDTH = 25\nconst GRID_HEIGHT = 5\n\nconst enum INPUT {\n    Clock,\n    Clear,\n    Data,\n}\n\n\nexport const ShiftBufferDecoders_ = {\n    \"raw\": { decodeWidth: 1, maxDisplayWidth: 16, decode: (v: number) => v.toString() },\n    \"octal\": { decodeWidth: 3, maxDisplayWidth: 16, decode: (v: number) => v.toString() },\n    \"hex\": { decodeWidth: 4, maxDisplayWidth: 16, decode: (v: number) => v.toString(16).toUpperCase() },\n    \"ascii\": { decodeWidth: 7, maxDisplayWidth: 12, decode: (v: number) => OutputAscii.numberToAscii(v) },\n    \"ascii8\": { decodeWidth: 8, maxDisplayWidth: 12, decode: (v: number) => OutputAscii.numberToAscii(v & 0x7F) },\n    \"uint4\": { decodeWidth: 4, maxDisplayWidth: 8, decode: (v: number) => v.toString() },\n    \"int4\": { decodeWidth: 4, maxDisplayWidth: 8, decode: (v: number) => (v > 7 ? v - 16 : v).toString() },\n    \"uint8\": { decodeWidth: 8, maxDisplayWidth: 4, decode: (v: number) => v.toString() },\n    \"int8\": { decodeWidth: 8, maxDisplayWidth: 4, decode: (v: number) => (v > 127 ? v - 256 : v).toString() },\n    \"uint16\": { decodeWidth: 16, maxDisplayWidth: 1, decode: (v: number) => v.toString() },\n    \"int16\": { decodeWidth: 16, maxDisplayWidth: 1, decode: (v: number) => (v > 32767 ? v - 65536 : v).toString() },\n} as const\n\ntype ShiftBufferDecoderProps = {\n    decodeWidth: number,\n    maxDisplayWidth: number,\n    decode: (n: number) => string,\n}\n\nexport const ShiftBufferDecoders =\n    RichStringEnum.withProps<ShiftBufferDecoderProps>()(ShiftBufferDecoders_)\n\nexport type ShiftBufferDecoder = keyof typeof ShiftBufferDecoders_\n\nexport const OutputShiftBufferDef =\n    defineComponent(3, 0, t.type({\n        type: t.literal(\"shiftbuffer\"),\n        state: typeOrUndefined(t.string),\n        decodeAs: typeOrUndefined(t.keyof(ShiftBufferDecoders_)),\n        groupEvery: typeOrUndefined(t.number),\n        maxItems: typeOrUndefined(t.number),\n        trigger: typeOrUndefined(t.keyof(EdgeTrigger)),\n    }, \"OutputShiftBuffer\"))\n\nexport type OutputShiftBufferRepr = typeof OutputShiftBufferDef.reprType\n\nconst OutputShiftBufferDefaults = {\n    decodeAs: \"raw\" as ShiftBufferDecoder,\n    trigger: EdgeTrigger.rising,\n}\n\ntype OutputShiftBufferState = {\n    incoming: LogicValue[]\n    decoded: [string, LogicValue[]][]\n}\n\nexport class OutputShiftBuffer extends ComponentBase<3, 0, OutputShiftBufferRepr, OutputShiftBufferState> {\n\n    protected _decodeAs: ShiftBufferDecoder = OutputShiftBufferDefaults.decodeAs\n    protected _groupEvery: number | undefined = undefined\n    protected _maxItems: number | undefined = undefined\n    protected _trigger: EdgeTrigger = OutputShiftBufferDefaults.trigger\n    protected _lastClock: LogicValue = Unknown\n\n    private static savedStateFrom(savedData: { state: string | undefined } | null): OutputShiftBufferState {\n        if (isNull(savedData) || isUndefined(savedData.state)) {\n            return { incoming: [], decoded: [] }\n        }\n        const incoming: LogicValue[] = []\n        for (let i = 0; i < savedData.state.length; i++) {\n            const c = savedData.state.charAt(i)\n            if (c === '1') {\n                incoming.push(true)\n            } else if (c === '0') {\n                incoming.push(false)\n            } else {\n                incoming.push(Unknown)\n            }\n        }\n        return { incoming, decoded: [] }\n    }\n\n    public constructor(editor: LogicEditor, savedData: OutputShiftBufferRepr | null) {\n        super(editor, OutputShiftBuffer.savedStateFrom(savedData), savedData, {\n            ins: [\n                [S.Components.Generic.InputClockDesc, -14, +1, \"w\"], // Clock\n                [S.Components.Generic.InputClearDesc, -10, +3, \"s\"], // Clear\n                [S.Components.Generic.InputDataDesc, -14, -1, \"w\"], // Data in\n            ],\n        })\n        if (isNotNull(savedData)) {\n            this._decodeAs = savedData.decodeAs ?? OutputShiftBufferDefaults.decodeAs\n            this._maxItems = savedData.maxItems\n            this._trigger = savedData.trigger ?? OutputShiftBufferDefaults.trigger\n        }\n        this.setInputsPreferSpike(INPUT.Clock, INPUT.Clear)\n        this.redecodeAll()\n    }\n\n    public toJSON() {\n        const stateArray = allBitsOf(this.value).map(b => toLogicValueRepr(b))\n        return {\n            type: \"shiftbuffer\" as const,\n            ...this.toJSONBase(),\n            state: stateArray.length === 0 ? undefined : stateArray.join(\"\"),\n            decodeAs: (this._decodeAs !== OutputShiftBufferDefaults.decodeAs) ? this._decodeAs : undefined,\n            groupEvery: this._groupEvery,\n            maxItems: this._maxItems,\n            trigger: (this._trigger !== OutputShiftBufferDefaults.trigger) ? this._trigger : undefined,\n        }\n    }\n\n    public get componentType() {\n        return \"out\" as const\n    }\n\n    public get unrotatedWidth() {\n        return GRID_WIDTH * GRID_STEP\n    }\n\n    public get unrotatedHeight() {\n        return GRID_HEIGHT * GRID_STEP\n    }\n\n    public get trigger() {\n        return this._trigger\n    }\n\n    public override makeTooltip() {\n        return tooltipContent(S.Components.OutputShiftBuffer.tooltip, mods(\n            div(JSON.stringify(this.value)) // TODO more info\n        ))\n    }\n\n    protected doRecalcValue(): OutputShiftBufferState {\n        if (this.inputs[INPUT.Clear].value === true) {\n            return { incoming: [], decoded: [] }\n        }\n        const prevClock = this._lastClock\n        const clock = this._lastClock = this.inputs[INPUT.Clock].value\n        const oldValue = this.value\n\n        if (Flipflop.isClockTrigger(this._trigger, prevClock, clock)) {\n            const newBit = this.inputs[INPUT.Data].value\n            const decoder = ShiftBufferDecoders.propsOf(this._decodeAs)\n            const maxItems = this._maxItems ?? decoder.maxDisplayWidth\n            return OutputShiftBuffer.valueByAddingNewBit(newBit, oldValue, decoder, maxItems)\n        }\n        return oldValue\n    }\n\n    private static valueByAddingNewBit(newBit: LogicValue, oldValue: OutputShiftBufferState, decoder: ShiftBufferDecoderProps, maxItems: number): OutputShiftBufferState {\n        const newIncoming = [newBit, ...oldValue.incoming]\n        if (newIncoming.length < decoder.decodeWidth) {\n            return { incoming: newIncoming, decoded: oldValue.decoded }\n        }\n        const valAsInt = displayValuesFromArray(newIncoming, true)[1]\n        const decoded = isUnknown(valAsInt) ? Unknown : decoder.decode(valAsInt)\n        const newDecoded: OutputShiftBufferState[\"decoded\"] = [[decoded, newIncoming], ...oldValue.decoded]\n        if (newDecoded.length > maxItems) {\n            newDecoded.splice(maxItems, newDecoded.length - maxItems)\n        }\n        return { incoming: [], decoded: newDecoded }\n    }\n\n\n    protected doSetTrigger(trigger: EdgeTrigger) {\n        this._trigger = trigger\n        this.setNeedsRedraw(\"trigger changed\")\n    }\n\n    protected doDraw(g: CanvasRenderingContext2D, ctx: DrawContext) {\n\n        const width = this.unrotatedWidth\n        const height = this.unrotatedHeight\n        const left = this.posX - width / 2\n        const top = this.posY - height / 2\n        const bottom = this.posY + height / 2\n\n        g.fillStyle = COLOR_BACKGROUND\n        g.strokeStyle = ctx.isMouseOver ? COLOR_MOUSE_OVER : COLOR_COMPONENT_BORDER\n        g.lineWidth = 3\n\n        g.beginPath()\n        g.rect(left, top, width, height)\n        g.fill()\n        g.stroke()\n        g.fillStyle = COLOR_BACKGROUND\n\n        Flipflop.drawClockInput(g, left, this.inputs[INPUT.Clock], this._trigger)\n        drawWireLineToComponent(g, this.inputs[INPUT.Clear], this.inputs[INPUT.Clear].posXInParentTransform, bottom + 2, false)\n        drawWireLineToComponent(g, this.inputs[INPUT.Data], left - 2, this.inputs[INPUT.Data].posYInParentTransform, false)\n\n        ctx.inNonTransformedFrame(ctx => {\n            g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n            g.font = \"12px sans-serif\"\n\n            drawLabel(ctx, this.orient, \"Clr\", \"s\", this.inputs[INPUT.Clear], bottom)\n            drawLabel(ctx, this.orient, \"D\", \"w\", left, this.inputs[INPUT.Data])\n        })\n\n        const drawContents = () => {\n            const text = this.makeRepresentationString()\n            let toDraw\n            if (isUndefined(text)) {\n                g.fillStyle = COLOR_COMPONENT_INNER_LABELS\n                g.font = \"15px sans-serif\"\n                toDraw = S.Components.OutputShiftBuffer.EmptyCaption\n            } else {\n                g.fillStyle = COLOR_COMPONENT_BORDER\n                g.font = \"bold 16px sans-serif\"\n                toDraw = text\n            }\n            g.fillText(toDraw, this.posX, this.posY)\n        }\n\n        g.textAlign = \"center\"\n        g.textBaseline = \"middle\"\n        if (this.orient === \"w\") {\n            ctx.inNonTransformedFrame(drawContents)\n        } else {\n            drawContents()\n        }\n    }\n\n    private makeRepresentationString() {\n        const { incoming, decoded } = this.value\n        if (incoming.length === 0 && decoded.length === 0) {\n            return undefined\n        }\n\n        const decodeAs = this._decodeAs\n        const decoder = ShiftBufferDecoders.propsOf(decodeAs)\n        const toPad = decoder.decodeWidth - incoming.length\n        const padding = repeatString(\"_\u202F\", toPad)\n        const undecodedStr = padding + displayValuesFromArray(incoming, true)[0]\n\n        const sep = decodeAs.includes(\"int\") ? \" \" : \"\"\n\n        let fullDecodedStr\n        if (decoded.length === 0) {\n            fullDecodedStr = \"\u2026\"\n        } else {\n            const groupEvery = this._groupEvery ?? 0\n            if (groupEvery < 2) {\n                fullDecodedStr = decoded.map(v => v[0]).join(sep)\n            } else {\n                const offset = groupEvery - (decoded.length % groupEvery)\n                const decodedParts: string[] = []\n                for (let i = 0; i < decoded.length; i++) {\n                    if (i !== 0) {\n                        if ((i + offset) % groupEvery === 0) {\n                            decodedParts.push(sep + \" \")\n                        } else {\n                            decodedParts.push(sep)\n                        }\n                    }\n                    decodedParts.push(decoded[i][0])\n                }\n                fullDecodedStr = decodedParts.join(\"\")\n            }\n            if (decodeAs === \"hex\") {\n                fullDecodedStr = \"0x\" + (groupEvery < 2 ? \"\" : \" \") + fullDecodedStr\n            } else if (decodeAs === \"octal\") {\n                fullDecodedStr = \"0o\" + (groupEvery < 2 ? \"\" : \" \") + fullDecodedStr\n            }\n        }\n\n        if (decodeAs === \"raw\") {\n            return fullDecodedStr\n        }\n        return undecodedStr + \" \u279F \" + fullDecodedStr\n    }\n\n    private redecodeAll() {\n        const decoder = ShiftBufferDecoders.propsOf(this._decodeAs)\n        const allBits = allBitsOf(this.value)\n        const maxItems = this._maxItems ?? decoder.maxDisplayWidth\n        let value: OutputShiftBufferState = { incoming: [], decoded: [] }\n        for (const newBit of allBits.reverse()) {\n            value = OutputShiftBuffer.valueByAddingNewBit(newBit, value, decoder, maxItems)\n        }\n        this.doSetValue(value)\n    }\n\n    private doSetDecodeAs(decodeAs: ShiftBufferDecoder) {\n        this._decodeAs = decodeAs\n        this.redecodeAll() // will call setNeedsRedraw\n    }\n\n    private doSetGroupEvery(groupEvery: number | undefined) {\n        this._groupEvery = groupEvery\n        this.setNeedsRedraw(\"grouping changed\")\n    }\n\n    protected override makeComponentSpecificContextMenuItems(): undefined | [ContextMenuItemPlacement, ContextMenuItem][] {\n\n        const s = S.Components.OutputShiftBuffer.contextMenu\n        const makeItemDecodeAs = (decoder: ShiftBufferDecoder, desc: string) => {\n            const isCurrent = this._decodeAs === decoder\n            const icon = isCurrent ? \"check\" : \"none\"\n            return ContextMenuData.item(icon, desc, () => this.doSetDecodeAs(decoder))\n        }\n\n        const makeItemGroupEvery = (groupEvery: number | undefined, desc: string) => {\n            const isCurrent = this._groupEvery === groupEvery\n            const icon = isCurrent ? \"check\" : \"none\"\n            return ContextMenuData.item(icon, desc, () => this.doSetGroupEvery(groupEvery))\n        }\n\n        return [\n            ...makeTriggerItems(this._trigger, this.doSetTrigger.bind(this)),\n            [\"mid\", ContextMenuData.sep()],\n            [\"mid\", ContextMenuData.submenu(\"eye\", s.Decoding, [\n                makeItemDecodeAs(\"raw\", s.DecodingNone),\n                makeItemDecodeAs(\"octal\", s.DecodingOctal),\n                makeItemDecodeAs(\"hex\", s.DecodingHex),\n                makeItemDecodeAs(\"ascii\", s.DecodingAscii7),\n                makeItemDecodeAs(\"ascii8\", s.DecodingAscii8),\n                makeItemDecodeAs(\"uint4\", s.DecodingUint4),\n                makeItemDecodeAs(\"int4\", s.DecodingInt4),\n                makeItemDecodeAs(\"uint8\", s.DecodingUint8),\n                makeItemDecodeAs(\"int8\", s.DecodingInt8),\n                makeItemDecodeAs(\"uint16\", s.DecodingUint16),\n                makeItemDecodeAs(\"int16\", s.DecodingInt16),\n                ContextMenuData.sep(),\n                ContextMenuData.text(s.DecodingChangeWarning),\n            ])],\n            [\"mid\", ContextMenuData.submenu(\"regroup\", s.Grouping, [\n                makeItemGroupEvery(undefined, s.GroupingNone),\n                ContextMenuData.sep(),\n                makeItemGroupEvery(2, s.GroupBy.expand({ n: 2 })),\n                makeItemGroupEvery(3, s.GroupBy.expand({ n: 3 })),\n                makeItemGroupEvery(4, s.GroupBy.expand({ n: 4 })),\n                makeItemGroupEvery(7, s.GroupBy.expand({ n: 7 })),\n                makeItemGroupEvery(8, s.GroupBy.expand({ n: 8 })),\n                makeItemGroupEvery(16, s.GroupBy.expand({ n: 16 })),\n            ])],\n        ]\n    }\n}\n\nfunction allBitsOf({ incoming, decoded }: OutputShiftBufferState): LogicValue[] {\n    const allBits = [...incoming]\n    for (const [__stringRep, bits] of decoded) {\n        allBits.push(...bits)\n    }\n    return allBits\n}\n", "import * as t from \"io-ts\"\nimport { LogicEditor } from \"../LogicEditor\"\nimport { isString, isUndefined } from \"../utils\"\nimport { Output16Seg, Output16SegDef } from \"./Output16Seg\"\nimport { Output7Seg, Output7SegDef } from \"./Output7Seg\"\nimport { OutputAscii, OutputAsciiDef } from \"./OutputAscii\"\nimport { OutputBar, OutputBarDef } from \"./OutputBar\"\nimport { OutputBit, OutputBitDef } from \"./OutputBit\"\nimport { OutputByte, OutputByteDef } from \"./OutputByte\"\nimport { OutputByteDisplay, OutputByteDisplayDef } from \"./OutputByteDisplay\"\nimport { OutputNibble, OutputNibbleDef } from \"./OutputNibble\"\nimport { OutputNibbleDisplay, OutputNibbleDisplayDef } from \"./OutputNibbleDisplay\"\nimport { OutputShiftBuffer, OutputShiftBufferDef } from \"./OutputShiftBuffer\"\n\nexport type Output = OutputBit | OutputNibbleDisplay | OutputAscii | OutputBar | OutputShiftBuffer\n\nexport const OutputDef = t.union([\n    OutputBitDef.repr,\n    OutputNibbleDef.repr,\n    OutputNibbleDisplayDef.repr,\n    OutputByteDef.repr,\n    OutputByteDisplayDef.repr,\n    Output7SegDef.repr,\n    Output16SegDef.repr,\n    OutputAsciiDef.repr,\n    OutputBarDef.repr,\n    OutputShiftBufferDef.repr,\n], \"Output\")\n\ntype OutputRepr = t.TypeOf<typeof OutputDef>\n\nexport const OutputFactory = {\n\n    make: (editor: LogicEditor, savedDataOrType: OutputRepr | string | undefined) => {\n        let blank\n        let savedData: OutputRepr\n\n        if (isUndefined(savedDataOrType)) {\n            // default, typeless option\n            blank = true\n            savedData = {} as OutputRepr\n        } else if (isString(savedDataOrType)) {\n            // specific subtype\n            blank = true\n            savedData = { type: savedDataOrType } as OutputRepr\n        } else {\n            // as saved\n            blank = false\n            savedData = savedDataOrType\n        }\n\n        if (!(\"type\" in savedData)) {\n            return new OutputBit(editor, blank ? null : savedData)\n        }\n        switch (savedData.type) {\n            case \"nibble\":\n                return new OutputNibble(editor, blank ? null : savedData)\n            case \"nibble-display\":\n                return new OutputNibbleDisplay(editor, blank ? null : savedData)\n            case \"byte\":\n                return new OutputByte(editor, blank ? null : savedData)\n            case \"byte-display\":\n                return new OutputByteDisplay(editor, blank ? null : savedData)\n            case \"7seg\":\n                return new Output7Seg(editor, blank ? null : savedData)\n            case \"16seg\":\n                return new Output16Seg(editor, blank ? null : savedData)\n            case \"ascii\":\n                return new OutputAscii(editor, blank ? null : savedData)\n            case \"bar\":\n                return new OutputBar(editor, blank ? null : savedData)\n            case \"shiftbuffer\":\n                return new OutputShiftBuffer(editor, blank ? null : savedData)\n        }\n    },\n\n}\n\n", "import { Component } from \"./components/Component\"\nimport { GateFactory } from \"./components/Gate\"\nimport { ICFactory } from \"./components/IC\"\nimport { InputFactory } from \"./components/Inputs\"\nimport { LabelFactory } from \"./components/Labels\"\nimport { LayoutFactory } from \"./components/Layout\"\nimport { OutputFactory } from \"./components/Outputs\"\nimport { LogicEditor } from \"./LogicEditor\"\nimport { isDefined, isUndefined, RichStringEnum } from \"./utils\"\n\ntype Factory = { make(editor: LogicEditor, type: string | undefined): Component | undefined }\n\nfunction makeFactory(compType: string, factory: Factory) {\n    return {\n        make: (editor: LogicEditor, elem: HTMLElement) => {\n            const compDataset = elem.dataset\n            const type = compDataset[\"type\"]\n            const newComp = factory.make(editor, type === null ? undefined : type)\n            if (isUndefined(newComp)) {\n                throw new Error(`undefined '${compType}' type - elem: ` + elem.outerHTML)\n            }\n\n            // further general component customisation based on editor options\n            const classId = compDataset[\"classid\"]\n            if (isUndefined(classId)) {\n                console.log(\"WARN No class ID linked to elem \" + elem.outerHTML)\n            } else {\n                const compConfig = editor.options.initParams?.[classId]\n                if (isDefined(compConfig)) {\n                    let val\n                    if (isDefined(val = compConfig.orient)) {\n                        newComp.doSetOrient(val)\n                    }\n                }\n            }\n            return newComp\n        },\n    }\n}\n\nconst ComponentFactoryTypes = RichStringEnum.withProps<{\n    make(editor: LogicEditor, elem: HTMLElement): Component,\n}>()({\n    \"in\": makeFactory(\"in\", InputFactory),\n    \"out\": makeFactory(\"out\", OutputFactory),\n    \"gate\": makeFactory(\"gate\", GateFactory),\n    \"component\": makeFactory(\"component\", ICFactory),\n    \"label\": makeFactory(\"label\", LabelFactory),\n    \"layout\": makeFactory(\"layout\", LayoutFactory),\n})\n// type ComponentFactoryType = typeof ComponentFactoryTypes.type\n\nclass _ComponentFactory {\n    public makeFactoryForButton(elem: HTMLElement): (editor: LogicEditor) => Component {\n        const compType = elem.dataset[\"component\"]\n        if (!ComponentFactoryTypes.isValue(compType)) {\n            throw new Error(`bad component category: '${compType}'; expected one of: ` + ComponentFactoryTypes.values.join(\", \"))\n        }\n        const compDef = ComponentFactoryTypes.propsOf(compType)\n        return (editor) => {\n            const newComp = compDef.make(editor, elem)\n            editor.components.add(newComp)\n            return newComp\n        }\n    }\n}\n\nexport const ComponentFactory = new _ComponentFactory()\n", "import { Component } from \"./components/Component\"\nimport { FixedArrayFillFactory } from \"./utils\"\n\nexport const DrawZIndex = {\n    Background: 0,\n    Normal: 1,\n    Overlay: 2,\n} as const\n\nexport type DrawZIndex = typeof DrawZIndex[keyof typeof DrawZIndex]\n\nexport class ComponentList {\n\n    // eslint-disable-next-line @typescript-eslint/semi\n    private _componentsByZIndex = FixedArrayFillFactory((__i) => [] as Component[], 3);\n\n    public *all() {\n        for (const compList of this._componentsByZIndex) {\n            for (const comp of compList) {\n                yield comp\n            }\n        }\n    }\n\n    public *allInReversedZIndexOrder() {\n        for (let i = this._componentsByZIndex.length - 1; i >= 0; i--) {\n            const compList = this._componentsByZIndex[i]\n            for (const comp of compList) {\n                yield comp\n            }\n        }\n    }\n\n    public *withZIndex(zIndex: DrawZIndex) {\n        for (const comp of this._componentsByZIndex[zIndex]) {\n            yield comp\n        }\n    }\n\n    public add(comp: Component) {\n        const z = comp.drawZIndex\n        this._componentsByZIndex[z].push(comp)\n    }\n\n    public tryDeleteWhere(cond: (e: Component) => boolean, onlyOne: boolean) {\n        let numDeleted = 0\n        \n        outer:\n        for (const compList of this._componentsByZIndex) {\n            for (let i = 0; i < compList.length; i++) {\n                const comp = compList[i]\n                if (cond(comp)) {\n                    comp.destroy()\n                    compList.splice(i, 1)\n                    numDeleted++\n                    if (onlyOne) {\n                        break outer\n                    }\n                }\n            }\n        }\n        return numDeleted\n    }\n\n    public clearAll() {\n        for (const compList of this._componentsByZIndex) {\n            compList.splice(0, compList.length)\n        }\n    }\n\n\n}\n", "/* eslint-disable @typescript-eslint/ban-ts-comment */\n/* eslint-disable @typescript-eslint/semi */\n\n// 'ts-ignore' works on the next line, so we need the next line\n// @ts-ignore\n\n\n\n// icons\nimport add from '../img/icons/add.icon.svg'; // @ts-ignore\nimport bordercolor from '../img/icons/bordercolor.icon.svg'; // @ts-ignore\nimport check from '../img/icons/check.icon.svg'; // @ts-ignore\nimport close from '../img/icons/close.icon.svg'; // @ts-ignore\nimport dimensions from '../img/icons/dimensions.icon.svg'; // @ts-ignore\nimport direction from '../img/icons/direction.icon.svg'; // @ts-ignore\nimport download from '../img/icons/download.icon.svg'; // @ts-ignore\nimport edit from '../img/icons/edit.icon.svg'; // @ts-ignore\nimport eye from '../img/icons/eye.icon.svg'; // @ts-ignore\nimport font from '../img/icons/font.icon.svg'; // @ts-ignore\nimport force from '../img/icons/force.icon.svg'; // @ts-ignore\nimport link from '../img/icons/link.icon.svg'; // @ts-ignore\nimport move from '../img/icons/move.icon.svg'; // @ts-ignore\nimport none from '../img/icons/none.icon.svg'; // @ts-ignore\nimport open from '../img/icons/open.icon.svg'; // @ts-ignore\nimport palette from '../img/icons/palette.icon.svg'; // @ts-ignore\nimport pause from '../img/icons/pause.icon.svg'; // @ts-ignore\nimport pen from '../img/icons/pen.icon.svg'; // @ts-ignore\nimport placement from '../img/icons/placement.icon.svg'; // @ts-ignore\nimport play from '../img/icons/play.icon.svg'; // @ts-ignore\nimport question from '../img/icons/question.icon.svg'; // @ts-ignore\nimport questioncircled from '../img/icons/questioncircled.icon.svg'; // @ts-ignore\nimport { default as ref, default as regroup } from '../img/icons/ref.icon.svg'; // @ts-ignore\nimport replace from '../img/icons/replace.icon.svg'; // @ts-ignore\nimport reset from '../img/icons/reset.icon.svg'; // @ts-ignore\nimport screenshot from '../img/icons/screenshot.icon.svg'; // @ts-ignore\nimport settings from '../img/icons/settings.icon.svg'; // @ts-ignore\nimport slanted from '../img/icons/slanted.icon.svg'; // @ts-ignore\nimport step from '../img/icons/step.icon.svg'; // @ts-ignore\nimport strokewidth from '../img/icons/strokewidth.icon.svg'; // @ts-ignore\nimport timer from '../img/icons/timer.icon.svg'; // @ts-ignore\nimport trash from '../img/icons/trash.icon.svg'; // @ts-ignore\nimport wirestyle from '../img/icons/wirestyle.icon.svg'; // @ts-ignore\n\n\n// images\nimport Adder from '../img/Adder.svg'; // @ts-ignore\nimport ALU from '../img/ALU.svg'; // @ts-ignore\nimport AND from '../img/AND.svg'; // @ts-ignore\nimport AND3 from '../img/AND3.svg'; // @ts-ignore\nimport AND4 from '../img/AND4.svg'; // @ts-ignore\nimport BUF from '../img/BUF.svg'; // @ts-ignore\nimport Clock from '../img/Clock.svg'; // @ts-ignore\nimport Comparator from '../img/Comparator.svg'; // @ts-ignore\nimport Counter from '../img/Counter.svg'; // @ts-ignore\nimport Decoder16Seg from '../img/Decoder16Seg.svg'; // @ts-ignore\nimport Decoder7Seg from '../img/Decoder7Seg.svg'; // @ts-ignore\nimport DecoderBCD4 from '../img/DecoderBCD4.svg'; // @ts-ignore\nimport Demux from '../img/Demux.svg'; // @ts-ignore\nimport FlipflopD from '../img/FlipflopD.svg'; // @ts-ignore\nimport FlipflopJK from '../img/FlipflopJK.svg'; // @ts-ignore\nimport FlipflopT from '../img/FlipflopT.svg'; // @ts-ignore\nimport HalfAdder from '../img/HalfAdder.svg'; // @ts-ignore\nimport IMPLY from '../img/IMPLY.svg'; // @ts-ignore\nimport InputBit from '../img/InputBit.svg'; // @ts-ignore\nimport InputByte from '../img/InputByte.svg'; // @ts-ignore\nimport InputNibble from '../img/InputNibble.svg'; // @ts-ignore\nimport InputRandom from '../img/InputRandom.svg'; // @ts-ignore\nimport LabelRectangle from '../img/LabelRectangle.svg'; // @ts-ignore\nimport LabelString from '../img/LabelString.svg'; // @ts-ignore\nimport LatchSR from '../img/LatchSR.svg'; // @ts-ignore\nimport Mux from '../img/Mux.svg'; // @ts-ignore\nimport NAND from '../img/NAND.svg'; // @ts-ignore\nimport NAND3 from '../img/NAND3.svg'; // @ts-ignore\nimport NAND4 from '../img/NAND4.svg'; // @ts-ignore\nimport NIMPLY from '../img/NIMPLY.svg'; // @ts-ignore\nimport NOR from '../img/NOR.svg'; // @ts-ignore\nimport NOR3 from '../img/NOR3.svg'; // @ts-ignore\nimport NOR4 from '../img/NOR4.svg'; // @ts-ignore\nimport NOT from '../img/NOT.svg'; // @ts-ignore\nimport OR from '../img/OR.svg'; // @ts-ignore\nimport OR3 from '../img/OR3.svg'; // @ts-ignore\nimport OR4 from '../img/OR4.svg'; // @ts-ignore\nimport Output16Seg from '../img/Output16Seg.svg'; // @ts-ignore\nimport Output7Seg from '../img/Output7Seg.svg'; // @ts-ignore\nimport OutputAscii from '../img/OutputAscii.svg'; // @ts-ignore\nimport OutputBar from '../img/OutputBar.svg'; // @ts-ignore\nimport OutputBit from '../img/OutputBit.svg'; // @ts-ignore\nimport OutputByte from '../img/OutputByte.svg'; // @ts-ignore\nimport OutputByteDisplay from '../img/OutputByteDisplay.svg'; // @ts-ignore\nimport OutputNibble from '../img/OutputNibble.svg'; // @ts-ignore\nimport OutputNibbleDisplay from '../img/OutputNibbleDisplay.svg'; // @ts-ignore\nimport OutputShiftBuffer from '../img/OutputShiftBuffer.svg'; // @ts-ignore\nimport Passthrough1 from '../img/Passthrough1.svg'; // @ts-ignore\nimport Passthrough4 from '../img/Passthrough4.svg'; // @ts-ignore\nimport Passthrough8 from '../img/Passthrough8.svg'; // @ts-ignore\nimport QuadGate from '../img/QuadGate.svg'; // @ts-ignore\nimport QuadTriState from '../img/QuadTriState.svg'; // @ts-ignore\nimport RAM16x4 from '../img/RAM16x4.svg'; // @ts-ignore\nimport RAM16x8 from '../img/RAM16x8.svg'; // @ts-ignore\nimport RAM64x8 from '../img/RAM64x8.svg'; // @ts-ignore\nimport RAM32x12 from '../img/RAM32x12.svg' // @ts-ignore\nimport Register from '../img/Register.svg'; // @ts-ignore\nimport SwitchedInverter from '../img/SwitchedInverter.svg'; // @ts-ignore\nimport TRI from '../img/TRI.svg'; // @ts-ignore\nimport TXA from '../img/TXA.svg'; // @ts-ignore\nimport XNOR from '../img/XNOR.svg'; // @ts-ignore\nimport XNOR3 from '../img/XNOR3.svg'; // @ts-ignore\nimport XNOR4 from '../img/XNOR4.svg'; // @ts-ignore\nimport XOR from '../img/XOR.svg'; // @ts-ignore\nimport XOR3 from '../img/XOR3.svg'; // @ts-ignore\nimport XOR4 from '../img/XOR4.svg'; // @ts-ignore\nimport { isDefined } from './utils';\n\n\nvoid 0 // dummy line to consume the last 'ts-ignore'\n\n\nconst icons = {\n    add,\n    bordercolor,\n    check,\n    close,\n    dimensions,\n    direction,\n    download,\n    edit,\n    eye,\n    font,\n    force,\n    link,\n    move,\n    none,\n    open,\n    palette,\n    pause,\n    pen,\n    placement,\n    play,\n    question,\n    questioncircled,\n    ref,\n    regroup,\n    replace,\n    reset,\n    screenshot,\n    settings,\n    slanted,\n    step,\n    strokewidth,\n    timer,\n    trash,\n    wirestyle,\n}\n\nconst images = {\n    Adder,\n    ALU,\n    AND,\n    AND3,\n    AND4,\n    BUF,\n    Clock,\n    Comparator,\n    Counter,\n    Decoder7Seg,\n    Decoder16Seg,\n    DecoderBCD4,\n    Demux,\n    FlipflopD,\n    FlipflopJK,\n    FlipflopT,\n    HalfAdder,\n    IMPLY,\n    InputBit,\n    InputByte,\n    InputNibble,\n    InputRandom,\n    LabelRectangle,\n    LabelString,\n    LatchSR,\n    Mux,\n    NAND,\n    NAND3,\n    NAND4,\n    NIMPLY,\n    NOR,\n    NOR3,\n    NOR4,\n    NOT,\n    OR,\n    OR3,\n    OR4,\n    Output7Seg,\n    Output16Seg,\n    OutputAscii,\n    OutputBar,\n    OutputBit,\n    OutputByte,\n    OutputByteDisplay,\n    OutputNibble,\n    OutputNibbleDisplay,\n    OutputShiftBuffer,\n    Passthrough1,\n    Passthrough4,\n    Passthrough8,\n    QuadGate,\n    QuadTriState,\n    RAM16x4,\n    RAM16x8,\n    RAM64x8,\n    RAM32x12,\n    Register,\n    SwitchedInverter,\n    TRI,\n    TXA,\n    XNOR,\n    XNOR3,\n    XNOR4,\n    XOR,\n    XOR3,\n    XOR4,\n}\n\nexport type IconName = keyof typeof icons\nexport function isIconName(name: string): name is IconName {\n    return name in icons\n}\n\nexport type ImageName = keyof typeof images\nexport function isImageName(name: string): name is ImageName {\n    return name in images\n}\n\nexport function makeImage(name: ImageName, width?: number, height?: number): HTMLImageElement {\n    const htmlImg = new Image(width, height)\n    htmlImg.src = images[name]\n    return htmlImg\n}\n\nexport function makeIcon(name: IconName, width?: number, height?: number): HTMLElement {\n    const elem = document.createElement('i')\n    elem.classList.add(\"svgicon\")\n    if (isDefined(width)) {\n        elem.style.width = `${width}px`\n    }\n    if (isDefined(height)) {\n        elem.style.height = `${height}px`\n    }\n    elem.dataset[\"icon\"] = name\n    elem.innerHTML = inlineSvgFor(name)\n    return elem\n}\n\nexport function inlineSvgFor(name: IconName): string {\n    return icons[name]\n}\n", "import { createPopper, Instance as PopperInstance } from '@popperjs/core'\nimport { ComponentFactory } from './ComponentFactory'\nimport { DrawZIndex } from './ComponentList'\nimport { ComponentBase, ComponentState } from './components/Component'\nimport { ContextMenuItem, Drawable, DrawableWithPosition } from \"./components/Drawable\"\nimport { Node } from \"./components/Node\"\nimport { dist, setColorMouseOverIsDanger } from './drawutils'\nimport { applyModifiersTo, button, cls, li, Modifier, ModifierObject, mods, span, type, ul } from './htmlgen'\nimport { IconName, makeIcon } from './images'\nimport { LogicEditor, MouseAction } from './LogicEditor'\nimport { isDefined, isNotNull, isNull, isUndefined, Mode, TimeoutHandle } from \"./utils\"\n\ntype MouseDownData = {\n    mainComp: Drawable | Element\n    selectionComps: Drawable[]\n    fireMouseClickedOnFinish: boolean\n    initialXY: [number, number]\n    triggeredContextMenu: boolean\n}\n\nexport class EditorSelection {\n\n    public previouslySelectedElements = new Set<Drawable>()\n\n    public constructor(\n        public currentlyDrawnRect: DOMRect | undefined,\n    ) { }\n\n    public toggle(elem: Drawable) {\n        if (this.previouslySelectedElements.has(elem)) {\n            this.previouslySelectedElements.delete(elem)\n        } else {\n            this.previouslySelectedElements.add(elem)\n        }\n    }\n\n    public finishCurrentRect(editor: LogicEditor) {\n        let rect\n        if (isDefined(rect = this.currentlyDrawnRect)) {\n            for (const comp of editor.components.all()) {\n                if (comp.isInRect(rect)) {\n                    this.toggle(comp)\n                }\n            }\n\n            for (const wire of editor.wireMgr.wires) {\n                for (const point of wire.waypoints) {\n                    if (point.isInRect(rect)) {\n                        this.toggle(point)\n                    }\n                }\n            }\n\n            this.currentlyDrawnRect = undefined\n        }\n    }\n\n    public isSelected(component: Drawable): boolean {\n        const prevSelected = this.previouslySelectedElements.has(component)\n        const rect = this.currentlyDrawnRect\n        if (isUndefined(rect)) {\n            return prevSelected\n        } else {\n            const inverted = component.isInRect(rect)\n            return inverted ? !prevSelected : prevSelected\n        }\n    }\n\n}\n\n\nexport class CursorMovementManager {\n\n    public readonly editor: LogicEditor\n    private _currentMouseOverComp: Drawable | null = null\n    private _currentMouseOverPopper: PopperInstance | null = null\n    private _currentMouseDownData: MouseDownData | null = null\n    private _startHoverTimeoutHandle: TimeoutHandle | null = null\n    private _startDragTimeoutHandle: TimeoutHandle | null = null\n    private _currentHandlers: ToolHandlers\n    private _lastTouchEnd: [Drawable, number] | undefined = undefined\n    public currentSelection: EditorSelection | undefined = undefined\n\n    public constructor(editor: LogicEditor) {\n        this.editor = editor\n        this._currentHandlers = new EditHandlers(editor)\n    }\n\n    public get currentMouseOverComp() {\n        return this._currentMouseOverComp\n    }\n\n    public get currentMouseDownData() {\n        return this._currentMouseDownData\n    }\n\n    public setHandlersFor(action: MouseAction) {\n        this._currentHandlers = (() => {\n            switch (action) {\n                case \"edit\": return new EditHandlers(this.editor)\n                case \"delete\": return new DeleteHandlers(this.editor)\n                case \"move\": return new MoveHandlers(this.editor)\n            }\n        })()\n        setColorMouseOverIsDanger(action === \"delete\")\n    }\n\n    public setStartDragTimeout(startMouseDownData: MouseDownData, e: MouseEvent | TouchEvent) {\n        // we do this because firefox otherwise sets back offsetX/Y to 0\n        const _e = e as any\n        _e._savedOffsetX = _e.offsetX\n        _e._savedOffsetY = _e.offsetY\n        _e._savedTarget = _e.target\n        this._startDragTimeoutHandle = setTimeout(\n            this.editor.wrapHandler(() => {\n                let fireDrag = true\n                const endMouseDownData = this._currentMouseDownData\n                if (isNotNull(endMouseDownData)) {\n                    endMouseDownData.fireMouseClickedOnFinish = false\n                    if (endMouseDownData.triggeredContextMenu) {\n                        fireDrag = false\n                    }\n                }\n                if (fireDrag) {\n                    if (startMouseDownData.mainComp instanceof Drawable) {\n                        this._currentHandlers.mouseDraggedOn(startMouseDownData.mainComp, e)\n                    }\n                    for (const comp of startMouseDownData.selectionComps) {\n                        this._currentHandlers.mouseDraggedOn(comp, e)\n                    }\n                }\n            }),\n            300\n        )\n    }\n\n    public clearStartDragTimeout() {\n        if (isNotNull(this._startDragTimeoutHandle)) {\n            clearTimeout(this._startDragTimeoutHandle)\n            this._startDragTimeoutHandle = null\n        }\n    }\n\n    public clearHoverTimeoutHandle() {\n        if (isNotNull(this._startHoverTimeoutHandle)) {\n            clearTimeout(this._startHoverTimeoutHandle)\n            this._startHoverTimeoutHandle = null\n        }\n    }\n\n    public setCurrentMouseOverComp(comp: Drawable | null) {\n        if (comp !== this._currentMouseOverComp) {\n            this.clearPopperIfNecessary()\n            this.clearHoverTimeoutHandle()\n\n            this._currentMouseOverComp = comp\n            if (isNotNull(comp)) {\n                this._startHoverTimeoutHandle = setTimeout(() => {\n                    this._currentHandlers.mouseHoverOn(comp)\n                    this._startHoverTimeoutHandle = null\n                }, 1200)\n            }\n            this.editor.redrawMgr.addReason(\"mouseover changed\", null)\n            // console.log(\"Over component: \", comp)\n        }\n    }\n\n    public updateMouseOver([x, y]: [number, number]) {\n        const findMouseOver: () => Drawable | null = () => {\n            // easy optimization: maybe we're still over the\n            // same component as before, so quickly check this\n            if (isNotNull(this._currentMouseOverComp) && this._currentMouseOverComp.drawZIndex !== 0) {\n                // second condition says: always revalidate the mouseover of background components (with z index 0)\n                if (this._currentMouseOverComp.isOver(x, y)) {\n                    return this._currentMouseOverComp\n                }\n            }\n\n            // overlays\n            for (const comp of this.editor.components.withZIndex(DrawZIndex.Overlay)) {\n                if (comp.isOver(x, y)) {\n                    return comp\n                }\n            }\n\n            // normal components or their nodes\n            for (const comp of this.editor.components.withZIndex(DrawZIndex.Normal)) {\n                let nodeOver: Node | null = null\n                comp.forEachNode((node) => {\n                    if (node.isOver(x, y)) {\n                        nodeOver = node\n                        return false\n                    }\n                    return true\n                })\n                if (isNotNull(nodeOver)) {\n                    return nodeOver\n                }\n                if (comp.isOver(x, y)) {\n                    return comp\n                }\n            }\n\n            // wires\n            for (const wire of this.editor.wireMgr.wires) {\n                for (const waypoint of wire.waypoints) {\n                    if (waypoint.isOver(x, y)) {\n                        return waypoint\n                    }\n                }\n                if (wire.isOver(x, y)) {\n                    return wire\n                }\n            }\n\n            // background elems\n            for (const comp of this.editor.components.withZIndex(DrawZIndex.Background)) {\n                if (comp.isOver(x, y)) {\n                    return comp\n                }\n            }\n\n            return null\n        }\n\n        this.setCurrentMouseOverComp(findMouseOver())\n    }\n\n    public selectAll() {\n        const sel = new EditorSelection(undefined)\n        this.currentSelection = sel\n        for (const comp of this.editor.components.all()) {\n            sel.previouslySelectedElements.add(comp)\n        }\n        for (const wire of this.editor.wireMgr.wires) {\n            for (const waypoint of wire.waypoints) {\n                sel.previouslySelectedElements.add(waypoint)\n            }\n        }\n        this.editor.redrawMgr.addReason(\"selected all\", null)\n    }\n\n    public toggleSelect(comp: Drawable) {\n        let sel\n        if (isUndefined(sel = this.currentSelection)) {\n            sel = new EditorSelection(undefined)\n            this.currentSelection = sel\n        }\n        sel.toggle(comp)\n        this.editor.redrawMgr.addReason(\"toggled selection\", null)\n    }\n\n\n    public clearPopperIfNecessary() {\n        if (isNotNull(this._currentMouseOverPopper)) {\n            this._currentMouseOverPopper.destroy()\n            this._currentMouseOverPopper = null\n            this.editor.html.tooltipElem.style.display = \"none\"\n        }\n    }\n\n    public makePopper(tooltipHtml: ModifierObject, rect: DOMRect) {\n        const tooltipContents = this.editor.html.tooltipContents\n        const tooltipElem = this.editor.html.tooltipElem\n        tooltipContents.innerHTML = \"\"\n        tooltipHtml.applyTo(tooltipContents)\n        tooltipElem.style.removeProperty(\"display\")\n        const canvas = document.getElementsByTagName(\"CANVAS\")[0]\n        this._currentMouseOverPopper = createPopper({\n            getBoundingClientRect() { return rect },\n            contextElement: canvas,\n        }, tooltipElem, {\n            placement: 'right',\n            modifiers: [{ name: 'offset', options: { offset: [4, 8] } }],\n        })\n        tooltipElem.setAttribute('data-show', '')\n        this._currentMouseOverPopper.update()\n    }\n\n    public registerCanvasListenersOn(canvas: HTMLCanvasElement) {\n        const editor = this.editor\n        canvas.addEventListener(\"touchstart\", editor.wrapHandler((e) => {\n            // console.log(\"canvas touchstart %o %o, composedPath = %o\", offsetXY(e), e, e.composedPath())\n            if (this.editor.mode >= Mode.CONNECT) {\n                // prevent scrolling when we can connect\n                e.preventDefault()\n            }\n            this._mouseDownTouchStart(e)\n        }))\n        canvas.addEventListener(\"touchmove\", editor.wrapHandler((e) => {\n            // console.log(\"canvas touchmove %o %o, composedPath = %o\", offsetXY(e), e, e.composedPath())\n            if (this.editor.mode >= Mode.CONNECT) {\n                // prevent scrolling when we can connect\n                e.preventDefault()\n            }\n            this._mouseMoveTouchMove(e)\n        }))\n\n        canvas.addEventListener(\"touchend\", editor.wrapHandler((e) => {\n            // console.log(\"canvas touchend %o %o, composedPath = %o\", offsetXY(e), e, e.composedPath())\n            // touchend should always be prevented, otherwise it may\n            // generate mouse/click events\n            e.preventDefault()\n            this._mouseUpTouchEnd(e)\n            this.setCurrentMouseOverComp(null)\n        }))\n\n        // canvasContainer.addEventListener(\"touchcancel\", wrapHandler((e) => {\n        //     // console.log(\"canvas touchcancel %o %o, composedPath = %o\", offsetXY(e), e, e.composedPath())\n        // }))\n\n        canvas.addEventListener(\"mousedown\", editor.wrapHandler((e) => {\n            // console.log(\"mousedown %o, composedPath = %o\", e, e.composedPath())\n            this._mouseDownTouchStart(e)\n        }))\n\n        canvas.addEventListener(\"mousemove\", editor.wrapHandler((e) => {\n            // console.log(\"mousemove %o, composedPath = %o\", e, e.composedPath())\n            this._mouseMoveTouchMove(e)\n            this.editor.updateCursor()\n        }))\n\n        canvas.addEventListener(\"mouseup\", editor.wrapHandler((e) => {\n            // console.log(\"mouseup %o, composedPath = %o\", e, e.composedPath())\n            this._mouseUpTouchEnd(e)\n            this.updateMouseOver([e.offsetX, e.offsetY])\n            this.editor.updateCursor()\n        }))\n\n        canvas.addEventListener(\"contextmenu\", editor.wrapHandler((e) => {\n            // console.log(\"contextmenu %o, composedPath = %o\", e, e.composedPath())\n            e.preventDefault()\n            if (this.editor.mode >= Mode.CONNECT && isNotNull(this._currentMouseOverComp)) {\n                this._currentHandlers.contextMenuOn(this._currentMouseOverComp, e)\n            }\n        }))\n    }\n\n    private _mouseDownTouchStart(e: MouseEvent | TouchEvent) {\n        this.clearHoverTimeoutHandle()\n        this.clearPopperIfNecessary()\n        if (isNull(this._currentMouseDownData)) {\n            const xy = this.editor.offsetXY(e)\n            this.updateMouseOver(xy)\n            if (isNotNull(this._currentMouseOverComp)) {\n                // mouse down on component\n                const { wantsDragEvents } = this._currentHandlers.mouseDownOn(this._currentMouseOverComp, e)\n                if (wantsDragEvents) {\n                    const selectedComps = isUndefined(this.currentSelection) ? [] : [...this.currentSelection.previouslySelectedElements]\n                    for (const comp of selectedComps) {\n                        if (comp !== this._currentMouseOverComp) {\n                            this._currentHandlers.mouseDownOn(comp, e)\n                        }\n                    }\n                    const mouseDownData: MouseDownData = {\n                        mainComp: this._currentMouseOverComp,\n                        selectionComps: selectedComps,\n                        fireMouseClickedOnFinish: true,\n                        initialXY: xy,\n                        triggeredContextMenu: false,\n                    }\n                    this._currentMouseDownData = mouseDownData\n                    this.setStartDragTimeout(mouseDownData, e)\n                }\n                this.editor.redrawMgr.addReason(\"mousedown\", null)\n            } else {\n                // mouse down on background\n                this._currentMouseDownData = {\n                    mainComp: this.editor.html.canvasContainer,\n                    selectionComps: [], // ignore selection\n                    fireMouseClickedOnFinish: true,\n                    initialXY: xy,\n                    triggeredContextMenu: false,\n                }\n                this._currentHandlers.mouseDownOnBackground(e)\n            }\n            this.editor.updateCursor()\n        } else {\n            // we got a mousedown while a component had programmatically\n            // been determined as being mousedown'd; ignore\n        }\n    }\n\n    private _mouseMoveTouchMove(e: MouseEvent | TouchEvent) {\n        if (isNotNull(this._currentMouseDownData)) {\n            if (this._currentMouseDownData.triggeredContextMenu) {\n                // cancel it all\n                this._currentMouseDownData = null\n            } else {\n                if (this._currentMouseDownData.mainComp instanceof Drawable) {\n                    // check if the drag is too small to be taken into account now\n                    // (e.g., touchmove is fired very quickly)\n                    const d = dist(...this.editor.offsetXY(e), ...this._currentMouseDownData.initialXY)\n                    // NaN is returned when no input point was specified and\n                    // dragging should then happen regardless\n                    if (isNaN(d) || d >= 5) {\n                        // dragging component\n                        this.clearStartDragTimeout()\n                        this._currentMouseDownData.fireMouseClickedOnFinish = false\n                        this._currentHandlers.mouseDraggedOn(this._currentMouseDownData.mainComp, e)\n                        for (const comp of this._currentMouseDownData.selectionComps) {\n                            if (comp !== this._currentMouseDownData.mainComp) {\n                                this._currentHandlers.mouseDraggedOn(comp, e)\n                            }\n                        }\n                    }\n                } else {\n                    // dragging background\n                    this._currentHandlers.mouseDraggedOnBackground(e)\n                }\n            }\n        } else {\n            // moving mouse or dragging without a locked component \n            this.updateMouseOver(this.editor.offsetXY(e))\n        }\n    }\n\n    private _mouseUpTouchEnd(e: MouseEvent | TouchEvent) {\n        // our target is either the locked component that\n        // was clicked or the latest mouse over component\n        const mouseUpTarget = this._currentMouseDownData?.mainComp ?? this._currentMouseOverComp\n        if (mouseUpTarget instanceof Drawable) {\n            // mouseup on component\n            if (isNotNull(this._startDragTimeoutHandle)) {\n                clearTimeout(this._startDragTimeoutHandle)\n                this._startDragTimeoutHandle = null\n            }\n            let shouldTakeSnapshot = this._currentHandlers.mouseUpOn(mouseUpTarget, e)\n            for (const comp of this._currentMouseDownData?.selectionComps ?? []) {\n                if (comp !== mouseUpTarget) {\n                    shouldTakeSnapshot = this._currentHandlers.mouseUpOn(comp, e) || shouldTakeSnapshot\n                }\n            }\n\n            if (this._currentMouseDownData?.fireMouseClickedOnFinish ?? false) {\n                if (this.isDoubleClick(mouseUpTarget, e)) {\n                    const handled = this._currentHandlers.mouseDoubleClickedOn(mouseUpTarget, e)\n                    if (!handled) {\n                        // no double click handler, so we trigger a normal click\n                        shouldTakeSnapshot = this._currentHandlers.mouseClickedOn(mouseUpTarget, e) || shouldTakeSnapshot\n                    } else {\n                        shouldTakeSnapshot = true\n                    }\n                } else {\n                    shouldTakeSnapshot = this._currentHandlers.mouseClickedOn(mouseUpTarget, e) || shouldTakeSnapshot\n                }\n            }\n\n            if (shouldTakeSnapshot) {\n                this.editor.undoMgr.takeSnapshot()\n            }\n\n        } else {\n            // mouseup on background\n            this._currentHandlers.mouseUpOnBackground(e)\n        }\n        this._currentMouseDownData = null\n        this.editor.redrawMgr.addReason(\"mouseup\", null)\n    }\n\n    private isDoubleClick(clickedComp: Drawable, e: MouseEvent | TouchEvent) {\n        if (\"offsetX\" in e) {\n            return e.detail === 2\n        } else {\n            const oldLastTouchEnd = this._lastTouchEnd\n            const now = new Date().getTime()\n            this._lastTouchEnd = [clickedComp, now]\n            if (!isDefined(oldLastTouchEnd)) {\n                return false\n            }\n            const [lastComp, lastTime] = oldLastTouchEnd\n            const elapsedTimeMillis = now - lastTime\n            const isDoubleTouch = lastComp === clickedComp && elapsedTimeMillis > 0 && elapsedTimeMillis < 300\n            if (isDoubleTouch) {\n                this._lastTouchEnd = undefined\n            }\n            return isDoubleTouch\n        }\n    }\n\n    public registerButtonListenersOn(componentButtons: NodeListOf<HTMLElement>) {\n        const editor = this.editor\n        for (let i = 0; i < componentButtons.length; i++) {\n            const compButton = componentButtons[i]\n            const factory = ComponentFactory.makeFactoryForButton(compButton)\n\n            const buttonMouseDownTouchStart = (e: MouseEvent | TouchEvent) => {\n                this.editor.setCurrentMouseAction(\"edit\")\n                e.preventDefault()\n                this.editor.cursorMovementMgr.currentSelection = undefined\n                const newComponent = factory(editor)\n                this._currentMouseOverComp = newComponent\n                const { wantsDragEvents } = this._currentHandlers.mouseDownOn(newComponent, e)\n                if (wantsDragEvents) {\n                    this._currentMouseDownData = {\n                        mainComp: this._currentMouseOverComp,\n                        selectionComps: [], // ignore selection when dragging new component\n                        fireMouseClickedOnFinish: false,\n                        initialXY: [NaN, NaN],\n                        triggeredContextMenu: false,\n                    }\n                }\n                this._currentHandlers.mouseDraggedOn(newComponent, e)\n            }\n\n            compButton.addEventListener(\"mousedown\", editor.wrapHandler((e) => {\n                buttonMouseDownTouchStart(e)\n            }))\n            compButton.addEventListener(\"touchstart\", editor.wrapHandler((e) => {\n                // console.log(\"button touchstart %o %o\", offsetXY(e), e)\n                buttonMouseDownTouchStart(e)\n            }))\n            compButton.addEventListener(\"touchmove\", editor.wrapHandler((e) => {\n                // console.log(\"button touchmove %o %o\", offsetXY(e), e)\n                e.preventDefault()\n                this._mouseMoveTouchMove(e)\n            }))\n            compButton.addEventListener(\"touchend\", editor.wrapHandler((e) => {\n                // console.log(\"button touchend %o %o\", offsetXY(e), e)\n                e.preventDefault() // otherwise, may generate mouseclick, etc.\n                this._mouseUpTouchEnd(e)\n                this.setCurrentMouseOverComp(null)\n            }))\n        }\n    }\n\n}\n\n\nabstract class ToolHandlers {\n\n    public readonly editor: LogicEditor\n\n    public constructor(editor: LogicEditor) {\n        this.editor = editor\n    }\n\n    public mouseHoverOn(__comp: Drawable) {\n        // empty\n    }\n    public mouseDownOn(__comp: Drawable, __e: MouseEvent | TouchEvent) {\n        return { wantsDragEvents: true }\n    }\n    public mouseDraggedOn(__comp: Drawable, __e: MouseEvent | TouchEvent) {\n        // empty\n    }\n    public mouseUpOn(__comp: Drawable, __e: MouseEvent | TouchEvent): boolean {\n        return false // false means no change in model\n    }\n    public mouseClickedOn(__comp: Drawable, __e: MouseEvent | TouchEvent) {\n        return false // false means no change in model\n    }\n    public mouseDoubleClickedOn(__comp: Drawable, __e: MouseEvent | TouchEvent): boolean {\n        return false // false means no change in model\n    }\n    public contextMenuOn(__comp: Drawable, __e: MouseEvent | TouchEvent): boolean {\n        return false // false means unhandled\n    }\n    public mouseDownOnBackground(__e: MouseEvent | TouchEvent) {\n        // empty\n    }\n    public mouseDraggedOnBackground(__e: MouseEvent | TouchEvent) {\n        // empty\n    }\n    public mouseUpOnBackground(__e: MouseEvent | TouchEvent) {\n        // empty\n    }\n}\n\nclass EditHandlers extends ToolHandlers {\n\n    private _openedContextMenu: HTMLElement | null = null\n\n    public constructor(editor: LogicEditor) {\n        super(editor)\n    }\n\n    public override mouseHoverOn(comp: Drawable) {\n        const editor = this.editor\n        editor.cursorMovementMgr.clearPopperIfNecessary()\n        if (editor.options.hideTooltips) {\n            return\n        }\n        // maybe the component is now dead\n        if (comp instanceof ComponentBase && comp.state === ComponentState.DEAD) {\n            return\n        }\n        const tooltip = comp.makeTooltip()\n        if (isDefined(tooltip)) {\n            const containerRect = editor.html.canvasContainer.getBoundingClientRect()\n            const f = editor.actualZoomFactor\n            const [cx, cy, w, h] =\n                comp instanceof DrawableWithPosition\n                    ? [comp.posX * f, comp.posY * f, comp.width * f, comp.height * f]\n                    : [editor.mouseX, editor.mouseY, 4, 4]\n            const rect = new DOMRect(containerRect.x + cx - w / 2, containerRect.y + cy - h / 2, w, h)\n            editor.cursorMovementMgr.makePopper(tooltip, rect)\n        }\n    }\n    public override mouseDownOn(comp: Drawable, e: MouseEvent | TouchEvent) {\n        return comp.mouseDown(e)\n    }\n    public override mouseDraggedOn(comp: Drawable, e: MouseEvent | TouchEvent) {\n        comp.mouseDragged(e)\n    }\n    public override mouseUpOn(comp: Drawable, e: MouseEvent | TouchEvent) {\n        const shouldTakeSnapshot = comp.mouseUp(e)\n        this.editor.wireMgr.tryCancelWire()\n        return shouldTakeSnapshot\n    }\n    public override mouseClickedOn(comp: Drawable, e: MouseEvent | TouchEvent) {\n        // console.log(\"mouseClickedOn %o\", comp)\n        return comp.mouseClicked(e)\n    }\n    public override mouseDoubleClickedOn(comp: Drawable, e: MouseEvent | TouchEvent) {\n        return comp.mouseDoubleClicked(e)\n    }\n    public override contextMenuOn(comp: Drawable, e: MouseEvent | TouchEvent) {\n        // console.log(\"contextMenuOn: %o\", comp)\n\n        const hideMenu = () => {\n            if (this._openedContextMenu !== null) {\n                this._openedContextMenu.classList.remove('show-menu')\n                this._openedContextMenu.innerHTML = \"\"\n                this._openedContextMenu = null\n            }\n        }\n\n        hideMenu()\n\n        const contextMenuData = comp.makeContextMenu()\n        // console.log(\"asking for menu: %o got: %o\", comp, contextMenuData)\n        if (isDefined(contextMenuData)) {\n\n            // console.log(\"setting triggered\")\n            const currentMouseDownData = this.editor.cursorMovementMgr.currentMouseDownData\n            if (isNotNull(currentMouseDownData)) {\n                currentMouseDownData.triggeredContextMenu = true\n            }\n\n            // console.log(\"building menu for %o\", contextMenuData)\n\n            const defToElem = (item: ContextMenuItem): HTMLElement => {\n                function mkButton(spec: { icon?: IconName | undefined, caption: Modifier }, danger: boolean) {\n                    return button(type(\"button\"), cls(`menu-btn${(danger ? \" danger\" : \"\")}`),\n                        isUndefined(spec.icon)\n                            ? spec.caption\n                            : mods(makeIcon(spec.icon), span(cls(\"menu-text\"), spec.caption))\n                    )\n                }\n\n                switch (item._tag) {\n                    case 'sep':\n                        return li(cls(\"menu-separator\")).render()\n                    case 'text':\n                        return li(cls(\"menu-item-static\"), item.caption).render()\n                    case \"item\": {\n                        const but = mkButton(item, item.danger ?? false).render()\n                        but.addEventListener(\"click\", this.editor.wrapHandler((itemEvent: MouseEvent | TouchEvent) => {\n                            item.action(itemEvent, e)\n                        }))\n                        return li(cls(\"menu-item\"), but).render()\n                    }\n                    case \"submenu\": {\n                        return li(cls(\"menu-item submenu\"),\n                            mkButton(item, false),\n                            ul(cls(\"menu\"),\n                                ...item.items.map(defToElem)\n                            )\n                        ).render()\n                    }\n                }\n            }\n\n            const items = contextMenuData.map(defToElem)\n\n            const mainContextMenu = this.editor.html.mainContextMenu\n            applyModifiersTo(mainContextMenu, items)\n            const em = e as MouseEvent\n            mainContextMenu.style.left = em.pageX + 'px'\n            mainContextMenu.style.top = em.pageY + 'px'\n            mainContextMenu.classList.add(\"show-menu\")\n            this._openedContextMenu = mainContextMenu\n\n            const clickHandler = () => {\n                hideMenu()\n                document.removeEventListener(\"click\", clickHandler)\n            }\n\n            setTimeout(() => {\n                document.addEventListener(\"click\", clickHandler, false)\n            }, 200)\n\n            return true // handled\n        }\n        return false // unhandled\n    }\n\n\n    public override mouseDownOnBackground(e: MouseEvent | TouchEvent) {\n        const editor = this.editor\n        const cursorMovementMgr = editor.cursorMovementMgr\n        const currentSelection = cursorMovementMgr.currentSelection\n        if (isDefined(currentSelection)) {\n            const allowSelection = editor.mode >= Mode.CONNECT\n            if (e.shiftKey && allowSelection) {\n                if (isDefined(currentSelection.currentlyDrawnRect)) {\n                    console.log(\"unexpected defined current rect when about to begin a new one\")\n                }\n                // augment selection\n                const [left, top] = editor.offsetXY(e)\n                const rect = new DOMRect(left, top, 1, 1)\n                currentSelection.currentlyDrawnRect = rect\n            } else {\n                // clear selection\n                cursorMovementMgr.currentSelection = undefined\n            }\n            editor.redrawMgr.addReason(\"selection rect changed\", null)\n        }\n    }\n    public override mouseDraggedOnBackground(e: MouseEvent | TouchEvent) {\n        // TODO smarter selection handling:\n        // - if shift key is pressed, add to selection, also individual component\n        // - shift-click or drag inverses selection state\n        const editor = this.editor\n        const allowSelection = editor.mode >= Mode.CONNECT\n        if (allowSelection) {\n            const cursorMovementMgr = editor.cursorMovementMgr\n            const currentSelection = cursorMovementMgr.currentSelection\n            const [x, y] = editor.offsetXY(e)\n            if (isUndefined(currentSelection)) {\n                const rect = new DOMRect(x, y, 1, 1)\n                cursorMovementMgr.currentSelection = new EditorSelection(rect)\n            } else {\n                const rect = currentSelection.currentlyDrawnRect\n                if (isUndefined(rect)) {\n                    console.log(\"trying to update a selection rect that is not defined\")\n                } else {\n                    rect.width = x - rect.x\n                    rect.height = y - rect.y\n                    editor.redrawMgr.addReason(\"selection rect changed\", null)\n                }\n            }\n        }\n    }\n\n    public override mouseUpOnBackground(__e: MouseEvent | TouchEvent) {\n        const editor = this.editor\n        editor.wireMgr.tryCancelWire()\n\n        const cursorMovementMgr = editor.cursorMovementMgr\n        const currentSelection = cursorMovementMgr.currentSelection\n        if (isDefined(currentSelection)) {\n            currentSelection.finishCurrentRect(this.editor)\n            editor.redrawMgr.addReason(\"selection rect changed\", null)\n        }\n    }\n}\n\nclass DeleteHandlers extends ToolHandlers {\n\n    public constructor(editor: LogicEditor) {\n        super(editor)\n    }\n\n    public override mouseClickedOn(comp: Drawable, __: MouseEvent) {\n        return this.editor.tryDeleteDrawable(comp)\n    }\n}\n\nclass MoveHandlers extends ToolHandlers {\n\n    public constructor(editor: LogicEditor) {\n        super(editor)\n    }\n\n    public override mouseDownOnBackground(e: MouseEvent) {\n        for (const comp of this.editor.components.all()) {\n            comp.mouseDown(e)\n        }\n        for (const wire of this.editor.wireMgr.wires) {\n            for (const waypoint of wire.waypoints) {\n                waypoint.mouseDown(e)\n            }\n        }\n    }\n    public override mouseDraggedOnBackground(e: MouseEvent) {\n        for (const comp of this.editor.components.all()) {\n            comp.mouseDragged(e)\n        }\n        for (const wire of this.editor.wireMgr.wires) {\n            for (const waypoint of wire.waypoints) {\n                waypoint.mouseDragged(e)\n            }\n        }\n    }\n    public override mouseUpOnBackground(e: MouseEvent) {\n        for (const comp of this.editor.components.all()) {\n            comp.mouseUp(e)\n        }\n        for (const wire of this.editor.wireMgr.wires) {\n            for (const waypoint of wire.waypoints) {\n                waypoint.mouseUp(e)\n            }\n        }\n    }\n}\n", "import * as t from \"io-ts\"\nimport { GateDef } from \"./components/Gate\"\nimport { ICDef } from \"./components/IC\"\nimport { InputDef } from \"./components/Inputs\"\nimport { OutputDef } from \"./components/Outputs\"\nimport { Wire } from \"./components/Wire\"\nimport { EditorOptions } from \"./LogicEditor\"\nimport { PartialWhereUndefinedRecursively } from \"./utils\"\n\nconst Circuit = t.partial({\n    in: t.array(InputDef),\n    out: t.array(OutputDef),\n    gates: t.array(GateDef),\n    components: t.array(ICDef),\n    wires: t.array(Wire.Repr),\n})\ntype Circuit = { v: 4, opts?: Partial<EditorOptions> } & PartialWhereUndefinedRecursively<t.TypeOf<typeof Circuit>>\n\nfunction assertCircuits<T extends Record<string, Circuit>>(v: T): T {\n    // remove prototype to have a nice, clean completion in the console\n    return Object.assign(Object.create(null), v)\n}\n\nexport const gallery = assertCircuits({\n    CharacterComparator: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [50, 130], \"id\": 0, \"val\": 1 },\n            { \"pos\": [50, 160], \"id\": 1, \"val\": 1 },\n            { \"pos\": [50, 190], \"id\": 2, \"val\": 1 },\n            { \"pos\": [50, 220], \"id\": 3, \"val\": 0 },\n            { \"pos\": [50, 250], \"id\": 4, \"val\": 1 },\n            { \"pos\": [50, 280], \"id\": 13, \"val\": 0 },\n            { \"pos\": [50, 310], \"id\": 14, \"val\": 1 },\n            { \"pos\": [50, 360], \"id\": 15, \"val\": 1 },\n            { \"pos\": [50, 390], \"id\": 16, \"val\": 0 },\n            { \"pos\": [50, 420], \"id\": 17, \"val\": 1 },\n            { \"pos\": [50, 450], \"id\": 18, \"val\": 0 },\n            { \"pos\": [50, 480], \"id\": 19, \"val\": 1 },\n            { \"pos\": [50, 510], \"id\": 20, \"val\": 0 },\n            { \"pos\": [50, 540], \"id\": 21, \"val\": 1 },\n        ],\n        \"out\": [\n            { \"pos\": [870, 310], \"id\": 5 },\n            { \"type\": \"ascii\", \"pos\": [180, 60], \"id\": [6, 7, 8, 9, 10, 11, 12] },\n            { \"type\": \"ascii\", \"pos\": [180, 620], \"id\": [22, 23, 24, 25, 26, 27, 28] },\n        ],\n        \"gates\": [\n            { \"type\": \"XOR\", \"pos\": [360, 140], \"in\": [29, 30], \"out\": 31 },\n            { \"type\": \"XOR\", \"pos\": [360, 200], \"in\": [32, 33], \"out\": 34 },\n            { \"type\": \"XOR\", \"pos\": [360, 260], \"in\": [35, 36], \"out\": 37 },\n            { \"type\": \"XOR\", \"pos\": [360, 320], \"in\": [38, 39], \"out\": 40 },\n            { \"type\": \"XOR\", \"pos\": [360, 380], \"in\": [41, 42], \"out\": 43 },\n            { \"type\": \"XOR\", \"pos\": [360, 440], \"in\": [44, 45], \"out\": 46 },\n            { \"type\": \"XOR\", \"pos\": [360, 500], \"in\": [47, 48], \"out\": 49 },\n            { \"type\": \"OR\", \"pos\": [470, 170], \"in\": [68, 69], \"out\": 70 },\n            { \"type\": \"OR\", \"pos\": [500, 280], \"in\": [71, 72], \"out\": 73 },\n            { \"type\": \"OR\", \"pos\": [490, 410], \"in\": [74, 75], \"out\": 76 },\n            { \"type\": \"OR\", \"pos\": [630, 250], \"in\": [77, 78], \"out\": 79 },\n            { \"type\": \"OR\", \"pos\": [630, 410], \"in\": [80, 81], \"out\": 82 },\n            { \"type\": \"OR\", \"pos\": [730, 310], \"in\": [83, 84], \"out\": 85 },\n            { \"type\": \"NOT\", \"pos\": [800, 310], \"in\": 50, \"out\": 51 },\n        ],\n        \"wires\": [\n            [0, 6],\n            [1, 7],\n            [2, 8],\n            [3, 9],\n            [4, 10],\n            [13, 11],\n            [14, 12],\n            [15, 22],\n            [16, 23],\n            [17, 24],\n            [18, 25],\n            [19, 26],\n            [20, 27],\n            [21, 28],\n            [0, 29],\n            [15, 30],\n            [79, 83],\n            [82, 84],\n            [31, 68],\n            [34, 69],\n            [37, 71],\n            [40, 72],\n            [43, 74],\n            [46, 75],\n            [49, 81],\n            [76, 80],\n            [73, 78],\n            [70, 77],\n            [85, 50],\n            [51, 5],\n            [1, 32],\n            [16, 33],\n            [2, 35],\n            [17, 36],\n            [18, 39],\n            [3, 38],\n            [4, 41],\n            [19, 42],\n            [13, 44],\n            [20, 45],\n            [21, 48],\n            [14, 47],\n        ],\n    },\n    Counters: {\n        \"v\": 4,\n        \"in\": [\n            { \"type\": \"clock\", \"pos\": [70, 40], \"id\": 0, \"name\": \"bit 0\", \"period\": 2000, \"phase\": 1000, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [70, 80], \"id\": 10, \"name\": \"bit 1\", \"period\": 4000, \"phase\": 2000, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [70, 120], \"id\": 23, \"name\": \"bit 2\", \"period\": 8000, \"phase\": 4000, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [70, 160], \"id\": 24, \"name\": \"bit 3\", \"period\": 16000, \"phase\": 8000, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [430, 30], \"id\": 5, \"period\": 500, \"phase\": 250, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [430, 70], \"id\": 6, \"period\": 1000, \"phase\": 500, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [430, 110], \"id\": 7, \"period\": 2000, \"phase\": 1000, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [430, 150], \"id\": 8, \"period\": 4000, \"phase\": 2000, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [430, 190], \"id\": 9, \"period\": 8000, \"phase\": 4000, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [430, 230], \"id\": 11, \"period\": 16000, \"phase\": 8000, \"showLabel\": false },\n            { \"type\": \"clock\", \"pos\": [430, 270], \"id\": 12, \"period\": 32000, \"phase\": 16000, \"showLabel\": false },\n        ],\n        \"out\": [\n            { \"type\": \"nibble-display\", \"pos\": [240, 90], \"id\": [1, 2, 3, 4] },\n            { \"type\": \"ascii\", \"pos\": [580, 150], \"id\": [13, 14, 15, 16, 17, 18, 19] },\n        ],\n        \"wires\": [\n            [0, 1], [24, 4], [23, 3], [10, 2], [5, 13],\n            [6, 14], [7, 15], [8, 16], [9, 17], [11, 18], [12, 19],\n        ],\n    },\n    AllGates: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [40, 320], \"id\": 0, \"val\": 0 },\n            { \"pos\": [40, 490], \"id\": 1, \"val\": 0 },\n        ],\n        \"out\": [\n            { \"pos\": [400, 30], \"id\": 48 },\n            { \"pos\": [400, 80], \"id\": 49 },\n            { \"pos\": [400, 140], \"id\": 50 },\n            { \"pos\": [400, 260], \"id\": 51 },\n            { \"pos\": [400, 380], \"id\": 52 },\n            { \"pos\": [400, 200], \"id\": 53 },\n            { \"pos\": [400, 320], \"id\": 54 },\n            { \"pos\": [400, 440], \"id\": 55 },\n            { \"pos\": [400, 560], \"id\": 56 },\n            { \"pos\": [400, 680], \"id\": 57 },\n            { \"pos\": [400, 500], \"id\": 58 },\n            { \"pos\": [400, 620], \"id\": 59 },\n            { \"pos\": [400, 740], \"id\": 60 },\n            { \"pos\": [400, 860], \"id\": 61 },\n            { \"pos\": [400, 800], \"id\": 62 },\n            { \"pos\": [400, 920], \"id\": 63 },\n        ],\n        \"gates\": [\n            { \"type\": \"NOT\", \"pos\": [290, 80], \"in\": 2, \"out\": 3 },\n            { \"type\": \"BUF\", \"pos\": [290, 30], \"in\": 4, \"out\": 5 },\n            { \"type\": \"AND\", \"pos\": [290, 140], \"in\": [6, 7], \"out\": 8 },\n            { \"type\": \"OR\", \"pos\": [290, 260], \"in\": [9, 10], \"out\": 11 },\n            { \"type\": \"XOR\", \"pos\": [290, 380], \"in\": [12, 13], \"out\": 14 },\n            { \"type\": \"NAND\", \"pos\": [290, 200], \"in\": [15, 16], \"out\": 17 },\n            { \"type\": \"NOR\", \"pos\": [290, 320], \"in\": [18, 19], \"out\": 20 },\n            { \"type\": \"XNOR\", \"pos\": [290, 440], \"in\": [21, 22], \"out\": 23 },\n            { \"type\": \"IMPLY\", \"pos\": [290, 560], \"in\": [24, 25], \"out\": 26 },\n            { \"type\": \"RIMPLY\", \"pos\": [290, 680], \"in\": [27, 28], \"out\": 29 },\n            { \"type\": \"NIMPLY\", \"pos\": [290, 500], \"in\": [30, 31], \"out\": 32 },\n            { \"type\": \"RNIMPLY\", \"pos\": [290, 620], \"in\": [33, 34], \"out\": 35 },\n            { \"type\": \"TXA\", \"pos\": [290, 740], \"in\": [36, 37], \"out\": 38 },\n            { \"type\": \"TXB\", \"pos\": [290, 860], \"in\": [39, 40], \"out\": 41 },\n            { \"type\": \"TXNA\", \"pos\": [290, 800], \"in\": [42, 43], \"out\": 44 },\n            { \"type\": \"TXNB\", \"pos\": [290, 920], \"in\": [45, 46], \"out\": 47 },\n        ],\n        \"wires\": [\n            [0, 4],\n            [0, 2],\n            [0, 6],\n            [0, 9],\n            [0, 12],\n            [0, 15],\n            [0, 18],\n            [0, 21],\n            [0, 24],\n            [0, 27],\n            [0, 30],\n            [0, 33],\n            [0, 36],\n            [0, 39],\n            [0, 42],\n            [0, 45],\n            [1, 7],\n            [1, 10],\n            [1, 13],\n            [1, 16],\n            [1, 19],\n            [1, 22],\n            [1, 25],\n            [1, 28],\n            [1, 31],\n            [1, 34],\n            [1, 37],\n            [1, 40],\n            [1, 43],\n            [1, 46],\n            [5, 48],\n            [3, 49],\n            [8, 50],\n            [11, 51],\n            [14, 52],\n            [17, 53],\n            [20, 54],\n            [23, 55],\n            [26, 56],\n            [29, 57],\n            [32, 58],\n            [35, 59],\n            [38, 60],\n            [41, 61],\n            [44, 62],\n            [47, 63],\n        ],\n    },\n    SevenSegmentDisplay: {\n        \"v\": 4,\n        \"opts\": {\n            \"propagationDelay\": 20,\n        },\n        \"in\": [\n            { type: \"clock\", \"pos\": [90, 60], \"orient\": \"s\", \"id\": 21, \"period\": 16000, \"phase\": 8000 },\n            { type: \"clock\", \"pos\": [130, 60], \"orient\": \"s\", \"id\": 22, \"period\": 8000, \"phase\": 4000 },\n            { type: \"clock\", \"pos\": [170, 60], \"orient\": \"s\", \"id\": 23, \"period\": 4000, \"phase\": 2000 },\n            { type: \"clock\", \"pos\": [210, 60], \"orient\": \"s\", \"id\": 24, \"period\": 2000, \"phase\": 1000 },\n        ],\n        \"out\": [\n            { \"type\": \"nibble-display\", \"pos\": [1320, 140], \"id\": [132, 133, 134, 135], \"radix\": 16 },\n            { \"type\": \"bar\", \"pos\": [1330, 310], \"id\": 117, \"display\": \"h\" },\n            { \"type\": \"bar\", \"pos\": [1270, 490], \"id\": 118, \"display\": \"v\" },\n            { \"type\": \"bar\", \"pos\": [1390, 370], \"id\": 119, \"display\": \"v\" },\n            { \"type\": \"bar\", \"pos\": [1270, 370], \"id\": 120, \"display\": \"v\" },\n            { \"type\": \"bar\", \"pos\": [1330, 430], \"id\": 121, \"display\": \"h\" },\n            { \"type\": \"bar\", \"pos\": [1390, 490], \"id\": 122, \"display\": \"v\" },\n            { \"type\": \"bar\", \"pos\": [1330, 550], \"id\": 123, \"display\": \"h\" },\n        ],\n        \"gates\": [\n            { \"type\": \"NOT\", \"pos\": [1170, 310], \"in\": 103, \"out\": 104 },\n            { \"type\": \"NOT\", \"pos\": [1170, 350], \"in\": 105, \"out\": 106 },\n            { \"type\": \"NOT\", \"pos\": [1170, 390], \"in\": 107, \"out\": 108 },\n            { \"type\": \"NOT\", \"pos\": [1170, 430], \"in\": 109, \"out\": 110 },\n            { \"type\": \"NOT\", \"pos\": [1170, 550], \"in\": 111, \"out\": 112 },\n            { \"type\": \"NOT\", \"pos\": [1170, 510], \"in\": 113, \"out\": 114 },\n            { \"type\": \"NOT\", \"pos\": [1170, 470], \"in\": 115, \"out\": 116 },\n            { \"type\": \"XOR\", \"pos\": [210, 180], \"in\": [0, 1], \"out\": 2 },\n            { \"type\": \"AND\", \"pos\": [220, 340], \"in\": [3, 4], \"out\": 5 },\n            { \"type\": \"XOR\", \"pos\": [200, 420], \"in\": [6, 7], \"out\": 8 },\n            { \"type\": \"XOR\", \"pos\": [330, 220], \"in\": [9, 10], \"out\": 11 },\n            { \"type\": \"XOR\", \"pos\": [340, 280], \"in\": [12, 13], \"out\": 14 },\n            { \"type\": \"OR\", \"pos\": [320, 480], \"in\": [15, 16], \"out\": 17 },\n            { \"type\": \"NOR\", \"pos\": [440, 220], \"in\": [18, 19], \"out\": 20 },\n            { \"type\": \"XOR\", \"pos\": [450, 290], \"in\": [25, 26], \"out\": 27 },\n            { \"type\": \"NOR\", \"pos\": [430, 450], \"in\": [31, 32], \"out\": 33 },\n            { \"type\": \"NOR\", \"pos\": [560, 410], \"in\": [34, 35], \"out\": 36 },\n            { \"type\": \"NOR\", \"pos\": [600, 190], \"in\": [37, 38], \"out\": 39 },\n            { \"type\": \"NOR\", \"pos\": [540, 360], \"in\": [40, 41], \"out\": 42 },\n            { \"type\": \"XOR\", \"pos\": [650, 320], \"in\": [43, 44], \"out\": 45 },\n            { \"type\": \"OR\", \"pos\": [670, 430], \"in\": [46, 47], \"out\": 48 },\n            { \"type\": \"XOR\", \"pos\": [770, 490], \"in\": [49, 50], \"out\": 51 },\n            { \"type\": \"NOR\", \"pos\": [770, 540], \"in\": [52, 53], \"out\": 54 },\n            { \"type\": \"NOR\", \"pos\": [800, 390], \"in\": [55, 56], \"out\": 57 },\n            { \"type\": \"OR\", \"pos\": [960, 250], \"in\": [58, 59], \"out\": 60 },\n            { \"type\": \"NOR\", \"pos\": [940, 310], \"in\": [61, 62], \"out\": 63 },\n            { \"type\": \"AND\", \"pos\": [1050, 270], \"in\": [64, 65], \"out\": 66 },\n            { \"type\": \"AND\", \"pos\": [950, 380], \"in\": [67, 68], \"out\": 69 },\n            { \"type\": \"AND\", \"pos\": [950, 440], \"in\": [70, 71], \"out\": 72 },\n            { \"type\": \"OR\", \"pos\": [1030, 410], \"in\": [73, 74], \"out\": 75 },\n            { \"type\": \"XOR\", \"pos\": [1030, 520], \"in\": [76, 77], \"out\": 78 },\n        ],\n        \"wires\": [\n            [104, 117],\n            [106, 119],\n            [108, 122],\n            [110, 123],\n            [112, 121],\n            [114, 120],\n            [116, 118],\n            [21, 135],\n            [22, 134],\n            [23, 133],\n            [24, 132],\n            [21, 0],\n            [23, 1],\n            [24, 3],\n            [22, 4],\n            [24, 6],\n            [21, 7],\n            [2, 9],\n            [22, 10],\n            [23, 12],\n            [5, 13],\n            [5, 15],\n            [8, 16],\n            [11, 18],\n            [14, 19],\n            [11, 25],\n            [8, 26],\n            [5, 32],\n            [14, 31],\n            [33, 34],\n            [21, 35],\n            [20, 37],\n            [2, 38],\n            [27, 40],\n            [8, 41],\n            [42, 43],\n            [21, 44],\n            [39, 46],\n            [17, 47],\n            [48, 49],\n            [21, 50],\n            [48, 52],\n            [33, 53],\n            [36, 56],\n            [45, 55],\n            [57, 103],\n            [39, 58],\n            [24, 59],\n            [60, 64],\n            [27, 65],\n            [66, 109],\n            [39, 61],\n            [45, 62],\n            [63, 113],\n            [69, 73],\n            [72, 74],\n            [75, 105],\n            [39, 67],\n            [24, 68],\n            [45, 70],\n            [22, 71],\n            [51, 115],\n            [20, 111],\n            [78, 107],\n            [72, 76],\n            [54, 77],\n        ],\n    },\n    SevenSegmentBCDDisplay: {\n        \"v\": 4,\n        \"in\": [\n            { \"type\": \"nibble\", \"pos\": [50, 80], \"id\": [0, 1, 2, 3], \"val\": [0, 1, 0, 1] },\n        ],\n        \"out\": [\n            { \"type\": \"bar\", \"pos\": [560, 100], \"id\": 4, \"display\": \"h\" },\n            { \"type\": \"bar\", \"pos\": [620, 280], \"id\": 5, \"display\": \"v\" },\n            { \"type\": \"bar\", \"pos\": [500, 160], \"id\": 6, \"display\": \"v\" },\n            { \"type\": \"bar\", \"pos\": [560, 220], \"id\": 7, \"display\": \"h\" },\n            { \"type\": \"bar\", \"pos\": [560, 340], \"id\": 8, \"display\": \"h\" },\n            { \"type\": \"bar\", \"pos\": [500, 280], \"id\": 9, \"display\": \"v\" },\n            { \"type\": \"bar\", \"pos\": [620, 160], \"id\": 10, \"display\": \"v\" },\n            { \"type\": \"bar\", \"pos\": [420, 160], \"id\": 50, \"display\": \"v\" },\n            { \"type\": \"bar\", \"pos\": [420, 280], \"id\": 51, \"display\": \"v\" },\n            { \"type\": \"nibble-display\", \"pos\": [170, 250], \"id\": [11, 23, 24, 25] },\n        ],\n        \"components\": [\n            { \"type\": \"decoder-7seg\", \"pos\": [280, 60], \"in\": [12, 13, 14, 15], \"out\": [16, 17, 18, 19, 20, 21, 22] },\n            { \"type\": \"decoder-bcd4\", \"pos\": [180, 80], \"in\": [26, 27, 28, 29], \"out\": [30, 31, 32, 33, 34] },\n        ],\n        \"wires\": [\n            [16, 4], [17, 10], [18, 5], [19, 8], [20, 9], [21, 6], [22, 7], [0, 11],\n            [1, 23], [2, 24], [3, 25], [0, 26], [1, 27], [2, 28], [3, 29], [30, 12],\n            [31, 13], [32, 14], [33, 15], [34, 50], [34, 51],\n        ],\n    },\n    SixteenVsSevenSegmentDisplays: {\n        \"v\": 4,\n        \"in\": [\n            { \"type\": \"nibble\", \"pos\": [50, 90], \"id\": [74, 75, 76, 77], \"val\": [1, 0, 0, 1] },\n            { \"type\": \"nibble\", \"pos\": [50, 170], \"id\": [78, 79, 80, 81], \"val\": [1, 1, 0, 0] },\n        ],\n        \"out\": [\n            { \"type\": \"16seg\", \"pos\": [440, 170], \"id\": [57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73] },\n            { \"type\": \"ascii\", \"pos\": [230, 60], \"id\": [82, 83, 84, 85, 86, 87, 88], \"additionalReprRadix\": 10 },\n            { \"type\": \"7seg\", \"pos\": [440, 330], \"id\": [93, 94, 95, 96, 97, 98, 99, 100] },\n        ],\n        \"gates\": [{ \"type\": \"OR\", \"pos\": [330, 250], \"in\": [90, 91], \"out\": 92 }],\n        \"components\": [\n            { \"type\": \"decoder-16seg\", \"pos\": [230, 170], \"in\": [34, 35, 36, 37, 38, 39, 40], \"out\": [41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 89] },\n            { \"type\": \"decoder-7seg\", \"pos\": [230, 320], \"in\": [101, 102, 103, 104], \"out\": [105, 106, 107, 108, 109, 110, 111] },\n        ],\n        \"wires\": [\n            [74, 82], [75, 83], [76, 84], [77, 85], [78, 86], [79, 87], [80, 88], [41, 57], [42, 58],\n            [43, 59], [44, 60], [45, 61], [46, 62], [47, 63], [48, 64], [49, 65], [50, 66], [51, 67],\n            [52, 68], [53, 69], [54, 70], [55, 71], [56, 72], [74, 34], [75, 35], [76, 36], [77, 37],\n            [78, 38], [79, 39], [80, 40], [89, 90], [92, 73], [81, 91], [105, 93], [106, 94], [107, 95],\n            [108, 96], [109, 97], [110, 98], [111, 99], [74, 101], [75, 102], [76, 103], [77, 104],\n            [81, 100, { \"via\": [[200, 370]] }],\n        ],\n    },\n    NibbleAdder: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [100, 40], \"orient\": \"s\", \"id\": 3, \"name\": \"A3\", \"val\": 0 },\n            { \"pos\": [200, 40], \"orient\": \"s\", \"id\": 0, \"name\": \"A2\", \"val\": 0 },\n            { \"pos\": [300, 40], \"orient\": \"s\", \"id\": 1, \"name\": \"A1\", \"val\": 0 },\n            { \"pos\": [400, 40], \"orient\": \"s\", \"id\": 2, \"name\": \"A0\", \"val\": 0 },\n            { \"pos\": [140, 180], \"orient\": \"s\", \"id\": 15, \"name\": \"B3\", \"val\": 0 },\n            { \"pos\": [240, 180], \"orient\": \"s\", \"id\": 14, \"name\": \"B2\", \"val\": 0 },\n            { \"pos\": [340, 180], \"orient\": \"s\", \"id\": 13, \"name\": \"B1\", \"val\": 0 },\n            { \"pos\": [440, 180], \"orient\": \"s\", \"id\": 12, \"name\": \"B0\", \"val\": 0 },\n        ],\n        \"out\": [\n            { \"pos\": [30, 450], \"orient\": \"s\", \"id\": 37, \"name\": \"S4\" },\n            { \"pos\": [120, 450], \"orient\": \"s\", \"id\": 36, \"name\": \"S3\" },\n            { \"pos\": [220, 450], \"orient\": \"s\", \"id\": 38, \"name\": \"S2\" },\n            { \"pos\": [320, 450], \"orient\": \"s\", \"id\": 39, \"name\": \"S1\" },\n            { \"pos\": [420, 450], \"orient\": \"s\", \"id\": 40, \"name\": \"S0\" },\n            { \"type\": \"nibble-display\", \"pos\": [530, 100], \"id\": [4, 5, 6, 7] },\n            { \"type\": \"nibble-display\", \"pos\": [530, 240], \"id\": [8, 9, 10, 11] },\n            { \"type\": \"nibble-display\", \"pos\": [530, 390], \"id\": [41, 42, 43, 44] },\n        ],\n        \"components\": [\n            { \"type\": \"adder\", \"pos\": [420, 320], \"in\": [16, 17, 18], \"out\": [19, 20] },\n            { \"type\": \"adder\", \"pos\": [320, 320], \"in\": [21, 22, 23], \"out\": [24, 25] },\n            { \"type\": \"adder\", \"pos\": [220, 320], \"in\": [26, 27, 28], \"out\": [29, 30] },\n            { \"type\": \"adder\", \"pos\": [120, 320], \"in\": [31, 32, 33], \"out\": [34, 35] },\n        ],\n        \"wires\": [\n            [12, 8],\n            [13, 9],\n            [14, 10],\n            [15, 11],\n            [2, 4],\n            [1, 5],\n            [0, 6],\n            [3, 7],\n            [20, 23],\n            [25, 28],\n            [30, 33],\n            [2, 16],\n            [12, 17],\n            [1, 21],\n            [13, 22],\n            [0, 26],\n            [14, 27],\n            [3, 31],\n            [15, 32],\n            [19, 41],\n            [24, 42],\n            [29, 43],\n            [34, 44],\n            [35, 37],\n            [34, 36],\n            [29, 38],\n            [24, 39],\n            [19, 40],\n        ],\n    },\n    ALU: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [290, 60], \"orient\": \"s\", \"id\": 16, \"name\": \"Op1\", \"val\": 0 },\n            { \"pos\": [330, 60], \"orient\": \"s\", \"id\": 17, \"name\": \"Op0\", \"val\": 0 },\n            { \"pos\": [50, 140], \"id\": 18, \"val\": 0 },\n            { \"pos\": [50, 160], \"id\": 19, \"name\": \"A\", \"val\": 0 },\n            { \"pos\": [50, 180], \"id\": 20, \"val\": 0 },\n            { \"pos\": [50, 200], \"id\": 21, \"val\": 0 },\n            { \"pos\": [50, 240], \"id\": 26, \"val\": 0 },\n            { \"pos\": [50, 260], \"id\": 27, \"name\": \"B\", \"val\": 0 },\n            { \"pos\": [50, 280], \"id\": 28, \"val\": 0 },\n            { \"pos\": [50, 300], \"id\": 29, \"val\": 0 },\n        ],\n        \"out\": [\n            { \"pos\": [420, 320], \"id\": 38, \"name\": \"Zero\" },\n            { \"pos\": [420, 350], \"id\": 39, \"name\": \"oVerflow\" },\n            { \"type\": \"nibble-display\", \"pos\": [110, 60], \"orient\": \"n\", \"id\": [22, 23, 24, 25], \"name\": \"A (non sign\u00E9)\" },\n            { \"type\": \"nibble-display\", \"pos\": [110, 350], \"orient\": \"s\", \"id\": [30, 31, 32, 33], \"name\": \"B (non sign\u00E9)\" },\n            { \"type\": \"nibble-display\", \"pos\": [420, 250], \"id\": [34, 35, 36, 37], \"name\": \"Y (sign\u00E9)\", \"radix\": -10 },\n            { \"type\": \"nibble-display\", \"pos\": [420, 150], \"id\": [40, 41, 42, 43], \"name\": \"Y (non sign\u00E9)\" },\n            { \"type\": \"nibble-display\", \"pos\": [210, 60], \"orient\": \"n\", \"id\": [44, 45, 46, 47], \"name\": \"A (sign\u00E9)\", \"radix\": -10 },\n            { \"type\": \"nibble-display\", \"pos\": [210, 350], \"orient\": \"s\", \"id\": [48, 49, 50, 51], \"name\": \"B (sign\u00E9)\", \"radix\": -10 },\n        ],\n        \"components\": [\n            { \"type\": \"alu\", \"pos\": [280, 220], \"in\": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], \"out\": [10, 11, 12, 13, 14, 15] },\n        ],\n        \"wires\": [\n            [16, 9],\n            [17, 8],\n            [21, 3],\n            [20, 2],\n            [19, 1],\n            [18, 0],\n            [18, 22],\n            [19, 23],\n            [20, 24],\n            [21, 25],\n            [26, 4],\n            [27, 5],\n            [28, 6],\n            [29, 7],\n            [26, 30],\n            [27, 31],\n            [28, 32],\n            [29, 33],\n            [10, 34],\n            [11, 35],\n            [12, 36],\n            [13, 37],\n            [15, 38],\n            [14, 39],\n            [10, 40],\n            [11, 41],\n            [12, 42],\n            [13, 43],\n            [18, 44],\n            [19, 45],\n            [20, 46],\n            [21, 47],\n            [26, 48],\n            [27, 49],\n            [28, 50],\n            [29, 51],\n        ],\n    },\n\n    MiniAlu: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [340, 40], \"orient\": \"s\", \"id\": 10, \"val\": 1 },\n            { \"pos\": [470, 40], \"orient\": \"s\", \"id\": 11, \"val\": 1 },\n            { \"pos\": [370, 180], \"orient\": \"s\", \"id\": 12, \"val\": 0 },\n            { \"pos\": [500, 180], \"orient\": \"s\", \"id\": 13, \"val\": 1 },\n            { \"pos\": [80, 40], \"orient\": \"s\", \"id\": 26, \"val\": 0 },\n            { \"pos\": [210, 40], \"orient\": \"s\", \"id\": 27, \"val\": 0 },\n            { \"pos\": [110, 180], \"orient\": \"s\", \"id\": 28, \"val\": 0 },\n            { \"pos\": [240, 180], \"orient\": \"s\", \"id\": 34, \"val\": 0 },\n            { \"pos\": [600, 370], \"orient\": \"w\", \"id\": 98, \"name\": \"Add/Sub\", \"val\": 0 },\n        ],\n        \"out\": [\n            { \"pos\": [600, 690], \"id\": 49, \"name\": \"V\" },\n            { \"type\": \"nibble-display\", \"pos\": [600, 120], \"id\": [18, 19, 20, 21], \"name\": \"A\" },\n            { \"type\": \"nibble-display\", \"pos\": [600, 260], \"id\": [22, 23, 24, 25], \"name\": \"B\" },\n            { \"type\": \"nibble-display\", \"pos\": [600, 620], \"id\": [45, 46, 47, 48], \"name\": \"S\" },\n        ],\n        \"gates\": [\n            { \"type\": \"XOR\", \"pos\": [120, 450], \"orient\": \"s\", \"in\": [86, 87], \"out\": 88 },\n            { \"type\": \"XOR\", \"pos\": [250, 450], \"orient\": \"s\", \"in\": [89, 90], \"out\": 91 },\n            { \"type\": \"XOR\", \"pos\": [380, 450], \"orient\": \"s\", \"in\": [92, 93], \"out\": 94 },\n            { \"type\": \"XOR\", \"pos\": [510, 450], \"orient\": \"s\", \"in\": [95, 96], \"out\": 97 },\n        ],\n        \"components\": [\n            { \"type\": \"adder\", \"pos\": [490, 530], \"in\": [0, 1, 2], \"out\": [3, 4] },\n            { \"type\": \"adder\", \"pos\": [360, 530], \"in\": [5, 6, 7], \"out\": [8, 9] },\n            { \"type\": \"adder\", \"pos\": [230, 530], \"in\": [35, 36, 37], \"out\": [38, 39] },\n            { \"type\": \"adder\", \"pos\": [100, 530], \"in\": [40, 41, 42], \"out\": [43, 44] },\n        ],\n        \"wires\": [\n            [4, 7],\n            [11, 0],\n            [10, 5],\n            [11, 18],\n            [10, 19],\n            [13, 22],\n            [12, 23],\n            [9, 37],\n            [39, 42],\n            [3, 45],\n            [8, 46],\n            [38, 47],\n            [43, 48],\n            [44, 49, { \"via\": [[50, 690]] }],\n            [27, 35],\n            [26, 40],\n            [28, 87],\n            [34, 90],\n            [34, 24],\n            [28, 25],\n            [27, 20],\n            [26, 21],\n            [12, 93],\n            [13, 96],\n            [97, 1],\n            [94, 6],\n            [91, 36],\n            [88, 41],\n            [98, 2],\n            [98, 95],\n            [98, 92],\n            [98, 89],\n            [98, 86],\n        ],\n    },\n\n    LatchedAdder: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [340, 570], \"orient\": \"n\", \"id\": 40, \"name\": \"Reset\", \"val\": 0, \"isPushButton\": true },\n            { \"pos\": [40, 220], \"id\": 41, \"val\": 0 },\n            { \"pos\": [40, 250], \"id\": 42, \"val\": 0 },\n            { \"pos\": [40, 280], \"id\": 43, \"val\": 0 },\n            { \"pos\": [40, 310], \"id\": 44, \"val\": 0 },\n            { \"pos\": [280, 570], \"orient\": \"n\", \"id\": 45, \"name\": \"Horloge\", \"val\": 0, \"isPushButton\": true },\n            { \"pos\": [190, 400], \"orient\": \"n\", \"id\": 60, \"name\": \"Add./soustr.\", \"val\": 0 },\n        ],\n        \"out\": [\n            { \"pos\": [550, 380], \"id\": 61, \"name\": \"V\" },\n            { \"type\": \"nibble-display\", \"pos\": [100, 390], \"orient\": \"s\", \"id\": [50, 51, 52, 53], \"name\": \"B\" },\n            { \"type\": \"nibble-display\", \"pos\": [550, 230], \"id\": [46, 47, 48, 49], \"name\": \"Acc.\" },\n        ],\n        \"components\": [\n            { \"type\": \"alu\", \"pos\": [180, 210], \"in\": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], \"out\": [10, 11, 12, 13, 14, 15] },\n            { \"type\": \"flipflop-d\", \"pos\": [390, 100], \"in\": [17, 18, 19, 16], \"out\": [20, 21], \"state\": 0 },\n            { \"type\": \"flipflop-d\", \"pos\": [390, 200], \"in\": [23, 24, 25, 22], \"out\": [26, 27], \"state\": 0 },\n            { \"type\": \"flipflop-d\", \"pos\": [390, 300], \"in\": [29, 30, 31, 28], \"out\": [32, 33], \"state\": 0 },\n            { \"type\": \"flipflop-d\", \"pos\": [390, 400], \"in\": [35, 36, 37, 34], \"out\": [38, 39], \"state\": 0 },\n            { \"type\": \"flipflop-d\", \"pos\": [390, 500], \"in\": [55, 56, 57, 54], \"out\": [58, 59], \"state\": 0 },\n        ],\n        \"wires\": [\n            [10, 16, { \"via\": [[260, 80]] }],\n            [11, 22, { \"via\": [[260, 180]] }],\n            [12, 28, { \"via\": [[260, 280]] }],\n            [13, 34, { \"via\": [[260, 380]] }],\n            [40, 37, { \"via\": [[340, 440]] }],\n            [40, 31, { \"via\": [[340, 340, \"n\"]] }],\n            [40, 25, { \"via\": [[340, 240, \"n\"]] }],\n            [40, 19, { \"via\": [[340, 140, \"n\"]] }],\n            [20, 0, { \"via\": [[430, 80], [430, 50], [130, 50], [130, 130]] }],\n            [26, 1, { \"via\": [[440, 180], [440, 40], [120, 40], [120, 150]] }],\n            [32, 2, { \"via\": [[450, 280], [450, 30], [110, 30], [110, 170]] }],\n            [38, 3, { \"via\": [[460, 380, \"n\"], [460, 20], [100, 20], [100, 190]] }],\n            [41, 4],\n            [42, 5],\n            [43, 6],\n            [44, 7],\n            [45, 35, { \"via\": [[280, 420]] }],\n            [45, 29, { \"via\": [[280, 320, \"n\"]] }],\n            [45, 23, { \"via\": [[280, 220, \"n\"]] }],\n            [45, 17, { \"via\": [[280, 120, \"n\"]] }],\n            [41, 50],\n            [42, 51],\n            [43, 52],\n            [44, 53],\n            [20, 46, { \"via\": [[480, 80]] }],\n            [26, 47, { \"via\": [[480, 180]] }],\n            [32, 48, { \"via\": [[480, 280]] }],\n            [38, 49, { \"via\": [[480, 380]] }],\n            [60, 8, { \"via\": [[230, 320, \"n\"], [230, 110, \"n\"]] }],\n            [40, 57],\n            [45, 55, { \"via\": [[280, 520]] }],\n            [14, 54, { \"via\": [[260, 420, \"s\"], [260, 480]] }],\n            [58, 61],\n        ],\n    },\n\n    LatchedCounter: {\n        \"v\": 4,\n        \"components\": [\n            { \"type\": \"flipflop-d\", \"pos\": [170, 160], \"in\": [7, 8, 9, 6], \"out\": [10, 11], \"state\": 0, \"trigger\": \"falling\", \"showContent\": true },\n            { \"type\": \"flipflop-d\", \"pos\": [300, 160], \"in\": [15, 16, 17, 14], \"out\": [18, 19], \"state\": 0, \"trigger\": \"falling\", \"showContent\": true },\n            { \"type\": \"flipflop-d\", \"pos\": [440, 160], \"in\": [21, 22, 23, 20], \"out\": [24, 25], \"state\": 0, \"trigger\": \"falling\", \"showContent\": true },\n            { \"type\": \"flipflop-d\", \"pos\": [580, 160], \"in\": [35, 36, 37, 34], \"out\": [38, 39], \"state\": 0, \"trigger\": \"falling\", \"showContent\": true },\n        ],\n        \"in\": [\n            { \"pos\": [100, 180], \"id\": 12, \"name\": \"Horloge\", \"val\": 0, \"isPushButton\": true },\n            { \"pos\": [100, 240], \"id\": 41, \"name\": \"Reset\", \"val\": 0, \"isPushButton\": true },\n        ],\n        \"out\": [{ \"type\": \"nibble-display\", \"pos\": [660, 60], \"id\": [26, 27, 28, 29] }],\n        \"wires\": [\n            [12, 7],\n            [10, 15],\n            [18, 21],\n            [19, 14],\n            [11, 6],\n            [25, 20],\n            [10, 26, { \"via\": [[400, 30]] }],\n            [18, 27, { \"via\": [[520, 50]] }],\n            [24, 28],\n            [39, 34],\n            [24, 35],\n            [38, 29],\n            [41, 9],\n            [41, 17],\n            [41, 23],\n            [41, 37],\n        ],\n    },\n\n    Decoder2To4: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [60, 80], \"id\": 0, \"name\": \"S0\", \"val\": 0 },\n            { \"pos\": [60, 220], \"id\": 1, \"name\": \"S1\", \"val\": 0 },\n        ],\n        \"gates\": [\n            { \"type\": \"NOT\", \"pos\": [130, 50], \"in\": 2, \"out\": 3 },\n            { \"type\": \"NOT\", \"pos\": [130, 190], \"in\": 4, \"out\": 5 },\n            { \"type\": \"AND\", \"pos\": [280, 60], \"in\": [6, 7], \"out\": 8 },\n            { \"type\": \"AND\", \"pos\": [280, 120], \"in\": [9, 10], \"out\": 11 },\n            { \"type\": \"AND\", \"pos\": [280, 180], \"in\": [12, 13], \"out\": 14 },\n            { \"type\": \"AND\", \"pos\": [280, 240], \"in\": [15, 16], \"out\": 17 },\n            { \"type\": \"BUF\", \"pos\": [130, 110], \"in\": 22, \"out\": 23 },\n            { \"type\": \"BUF\", \"pos\": [130, 250], \"in\": 24, \"out\": 25 },\n        ],\n        \"out\": [\n            { \"pos\": [370, 60], \"id\": 18, \"name\": \"0\" },\n            { \"pos\": [370, 120], \"id\": 19, \"name\": \"1\" },\n            { \"pos\": [370, 180], \"id\": 20, \"name\": \"2\" },\n            { \"pos\": [370, 240], \"id\": 21, \"name\": \"3\" },\n        ],\n        \"wires\": [\n            [0, 2],\n            [1, 4],\n            [11, 19],\n            [17, 21],\n            [14, 20],\n            [8, 18],\n            [3, 6],\n            [5, 7],\n            [5, 10],\n            [3, 12],\n            [0, 22],\n            [1, 24],\n            [23, 9],\n            [23, 15],\n            [25, 13],\n            [25, 16],\n        ],\n    },\n\n    Decoder3To8: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [60, 130], \"id\": 26, \"name\": \"S0\", \"val\": 1 },\n            { \"pos\": [60, 290], \"id\": 27, \"name\": \"S1\", \"val\": 1 },\n            { \"pos\": [60, 460], \"id\": 28, \"name\": \"S2\", \"val\": 0 },\n        ],\n        \"gates\": [\n            { \"type\": \"NOT\", \"pos\": [130, 90], \"in\": 30, \"out\": 31 },\n            { \"type\": \"NOT\", \"pos\": [130, 250], \"in\": 32, \"out\": 33 },\n            { \"type\": \"NOT\", \"pos\": [130, 420], \"in\": 34, \"out\": 35 },\n            { \"type\": \"AND3\", \"pos\": [340, 120], \"in\": [36, 37, 38], \"out\": 39 },\n            { \"type\": \"AND3\", \"pos\": [340, 190], \"in\": [40, 41, 42], \"out\": 43 },\n            { \"type\": \"AND3\", \"pos\": [340, 260], \"in\": [44, 45, 46], \"out\": 47 },\n            { \"type\": \"AND3\", \"pos\": [340, 330], \"in\": [48, 49, 50], \"out\": 51 },\n            { \"type\": \"AND3\", \"pos\": [340, 400], \"in\": [52, 53, 54], \"out\": 55 },\n            { \"type\": \"AND3\", \"pos\": [340, 470], \"in\": [56, 57, 58], \"out\": 59 },\n            { \"type\": \"AND3\", \"pos\": [340, 540], \"in\": [60, 61, 62], \"out\": 63 },\n            { \"type\": \"AND3\", \"pos\": [340, 50], \"in\": [64, 65, 66], \"out\": 67 },\n            { \"type\": \"BUF\", \"pos\": [130, 170], \"in\": 76, \"out\": 77 },\n            { \"type\": \"BUF\", \"pos\": [130, 330], \"in\": 78, \"out\": 79 },\n            { \"type\": \"BUF\", \"pos\": [130, 500], \"in\": 80, \"out\": 81 },\n        ],\n        \"out\": [\n            { \"pos\": [420, 50], \"id\": 68, \"name\": \"0\" },\n            { \"pos\": [420, 120], \"id\": 69, \"name\": \"1\" },\n            { \"pos\": [420, 190], \"id\": 70, \"name\": \"2\" },\n            { \"pos\": [420, 260], \"id\": 71, \"name\": \"3\" },\n            { \"pos\": [420, 330], \"id\": 72, \"name\": \"4\" },\n            { \"pos\": [420, 400], \"id\": 73, \"name\": \"5\" },\n            { \"pos\": [420, 470], \"id\": 74, \"name\": \"6\" },\n            { \"pos\": [420, 540], \"id\": 75, \"name\": \"7\" },\n        ],\n        \"wires\": [\n            [26, 30],\n            [27, 32],\n            [28, 34],\n            [67, 68],\n            [39, 69],\n            [43, 70],\n            [47, 71],\n            [51, 72],\n            [55, 73],\n            [59, 74],\n            [63, 75],\n            [31, 64],\n            [33, 65],\n            [35, 66],\n            [26, 76],\n            [27, 78],\n            [28, 80],\n            [77, 36],\n            [33, 37],\n            [35, 38],\n            [31, 40],\n            [79, 41],\n            [35, 42],\n            [35, 46],\n            [79, 45],\n            [77, 44],\n            [31, 48],\n            [77, 52],\n            [31, 56],\n            [77, 60],\n            [33, 49],\n            [33, 53],\n            [79, 57],\n            [79, 61],\n            [81, 50],\n            [81, 54],\n            [81, 58],\n            [81, 62],\n        ],\n    },\n\n    ParityGenerator: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [70, 180], \"id\": 0, \"name\": \"D1\", \"val\": 0 },\n            { \"pos\": [70, 300], \"id\": 1, \"name\": \"D2\", \"val\": 0 },\n            { \"pos\": [70, 360], \"id\": 2, \"name\": \"D3\", \"val\": 0 },\n            { \"pos\": [70, 420], \"id\": 3, \"name\": \"D4\", \"val\": 0 },\n        ],\n        \"out\": [\n            { \"pos\": [530, 60], \"id\": 4, \"name\": \"P1\" },\n            { \"pos\": [530, 120], \"id\": 5, \"name\": \"P2\" },\n            { \"pos\": [530, 180], \"id\": 6, \"name\": \"D1\" },\n            { \"pos\": [530, 240], \"id\": 7, \"name\": \"P3\" },\n            { \"pos\": [530, 300], \"id\": 8, \"name\": \"D2\" },\n            { \"pos\": [530, 360], \"id\": 9, \"name\": \"D3\" },\n            { \"pos\": [530, 420], \"id\": 10, \"name\": \"D4\" },\n        ],\n        \"gates\": [\n            { \"type\": \"XOR\", \"pos\": [460, 240], \"in\": [11, 12], \"out\": 13 },\n            { \"type\": \"XOR\", \"pos\": [380, 230], \"in\": [14, 15], \"out\": 16 },\n            { \"type\": \"XOR\", \"pos\": [340, 120], \"in\": [17, 18], \"out\": 19 },\n            { \"type\": \"XOR\", \"pos\": [260, 110], \"in\": [20, 21], \"out\": 22 },\n            { \"type\": \"XOR\", \"pos\": [300, 60], \"in\": [23, 24], \"out\": 25 },\n            { \"type\": \"XOR\", \"pos\": [220, 40], \"in\": [26, 27], \"out\": 28 },\n        ],\n        \"wires\": [\n            [3, 10],\n            [2, 9],\n            [1, 8],\n            [0, 6],\n            [22, 17],\n            [16, 11],\n            [28, 23],\n            [25, 4],\n            [19, 5],\n            [13, 7],\n            [3, 18, { \"via\": [[280, 420], [280, 130]] }],\n            [3, 12, { \"via\": [[420, 420]] }],\n            [2, 15, { \"via\": [[340, 360]] }],\n            [1, 14, { \"via\": [[310, 300], [310, 220]] }],\n            [2, 21, { \"via\": [[220, 360]] }],\n            [0, 20, { \"via\": [[190, 180], [190, 100]] }],\n            [3, 24, { \"via\": [[150, 420], [150, 70]] }],\n            [1, 27, { \"via\": [[120, 300], [120, 50]] }],\n            [0, 26, { \"via\": [[100, 30]] }],\n        ],\n    },\n\n    ShiftRegister: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [110, 130], \"id\": 0, \"name\": \"D\", \"val\": 1 },\n            { \"pos\": [100, 210], \"id\": 1, \"name\": \"Horloge\", \"val\": 0, \"isPushButton\": true },\n            { \"pos\": [100, 260], \"id\": 38, \"name\": \"Reset\", \"val\": 0, \"isPushButton\": true },\n        ],\n        \"out\": [{ \"type\": \"nibble-display\", \"pos\": [650, 60], \"id\": [39, 40, 41, 42] }],\n        \"components\": [\n            { \"type\": \"flipflop-d\", \"pos\": [560, 150], \"in\": [21, 22, 23, 20], \"out\": [24, 25], \"state\": 1, \"showContent\": true },\n            { \"type\": \"flipflop-d\", \"pos\": [450, 150], \"in\": [15, 16, 17, 14], \"out\": [18, 19], \"state\": 0, \"showContent\": true },\n            { \"type\": \"flipflop-d\", \"pos\": [340, 150], \"in\": [9, 10, 11, 8], \"out\": [12, 13], \"state\": 1, \"showContent\": true },\n            { \"type\": \"flipflop-d\", \"pos\": [230, 150], \"in\": [3, 4, 5, 2], \"out\": [6, 7], \"state\": 1, \"showContent\": true },\n        ],\n        \"wires\": [\n            [6, 8],\n            [12, 14],\n            [18, 20],\n            [38, 5, { \"via\": [[230, 260]] }],\n            [38, 11, { \"via\": [[340, 260]] }],\n            [38, 17, { \"via\": [[450, 260]] }],\n            [38, 23, { \"via\": [[560, 260]] }],\n            [1, 21, { \"via\": [[490, 210]] }],\n            [1, 15, { \"via\": [[380, 210]] }],\n            [1, 9, { \"via\": [[270, 210]] }],\n            [1, 3, { \"via\": [[160, 210]] }],\n            [0, 2],\n            [24, 39],\n            [18, 40, { \"via\": [[530, 50]] }],\n            [12, 41, { \"via\": [[410, 70]] }],\n            [6, 42, { \"via\": [[300, 90]] }],\n        ],\n    },\n\n    Muxes: {\n        \"v\": 4,\n        \"in\": [\n            { \"pos\": [160, 70], \"orient\": \"s\", \"id\": 59, \"name\": \"S0\", \"val\": 0 },\n            { \"pos\": [160, 340], \"orient\": \"s\", \"id\": 64, \"name\": \"S0\", \"val\": 0 },\n            { \"pos\": [450, 360], \"orient\": \"s\", \"id\": 69, \"name\": \"S0\", \"val\": 0 },\n            { \"type\": \"nibble\", \"pos\": [270, 60], \"orient\": \"s\", \"id\": [0, 1, 2, 3], \"val\": [1, 1, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [460, 70], \"orient\": \"s\", \"id\": [60, 61, 62, 63], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [270, 300], \"orient\": \"s\", \"id\": [65, 66, 67, 68], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [110, 180], \"id\": [86, 87, 88, 89], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [230, 180], \"id\": [90, 91, 92, 93], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [400, 170], \"id\": [94, 95, 96, 97], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [400, 250], \"id\": [98, 99, 100, 101], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [110, 420], \"id\": [102, 103, 104, 105], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [110, 520], \"id\": [106, 107, 108, 109], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [400, 540], \"id\": [110, 111, 112, 113], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [400, 440], \"id\": [114, 115, 116, 117], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [230, 400], \"id\": [118, 119, 120, 121], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [230, 460], \"id\": [122, 123, 124, 125], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [230, 520], \"id\": [126, 127, 128, 129], \"val\": [0, 0, 0, 0] },\n            { \"type\": \"nibble\", \"pos\": [230, 580], \"id\": [130, 131, 132, 133], \"val\": [0, 0, 0, 0] },\n        ],\n        \"components\": [\n            { \"type\": \"mux-2to1\", \"pos\": [160, 160], \"in\": [5, 6, 7], \"out\": 8 },\n            { \"type\": \"mux-4to1\", \"pos\": [290, 180], \"in\": [4, 9, 10, 11, 12, 13], \"out\": 14 },\n            { \"type\": \"mux-8to1\", \"pos\": [470, 210], \"in\": [15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25], \"out\": 26 },\n            { \"type\": \"mux-4to2\", \"pos\": [160, 470], \"in\": [27, 28, 29, 30, 31], \"out\": [32, 33] },\n            { \"type\": \"mux-8to2\", \"pos\": [290, 490], \"in\": [34, 35, 36, 37, 38, 39, 40, 41, 42, 43], \"out\": [44, 45] },\n            { \"type\": \"mux-8to4\", \"pos\": [450, 490], \"in\": [46, 47, 48, 49, 50, 51, 52, 53, 54], \"out\": [55, 56, 57, 58] },\n            { \"type\": \"alu\", \"pos\": [630, 450], \"in\": [70, 71, 72, 73, 74, 75, 76, 77, 78, 79], \"out\": [80, 81, 82, 83, 84, 85] },\n        ],\n        \"wires\": [\n            [59, 7],\n            [0, 12],\n            [1, 13],\n            [60, 23],\n            [61, 24],\n            [62, 25],\n            [64, 31],\n            [65, 42],\n            [66, 43],\n            [69, 54],\n            [86, 5],\n            [87, 6],\n            [90, 4],\n            [91, 9],\n            [92, 10],\n            [93, 11],\n            [94, 15],\n            [95, 16],\n            [96, 17],\n            [97, 18],\n            [98, 19],\n            [99, 20],\n            [100, 21],\n            [101, 22],\n            [104, 27],\n            [105, 28],\n            [106, 29],\n            [107, 30],\n            [110, 50],\n            [111, 51],\n            [112, 52],\n            [113, 53],\n            [114, 46],\n            [115, 47],\n            [116, 48],\n            [117, 49],\n            [119, 34],\n            [120, 35],\n            [123, 36],\n            [124, 37],\n            [127, 38],\n            [128, 39],\n            [131, 40],\n            [132, 41],\n        ],\n    },\n})\n\n", "import { a, button, cls, dataClassId, dataComponent, dataType, div, emptyMod, raw, span, style, title, type } from \"./htmlgen\"\nimport { ImageName, makeImage } from \"./images\"\nimport { S, Strings } from \"./strings\"\nimport { isDefined, isString, isUndefined } from \"./utils\"\n\ntype ComponentKey = Strings[\"ComponentBar\"][\"Components\"][\"type\"]\n\n\ntype ComponentItem = {\n    type: string // TODO better types for this\n    subtype: string | undefined // explicit undefined\n    strings: ComponentKey\n    img: ImageName\n    width: number\n    normallyHidden?: boolean\n}\n\ntype SectionNameKey = keyof Strings[\"ComponentBar\"][\"SectionNames\"]\n\ntype Section = {\n    nameKey: SectionNameKey,\n    items: Array<ComponentItem>\n}\n\nconst componentsMenu: Array<Section> = [\n    {\n        nameKey: \"InputOutput\",\n        items: [\n            {\n                type: \"in\", subtype: undefined,\n                strings: \"InputBit\", img: \"InputBit\", width: 32,\n            },\n            {\n                type: \"out\", subtype: undefined,\n                strings: \"OutputBit\", img: \"OutputBit\", width: 32,\n            },\n            {\n                type: \"out\", subtype: \"bar\",\n                strings: \"OutputBar\", img: \"OutputBar\", width: 32,\n                normallyHidden: true,\n            },\n            {\n                type: \"in\", subtype: \"clock\",\n                strings: \"Clock\", img: \"Clock\", width: 50,\n            },\n            {\n                type: \"in\", subtype: \"nibble\",\n                strings: \"InputNibble\", img: \"InputNibble\", width: 32,\n            },\n            {\n                type: \"out\", subtype: \"nibble\",\n                strings: \"OutputNibble\", img: \"OutputNibble\", width: 32,\n            },\n            {\n                type: \"out\", subtype: \"nibble-display\",\n                strings: \"OutputNibbleDisplay\", img: \"OutputNibbleDisplay\", width: 32,\n            },\n            {\n                type: \"in\", subtype: \"byte\",\n                strings: \"InputByte\", img: \"InputByte\", width: 32,\n                normallyHidden: true,\n            },\n            {\n                type: \"out\", subtype: \"byte\",\n                strings: \"OutputByte\", img: \"OutputByte\", width: 32,\n                normallyHidden: true,\n            },\n            {\n                type: \"out\", subtype: \"byte-display\",\n                strings: \"OutputByteDisplay\", img: \"OutputByteDisplay\", width: 32,\n                normallyHidden: true,\n            },\n            {\n                type: \"out\", subtype: \"7seg\",\n                strings: \"Output7Seg\", img: \"Output7Seg\", width: 32,\n                normallyHidden: true,\n            },\n            {\n                type: \"out\", subtype: \"16seg\",\n                strings: \"Output16Seg\", img: \"Output16Seg\", width: 32,\n                normallyHidden: true,\n            },\n            {\n                type: \"out\", subtype: \"ascii\",\n                strings: \"OutputAscii\", img: \"OutputAscii\", width: 32,\n                normallyHidden: true,\n            },\n            {\n                type: \"in\", subtype: \"random\",\n                strings: \"InputRandom\", img: \"InputRandom\", width: 32,\n                normallyHidden: true,\n            },\n            {\n                type: \"out\", subtype: \"shiftbuffer\",\n                strings: \"OutputShiftBuffer\", img: \"OutputShiftBuffer\", width: 50,\n                normallyHidden: true,\n            },\n        ],\n    },\n\n    {\n        nameKey: \"Gates\",\n        items: [\n            {\n                type: \"gate\", subtype: \"NOT\",\n                strings: \"NOT\", img: \"NOT\", width: 50,\n            },\n            {\n                type: \"gate\", subtype: \"BUF\",\n                strings: \"BUF\", img: \"BUF\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"TRI\",\n                strings: \"TRI\", img: \"TRI\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"AND\",\n                strings: \"AND\", img: \"AND\", width: 50,\n            },\n            {\n                type: \"gate\", subtype: \"OR\",\n                strings: \"OR\", img: \"OR\", width: 50,\n            },\n            {\n                type: \"gate\", subtype: \"XOR\",\n                strings: \"XOR\", img: \"XOR\", width: 50,\n            },\n            {\n                type: \"gate\", subtype: \"NAND\",\n                strings: \"NAND\", img: \"NAND\", width: 50,\n            },\n            {\n                type: \"gate\", subtype: \"NOR\",\n                strings: \"NOR\", img: \"NOR\", width: 50,\n            },\n\n            {\n                type: \"gate\", subtype: \"XNOR\",\n                strings: \"XNOR\", img: \"XNOR\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"IMPLY\",\n                strings: \"IMPLY\", img: \"IMPLY\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"NIMPLY\",\n                strings: \"NIMPLY\", img: \"NIMPLY\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"TXA\",\n                strings: \"TRANSFER\", img: \"TXA\", width: 50,\n                normallyHidden: true,\n            },\n\n            {\n                type: \"gate\", subtype: \"AND3\",\n                strings: \"AND3\", img: \"AND3\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"OR3\",\n                strings: \"OR3\", img: \"OR3\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"XOR3\",\n                strings: \"XOR3\", img: \"XOR3\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"NAND3\",\n                strings: \"NAND3\", img: \"NAND3\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"NOR3\",\n                strings: \"NOR3\", img: \"NOR3\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"XNOR3\",\n                strings: \"XNOR3\", img: \"XNOR3\", width: 50,\n                normallyHidden: true,\n            },\n\n            {\n                type: \"gate\", subtype: \"AND4\",\n                strings: \"AND4\", img: \"AND4\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"OR4\",\n                strings: \"OR4\", img: \"OR4\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"XOR4\",\n                strings: \"XOR4\", img: \"XOR4\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"NAND4\",\n                strings: \"NAND4\", img: \"NAND4\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"NOR4\",\n                strings: \"NOR4\", img: \"NOR4\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"gate\", subtype: \"XNOR4\",\n                strings: \"XNOR4\", img: \"XNOR4\", width: 50,\n                normallyHidden: true,\n            },\n\n\n            {\n                type: \"component\", subtype: \"switched-inverter\",\n                strings: \"SwitchedInverter\", img: \"SwitchedInverter\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"quad-gate\",\n                strings: \"QuadGate\", img: \"QuadGate\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"quad-tristate\",\n                strings: \"QuadTriState\", img: \"QuadTriState\", width: 50,\n                normallyHidden: true,\n            },\n\n\n        ],\n    },\n\n    {\n        nameKey: \"Layout\",\n        items: [\n            {\n                type: \"label\", subtype: undefined,\n                strings: \"LabelString\", img: \"LabelString\", width: 32,\n            },\n            {\n                type: \"label\", subtype: \"rect\",\n                strings: \"LabelRectangle\", img: \"LabelRectangle\", width: 32,\n            },\n            {\n                type: \"layout\", subtype: \"pass\",\n                strings: \"Passthrough1\", img: \"Passthrough1\", width: 32,\n            },\n            {\n                type: \"layout\", subtype: \"pass-4\",\n                strings: \"Passthrough4\", img: \"Passthrough4\", width: 32,\n            },\n            {\n                type: \"layout\", subtype: \"pass-8\",\n                strings: \"Passthrough8\", img: \"Passthrough8\", width: 32,\n                normallyHidden: true,\n            },\n        ],\n    },\n\n\n    {\n        nameKey: \"Components\",\n        items: [\n            {\n                type: \"component\", subtype: \"halfadder\",\n                strings: \"HalfAdder\", img: \"HalfAdder\", width: 50,\n            },\n            {\n                type: \"component\", subtype: \"adder\",\n                strings: \"Adder\", img: \"Adder\", width: 50,\n            },\n            {\n                type: \"component\", subtype: \"alu\",\n                strings: \"ALU\", img: \"ALU\", width: 50,\n            },\n\n            {\n                type: \"component\", subtype: \"mux-2to1\",\n                strings: \"Mux2to1\", img: \"Mux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"mux-4to1\",\n                strings: \"Mux4to1\", img: \"Mux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"mux-8to1\",\n                strings: \"Mux8to1\", img: \"Mux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"mux-4to2\",\n                strings: \"Mux4to2\", img: \"Mux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"mux-8to2\",\n                strings: \"Mux8to2\", img: \"Mux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"mux-8to4\",\n                strings: \"Mux8to4\", img: \"Mux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"mux-16to8\",\n                strings: \"Mux16to8\", img: \"Mux\", width: 50,\n                normallyHidden: true,\n            },\n\n            {\n                type: \"component\", subtype: \"demux-1to2\",\n                strings: \"Demux1to2\", img: \"Demux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"demux-1to4\",\n                strings: \"Demux1to4\", img: \"Demux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"demux-1to8\",\n                strings: \"Demux1to8\", img: \"Demux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"demux-2to4\",\n                strings: \"Demux2to4\", img: \"Demux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"demux-2to8\",\n                strings: \"Demux2to8\", img: \"Demux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"demux-4to8\",\n                strings: \"Demux4to8\", img: \"Demux\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"demux-8to16\",\n                strings: \"Demux8to16\", img: \"Demux\", width: 50,\n                normallyHidden: true,\n            },\n\n            {\n                type: \"component\", subtype: \"latch-sr\",\n                strings: \"LatchSR\", img: \"LatchSR\", width: 50,\n            },\n            {\n                type: \"component\", subtype: \"flipflop-jk\",\n                strings: \"FlipflopJK\", img: \"FlipflopJK\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"flipflop-t\",\n                strings: \"FlipflopT\", img: \"FlipflopT\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"flipflop-d\",\n                strings: \"FlipflopD\", img: \"FlipflopD\", width: 50,\n            },\n            {\n                type: \"component\", subtype: \"register\",\n                strings: \"Register\", img: \"Register\", width: 50,\n            },\n            {\n                type: \"component\", subtype: \"ram-16x4\",\n                strings: \"RAM16x4\", img: \"RAM16x4\", width: 50,\n            },\n            {\n                type: \"component\", subtype: \"ram-16x8\",\n                strings: \"RAM16x8\", img: \"RAM16x8\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"ram-64x8\",\n                strings: \"RAM64x8\", img: \"RAM64x8\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"ram-32x12\",\n                strings: \"RAM32x12\", img: \"RAM32x12\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"counter\",\n                strings: \"Counter\", img: \"Counter\", width: 50,\n            },\n            {\n                type: \"component\", subtype: \"decoder-7seg\",\n                strings: \"Decoder7Seg\", img: \"Decoder7Seg\", width: 50,\n            },\n            {\n                type: \"component\", subtype: \"decoder-16seg\",\n                strings: \"Decoder16Seg\", img: \"Decoder16Seg\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"decoder-bcd4\",\n                strings: \"DecoderBCD4\", img: \"DecoderBCD4\", width: 50,\n                normallyHidden: true,\n            },\n            {\n                type: \"component\", subtype: \"comparator\",\n                strings: \"Comparator\", img: \"Comparator\", width: 50,\n                normallyHidden: true,\n            },\n\n        ],\n    },\n]\n\n\nexport function makeComponentMenuInto(target: HTMLElement, _showOnly: string[] | undefined) {\n\n    let showOnly: string[] | undefined = undefined\n    if (isDefined(_showOnly)) {\n        showOnly = [..._showOnly]\n    }\n\n    // console.log(\"makeComponentMenuInto; showOnly\", showOnly)\n\n    let lastSectionNonEmpty = false\n\n    for (const section of componentsMenu) {\n\n        // separator from previous section\n        let separator: HTMLElement | undefined = undefined\n        const lastSectionNonEmptyPrev: boolean = lastSectionNonEmpty\n\n        if (lastSectionNonEmpty) {\n            separator =\n                div(style(\"height: 20px\"),\n                    raw(\"&nbsp;\")\n                ).render()\n\n            target.appendChild(separator)\n        }\n\n        // section header\n        const header =\n            div(cls(\"leftToolbarHeader\"),\n                S.ComponentBar.SectionNames[section.nameKey]\n            ).render()\n        target.appendChild(header)\n\n        // section content\n        let numAdded = 0\n        const normallyHiddenButtons: HTMLButtonElement[] = []\n        for (const item of section.items) {\n            const normallyHidden = item.normallyHidden ?? false\n            const hiddenNow = isDefined(showOnly) ? !shouldShow(item, showOnly) : normallyHidden\n\n            let buttonStyle = \"\"\n            if (hiddenNow) {\n                buttonStyle += \"max-height: 0; transition: all 0.25s ease-out; overflow: hidden; padding: 0; border: 0; margin-bottom: 0;\"\n            }\n            const dataTypeOpt = isUndefined(item.subtype) ? emptyMod : dataType(item.subtype)\n            const compStrings = S.ComponentBar.Components.propsOf(item.strings)\n            const [titleStr, captionStr] = isString(compStrings) ? [compStrings, undefined] : compStrings\n            const caption = isUndefined(captionStr) ? emptyMod : span(cls(\"gate-label\"), captionStr)\n            const classId = componentIdFor(item)\n            const buttonTitle = title(isUndefined(titleStr) ? \"\" : (titleStr + \" \\n\") + `(\u201C${classId}\u201D)`)\n            const extraClasses = hiddenNow ? \" sim-component-button-extra\" : \"\"\n            const compButton =\n                button(type(\"button\"), style(buttonStyle), cls(`list-group-item list-group-item-action sim-component-button${extraClasses}`),\n                    dataComponent(item.type), dataTypeOpt,\n                    dataClassId(classId),\n                    makeImage(item.img, item.width),\n                    caption, buttonTitle\n                ).render()\n\n            if (hiddenNow) {\n                normallyHiddenButtons.push(compButton)\n            }\n\n            target.appendChild(compButton)\n            numAdded++\n        }\n\n        const numHidden = normallyHiddenButtons.length\n        const numVisible = numAdded - numHidden\n\n        // link to show more if needed\n        if (numHidden !== 0 && isUndefined(showOnly)) {\n            let moreShown = false\n            const names = [S.ComponentBar.Labels.More + \" \u2193\", S.ComponentBar.Labels.Less + \" \u2191\"]\n            const linkShowMore = a(cls(\"leftToolbarMore\"), names[0]).render()\n            linkShowMore.addEventListener(\"click\", () => {\n                moreShown = !moreShown\n                for (const button of normallyHiddenButtons) {\n                    if (moreShown) {\n                        button.style.removeProperty(\"padding\")\n                        button.style.removeProperty(\"border\")\n                        button.style.removeProperty(\"margin-bottom\")\n                        button.style.removeProperty(\"max-height\")\n                        button.style.removeProperty(\"overflow\")\n                    } else {\n                        button.style.padding = \"0\"\n                        button.style.border = \"0\"\n                        button.style.marginBottom = \"0\"\n                        button.style.maxHeight = \"0\"\n                        button.style.overflow = \"hidden\"\n                    }\n                }\n                linkShowMore.innerHTML = names[Number(moreShown)]\n            })\n            target.appendChild(linkShowMore)\n        }\n\n        if (numVisible === 0) {\n            if (isDefined(separator)) {\n                separator.remove()\n            }\n            header.remove()\n\n            // as we removed our sep, keep nonempty value for next section from previous one\n            lastSectionNonEmpty = lastSectionNonEmptyPrev\n        } else {\n            // if we're visible, we're nonempty\n            lastSectionNonEmpty = true\n        }\n\n    }\n\n    if (isDefined(showOnly) && showOnly.length > 0) {\n        console.log(`ERROR Supposed to show unknown elems: ${showOnly.join(\"; \")}`)\n    }\n}\n\nfunction shouldShow(item: ComponentItem, showOnly: string[]) {\n    const componentId = componentIdFor(item)\n\n    let visible = false\n    if (showOnly.includes(componentId)) {\n        visible = true\n        const ind = showOnly.indexOf(componentId)\n        showOnly.splice(ind, 1)\n    }\n\n    // console.log(`buttonId '${buttonId}' is visible: ${visible}`)\n\n    return visible\n}\n\nfunction componentIdFor(item: ComponentItem): string {\n    const compType = item.type\n    const compSubtype = item.subtype\n\n    let buttonId\n    if (isUndefined(compSubtype)) {\n        buttonId = compType\n    } else {\n        if (compType === \"component\" || compType === \"gate\") {\n            buttonId = compSubtype\n        } else if (compType === \"in\" && compSubtype === \"clock\") {\n            buttonId = \"clock\"\n        } else {\n            buttonId = `${compType}.${compSubtype}`\n        }\n    }\n    return buttonId.toLowerCase()\n}\n\n", "import { DrawableWithPosition } from \"./components/Drawable\"\nimport { Waypoint } from \"./components/Wire\"\nimport { LogicEditor } from \"./LogicEditor\"\n\nexport class MoveManager {\n\n    public readonly editor: LogicEditor\n    private _movingDrawables = new Set<DrawableWithPosition>()\n\n    public constructor(editor: LogicEditor) {\n        this.editor = editor\n    }\n\n    public areDrawablesMoving() {\n        return this._movingDrawables.size > 0\n    }\n\n    public getSingleMovingWaypoint(): Waypoint | undefined {\n        if (this._movingDrawables.size === 1) {\n            const drawable = this._movingDrawables.values().next().value\n            if (drawable instanceof Waypoint) {\n                return drawable\n            }\n        }\n        return undefined\n    }\n\n    public setDrawableMoving(comp: DrawableWithPosition) {\n        this.changeMovingDrawables(() => {\n            this._movingDrawables.add(comp)\n        })\n    }\n    \n    public setDrawableStoppedMoving(comp: DrawableWithPosition) {\n        this.changeMovingDrawables(() => {\n            this._movingDrawables.delete(comp)\n        })\n    }\n\n    private changeMovingDrawables(change: () => void) {\n        const emptyBefore = this._movingDrawables.size === 0\n        change()\n        const emptyAfter = this._movingDrawables.size === 0\n        if (emptyBefore !== emptyAfter) {\n            this.editor.updateCursor()\n            this.editor.redrawMgr.addReason(\"started or stopped moving drawables\", null)\n        }\n    }\n\n}\n", "import { Component } from \"./components/Component\"\nimport { Node } from \"./components/Node\"\nimport { isDefined, isUndefined } from \"./utils\"\n\n\n\nexport class NodeManager {\n\n    private lastGivenNodeID = -1\n    private usedIDs = new Set<number>()\n    private allLiveNodes: Node[] = []\n\n    public newID(): number {\n        while (this.usedIDs.has(++this.lastGivenNodeID)) {\n            // empty block, condition does the increment\n        }\n        this.usedIDs.add(this.lastGivenNodeID)\n        // console.log(`gave out new node id ${lastGivenNodeID}`)\n        return this.lastGivenNodeID\n    }\n\n    public markIDUsed(id: number): void {\n        if (this.usedIDs.has(id)) {\n            console.warn(`WARN: loaded node with id ${id}, which is already taken`)\n        }\n        this.usedIDs.add(id)\n    }\n\n    public addLiveNode(node: Node) {\n        if (!this.usedIDs.has(node.id)) {\n            console.warn(`WARN inserting live node with unreserved id ${node.id}`)\n        }\n        this.allLiveNodes[node.id] = node\n    }\n\n    public removeLiveNode(node: Node) {\n        delete this.allLiveNodes[node.id]\n        this.usedIDs.delete(node.id)\n    }\n\n    public clearAllLiveNodes() {\n        this.allLiveNodes.splice(0, this.allLiveNodes.length)\n        this.usedIDs.clear()\n        this.lastGivenNodeID = -1\n    }\n\n    public findNode(nodeID: number): Node | undefined {\n        return this.allLiveNodes[nodeID]\n    }\n\n    public tryConnectNodesOf(comp: Component) {\n        const wireMgr = comp.editor.wireMgr\n        const addedConnections: [Node, Component, Node][] = []\n        comp.forEachNode(node => {\n            if (node.acceptsMoreConnections) {\n                const nodeX = node.posX\n                const nodeY = node.posY\n                const parent = node.parent\n                for (const other of this.allLiveNodes) {\n                    if (!isUndefined(other) && other.parent !== parent && other.acceptsMoreConnections) {\n                        if (other.posX === nodeX && other.posY === nodeY) {\n                            // the wire manager will take care of determining whether\n                            // they can actually be connected or not\n                            wireMgr.addNode(node)\n                            const wire = wireMgr.addNode(other)\n                            if (isDefined(wire)) {\n                                addedConnections.push([node, other.parent as Component, other])\n                            }\n                        }\n                    }\n                }\n            }\n            return true\n        })\n        return addedConnections\n    }\n\n}\n\n\n", "import { getFunctionName } from '.';\nimport { fold } from 'fp-ts/es6/Either';\nfunction stringify(v) {\n    if (typeof v === 'function') {\n        return getFunctionName(v);\n    }\n    if (typeof v === 'number' && !isFinite(v)) {\n        if (isNaN(v)) {\n            return 'NaN';\n        }\n        return v > 0 ? 'Infinity' : '-Infinity';\n    }\n    return JSON.stringify(v);\n}\nfunction getContextPath(context) {\n    return context.map(function (_a) {\n        var key = _a.key, type = _a.type;\n        return key + \": \" + type.name;\n    }).join('/');\n}\nfunction getMessage(e) {\n    return e.message !== undefined\n        ? e.message\n        : \"Invalid value \" + stringify(e.value) + \" supplied to \" + getContextPath(e.context);\n}\n/**\n * @since 1.0.0\n */\nexport function failure(es) {\n    return es.map(getMessage);\n}\n/**\n * @since 1.0.0\n */\nexport function success() {\n    return ['No errors!'];\n}\n/**\n * @since 1.0.0\n */\nexport var PathReporter = {\n    report: fold(failure, success)\n};\n", "// Note: This regex matches even invalid JSON strings, but since we\u2019re\n// working on the output of `JSON.stringify` we know that only valid strings\n// are present (unless the user supplied a weird `options.indent` but in\n// that case we don\u2019t care since the output would be invalid anyway).\n\nimport { isDefined } from \"./utils\"\n\n// eslint-disable-next-line prefer-named-capture-group\nconst stringOrChar = /(\"(?:[^\\\\\"]|\\\\.)*\")|[:,]/g\n\nexport function stringifySmart(\n    passedObj: any,\n    options?: {\n        replacer?: (this: any, key: string, value: any) => any,\n        indent?: number | string,\n        maxLength?: number\n    }\n): string {\n\n    options ??= {}\n    const indent: string = JSON.stringify([1], undefined, options.indent ?? 2).slice(2, -3)\n    const maxLength: number =\n        indent === \"\"\n            ? Infinity\n            : options.maxLength ?? 80\n\n    let replacer = options.replacer\n\n    return (function _stringify(obj: any, currentIndent: string, reserved: number): string {\n        if (isDefined(obj) && typeof obj.toJSON === \"function\") {\n            obj = obj.toJSON()\n        }\n\n        const string = JSON.stringify(obj, replacer)\n\n        if (string === undefined) {\n            return string\n        }\n\n        let length = maxLength - currentIndent.length - reserved\n\n        if (string.length <= length) {\n            const prettified = string.replace(\n                stringOrChar,\n                function (match, stringLiteral) {\n                    return stringLiteral ?? match + \" \"\n                }\n            )\n            if (prettified.length <= length) {\n                return prettified\n            }\n        }\n\n        if (replacer !== null) {\n            obj = JSON.parse(string)\n            replacer = undefined\n        }\n\n        if (typeof obj === \"object\" && obj !== null) {\n            const nextIndent = currentIndent + indent\n            const items: string[] = []\n            let index = 0\n\n            let start: string\n            let end: string\n            if (Array.isArray(obj)) {\n                start = \"[\"\n                end = \"]\"\n                length = obj.length\n                for (; index < length; index++) {\n                    items.push(\n                        _stringify(obj[index], nextIndent, index === length - 1 ? 0 : 1) ||\n                        \"null\"\n                    )\n                }\n            } else {\n                start = \"{\"\n                end = \"}\"\n                const keys = Object.keys(obj)\n                length = keys.length\n                for (; index < length; index++) {\n                    const key = keys[index]\n                    const keyPart = JSON.stringify(key) + \": \"\n                    const value = _stringify(\n                        obj[key],\n                        nextIndent,\n                        keyPart.length + (index === length - 1 ? 0 : 1)\n                    )\n                    if (value !== undefined) {\n                        items.push(keyPart + value)\n                    }\n                }\n            }\n\n            if (items.length > 0) {\n                return [start, indent + items.join(\",\\n\" + nextIndent), end].join(\n                    \"\\n\" + currentIndent\n                )\n            }\n        }\n\n        return string\n    })(passedObj, \"\", 0)\n}\n", "import * as t from \"io-ts\"\nimport { PathReporter } from 'io-ts/PathReporter'\nimport { Component, ComponentTypes, JsonFieldComponent, JsonFieldsComponents, MainJsonFieldName } from \"./components/Component\"\nimport { GateDef, GateFactory } from \"./components/Gate\"\nimport { ICDef, ICFactory } from \"./components/IC\"\nimport { InputDef, InputFactory } from \"./components/Inputs\"\nimport { LabelDef, LabelFactory } from \"./components/Labels\"\nimport { LayoutDef, LayoutFactory } from \"./components/Layout\"\nimport { OutputDef, OutputFactory } from \"./components/Outputs\"\nimport { Wire } from \"./components/Wire\"\nimport { LogicEditor } from \"./LogicEditor\"\nimport { stringifySmart } from \"./stringifySmart\"\nimport { isArray, isDefined, isString, isUndefined, keysOf } from \"./utils\"\n\nexport type Workspace = Record<string, unknown>\n\nclass _PersistenceManager {\n\n    public loadFile(editor: LogicEditor, e: Event) {\n        const sourceElem = e.target as HTMLInputElement\n        const file = sourceElem.files?.item(0)\n        if (!file) {\n            return\n        }\n\n        const reader = new FileReader()\n\n        reader.onload = () => {\n            const contentFile = reader.result\n            //console.log(contentFile);\n            if (isString(contentFile)) {\n                this.doLoadFromJson(editor, contentFile)\n            }\n        }\n        reader.readAsText(file)\n    }\n\n    public doLoadFromJson(editor: LogicEditor, content: string | Workspace, isUndoRedoAction = false): undefined | string { // string is an error\n        const nodeMgr = editor.nodeMgr\n        const wireMgr = editor.wireMgr\n        const components = editor.components\n\n        let parsedContents: Workspace\n        if (!isString(content)) {\n            parsedContents = content\n        } else {\n            try {\n                parsedContents = JSON.parse(content)\n            } catch (err) {\n                return \"can't load this JSON - error \" + err\n            }\n        }\n\n        let jsonVersion = parsedContents[\"v\"] ?? 0\n        const savedVersion = jsonVersion\n        if (jsonVersion === 0) {\n            migrate0To1(parsedContents)\n            jsonVersion = 1\n        }\n        if (jsonVersion === 1) {\n            migrate1To2(parsedContents)\n            jsonVersion = 2\n        }\n        if (jsonVersion === 2) {\n            migrate2To3(parsedContents)\n            jsonVersion = 3\n        }\n        if (jsonVersion === 3) {\n            migrate3To4(parsedContents)\n            jsonVersion = 3\n        }\n        if (jsonVersion !== savedVersion) {\n            console.log(`Migrated data format from v${savedVersion} to v${jsonVersion}, consider upgrading the source`)\n        }\n        delete parsedContents[\"v\"]\n\n        for (const elem of components.all()) {\n            elem.destroy()\n        }\n        components.clearAll()\n        wireMgr.clearAllWires()\n        nodeMgr.clearAllLiveNodes()\n        editor.timeline.reset()\n\n        function loadField<T>(fieldName: MainJsonFieldName | \"wires\", repr: t.Type<T, any> | { repr: t.Type<T, any> }, process: (params: T) => any) {\n            if (!(fieldName in parsedContents)) {\n                return\n            }\n            const fieldValues = parsedContents[fieldName]\n            delete parsedContents[fieldName]\n\n            if (!isArray(fieldValues)) {\n                return\n            }\n            if (\"repr\" in repr) {\n                repr = repr.repr\n            }\n            for (const someDefinition of fieldValues) {\n                const validated = repr.decode(someDefinition)\n                switch (validated._tag) {\n                    case \"Left\":\n                        console.log(`ERROR while parsing ${repr.name} from %o -> %s: `, someDefinition, PathReporter.report(validated).join(\"; \"))\n                        break\n                    case \"Right\":\n                        process(validated.right)\n                        break\n                }\n            }\n        }\n\n        type Factory<T> = {\n            make: (editor: LogicEditor, savedDataOrType: T) => Component | undefined\n        }\n\n        function loadComponentField<T>(fieldName: MainJsonFieldName, repr: t.Type<T, any> | { repr: t.Type<T, any> }, factory: Factory<T>) {\n            loadField(fieldName, repr, (d) => {\n                const comp = factory.make(editor, d)\n                if (isDefined(comp)) {\n                    components.add(comp)\n                }\n            })\n        }\n\n        loadComponentField(\"in\", InputDef, InputFactory)\n        loadComponentField(\"out\", OutputDef, OutputFactory)\n        loadComponentField(\"gates\", GateDef, GateFactory as any)\n        loadComponentField(\"components\", ICDef, ICFactory)\n        loadComponentField(\"labels\", LabelDef, LabelFactory)\n        loadComponentField(\"layout\", LayoutDef, LayoutFactory)\n\n        // recalculating all the unconnected gates here allows\n        // to avoid spurious circular dependency messages, as right\n        // now all components are marked as needing recalculating\n        const recalcMgr = editor.recalcMgr\n        recalcMgr.recalcAndPropagateIfNeeded()\n\n        loadField(\"wires\", Wire.Repr, ([nodeID1, nodeID2, wireOptions]) => {\n            const node1 = nodeMgr.findNode(nodeID1)\n            const node2 = nodeMgr.findNode(nodeID2)\n            if (!isUndefined(node1) && !isUndefined(node2)) {\n                wireMgr.addNode(node1)\n                const completedWire = wireMgr.addNode(node2)\n                if (isDefined(completedWire) && isDefined(wireOptions)) {\n                    completedWire.ref = wireOptions.ref\n                    if (isDefined(wireOptions.via)) {\n                        completedWire.setWaypoints(wireOptions.via)\n                    }\n                    if (isDefined(wireOptions.propagationDelay)) {\n                        completedWire.customPropagationDelay = wireOptions.propagationDelay\n                    }\n                    if (isDefined(wireOptions.style)) {\n                        completedWire.doSetStyle(wireOptions.style)\n                    }\n                }\n                recalcMgr.recalcAndPropagateIfNeeded()\n            }\n        })\n\n        // load userdata, keeping already existing data\n        if (isDefined(parsedContents.userdata)) {\n            if (typeof editor.userdata === \"object\" && typeof parsedContents.userdata === \"object\") {\n                // merge\n                editor.userdata = {\n                    ...parsedContents.userdata,\n                    ...editor.userdata,\n                }\n            } else {\n                // cannot merge, keep existing data\n            }\n            delete parsedContents.userdata\n        }\n\n        // also works with undefined\n        // must be done AFTER setting user data to ensure the UI is updated accordingly\n        editor.setPartialOptions(parsedContents.opts as any)\n        delete parsedContents.opts\n\n        const unhandledData = keysOf(parsedContents)\n        if (unhandledData.length !== 0) {\n            console.log(\"Unloaded data fields: \" + unhandledData.join(\", \"))\n        }\n\n        if (!isUndoRedoAction) {\n            editor.undoMgr.takeSnapshot()\n        }\n\n        return undefined // meaning no error\n    }\n\n    public buildWorkspace(editor: LogicEditor): Workspace {\n        const workspace: Workspace = {\n            \"v\": 4,\n            \"opts\": editor.nonDefaultOptions(),\n        }\n\n        if (isDefined(editor.userdata)) {\n            workspace[\"userdata\"] = editor.userdata\n        }\n\n        for (const comp of editor.components.all()) {\n            const fieldName = ComponentTypes.propsOf(comp.componentType).jsonFieldName\n            let arr = workspace[fieldName]\n            if (isUndefined(arr)) {\n                workspace[fieldName] = (arr = [comp])\n            } else if (Array.isArray(arr)) {\n                arr.push(comp)\n            }\n        }\n\n        const wireMgr = editor.wireMgr\n        if (wireMgr.wires.length !== 0) {\n            workspace.wires = wireMgr.wires\n        }\n\n        return workspace\n    }\n\n    public removeShowOnlyFrom(workspace: Workspace): void {\n        const opts = workspace.opts as any\n        if (typeof opts === \"object\" && opts !== null && Object.prototype.hasOwnProperty.call(opts, \"showOnly\")) {\n            delete opts.showOnly\n        }\n    }\n\n    public stringifyWorkspace(_workspace: Workspace, compact: boolean): string {\n        if (compact) {\n            return JSON.stringify(_workspace)\n        }\n\n        // Custom stringifier to have always one component per line and\n        // spaces after commas\n\n        const workspace = { ..._workspace }\n\n        const parts = [`{\\n  \"v\": ${workspace.v}`]\n        delete workspace.v\n\n        const pushCompact = (key: string) => {\n            const value = workspace[key]\n            if (isDefined(value)) {\n                parts.push(`\"${key}\": ${stringifySmart(value, { maxLength: Infinity })}`)\n            }\n            delete workspace[key]\n        }\n\n        pushCompact(\"opts\")\n        pushCompact(\"userdata\")\n\n        const pushComponents = (jsonField: JsonFieldComponent) => {\n            const arr = workspace[jsonField]\n            if (isDefined(arr) && Array.isArray(arr)) {\n                const subparts: string[] = []\n                for (const comp of arr) {\n                    subparts.push(stringifySmart(comp, { maxLength: Infinity }))\n                }\n                parts.push(`\"${jsonField}\": [\\n    ` + subparts.join(\",\\n    \") + \"\\n  ]\")\n                delete workspace[jsonField]\n            }\n        }\n\n        for (const jsonField of JsonFieldsComponents) {\n            pushComponents(jsonField)\n        }\n\n        pushCompact(\"wires\")\n\n        // loop though the remaining fields\n        const unprocessedFields = keysOf(workspace)\n        if (unprocessedFields.length !== 0) {\n            console.log(\"ERROR: unprocessed fields in stringified JSON: \" + unprocessedFields.join(\", \"))\n        }\n\n        return parts.join(\",\\n  \") + \"\\n}\"\n    }\n\n    public saveToFile(editor: LogicEditor) {\n        const workspaceJsonStr = this.stringifyWorkspace(this.buildWorkspace(editor), false)\n        const blob = new Blob([workspaceJsonStr], { type: 'application/json' })\n        const filename = (editor.options.name ?? \"circuit\") + \".json\"\n\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = filename\n\n        const clickHandler = () => {\n            setTimeout(() => {\n                URL.revokeObjectURL(url)\n                a.removeEventListener('click', clickHandler)\n            }, 150)\n        }\n\n        a.addEventListener('click', clickHandler, false)\n        a.click()\n    }\n\n}\n\nexport const PersistenceManager = new _PersistenceManager()\n\n\nfunction findFirstFreeId(parsedContents: any): number {\n    // this finds the maximum id of all components on raw (but parsed) JSON;\n    // it is useful for migration code that needs to generate new ids\n\n    let maxId = -1\n\n    function inspectComponentDef(compDef: any) {\n        for (const fieldName of [\"id\", \"in\", \"out\"]) {\n            inspectValue(compDef[fieldName])\n        }\n    }\n\n    function inspectValue(value: any) {\n        if (isUndefined(value)) {\n            return\n        }\n        if (typeof value === \"number\") {\n            maxId = Math.max(maxId, value)\n        } else if (Array.isArray(value)) {\n            for (const item of value) {\n                inspectValue(item)\n            }\n        } else if (typeof value === \"object\" && value !== null) {\n            inspectValue(value.id)\n        }\n    }\n\n    for (const jsonField of JsonFieldsComponents) {\n        const arr = parsedContents[jsonField]\n        if (isDefined(arr) && Array.isArray(arr)) {\n            for (const comp of arr) {\n                inspectComponentDef(comp)\n            }\n        }\n    }\n\n    return maxId + 1\n}\n\nfunction migrate0To1(workspace: any) {\n    // all displays are now out\n    if (\"displays\" in workspace) {\n        const displays = workspace.displays\n        delete workspace.displays\n        if (!(\"out\" in workspace)) {\n            workspace.out = []\n        }\n        for (const display of displays) {\n            workspace.out.push(display)\n        }\n    }\n\n    // all clocks are now in\n    if (\"clocks\" in workspace) {\n        const clocks = workspace.clocks\n        delete workspace.clocks\n        if (!(\"in\" in workspace)) {\n            workspace.in = []\n        }\n        for (const clock of clocks) {\n            clock.type = \"clock\"\n            workspace.in.push(clock)\n        }\n    }\n\n    // flipflops have a different input node order\n    if (\"components\" in workspace) {\n        const components = workspace.components\n        for (const comp of components) {\n            // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n            if (comp.type.startsWith(\"flipflop\")) {\n                // extract last three inputs\n                const inputs: Array<number> = comp.in\n                const lastThree = inputs.splice(-3)\n                comp.in = [...lastThree, ...inputs]\n            }\n        }\n    }\n}\n\n\nfunction migrate1To2(workspace: any) {\n    // waypoints -> via\n    if (\"wires\" in workspace) {\n        const wires = workspace.wires\n        if (Array.isArray(wires)) {\n            for (const wire of wires) {\n                if (Array.isArray(wire) && wire.length === 3) {\n                    const wireOptions = wire[2]\n                    if (\"waypoints\" in wireOptions) {\n                        wireOptions.via = wireOptions.waypoints\n                        delete wireOptions.waypoints\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction migrate2To3(parsedContents: any) {\n    let nextNewId = findFirstFreeId(parsedContents)\n\n    if (\"components\" in parsedContents) {\n        const components = parsedContents.components\n        if (Array.isArray(components)) {\n            for (const comp of components) {\n                if (\"type\" in comp && comp.type === \"alu\") {\n                    if (Array.isArray(comp.in)) {\n                        comp.in.push(nextNewId++)\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction migrate3To4(parsedContents: any) {\n    let nextNewId = findFirstFreeId(parsedContents)\n\n    if (\"out\" in parsedContents) {\n        const outs = parsedContents.out\n        if (Array.isArray(outs)) {\n            for (const out of outs) {\n                if (\"type\" in out && out.type === \"nibble\") {\n                    out.type = \"nibble-display\"\n                }\n            }\n        }\n    }\n    if (\"components\" in parsedContents) {\n        const components = parsedContents.components\n        if (Array.isArray(components)) {\n            for (const comp of components) {\n                if (\"type\" in comp && comp.type === \"alu\") {\n                    if (Array.isArray(comp.out)) {\n                        comp.out.push(nextNewId++) // add a new oVerflow output\n                        // replace carry output with overflow output as it was wrongly used before\n                        const t = comp.out[4]\n                        comp.out[4] = comp.out[6]\n                        comp.out[6] = t\n                    }\n                }\n            }\n        }\n    }\n\n}\n\n", "import { Component } from \"./components/Component\"\nimport { Drawable } from \"./components/Drawable\"\nimport { Dict, isDefined, isNotNull, isUndefined } from \"./utils\"\n\nexport class RedrawManager {\n\n    private _canvasRedrawReasons: Dict<unknown[]> = {}\n    private _isEmpty = true\n\n    public addReason(reason: string, comp: Drawable | null) {\n        const compObj = comp\n        const compList = this._canvasRedrawReasons[reason]\n        if (isUndefined(compList)) {\n            this._canvasRedrawReasons[reason] = [compObj]\n        } else {\n            compList.push(compObj)\n        }\n        this._isEmpty = false\n    }\n\n    public getReasonsAndClear(): string | undefined {\n        if (this._isEmpty) {\n            return undefined\n        }\n\n        const reasonParts: string[] = []\n        for (const reason of Object.keys(this._canvasRedrawReasons)) {\n            reasonParts.push(reason)\n            const linkedComps = this._canvasRedrawReasons[reason]!\n            reasonParts.push(\" (\", String(linkedComps.length), \"\u00D7)\", \": \")\n            for (const comp of linkedComps) {\n                if (isNotNull(comp)) {\n                    const compAny = comp as any\n                    reasonParts.push(compAny.constructor?.name ?? \"Component\")\n                    if (isDefined(compAny.type)) {\n                        reasonParts.push(\"_\", compAny.type)\n                    }\n                    if (isDefined(compAny.name)) {\n                        reasonParts.push(\"('\", compAny.name, \"')\")\n                    }\n                    reasonParts.push(\"; \")\n                }\n            }\n            reasonParts.pop()\n            reasonParts.push(\"\\n    \")\n        }\n        reasonParts.pop()\n\n        this._canvasRedrawReasons = {}\n        this._isEmpty = true\n        return reasonParts.join(\"\")\n    }\n\n    public hasReasons(): boolean {\n        return !this._isEmpty\n    }\n}\n\nconst RECALC = \"recalc\"\nconst PROPAGATE = \"propagate\"\n\ntype UpdateType = typeof RECALC | typeof PROPAGATE\n\nexport class RecalcManager {\n\n    private _queue: Array<[Component, UpdateType, boolean]> = []\n\n    public enqueueForRecalc(comp: Component, forcePropagate: boolean) {\n        this._queue.push([comp, RECALC, forcePropagate])\n    }\n\n    public enqueueForPropagate(comp: Component) {\n        this._queue.push([comp, PROPAGATE, false])\n    }\n\n    public recalcAndPropagateIfNeeded(): boolean {\n        if (this._queue.length !== 0) {\n            this.recalcAndPropagate()\n            return true\n        }\n        return false\n    }\n\n    private recalcAndPropagate() {\n        let round = 1\n        do {\n            const currentQueue = [...this._queue]\n            // console.log(`Recalc/propagate round ${round}: ` + currentQueue.map((c) => c.toString()).join(\", \"))\n            this._queue = []\n            for (const [comp, udpateType, forcePropagate] of currentQueue) {\n                switch (udpateType) {\n                    case RECALC:\n                        // console.log(` -> Recalc ${comp}`)\n                        comp.recalcValue(forcePropagate)\n                        break\n                    case PROPAGATE:\n                        // console.log(` -> Propagate ${comp}`)\n                        comp.propagateCurrentValue()\n                        break\n                }\n            }\n\n            round++\n\n            // TODO smarter circular dependency tracking\n            if (round > 1000) {\n                console.log(\"ERROR circular dependency; suspending updates after 1000 recalc/propagate rounds\")\n                break\n            }\n        } while (this._queue.length !== 0)\n\n        // console.log(`Recalc/propagate done in ${round - 1} rounds.`)\n    }\n\n}\n", "import { LogicEditor } from \"./LogicEditor\"\nimport { isDefined, isEmpty, isUndefined, nonEmpty, TimeoutHandle } from \"./utils\"\n\nexport type Timestamp = number\nexport type Callback = (theoreticalTime: Timestamp) => unknown\nexport type TimelineState = { hasCallbacks: boolean, isPaused: boolean, canStep: boolean }\n\nfunction areStatesEqual(s1: TimelineState, s2: TimelineState): boolean {\n    return s1.hasCallbacks === s2.hasCallbacks\n        && s1.isPaused === s2.isPaused\n        && s1.canStep === s2.canStep\n}\n\ntype ScheduledCallbacks = { [time: Timestamp]: [Callback, string][] }\n\nexport class Timeline {\n\n    public readonly editor: LogicEditor\n\n    // what in the system time is our zero time (adjusted on pause, reset on reload)\n    private _epochStart!: Timestamp\n    private _sortedNextCallbackTimes!: Timestamp[]\n    // per callback time, a list of callbacks\n    private _schedule!: ScheduledCallbacks\n    // allows canceling the next tick if (a) we pause, (b) we enqueue something before\n    private _nextTimeoutHandle: TimeoutHandle | undefined\n    // when we are paused: the (absolute) start time of the pause\n    private _pausedSince: Timestamp | undefined\n    // remember last sent state to avoid fake events\n    private _lastSentState: TimelineState | undefined\n\n    // public callback function\n    public onStateChanged: (state: TimelineState) => unknown = __ => null\n\n    public constructor(editor: LogicEditor) {\n        this.editor = editor\n        this.reset()\n    }\n\n    public reset() {\n        this._epochStart = this.unadjustedTime()\n        this._sortedNextCallbackTimes = []\n        this._schedule = {}\n        if (isDefined(this._nextTimeoutHandle)) {\n            clearTimeout(this._nextTimeoutHandle)\n            this._nextTimeoutHandle = undefined\n        }\n        this._pausedSince = undefined\n    }\n\n    public get state(): TimelineState {\n        const hasCallbacks = nonEmpty(this._sortedNextCallbackTimes)\n        const isPaused = isDefined(this._pausedSince)\n        const canStep = isPaused && hasCallbacks\n        return { hasCallbacks, isPaused, canStep }\n    }\n\n    public unadjustedTime(): Timestamp {\n        return new Date().getTime()\n    }\n\n    public adjustedTime(): Timestamp {\n        if (isDefined(this._pausedSince)) {\n            // return constant value of \"stuck\" time\n            return this._pausedSince - this._epochStart\n        } else {\n            // return absolute time minus when we started to count\n            return this.unadjustedTime() - this._epochStart\n        }\n    }\n\n    public scheduleAt(time: Timestamp, desc: string, callback: Callback) {\n        if (time < this.adjustedTime()) {\n            console.log(`WARNING Scheduling this (${this.adjustedTime() - time} ms), may behave strangely: ` + desc)\n        }\n        // console.log(`Scheduling '${desc}' at ${time}`)\n        if (time in this._schedule) {\n            // add callback to existing time\n            this._schedule[time].push([callback, desc])\n\n        } else {\n            // add new time to sorted list of times\n            let i = 0\n            do {\n                if (i >= this._sortedNextCallbackTimes.length) {\n                    // push as last value\n                    this._sortedNextCallbackTimes.push(time)\n                    break\n                }\n                if (time < this._sortedNextCallbackTimes[i]) {\n                    // insert at position i\n                    this._sortedNextCallbackTimes.splice(i, 0, time)\n                    break\n                }\n                i++\n                // eslint-disable-next-line no-constant-condition\n            } while (true)\n            this._schedule[time] = [[callback, desc]]\n\n            if (i === 0) {\n                // inserted in front of queue\n                this.rescheduleNextIfNeeded()\n            }\n\n            this.fireStateChangedIfNeeded()\n            // console.log(\"Schedule: \", this._schedule)\n        }\n    }\n\n    private rescheduleNextIfNeeded() {\n        // schedules a timeout for the next wanted tick time\n        if (isDefined(this._nextTimeoutHandle)) {\n            clearTimeout(this._nextTimeoutHandle)\n        }\n\n        if (nonEmpty(this._sortedNextCallbackTimes)) {\n            const tickTime = this._sortedNextCallbackTimes[0]\n            const waitDuration = tickTime - this.adjustedTime()\n            this._nextTimeoutHandle = setTimeout(\n                () => this.nextTickCallback(), waitDuration\n            )\n        }\n    }\n\n    private nextTickCallback() {\n        this._nextTimeoutHandle = undefined\n        // don't do anything if this was called while we are paused\n        if (isDefined(this._pausedSince)) {\n            return\n        }\n        this.handleNextTick()\n    }\n\n    private handleNextTick() {\n        // run all the handlers from the next tick\n        const wantedTime = this._sortedNextCallbackTimes.shift() ?? -1\n        if (wantedTime === -1) {\n            return\n        }\n        const callbacks = this._schedule[wantedTime]\n        delete this._schedule[wantedTime]\n\n        const runCallback = () => {\n            // console.log(`Running ${callbacks.length} callbacks at real time ${this.adjustedTime()} (wanted for ${wantedTime})`)\n            for (const [callback, desc] of callbacks) {\n                // console.log(`  -> Running '${desc}'`)\n                try {\n                    callback(wantedTime)\n                } catch (err) {\n                    console.log(`ERROR running callback '${desc}': ` + err)\n                }\n            }\n        }\n\n        // use wrapHandler to do any recalc/redraws after\n        // calling the handlers if necessary\n        this.editor.wrapHandler(runCallback)()\n\n        // move on to the next tick\n        this.rescheduleNextIfNeeded()\n        this.fireStateChangedIfNeeded()\n    }\n\n    public pause() {\n        if (isDefined(this._pausedSince)) {\n            return\n        }\n        if (isDefined(this._nextTimeoutHandle)) {\n            clearTimeout(this._nextTimeoutHandle)\n        }\n        this._pausedSince = this.unadjustedTime()\n        this.fireStateChangedIfNeeded()\n    }\n\n    public play() {\n        if (isUndefined(this._pausedSince)) {\n            return\n        }\n        this._epochStart += (this.unadjustedTime() - this._pausedSince)\n        this._pausedSince = undefined\n        this.rescheduleNextIfNeeded()\n        this.fireStateChangedIfNeeded()\n    }\n\n    public step() {\n        if (isUndefined(this._pausedSince) || isEmpty(this._sortedNextCallbackTimes)) {\n            return\n        }\n        // move back epoch start time to simulate that the time\n        // between now and the next tick has been elapsed\n        const nextTickTime = this._sortedNextCallbackTimes[0]\n        const currentPauseTime = this.adjustedTime()\n        this._epochStart -= nextTickTime - currentPauseTime\n        this.handleNextTick()\n        this.fireStateChangedIfNeeded()\n    }\n\n    private fireStateChangedIfNeeded() {\n        const newState = this.state\n        if (isUndefined(this._lastSentState) || !areStatesEqual(this._lastSentState, newState)) {\n            this.onStateChanged(newState)\n            this._lastSentState = newState\n        }\n    }\n}\n", "import dialogPolyfill from 'dialog-polyfill'\nimport { Component, ComponentBase, ComponentState } from \"./components/Component\"\nimport { Drawable, DrawableWithPosition, Orientation } from \"./components/Drawable\"\nimport { Waypoint, Wire, WireManager, WireStyle, WireStyles } from \"./components/Wire\"\nimport { CursorMovementManager, EditorSelection } from \"./CursorMovementManager\"\nimport { clampZoom, COLOR_BACKGROUND, COLOR_BACKGROUND_UNUSED_REGION, COLOR_BORDER, COLOR_COMPONENT_BORDER, COLOR_GRID_LINES, COLOR_GRID_LINES_GUIDES, GRID_STEP, setColors, strokeSingleLine } from \"./drawutils\"\nimport { gallery } from \"./gallery\"\nimport { a, applyModifierTo, attr, attrBuilder, button, cls, div, emptyMod, href, input, label, mods, option, raw, select, span, style, target, title, type } from \"./htmlgen\"\nimport { makeComponentMenuInto } from \"./menuutils\"\nimport { MoveManager } from \"./MoveManager\"\nimport { NodeManager } from \"./NodeManager\"\nimport { PersistenceManager, Workspace } from \"./PersistenceManager\"\nimport { RecalcManager, RedrawManager } from \"./RedrawRecalcManager\"\nimport { Timeline, TimelineState } from \"./Timeline\"\nimport { copyToClipboard, downloadBlob as downloadDataUrl, formatString, getURLParameter, isDefined, isEmbeddedInIframe, isFalsyString, isNotNull, isNull, isNullOrUndefined, isString, isTruthyString, isUndefined, KeysOfByType, RichStringEnum, setVisible, showModal, targetIsFieldOrOtherInput } from \"./utils\"\n\nimport * as LZString from \"lz-string\"\nimport * as pngMeta from 'png-metadata-writer'\n// import * as QRCode from \"qrcode\"\n// import * as C2S from \"canvas2svg\"\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport LogicEditorTemplate from \"../html/LogicEditorTemplate.html\"\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport LogicEditorCSS from \"../css/LogicEditor.css\"\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport DialogPolyfillCSS from \"../../node_modules/dialog-polyfill/dist/dialog-polyfill.css\"\nimport { ComponentFactory } from \"./ComponentFactory\"\nimport { ComponentList, DrawZIndex } from \"./ComponentList\"\nimport { LabelRect } from \"./components/LabelRect\"\nimport { IconName, inlineSvgFor, isIconName, makeIcon } from \"./images\"\nimport { DefaultLang, isLang, S, setLang } from \"./strings\"\nimport { Tests } from \"./Tests\"\nimport { UndoManager } from './UndoManager'\n\n\nenum Mode {\n    STATIC,  // cannot interact in any way\n    TRYOUT,  // can change inputs on predefined circuit\n    CONNECT, // can additionnally move preexisting components around and connect them\n    DESIGN,  // can additionally add components from left menu\n    FULL,    // can additionally force output nodes to 'unset' state and draw undetermined dates\n}\n\nconst MAX_MODE_WHEN_SINGLETON = Mode.FULL\nconst MAX_MODE_WHEN_EMBEDDED = Mode.DESIGN\nconst DEFAULT_MODE = Mode.DESIGN\n\nconst ATTRIBUTE_NAMES = {\n    lang: \"lang\",\n    singleton: \"singleton\", // whether this is the only editor in the page\n    mode: \"mode\",\n    hidereset: \"hidereset\",\n\n    // these are mirrored in the display options\n    name: \"name\",\n    showonly: \"showonly\",\n    showgatetypes: \"showgatetypes\",\n    showdisconnectedpins: \"showdisconnectedpins\",\n    showtooltips: \"tooltips\",\n\n    src: \"src\",\n    data: \"data\",\n} as const\n\nexport type InitParams = {\n    orient: Orientation\n}\n\nconst DEFAULT_EDITOR_OPTIONS = {\n    name: undefined as string | undefined,\n    showOnly: undefined as undefined | Array<string>,\n    initParams: undefined as undefined | Record<string, Partial<InitParams>>,\n    showGateTypes: false,\n    showDisconnectedPins: false,\n    wireStyle: WireStyles.auto as WireStyle,\n    hideWireColors: false,\n    hideInputColors: false,\n    hideOutputColors: false,\n    hideMemoryContent: false,\n    hideTooltips: false,\n    groupParallelWires: false,\n    propagationDelay: 100,\n    zoom: 100,\n}\n\nexport type EditorOptions = typeof DEFAULT_EDITOR_OPTIONS\n\n\nexport const MouseActions = RichStringEnum.withProps<{\n    cursor: string | null\n}>()({\n    edit: { cursor: null },\n    move: { cursor: \"move\" },\n    delete: { cursor: \"not-allowed\" },\n})\nexport type MouseAction = typeof MouseActions.type\n\ntype InitialData = { _type: \"url\", url: string } | { _type: \"json\", json: string } | { _type: \"compressed\", str: string }\n\ntype HighlightedItems = { comps: Component[], wires: Wire[], start: number }\n\nexport type DrawParams = {\n    drawTime: number,\n    currentMouseOverComp: Drawable | null,\n    currentSelection: EditorSelection | undefined,\n    highlightedItems: HighlightedItems | undefined,\n    highlightColor: string | undefined,\n}\nexport class LogicEditor extends HTMLElement {\n\n    public static _globalListenersInstalled = false\n\n    public static _allConnectedEditors: Array<LogicEditor> = []\n    public static get allConnectedEditors(): ReadonlyArray<LogicEditor> {\n        return LogicEditor._allConnectedEditors\n    }\n\n    public readonly wireMgr = new WireManager(this)\n    public readonly nodeMgr = new NodeManager()\n    public readonly timeline = new Timeline(this)\n    public readonly redrawMgr = new RedrawManager()\n    public readonly recalcMgr = new RecalcManager()\n    public readonly moveMgr = new MoveManager(this)\n    public readonly cursorMovementMgr = new CursorMovementManager(this)\n    public readonly undoMgr = new UndoManager(this)\n\n    public readonly components = new ComponentList()\n\n    private _isEmbedded = false\n    private _isSingleton = false\n    private _maxInstanceMode: Mode = MAX_MODE_WHEN_EMBEDDED // can be set later\n    private _isDirty = false\n    private _mode: Mode = DEFAULT_MODE\n    private _initialData: InitialData | undefined = undefined\n    private _options: EditorOptions = { ...DEFAULT_EDITOR_OPTIONS }\n    private _hideResetButton = false\n\n    private _currentMouseAction: MouseAction = \"edit\"\n    private _toolCursor: string | null = null\n    private _highlightedItems: HighlightedItems | undefined = undefined\n    private _nextAnimationFrameHandle: number | null = null\n\n    public root: ShadowRoot\n    public readonly html: {\n        rootDiv: HTMLDivElement,\n        canvasContainer: HTMLElement,\n        mainCanvas: HTMLCanvasElement,\n        leftToolbar: HTMLElement,\n        tooltipElem: HTMLElement,\n        tooltipContents: HTMLElement,\n        mainContextMenu: HTMLElement,\n        hiddenPath: SVGPathElement,\n        fileChooser: HTMLInputElement,\n        optionsZone: HTMLElement,\n        embedDialog: HTMLDialogElement,\n        embedUrl: HTMLTextAreaElement,\n        // embedUrlQRCode: HTMLImageElement,\n        embedIframe: HTMLTextAreaElement,\n        embedWebcomp: HTMLTextAreaElement,\n        embedMarkdown: HTMLTextAreaElement,\n    }\n    public optionsHtml: {\n        nameField: HTMLInputElement,\n        showGateTypesCheckbox: HTMLInputElement,\n        showDisconnectedPinsCheckbox: HTMLInputElement,\n        wireStylePopup: HTMLSelectElement,\n        hideWireColorsCheckbox: HTMLInputElement,\n        hideInputColorsCheckbox: HTMLInputElement,\n        hideOutputColorsCheckbox: HTMLInputElement,\n        hideMemoryContentCheckbox: HTMLInputElement,\n        hideTooltipsCheckbox: HTMLInputElement,\n        groupParallelWiresCheckbox: HTMLInputElement,\n        propagationDelayField: HTMLInputElement,\n        zoomLevelField: HTMLInputElement,\n        showUserDataLinkContainer: HTMLDivElement,\n    } | undefined = undefined\n    public userdata: any = undefined\n\n    private _baseDrawingScale = 1\n    private _actualZoomFactor = 1\n    public mouseX = -1000 // offscreen at start\n    public mouseY = -1000\n\n    public constructor() {\n        super()\n\n        this.root = this.attachShadow({ mode: 'open' })\n        this.root.appendChild(template.content.cloneNode(true) as HTMLElement)\n\n        const html: typeof this.html = {\n            rootDiv: this.elemWithId(\"logicEditorRoot\"),\n            canvasContainer: this.elemWithId(\"canvas-sim\"),\n            mainCanvas: this.elemWithId(\"mainCanvas\"),\n            leftToolbar: this.elemWithId(\"leftToolbar\"),\n            tooltipElem: this.elemWithId(\"tooltip\"),\n            tooltipContents: this.elemWithId(\"tooltipContents\"),\n            mainContextMenu: this.elemWithId(\"mainContextMenu\"),\n            optionsZone: this.elemWithId(\"optionsZone\"),\n            hiddenPath: this.elemWithId(\"hiddenPath\"),\n            fileChooser: this.elemWithId(\"fileChooser\"),\n            embedDialog: this.elemWithId(\"embedDialog\"),\n            embedUrl: this.elemWithId(\"embedUrl\"),\n            // embedUrlQRCode: this.elemWithId(\"embedUrlQRCode\"),\n            embedIframe: this.elemWithId(\"embedIframe\"),\n            embedWebcomp: this.elemWithId(\"embedWebcomp\"),\n            embedMarkdown: this.elemWithId(\"embedMarkdown\"),\n        }\n        this.html = html\n        dialogPolyfill.registerDialog(html.embedDialog)\n    }\n\n    private elemWithId<E extends Element>(id: string) {\n        let elem = this.root.querySelector(`#${id}`)\n        if (elem === null) {\n            elem = document.querySelector(`#${id}`)\n            if (elem !== null) {\n                console.log(`WARNING found elem with id ${id} in document rather than in shadow root`)\n            }\n        }\n        if (elem === null) {\n            console.log(\"root\", this.root)\n            throw new Error(`Could not find element with id '${id}'`)\n        }\n        return elem as E\n    }\n\n    public static get observedAttributes() {\n        return []\n    }\n\n\n    public get mode() {\n        return this._mode\n    }\n\n    public get actualZoomFactor() {\n        return this._actualZoomFactor\n    }\n\n    public get options(): Readonly<EditorOptions> {\n        return this._options\n    }\n\n    public setPartialOptions(opts: Partial<EditorOptions>) {\n        const newOptions = { ...DEFAULT_EDITOR_OPTIONS, ...opts }\n        if (this._isSingleton) {\n            // restore showOnly\n            newOptions.showOnly = this._options.showOnly\n        }\n        this._options = newOptions\n        let optionsHtml\n\n        if (isDefined(optionsHtml = this.optionsHtml)) {\n            this.setDocumentName(newOptions.name)\n            optionsHtml.nameField.value = newOptions.name ?? \"\"\n            optionsHtml.hideWireColorsCheckbox.checked = newOptions.hideWireColors\n            optionsHtml.hideInputColorsCheckbox.checked = newOptions.hideInputColors\n            optionsHtml.hideOutputColorsCheckbox.checked = newOptions.hideOutputColors\n            optionsHtml.hideMemoryContentCheckbox.checked = newOptions.hideMemoryContent\n            optionsHtml.showGateTypesCheckbox.checked = newOptions.showGateTypes\n            optionsHtml.wireStylePopup.value = newOptions.wireStyle\n            optionsHtml.showDisconnectedPinsCheckbox.checked = newOptions.showDisconnectedPins\n            optionsHtml.hideTooltipsCheckbox.checked = newOptions.hideTooltips\n            optionsHtml.groupParallelWiresCheckbox.checked = newOptions.groupParallelWires\n            optionsHtml.propagationDelayField.valueAsNumber = newOptions.propagationDelay\n            optionsHtml.zoomLevelField.valueAsNumber = newOptions.zoom\n\n            optionsHtml.showUserDataLinkContainer.style.display = isDefined(this.userdata) ? \"initial\" : \"none\"\n        }\n\n        this._actualZoomFactor = clampZoom(newOptions.zoom)\n\n        this.redrawMgr.addReason(\"options changed\", null)\n    }\n\n    private setDocumentName(name: string | undefined) {\n        if (!this._isSingleton) {\n            return\n        }\n        const defaultTitle = \"Logic\"\n        if (isUndefined(name)) {\n            document.title = defaultTitle\n        } else {\n            document.title = `${name} \u2013 ${defaultTitle}`\n        }\n    }\n\n    public nonDefaultOptions(): undefined | Partial<EditorOptions> {\n        const nonDefaultOpts: Partial<EditorOptions> = {}\n        let set = false\n        for (const [_k, v] of Object.entries(this._options)) {\n            const k = _k as keyof EditorOptions\n            if (v !== DEFAULT_EDITOR_OPTIONS[k]) {\n                nonDefaultOpts[k] = v as any\n                set = true\n            }\n        }\n        return set ? nonDefaultOpts : undefined\n    }\n\n\n    public setActiveTool(toolElement: HTMLElement) {\n        const tool = toolElement.getAttribute(\"tool\")\n        if (isNullOrUndefined(tool)) {\n            return\n        }\n\n        // Main edit buttons on the right\n        if (MouseActions.isValue(tool)) {\n            this.wrapHandler(() => {\n                this.setCurrentMouseAction(tool)\n            })()\n            return\n        }\n\n        if (tool === \"save\") {\n            PersistenceManager.saveToFile(this)\n            return\n        }\n\n        if (tool === \"screenshot\") {\n            this.downloadSnapshotImage()\n            return\n        }\n\n        if (tool === \"open\") {\n            this.html.fileChooser.click()\n            return\n        }\n\n        this.setCurrentMouseAction(\"edit\")\n        if (tool === \"reset\") {\n            this.wrapHandler(() => {\n                this.tryLoadFromData()\n            })()\n            return\n        }\n    }\n\n    public setToolCursor(cursor: string | null) {\n        this._toolCursor = cursor\n    }\n\n    private setCanvasSize() {\n        const { canvasContainer } = this.html\n        const w = canvasContainer.clientWidth\n        const h = canvasContainer.clientHeight\n        const f = window.devicePixelRatio ?? 1\n        const mainCanvas = this.html.mainCanvas\n        mainCanvas.setAttribute(\"width\", String(w * f))\n        mainCanvas.setAttribute(\"height\", String(h * f))\n        mainCanvas.style.setProperty(\"width\", w + \"px\")\n        mainCanvas.style.setProperty(\"height\", h + \"px\")\n        this._baseDrawingScale = f\n    }\n\n    public connectedCallback() {\n        const { rootDiv, mainCanvas } = this.html\n\n        const parentStyles = this.getAttribute(\"style\")\n        if (isNotNull(parentStyles)) {\n            rootDiv.setAttribute(\"style\", rootDiv.getAttribute(\"style\") + parentStyles)\n        }\n\n        // TODO move this in SelectionMgr?\n        mainCanvas.ondragenter = () => {\n            return false\n        }\n        mainCanvas.ondragover = () => {\n            return false\n        }\n        mainCanvas.ondragend = () => {\n            return false\n        }\n        mainCanvas.ondrop = e => {\n            if (isNull(e.dataTransfer)) {\n                return false\n            }\n\n            e.preventDefault()\n            const file = e.dataTransfer.files?.[0]\n            if (isDefined(file)) {\n                this.tryLoadFromFile(file)\n            } else {\n                const dataItems = e.dataTransfer.items\n                if (isDefined(dataItems)) {\n                    for (let i = 0; i < dataItems.length; i++) {\n                        const dataItem = dataItems[i]\n                        if (dataItem.kind === \"string\" && (dataItem.type === \"application/json\" || dataItem.type !== \"text/plain\")) {\n                            dataItem.getAsString(content => {\n                                e.dataTransfer!.dropEffect = \"copy\"\n                                this.load(content)\n                            })\n                            break\n                        }\n                    }\n                }\n            }\n            return false\n        }\n\n        // TODO clear all redrawmanager\n        // TODO add initial reason to redraw\n        // draw\n\n        this.cursorMovementMgr.registerCanvasListenersOn(this.html.mainCanvas)\n        if (LogicEditor._allConnectedEditors.length === 0) {\n            // set lang on first instance of editor on the page\n            this.setupLang()\n        }\n        LogicEditor._allConnectedEditors.push(this)\n        this.setup()\n    }\n\n    public disconnectedCallback() {\n        const insts = LogicEditor._allConnectedEditors\n        insts.splice(insts.indexOf(this), 1)\n\n        // TODO\n        // this.cursorMovementManager.unregisterCanvasListenersOn(this.html.mainCanvas)\n    }\n\n    private setupLang() {\n        const getNavigatorLanguage = () => {\n            const lang = navigator.languages?.[0] ?? navigator.language\n            if (lang.length > 2) {\n                return lang.substring(0, 2)\n            }\n            if (lang.length === 2) {\n                return lang\n            }\n            return undefined\n        }\n\n        const getSavedLang = () => {\n            return localStorage.getItem(ATTRIBUTE_NAMES.lang)\n        }\n\n        const langStr = (getURLParameter(ATTRIBUTE_NAMES.lang)\n            ?? this.getAttribute(ATTRIBUTE_NAMES.lang)\n            ?? getSavedLang()\n            ?? getNavigatorLanguage()\n            ?? DefaultLang).toLowerCase()\n        const lang = isLang(langStr) ? langStr : DefaultLang\n        setLang(lang)\n    }\n\n    private setup() {\n        this._isEmbedded = isEmbeddedInIframe()\n        const singletonAttr = this.getAttribute(ATTRIBUTE_NAMES.singleton)\n        this._isSingleton = !this._isEmbedded && singletonAttr !== null && !isFalsyString(singletonAttr)\n        this._maxInstanceMode = this._isSingleton && !this._isEmbedded ? MAX_MODE_WHEN_SINGLETON : MAX_MODE_WHEN_EMBEDDED\n\n        // Transfer from URL param to attributes if we are in singleton mode\n        if (this._isSingleton || this._isEmbedded) {\n            const transferUrlParamToAttribute = (name: string) => {\n                const value = getURLParameter(name)\n                if (isDefined(value)) {\n                    this.setAttribute(name, value)\n                }\n            }\n\n            for (const attr of [\n                ATTRIBUTE_NAMES.mode,\n                ATTRIBUTE_NAMES.showonly,\n                ATTRIBUTE_NAMES.showgatetypes,\n                ATTRIBUTE_NAMES.showdisconnectedpins,\n                ATTRIBUTE_NAMES.showtooltips,\n                ATTRIBUTE_NAMES.data,\n                ATTRIBUTE_NAMES.src,\n                ATTRIBUTE_NAMES.hidereset,\n            ]) {\n                transferUrlParamToAttribute(attr)\n            }\n\n            const userParamPrefix = \"user\"\n            const url = new URL(window.location.href)\n            url.searchParams.forEach((value: string, key: string) => {\n                if (key.startsWith(userParamPrefix)) {\n                    key = key.substring(userParamPrefix.length)\n                    if (key.startsWith(\".\")) {\n                        key = key.substring(1)\n                    }\n                    if (key.length === 0) {\n                        this.userdata = value\n                    } else {\n                        key = key[0].toLowerCase() + key.substring(1)\n                        if (typeof this.userdata !== \"object\") {\n                            this.userdata = {}\n                        }\n                        if (key in this.userdata) {\n                            const oldValue = this.userdata[key]\n                            if (Array.isArray(oldValue)) {\n                                oldValue.push(value)\n                            } else {\n                                this.userdata[key] = [oldValue, value]\n                            }\n                        } else {\n                            this.userdata[key] = value\n                        }\n                    }\n                }\n            })\n            if (isDefined(this.userdata)) {\n                console.log(\"Custom user data: \", this.userdata)\n            }\n        }\n\n        if (this._isSingleton) {\n            console.log(\"LogicEditor is in singleton mode\")\n\n            // singletons manage their dark mode according to system settings\n            const darkModeQuery = window.matchMedia(\"(prefers-color-scheme: dark)\")\n            darkModeQuery.onchange = () => {\n                setColors(darkModeQuery.matches)\n            }\n            setColors(darkModeQuery.matches)\n\n            window.addEventListener(\"keyup\", this.wrapHandler(e => {\n                if (targetIsFieldOrOtherInput(e)) {\n                    return\n                }\n                switch (e.key) {\n                    case \"Escape\":\n                        this.tryDeleteComponentsWhere(comp => comp.state === ComponentState.SPAWNING, false)\n                        this.wireMgr.tryCancelWire()\n                        e.preventDefault()\n                        return\n\n                    case \"Backspace\":\n                    case \"Delete\": {\n                        let selComp\n                        if (isDefined(selComp = this.cursorMovementMgr.currentSelection?.previouslySelectedElements) && selComp.size !== 0) {\n                            for (const comp of selComp) {\n                                this.tryDeleteDrawable(comp)\n                            }\n                            this.undoMgr.takeSnapshot()\n                        } else if ((selComp = this.cursorMovementMgr.currentMouseOverComp) !== null) {\n                            this.tryDeleteDrawable(selComp)\n                            this.undoMgr.takeSnapshot()\n                        }\n                        e.preventDefault()\n                        return\n                    }\n\n                    case \"e\":\n                        this.setCurrentMouseAction(\"edit\")\n                        e.preventDefault()\n                        return\n\n                    case \"d\":\n                        this.setCurrentMouseAction(\"delete\")\n                        e.preventDefault()\n                        return\n\n                    case \"m\":\n                        this.setCurrentMouseAction(\"move\")\n                        e.preventDefault()\n                        return\n\n                    case \"ArrowRight\":\n                        this.trySetCurrentComponentOrientation(\"e\", e)\n                        return\n                    case \"ArrowLeft\":\n                        this.trySetCurrentComponentOrientation(\"w\", e)\n                        return\n                    case \"ArrowUp\":\n                        this.trySetCurrentComponentOrientation(\"n\", e)\n                        return\n                    case \"ArrowDown\":\n                        this.trySetCurrentComponentOrientation(\"s\", e)\n                        return\n                }\n            }))\n\n            // TODO this should also work then not in singleton mode,\n            // but it still requires listening for keydown on the window,\n            // so we must know which was the lastest editor on screen to target\n            // this to\n            window.addEventListener(\"keydown\", this.wrapHandler(e => {\n                const ctrlOrCommand = e.ctrlKey || e.metaKey\n                const keyLower = e.key.toLowerCase()\n                const shift = e.shiftKey || (keyLower !== e.key)\n                switch (keyLower) {\n                    case \"a\":\n                        if (ctrlOrCommand && this.mode >= Mode.CONNECT && !targetIsFieldOrOtherInput(e)) {\n                            this.cursorMovementMgr.selectAll()\n                            e.preventDefault()\n                        }\n                        return\n\n                    case \"s\":\n                        if (ctrlOrCommand && this._isSingleton) {\n                            this.saveCurrentStateToUrl()\n                            e.preventDefault()\n                        }\n                        return\n\n                    case \"z\":\n                        if (ctrlOrCommand && !targetIsFieldOrOtherInput(e)) {\n                            if (shift) {\n                                this.undoMgr.redo()\n                            } else {\n                                this.undoMgr.undo()\n                            }\n                            e.preventDefault()\n                        }\n                        return\n                    case \"y\":\n                        if (ctrlOrCommand && !targetIsFieldOrOtherInput(e)) {\n                            this.undoMgr.redo()\n                            e.preventDefault()\n                        }\n                        return\n                    case \"x\":\n                        if (ctrlOrCommand && !targetIsFieldOrOtherInput(e)) {\n                            this.cut()\n                            e.preventDefault()\n                        }\n                        return\n                    // case \"c\":\n                    // NO: this prevents the sharing code from being copied\n                    // if (ctrlOrCommand && !targetIsField()) {\n                    //     this.copy()\n                    //     e.preventDefault()\n                    // }\n                    // return\n                    case \"v\":\n                        if (ctrlOrCommand && !targetIsFieldOrOtherInput(e)) {\n                            this.paste()\n                            e.preventDefault()\n                        }\n                        return\n                }\n\n                const mouseOverComp = this.cursorMovementMgr.currentMouseOverComp\n                if (mouseOverComp !== null) {\n                    mouseOverComp.keyDown(e)\n                }\n            }))\n\n            // make load function available globally\n            window.Logic.singleton = this\n            window.load = this.load.bind(this)\n            window.save = this.save.bind(this)\n            window.highlight = this.highlight.bind(this)\n\n            window.adjustedTime = () => {\n                const nowAdjusted = this.timeline.adjustedTime()\n                // console.log(nowAdjusted)\n                return nowAdjusted\n            }\n\n            this.html.canvasContainer.appendChild(\n                div(style(\"user-select: none; position: absolute; bottom: 0; right: 0; padding: 5px 3px 2px 5px; background-color: rgba(255,255,255,0.3); color: rgba(0,0,0,0.2); border-radius: 10px 0 0 0; font-size: 69%; font-style: italic;\"),\n                    \"D\u00E9velopp\u00E9 par \",\n                    a(style(\"color: inherit\"),\n                        href(\"https://github.com/jppellet/Logic-Circuit-Simulator\"), target(\"_blank\"),\n                        \"Jean-Philippe Pellet\"\n                    ),\n                    \", \",\n                    a(style(\"color: inherit\"),\n                        href(\"https://www.hepl.ch/accueil/formation/unites-enseignement-et-recherche/medias-usages-numeriques-et-didactique-de-linformatique.html\"), target(\"_blank\"),\n                        \"HEP Vaud\"\n                    ),\n                ).render()\n            )\n\n            window.onbeforeunload = e => {\n                if (this._isSingleton && this._isDirty && this.mode >= Mode.CONNECT) {\n                    e.preventDefault() // ask to save changes\n                    e.returnValue = S.Messages.ReallyCloseWindow\n                }\n            }\n        }\n\n        // Load parameters from attributes\n        let modeAttr = this.getAttribute(ATTRIBUTE_NAMES.mode)\n        if (modeAttr !== null && (modeAttr = modeAttr.toUpperCase()) in Mode) {\n            this._maxInstanceMode = (Mode as any)[modeAttr]\n        }\n\n        const showonlyAttr = this.getAttribute(ATTRIBUTE_NAMES.showonly)\n        if (showonlyAttr !== null) {\n            this._options.showOnly = showonlyAttr.toLowerCase().split(/[, +]+/).filter(x => x.trim())\n        }\n\n        const showgatetypesAttr = this.getAttribute(ATTRIBUTE_NAMES.showgatetypes)\n        if (showgatetypesAttr !== null) {\n            this._options.showGateTypes = isTruthyString(showgatetypesAttr)\n        }\n\n        const showdisconnectedpinsAttr = this.getAttribute(ATTRIBUTE_NAMES.showdisconnectedpins)\n        if (showdisconnectedpinsAttr !== null) {\n            this._options.showDisconnectedPins = isTruthyString(showdisconnectedpinsAttr)\n        }\n\n        const showtooltipsAttr = this.getAttribute(ATTRIBUTE_NAMES.showtooltips)\n        if (showtooltipsAttr !== null) {\n            this._options.hideTooltips = !isFalsyString(showtooltipsAttr)\n        }\n\n        // TODO move this to options so that it is correctly persisted, too\n        this._hideResetButton = this.getAttribute(ATTRIBUTE_NAMES.hidereset) !== null && !isFalsyString(this.getAttribute(ATTRIBUTE_NAMES.hidereset))\n\n        let dataOrSrcRef\n        if ((dataOrSrcRef = this.getAttribute(ATTRIBUTE_NAMES.data)) !== null) {\n            this._initialData = { _type: \"compressed\", str: dataOrSrcRef }\n        } else if ((dataOrSrcRef = this.getAttribute(ATTRIBUTE_NAMES.src)) !== null) {\n            this._initialData = { _type: \"url\", url: dataOrSrcRef }\n        } else {\n\n            const tryLoadFromLightDOM = () => {\n                const innerScriptElem = this.findLightDOMChild(\"script\")\n                if (innerScriptElem !== null) {\n                    this._initialData = { _type: \"json\", json: innerScriptElem.innerHTML }\n                    innerScriptElem.remove() // remove the data element to hide the raw data\n                    // do this manually\n                    this.tryLoadFromData()\n                    this.doRedraw()\n                    return true\n                } else {\n                    return false\n                }\n            }\n\n            // try to load from the children of the light DOM,\n            // but this has to be done later as it hasn't been parsed yet\n            setTimeout(() => {\n                const loaded = tryLoadFromLightDOM()\n\n                // sometimes the light DOM is not parsed yet, so try again a bit later\n                if (!loaded) {\n                    setTimeout(() => {\n                        tryLoadFromLightDOM()\n                    }, 100)\n                }\n            })\n        }\n\n        const setCaption = (buttonId: string, name: string) => this.elemWithId(buttonId).insertAdjacentText(\"beforeend\", name)\n\n        {\n            // set strings in the UI\n            const s = S.Palette\n            setCaption(\"editToolButton\", s.Design)\n            setCaption(\"deleteToolButton\", s.Delete)\n            setCaption(\"moveToolButton\", s.Move)\n            setCaption(\"saveToolButton\", s.Download)\n            setCaption(\"screenshotToolButton\", s.Screenshot)\n            setCaption(\"openToolButton\", s.Open)\n            setCaption(\"resetToolButtonCaption\", s.Reset)\n            setCaption(\"settingsTitle\", S.Settings.Settings)\n        }\n\n        {\n            const s = S.Dialogs.Share\n            setCaption(\"shareDialogTitle\", s.title)\n            setCaption(\"shareDialogUrl\", s.URL)\n            setCaption(\"shareDialogIframe\", s.EmbedInIframe)\n            setCaption(\"shareDialogWebComp\", s.EmbedWithWebComp)\n            setCaption(\"shareDialogMarkdown\", s.EmbedInMarkdown)\n            setCaption(\"shareDialogClose\", S.Dialogs.Generic.Close)\n        }\n\n        makeComponentMenuInto(this.html.leftToolbar, this._options.showOnly)\n\n        const groupButton = this.html.leftToolbar.querySelector(\"button.sim-component-button[data-component=label][data-type=rect]\")\n        if (groupButton === null) {\n            console.log(\"ERROR: Could not find group button\")\n        } else {\n            groupButton.addEventListener(\"mousedown\", this.wrapHandler(e => {\n                const selectedComps = this.cursorMovementMgr.currentSelection?.previouslySelectedElements || new Set()\n                if (selectedComps.size !== 0) {\n                    e.preventDefault()\n                    e.stopImmediatePropagation()\n                    const factory = ComponentFactory.makeFactoryForButton(groupButton as HTMLElement)\n                    const newGroup = factory(this)\n                    newGroup.setSpawned()\n\n                    if (newGroup instanceof LabelRect) {\n                        newGroup.wrapContents(selectedComps)\n                    } else {\n                        console.log(\"ERROR: created component is not a LabelRect\")\n                    }\n                }\n            }))\n        }\n\n        this.cursorMovementMgr.registerButtonListenersOn(this.root.querySelectorAll(\".sim-component-button\"))\n\n        const modifButtons = this.root.querySelectorAll(\"button.sim-modification-tool\")\n        for (let i = 0; i < modifButtons.length; i++) {\n            const but = modifButtons[i] as HTMLElement\n            but.addEventListener(\"click\", () => {\n                this.setActiveTool(but)\n            })\n        }\n\n        const showModeChange = this._maxInstanceMode >= Mode.FULL\n        if (showModeChange) {\n            const modeChangeMenu: HTMLElement = this.elemWithId(\"modeChangeMenu\")!\n            div(cls(\"btn-group-vertical\"),\n                div(style(\"text-align: center; width: 100%; font-weight: bold; font-size: 80%; color: #666; padding: 2px;\"),\n                    \"Mode\",\n                ),\n                ...[Mode.FULL, Mode.DESIGN, Mode.CONNECT, Mode.TRYOUT, Mode.STATIC].map((buttonMode) => {\n                    const [[modeTitle, expl], addElem] = (() => {\n                        switch (buttonMode) {\n                            case Mode.FULL: {\n                                const optionsDiv =\n                                    div(cls(\"sim-mode-link\"),\n                                        title(S.Settings.Settings),\n                                        makeIcon(\"settings\")\n                                    ).render()\n\n                                optionsDiv.addEventListener(\"click\", () => {\n                                    setVisible(this.html.optionsZone, true)\n                                })\n\n                                return [S.Modes.FULL, optionsDiv]\n                            }\n                            case Mode.DESIGN: return [S.Modes.DESIGN, emptyMod]\n                            case Mode.CONNECT: return [S.Modes.CONNECT, emptyMod]\n                            case Mode.TRYOUT: return [S.Modes.TRYOUT, emptyMod]\n                            case Mode.STATIC: return [S.Modes.STATIC, emptyMod]\n                        }\n                    })()\n\n                    const copyLinkDiv =\n                        div(cls(\"sim-mode-link\"),\n                            title(\"Copie un lien vers ce contenu dans ce mode\"),\n                            makeIcon(\"link\"),\n                        ).render()\n\n                    copyLinkDiv.addEventListener(\"click\", __ => {\n                        this.shareSheetForMode(buttonMode)\n                    })\n\n                    const switchToModeDiv =\n                        div(cls(\"btn btn-sm btn-outline-light sim-toolbar-button-right sim-mode-tool\"),\n                            style(\"display: flex; justify-content: space-between; align-items: center\"),\n                            attrBuilder(\"mode\")(Mode[buttonMode]),\n                            title(expl),\n                            modeTitle,\n                            addElem,\n                            copyLinkDiv\n                        ).render()\n\n                    switchToModeDiv.addEventListener(\"click\", this.wrapHandler(() => this.setMode(buttonMode)))\n\n                    return switchToModeDiv\n                })\n            ).applyTo(modeChangeMenu)\n            setVisible(modeChangeMenu, true)\n        }\n\n        // this.html.embedUrlQRCode.addEventListener(\"click\", __ => {\n        //     // download\n        //     const dataUrl = this.html.embedUrlQRCode.src\n        //     const filename = (this.options.name ?? \"circuit\") + \"_qrcode.png\"\n        //     downloadDataUrl(dataUrl, filename)\n        // })\n\n        this.html.fileChooser.addEventListener(\"change\", __ => {\n            let files\n            if ((files = this.html.fileChooser.files) !== null && files.length > 0) {\n                this.tryLoadFromFile(files[0])\n            }\n        })\n\n        const selectAllListener = (e: Event) => {\n            const textArea = e.target as HTMLTextAreaElement\n            textArea.focus()\n            textArea.select()\n            e.preventDefault()\n        }\n        for (const textArea of [this.html.embedUrl, this.html.embedIframe, this.html.embedWebcomp, this.html.embedMarkdown]) {\n            textArea.addEventListener(\"pointerdown\", selectAllListener)\n            textArea.addEventListener(\"focus\", selectAllListener)\n        }\n\n\n        const timelineControls: HTMLElement = this.elemWithId(\"timelineControls\")!\n        const makeTimelineButton = (icon: IconName, [text, expl]: [string | undefined, string], action: () => unknown) => {\n            const but =\n                button(cls(\"btn btn-sm btn-outline-light sim-toolbar-button-right\"),\n                    isUndefined(text) ? style(\"text-align: center\") : emptyMod,\n                    title(expl),\n                    makeIcon(icon, 20, 20),\n                    isUndefined(text) ? raw(\"&nbsp;\") : text,\n                ).render()\n            but.addEventListener(\"click\", action)\n            return but\n        }\n        const playButton = makeTimelineButton(\"play\", S.Timeline.Play, () => this.timeline.play())\n        const pauseButton = makeTimelineButton(\"pause\", S.Timeline.Pause, () => this.timeline.pause())\n        const stepButton = makeTimelineButton(\"step\", S.Timeline.Step, () => this.timeline.step())\n        applyModifierTo(timelineControls, mods(playButton, pauseButton, stepButton))\n\n        const showTimelineButtons = true\n        setVisible(timelineControls, showTimelineButtons)\n\n        function setTimelineButtonsVisible(state: TimelineState) {\n            if (state.hasCallbacks) {\n                // show part of the interface\n                setVisible(playButton, state.isPaused)\n                setVisible(pauseButton, !state.isPaused)\n                setVisible(stepButton, state.canStep)\n            } else {\n                // show nothing\n                setVisible(playButton, false)\n                setVisible(pauseButton, false)\n                setVisible(stepButton, false)\n            }\n        }\n\n        this.timeline.reset()\n        this.timeline.onStateChanged = newState => setTimelineButtonsVisible(newState)\n        setTimelineButtonsVisible(this.timeline.state)\n\n        // Options\n        const optionsZone = this.html.optionsZone\n        optionsZone.querySelector(\"#closeOptions\")?.addEventListener(\"click\", () => {\n            setVisible(optionsZone, false)\n        })\n\n        const makeCheckbox = <K extends KeysOfByType<EditorOptions, boolean>>(optionName: K, [title, mouseover]: [string, string], hide = false) => {\n            const checkbox = input(type(\"checkbox\")).render()\n            if (this.options[optionName] === true) {\n                checkbox.checked = true\n            }\n            checkbox.addEventListener(\"change\", this.wrapHandler(() => {\n                this._options[optionName] = checkbox.checked\n                this.redrawMgr.addReason(\"option changed: \" + optionName, null)\n            }))\n            const section = div(\n                style(\"height: 20px\"),\n                label(checkbox, span(style(\"margin-left: 4px\"), attr(\"title\", mouseover), title))\n            ).render()\n            optionsZone.appendChild(section)\n            if (hide) {\n                setVisible(section, false)\n            }\n            return checkbox\n        }\n\n        const nameField = input(type(\"text\"),\n            style(\"margin-left: 4px\"),\n            attr(\"value\", this.options.name ?? \"\"),\n            attr(\"placeholder\", \"circuit\"),\n            attr(\"title\", S.Settings.NameOfDownloadedFile),\n        ).render()\n        nameField.addEventListener(\"change\", () => {\n            const newName = nameField.value\n            this._options.name = newName.length === 0 ? undefined : newName\n            this.setDocumentName(this._options.name)\n        })\n        optionsZone.appendChild(\n            div(\n                style(\"height: 20px; margin-bottom: 4px\"),\n                S.Settings.CircuitName, nameField\n            ).render()\n        )\n\n        const hideWireColorsCheckbox = makeCheckbox(\"hideWireColors\", S.Settings.hideWireColors)\n        const hideInputColorsCheckbox = makeCheckbox(\"hideInputColors\", S.Settings.hideInputColors)\n        const hideOutputColorsCheckbox = makeCheckbox(\"hideOutputColors\", S.Settings.hideOutputColors)\n        const hideMemoryContentCheckbox = makeCheckbox(\"hideMemoryContent\", S.Settings.hideMemoryContent)\n        const showGateTypesCheckbox = makeCheckbox(\"showGateTypes\", S.Settings.showGateTypes)\n        const showDisconnectedPinsCheckbox = makeCheckbox(\"showDisconnectedPins\", S.Settings.showDisconnectedPins)\n        const hideTooltipsCheckbox = makeCheckbox(\"hideTooltips\", S.Settings.hideTooltips)\n        const groupParallelWiresCheckbox = makeCheckbox(\"groupParallelWires\", S.Settings.groupParallelWires, true)\n        // \n        const wireStylePopup = select(\n            option(attr(\"value\", WireStyles.auto), S.Settings.WireStyleAuto),\n            option(attr(\"value\", WireStyles.straight), S.Settings.WireStyleLine),\n            option(attr(\"value\", WireStyles.bezier), S.Settings.WireStyleCurve),\n        ).render()\n        wireStylePopup.addEventListener(\"change\", this.wrapHandler(() => {\n            this._options.wireStyle = wireStylePopup.value as WireStyle\n            this.redrawMgr.addReason(\"wire style changed\", null)\n        }))\n        optionsZone.appendChild(\n            div(\n                style(\"height: 20px\"),\n                S.Settings.wireStyle + \" \", wireStylePopup\n            ).render()\n        )\n\n        const propagationDelayField = input(type(\"number\"),\n            style(\"margin: 0 4px; width: 4em\"),\n            attr(\"min\", \"0\"), attr(\"step\", \"50\"),\n            attr(\"value\", String(this.options.propagationDelay)),\n            attr(\"title\", S.Settings.propagationDelay),\n        ).render()\n        propagationDelayField.addEventListener(\"change\", () => {\n            this._options.propagationDelay = propagationDelayField.valueAsNumber\n        })\n        optionsZone.appendChild(\n            div(\n                style(\"height: 20px\"),\n                S.Settings.propagationDelayField[0], propagationDelayField, S.Settings.propagationDelayField[1]\n            ).render()\n        )\n\n        const zoomLevelField = input(type(\"number\"),\n            style(\"margin: 0 2px 0 5px; width: 4em\"),\n            attr(\"min\", \"0\"), attr(\"step\", \"10\"),\n            attr(\"value\", String(this.options.zoom)),\n            attr(\"title\", S.Settings.zoomLevel),\n        ).render()\n        zoomLevelField.addEventListener(\"change\", this.wrapHandler(() => {\n            const zoom = zoomLevelField.valueAsNumber\n            this._options.zoom = zoom\n            this._actualZoomFactor = clampZoom(zoom)\n            this.redrawMgr.addReason(\"zoom level changed\", null)\n        }))\n        optionsZone.appendChild(\n            div(\n                style(\"height: 20px\"),\n                S.Settings.zoomLevelField[0], zoomLevelField, S.Settings.zoomLevelField[1]\n            ).render()\n        )\n\n        const showUserdataLink = a(S.Settings.showUserDataLink[1], style(\"text-decoration: underline; cursor: pointer\")).render()\n        showUserdataLink.addEventListener(\"click\", () => {\n            alert(S.Settings.userDataHeader + \"\\n\\n\" + JSON.stringify(this.userdata, undefined, 4))\n        })\n        const showUserDataLinkContainer = div(\n            style(\"margin-top: 5px; display: none\"),\n            S.Settings.showUserDataLink[0], showUserdataLink,\n        ).render()\n        optionsZone.appendChild(showUserDataLinkContainer)\n\n        this.optionsHtml = {\n            nameField,\n            hideWireColorsCheckbox,\n            hideInputColorsCheckbox,\n            hideOutputColorsCheckbox,\n            hideMemoryContentCheckbox,\n            wireStylePopup,\n            showGateTypesCheckbox,\n            showDisconnectedPinsCheckbox,\n            hideTooltipsCheckbox,\n            groupParallelWiresCheckbox,\n            propagationDelayField,\n            zoomLevelField,\n            showUserDataLinkContainer,\n        }\n\n        // this is called once here to set the initial transform and size before the first draw, and again later\n        this.setCanvasSize()\n\n        this.tryLoadFromData()\n        // also triggers redraw, should be last thing called here\n\n        this.setModeFromString(this.getAttribute(ATTRIBUTE_NAMES.mode))\n\n        // this is called a second time here because the canvas width may have changed following the mode change\n        this.setCanvasSize()\n        LogicEditor.installGlobalListeners()\n\n        this.doRedraw()\n    }\n\n    private findLightDOMChild<K extends keyof HTMLElementTagNameMap>(tagName: K): HTMLElementTagNameMap[K] | null {\n        tagName = tagName.toUpperCase() as any\n        for (const child of Array.from(this.children)) {\n            if (child.tagName === tagName) {\n                return child as HTMLElementTagNameMap[K]\n            }\n        }\n        return null\n    }\n\n    public static installGlobalListeners() {\n        if (LogicEditor._globalListenersInstalled) {\n            return\n        }\n\n        window.formatString = formatString\n\n        // make gallery available globally\n        window.gallery = gallery\n\n        window.addEventListener(\"mousemove\", e => {\n            // console.log({ x: e.clientX, y: e.clientY })\n            for (const editor of LogicEditor._allConnectedEditors) {\n                const canvasContainer = editor.html.canvasContainer\n                if (isDefined(canvasContainer)) {\n                    const canvasPos = canvasContainer.getBoundingClientRect()\n                    // console.log(canvasContainer.getBoundingClientRect(), { x: e.clientX - canvasPos.left, y: e.clientY - canvasPos.top })\n                    editor.mouseX = e.clientX - canvasPos.left\n                    editor.mouseY = e.clientY - canvasPos.top\n                }\n            }\n            // console.log(\"--\")\n        }, true)\n\n        window.addEventListener(\"resize\", () => {\n            for (const editor of LogicEditor._allConnectedEditors) {\n                const canvasContainer = editor.html.canvasContainer\n                if (isDefined(canvasContainer)) {\n                    editor.wrapHandler(() => {\n                        editor.setCanvasSize()\n                        editor.redrawMgr.addReason(\"window resized\", null)\n                    })()\n                }\n            }\n            registerPixelRatioListener()\n        })\n\n        let pixelRatioMediaQuery: undefined | MediaQueryList\n        const registerPixelRatioListener = () => {\n            if (isDefined(pixelRatioMediaQuery)) {\n                pixelRatioMediaQuery.onchange = null\n            }\n\n            const queryString = `(resolution: ${window.devicePixelRatio}dppx)`\n            pixelRatioMediaQuery = window.matchMedia(queryString)\n            pixelRatioMediaQuery.onchange = () => {\n                for (const editor of LogicEditor._allConnectedEditors) {\n                    editor.wrapHandler(() => {\n                        editor.redrawMgr.addReason(\"devicePixelRatio changed\", null)\n                    })()\n                }\n                registerPixelRatioListener()\n            }\n        }\n        registerPixelRatioListener()\n\n        document.body.addEventListener(\"themechanged\", (e) => {\n            const isDark = Boolean((e as any).detail?.is_dark_theme)\n            setColors(isDark)\n        })\n\n        LogicEditor._globalListenersInstalled = true\n    }\n\n    public setMode(mode: Mode) {\n        this.wrapHandler(() => {\n            let wantedModeStr = Mode[mode]\n            if (mode > this._maxInstanceMode) {\n                mode = this._maxInstanceMode\n                console.log(`Cannot switch to mode ${wantedModeStr} because we are capped by ${Mode[this._maxInstanceMode]}`)\n                wantedModeStr = Mode[mode]\n            }\n            this._mode = mode\n\n            // console.log(`Display/interaction is ${wantedModeStr} - ${mode}`)\n\n            this.redrawMgr.addReason(\"mode changed\", null)\n\n            // update mode active button\n            this.root.querySelectorAll(\".sim-mode-tool\").forEach((elem) => {\n                if (elem.getAttribute(\"mode\") === wantedModeStr) {\n                    elem.classList.add(\"active\")\n                } else {\n                    elem.classList.remove(\"active\")\n                }\n            })\n\n            if (mode < Mode.CONNECT) {\n                this.setCurrentMouseAction(\"edit\")\n            }\n\n            type LeftMenuDisplay = \"show\" | \"hide\" | \"inactive\"\n\n            const showLeftMenu: LeftMenuDisplay =\n                (this._maxInstanceMode !== Mode.FULL)\n                    ? (mode >= Mode.DESIGN) ? \"show\" : \"hide\"\n                    : (mode >= Mode.DESIGN) ? \"show\" : \"inactive\"\n\n            const showRightEditControls = mode >= Mode.CONNECT\n            const modifButtons = this.root.querySelectorAll(\"button.sim-modification-tool\")\n            for (let i = 0; i < modifButtons.length; i++) {\n                const but = modifButtons[i] as HTMLElement\n                setVisible(but, showRightEditControls)\n            }\n\n            const showReset = mode >= Mode.TRYOUT && !this._hideResetButton\n            const showRightMenu = showReset || showRightEditControls\n            const showOnlyReset = showReset && !showRightEditControls\n            const hideSettings = mode < Mode.FULL\n\n            setVisible(this.elemWithId(\"resetToolButton\"), showReset)\n            setVisible(this.elemWithId(\"resetToolButtonCaption\"), !showOnlyReset)\n            setVisible(this.elemWithId(\"resetToolButtonDummyCaption\"), showOnlyReset)\n\n            if (hideSettings) {\n                setVisible(this.html.optionsZone, false)\n            }\n\n            const leftToolbar = this.html.leftToolbar\n            switch (showLeftMenu) {\n                case \"hide\":\n                    leftToolbar.style.removeProperty(\"visibility\")\n                    leftToolbar.style.display = \"none\"\n                    break\n                case \"show\":\n                    leftToolbar.style.removeProperty(\"visibility\")\n                    leftToolbar.style.removeProperty(\"display\")\n                    break\n                case \"inactive\":\n                    leftToolbar.style.visibility = \"hidden\"\n                    leftToolbar.style.removeProperty(\"display\")\n                    break\n            }\n\n            // const showTxGates = mode >= Mode.FULL && (isUndefined(showOnly) || showOnly.includes(\"TX\") || showOnly.includes(\"TXA\"))\n            // const txGateButton = this.root.querySelector(\"button[data-type=TXA]\") as HTMLElement\n            // setVisible(txGateButton, showTxGates)\n\n            const rightToolbarContainer: HTMLElement = this.elemWithId(\"rightToolbarContainer\")\n            setVisible(rightToolbarContainer, showRightMenu)\n        })()\n    }\n\n    public setModeFromString(modeStr: string | null) {\n        let mode: Mode = this._maxInstanceMode\n        if (modeStr !== null && (modeStr = modeStr.toUpperCase()) in Mode) {\n            mode = (Mode as any)[modeStr]\n        }\n        this.setMode(mode)\n    }\n\n    public tryLoadFromFile(file: File) {\n        if (file.type === \"application/json\" || file.type === \"text/plain\") {\n            const reader = new FileReader()\n            reader.onload = e => {\n                const content = e.target?.result?.toString()\n                if (isDefined(content)) {\n                    this.load(content)\n                }\n            }\n            reader.readAsText(file, \"utf-8\")\n        } else if (file.type === \"image/png\") {\n            const reader = new FileReader()\n            reader.onload = e => {\n                const content = e.target?.result\n                if (content instanceof ArrayBuffer) {\n                    const uintArray2 = new Uint8Array(content)\n                    const pngMetadata = pngMeta.readMetadata(uintArray2)\n                    const compressedJSON = pngMetadata.tEXt?.Description\n                    if (isString(compressedJSON)) {\n                        this._initialData = { _type: \"compressed\", str: compressedJSON }\n                        this.tryLoadFromData()\n                    }\n                }\n            }\n            reader.readAsArrayBuffer(file)\n        } else {\n            console.log(\"Unsupported file type\", file.type)\n        }\n    }\n\n    public tryLoadFromData() {\n        if (isUndefined(this._initialData)) {\n            return\n        }\n\n        if (this._initialData._type === \"url\") {\n            // load from URL\n            const url = this._initialData.url\n            // will only work within the same domain for now\n            fetch(url, { mode: \"cors\" }).then(response => response.text()).then(json => {\n                console.log(`Loaded initial data from URL '${url}'`)\n                this._initialData = { _type: \"json\", json }\n                this.tryLoadFromData()\n            })\n\n            // TODO try fetchJSONP if this fails?\n\n            return\n        }\n\n        let error: undefined | string = undefined\n\n        if (this._initialData._type === \"json\") {\n            // already decompressed\n            try {\n                error = PersistenceManager.doLoadFromJson(this, this._initialData.json)\n            } catch (e) {\n                error = String(e) + \" (JSON)\"\n            }\n\n        } else {\n            let decodedData\n            try {\n                decodedData = LZString.decompressFromEncodedURIComponent(this._initialData.str)\n                error = PersistenceManager.doLoadFromJson(this, decodedData!)\n            } catch (e) {\n                error = String(e) + \" (LZString)\"\n            }\n\n            if (isDefined(error)) {\n                // try the old, uncompressed way of storing the data in the URL\n                try {\n                    decodedData = atob(this._initialData.str.replace(/-/g, \"+\").replace(/_/g, \"/\").replace(/%3D/g, \"=\"))\n                    error = PersistenceManager.doLoadFromJson(this, decodeURIComponent(decodedData))\n                } catch (e) {\n                    error = String(e) + \" (atob)\"\n                }\n            }\n\n            if (isUndefined(error) && isString(decodedData)) {\n                // remember the decompressed/decoded value\n                this._initialData = { _type: \"json\", json: decodedData }\n            }\n        }\n\n\n        if (isDefined(error)) {\n            console.log(\"ERROR could not not load initial data: \" + error)\n        }\n    }\n\n    public load(jsonStringOrObject: string | Record<string, unknown>) {\n        this.wrapHandler(\n            (jsonStringOrObject: string | Record<string, unknown>) =>\n                PersistenceManager.doLoadFromJson(this, jsonStringOrObject)\n        )(jsonStringOrObject)\n    }\n\n    public setDirty(__reason: string) {\n        if (this.mode >= Mode.CONNECT) {\n            // other modes can't be dirty\n            this._isDirty = true\n        }\n    }\n\n    public tryDeleteDrawable(comp: Drawable): boolean {\n        if (comp instanceof ComponentBase) {\n            return this.tryDeleteComponentsWhere(c => c === comp, true) !== 0\n        } else if (comp instanceof Wire) {\n            this.wireMgr.deleteWire(comp)\n            return true\n        } else if (comp instanceof Waypoint) {\n            comp.removeFromParent()\n            return true\n        }\n        return false\n    }\n\n    public trySetCurrentComponentOrientation(orient: Orientation, e: Event) {\n        const currentMouseOverComp = this.cursorMovementMgr.currentMouseOverComp\n        if (isDefined(currentMouseOverComp) && currentMouseOverComp instanceof DrawableWithPosition && currentMouseOverComp.canRotate()) {\n            currentMouseOverComp.doSetOrient(orient)\n            e.preventDefault()\n            e.stopPropagation()\n        }\n    }\n\n    public tryDeleteComponentsWhere(cond: (e: Component) => boolean, onlyOne: boolean) {\n        const numDeleted = this.components.tryDeleteWhere(cond, onlyOne)\n        if (numDeleted > 0) {\n            this.redrawMgr.addReason(\"component(s) deleted\", null)\n        }\n        return numDeleted\n    }\n\n    public setCurrentMouseAction(action: MouseAction) {\n        this._currentMouseAction = action\n        this.setToolCursor(MouseActions.propsOf(action).cursor)\n\n        const toolButtons = this.root.querySelectorAll(\".sim-modification-tool\")\n        for (let i = 0; i < toolButtons.length; i++) {\n            const toolButton = toolButtons[i] as HTMLElement\n            const setActive = toolButton.getAttribute(\"tool\") === action\n            if (setActive) {\n                toolButton.classList.add(\"active\")\n            } else {\n                toolButton.classList.remove(\"active\")\n            }\n        }\n\n        this.cursorMovementMgr.setHandlersFor(action)\n        this.redrawMgr.addReason(\"mouse action changed\", null)\n    }\n\n    public updateCursor() {\n        this.html.canvasContainer.style.cursor =\n            this.moveMgr.areDrawablesMoving()\n                ? \"grabbing\"\n                : this._toolCursor\n                ?? this.cursorMovementMgr.currentMouseOverComp?.cursorWhenMouseover\n                ?? \"default\"\n    }\n\n    public lengthOfPath(svgPathDesc: string): number {\n        const p = this.html.hiddenPath\n        p.setAttribute(\"d\", svgPathDesc)\n        const length = p.getTotalLength()\n        // console.log(`p=${svgPathDesc}, l=${length}`)\n        return length\n    }\n\n    public offsetXYForContextMenu(e: MouseEvent | TouchEvent, snapToGrid = false): [number, number] {\n        const mainCanvas = this.html.mainCanvas\n        let x, y\n\n        if (\"offsetX\" in e && e.offsetX === 0 && e.offsetY === 0 && e.target === mainCanvas) {\n            const canvasRect = mainCanvas.getBoundingClientRect()\n            x = e.clientX - canvasRect.x\n            y = e.clientY - canvasRect.y\n        } else {\n            [x, y] = this.offsetXY(e)\n        }\n\n        if (snapToGrid) {\n            x = Math.round(x / GRID_STEP) * GRID_STEP\n            y = Math.round(y / GRID_STEP) * GRID_STEP\n        }\n        return [x, y]\n    }\n\n    public offsetXY(e: MouseEvent | TouchEvent): [number, number] {\n        const [unscaledX, unscaledY] = (() => {\n            const mainCanvas = this.html.mainCanvas\n            let target = e.target\n            if (\"offsetX\" in e) {\n                // MouseEvent\n                const canvasRect = mainCanvas.getBoundingClientRect()\n                let offsetX = e.offsetX\n                let offsetY = e.offsetY\n\n                // fix for firefox having always 0 offsetX,Y\n                if (offsetX === 0 && offsetY === 0) {\n                    const _e = e as any\n                    if (\"_savedOffsetX\" in _e) {\n                        offsetX = _e._savedOffsetX\n                        offsetY = _e._savedOffsetY\n                        target = _e._savedTarget\n                    } else if (\"layerX\" in e) {\n                        // This should never happen and is actually wrong, because we assume \n                        offsetX = _e.layerX + canvasRect.x\n                        offsetY = _e.layerY + canvasRect.y\n                    }\n                }\n\n                if (target === mainCanvas) {\n                    return [offsetX, offsetY]\n                } else {\n                    const elemRect = (target as HTMLElement).getBoundingClientRect()\n                    return [\n                        Math.max(GRID_STEP * 2, offsetX + elemRect.x - canvasRect.x),\n                        Math.max(GRID_STEP * 2, offsetY + elemRect.y - canvasRect.y),\n                    ]\n                }\n            } else {\n                const elemRect = (target as HTMLElement).getBoundingClientRect()\n                const bodyRect = document.body.getBoundingClientRect()\n                const touch = e.changedTouches[0]\n                const offsetX = touch.pageX - (elemRect.left - bodyRect.left)\n                const offsetY = touch.pageY - (elemRect.top - bodyRect.top)\n\n                if (target === mainCanvas) {\n                    return [offsetX, offsetY]\n                } else {\n                    const canvasRect = mainCanvas.getBoundingClientRect()\n                    return [\n                        Math.max(GRID_STEP * 2, offsetX + elemRect.x - canvasRect.x),\n                        Math.max(GRID_STEP * 2, offsetY + elemRect.y - canvasRect.y),\n                    ]\n                }\n            }\n        })()\n        const currentScale = this._actualZoomFactor\n        return [unscaledX / currentScale, unscaledY / currentScale]\n    }\n\n    public offsetXYForComponent(e: MouseEvent | TouchEvent, comp: Component): [number, number] {\n        const offset = this.offsetXY(e)\n        if (comp.orient === Orientation.default) {\n            return offset\n        }\n        const [x, y] = offset\n        const dx = x - comp.posX\n        const dy = y - comp.posY\n        switch (comp.orient) {\n            case \"e\": return offset // done before anyway\n            case \"w\": return [comp.posX - dx, comp.posY - dy]\n            case \"s\": return [comp.posX - dy, comp.posY - dx]\n            case \"n\": return [comp.posX + dy, comp.posY + dx]\n        }\n    }\n\n    private guessAdequateCanvasSize(applyZoom: boolean): [number, number] {\n        let rightmostX = Number.NEGATIVE_INFINITY, leftmostX = Number.POSITIVE_INFINITY\n        let lowestY = Number.NEGATIVE_INFINITY, highestY = Number.POSITIVE_INFINITY\n        for (const comp of this.components.all()) {\n            const cx = comp.posX\n            const width = comp.width\n            const left = cx - width / 2\n            const right = left + width\n            if (right > rightmostX) {\n                rightmostX = right\n            }\n            if (left < leftmostX) {\n                leftmostX = left\n            }\n\n            const cy = comp.posY\n            const height = comp.height\n            const top = cy - height / 2\n            const bottom = top + height\n            if (bottom > lowestY) {\n                lowestY = bottom\n            }\n            if (top < highestY) {\n                highestY = top\n            }\n        }\n        leftmostX = Math.max(0, leftmostX)\n        let w = rightmostX + leftmostX // add right margin equal to left margin\n        if (isNaN(w)) {\n            w = 300\n        }\n        highestY = Math.max(0, highestY)\n        let h = highestY + lowestY // add lower margin equal to top margin\n        if (isNaN(h)) {\n            h = 150\n        }\n        const f = applyZoom ? this._actualZoomFactor : 1\n        return [f * w, f * h]\n    }\n\n    public async shareSheetForMode(mode: Mode) {\n        if (this._mode > MAX_MODE_WHEN_EMBEDDED) {\n            this._mode = MAX_MODE_WHEN_EMBEDDED\n        }\n        const modeStr = Mode[mode].toLowerCase()\n        const [fullJson, compressedUriSafeJson] = this.fullJsonStateAndCompressedForUri()\n\n        console.log(\"JSON:\\n\" + fullJson)\n\n        const fullUrl = this.fullUrlForMode(mode, compressedUriSafeJson)\n        this.html.embedUrl.value = fullUrl\n\n        const modeParam = mode === MAX_MODE_WHEN_EMBEDDED ? \"\" : `:mode: ${modeStr}\\n`\n        const embedHeight = this.guessAdequateCanvasSize(true)[1]\n\n        const markdownBlock = `\\`\\`\\`{logic}\\n:height: ${embedHeight}\\n${modeParam}\\n${fullJson}\\n\\`\\`\\``\n        this.html.embedMarkdown.value = markdownBlock\n\n        const iframeEmbed = `<iframe style=\"width: 100%; height: ${embedHeight}px; border: 0\" src=\"${fullUrl}\"></iframe>`\n        this.html.embedIframe.value = iframeEmbed\n\n        const webcompEmbed = `<div style=\"width: 100%; height: ${embedHeight}px\">\\n  <logic-editor mode=\"${Mode[mode].toLowerCase()}\">\\n    <script type=\"application/json\">\\n      ${fullJson.replace(/\\n/g, \"\\n      \")}\\n    </script>\\n  </logic-editor>\\n</div>`\n        this.html.embedWebcomp.value = webcompEmbed\n\n\n        // const dataUrl = await QRCode.toDataURL(fullUrl, { margin: 0, errorCorrectionLevel: 'L' })\n        // const qrcodeImg = this.html.embedUrlQRCode\n        // qrcodeImg.src = dataUrl\n\n        this.saveToUrl(compressedUriSafeJson)\n\n        if (!showModal(this.html.embedDialog)) {\n            // alert(\"The <dialog> API is not supported by this browser\")\n\n            // TODO show the info some other way\n\n            if (copyToClipboard(fullUrl)) {\n                console.log(\"  -> Copied!\")\n            } else {\n                console.log(\"  -> Could not copy!\")\n            }\n        }\n    }\n\n    public saveCurrentStateToUrl() {\n        const [fullJson, compressedUriSafeJson] = this.fullJsonStateAndCompressedForUri()\n        console.log(fullJson)\n        this.saveToUrl(compressedUriSafeJson)\n    }\n\n    public save(): Workspace {\n        return PersistenceManager.buildWorkspace(this)\n    }\n\n    public saveToUrl(compressedUriSafeJson: string) {\n        if (this._isSingleton) {\n            history.pushState(null, \"\", this.fullUrlForMode(MAX_MODE_WHEN_SINGLETON, compressedUriSafeJson))\n            this._isDirty = false\n        }\n    }\n\n    private fullJsonStateAndCompressedForUri(): [string, string] {\n        const jsonObj = PersistenceManager.buildWorkspace(this)\n        const jsonFull = PersistenceManager.stringifyWorkspace(jsonObj, false)\n        PersistenceManager.removeShowOnlyFrom(jsonObj)\n        const jsonForUri = PersistenceManager.stringifyWorkspace(jsonObj, true)\n\n        // We did this in the past, but now we're compressing things a bit\n        // const encodedJson1 = btoa(json).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"%3D\")\n\n        // this can compress to like 40-50% of the original size\n        const compressedUriSafeJson = LZString.compressToEncodedURIComponent(jsonForUri)\n        return [jsonFull, compressedUriSafeJson]\n    }\n\n    private fullUrlForMode(mode: Mode, compressedUriSafeJson: string): string {\n        const loc = window.location\n        const showOnlyParam = isUndefined(this._options.showOnly) ? \"\" : `&${ATTRIBUTE_NAMES.showonly}=${this._options.showOnly.join(\",\")}`\n        return `${loc.protocol}//${loc.host}${loc.pathname}?${ATTRIBUTE_NAMES.mode}=${Mode[mode].toLowerCase()}${showOnlyParam}&${ATTRIBUTE_NAMES.data}=${compressedUriSafeJson}`\n    }\n\n    private async toPNG(heightHint?: number) {\n        return new Promise<Blob | null>((resolve) => {\n            const drawingScale = 3 // super retina\n            let [width, height] = this.guessAdequateCanvasSize(false)\n            if (isDefined(heightHint)) {\n                height = heightHint\n            }\n            width *= drawingScale\n            height *= drawingScale\n\n            const transform = new DOMMatrix(`scale(${drawingScale})`)\n\n            const tmpCanvas = document.createElement('canvas')\n            tmpCanvas.width = width\n            tmpCanvas.height = height\n\n            const g = tmpCanvas.getContext('2d')!\n            this.doDrawWithContext(g, width, height, transform, transform, true, true)\n            tmpCanvas.toBlob(resolve, 'image/png')\n            tmpCanvas.remove()\n\n            // TODO this was an attempt at generating SVG rather than PNG\n            // const svgCtx = new C2S(width, height)\n            // this.doDrawWithContext(svgCtx)\n            // const serializedSVG = svgCtx.getSerializedSvg()\n            // console.log(serializedSVG)\n        })\n    }\n\n    public async toPNGBase64(heightHint?: number) {\n        const blob = await this.toPNG(heightHint)\n        if (blob === null) {\n            return null\n        }\n        return new Promise<string>((resolve) => {\n            const reader = new FileReader()\n            reader.onloadend = () => {\n                let dataURL = reader.result as string\n                const prefix = \"data:image/png;base64,\"\n                if (dataURL.startsWith(prefix)) {\n                    dataURL = dataURL.substring(prefix.length)\n                }\n                resolve(dataURL)\n            }\n            reader.readAsDataURL(blob)\n        })\n    }\n\n    public async downloadSnapshotImage() {\n        const pngBareBlob = await this.toPNG()\n        if (pngBareBlob === null) {\n            return\n        }\n        const [__, compressedUriSafeJson] = this.fullJsonStateAndCompressedForUri()\n\n        const pngBareData = new Uint8Array(await pngBareBlob.arrayBuffer())\n        const pngChunks = pngMeta.extractChunks(pngBareData)\n        pngMeta.insertMetadata(pngChunks, { \"tEXt\": { \"Description\": compressedUriSafeJson } })\n        const pngCompletedBlob = new Blob([pngMeta.encodeChunks(pngChunks)], { type: \"image/png\" })\n\n        const filename = (this.options.name ?? \"circuit\") + \".png\"\n        const url = URL.createObjectURL(pngCompletedBlob)\n        downloadDataUrl(url, filename)\n    }\n\n\n    public recalcPropagateAndDrawIfNeeded() {\n        if (this._nextAnimationFrameHandle !== null) {\n            // an animation frame will be played soon anyway\n            return\n        }\n\n        const __recalculated = this.recalcMgr.recalcAndPropagateIfNeeded()\n\n        if (this.wireMgr.isAddingWire) {\n            this.redrawMgr.addReason(\"adding a wire\", null)\n        }\n\n        const redrawReasons = this.redrawMgr.getReasonsAndClear()\n        if (isUndefined(redrawReasons)) {\n            return\n        }\n\n        // console.log(\"Drawing \" + (__recalculated ? \"with\" : \"without\") + \" recalc, reasons:\\n    \" + redrawReasons)\n        // console.log(\"Drawing\")\n        this.doRedraw()\n\n        if (this.redrawMgr.hasReasons()) {\n            // an animation is running\n            this._nextAnimationFrameHandle = requestAnimationFrame(() => {\n                this._nextAnimationFrameHandle = null\n                this.recalcPropagateAndDrawIfNeeded()\n            })\n        }\n    }\n\n    public highlight(refs: string | string[] | undefined) {\n        if (isUndefined(refs)) {\n            this._highlightedItems = undefined\n            return\n        }\n\n        if (isString(refs)) {\n            refs = [refs]\n        }\n\n        const highlightComps: Component[] = []\n        for (const comp of this.components.all()) {\n            if (isDefined(comp.ref) && refs.includes(comp.ref)) {\n                highlightComps.push(comp)\n            }\n        }\n\n        const highlightWires: Wire[] = []\n        for (const wire of this.wireMgr.wires) {\n            if (isDefined(wire.ref) && refs.includes(wire.ref)) {\n                highlightWires.push(wire)\n            }\n        }\n\n        if (highlightComps.length === 0 && highlightWires.length === 0) {\n            console.log(`Nothing to highlight for ref '${refs}'`)\n            this._highlightedItems = undefined\n            return\n        }\n\n        const start = this.timeline.unadjustedTime()\n        this._highlightedItems = { comps: highlightComps, wires: highlightWires, start }\n        this.redrawMgr.addReason(\"highlighting component\", null)\n        this.recalcPropagateAndDrawIfNeeded()\n    }\n\n    public redraw() {\n        this.setCanvasSize()\n        this.redrawMgr.addReason(\"explicit redraw call\", null)\n        this.recalcPropagateAndDrawIfNeeded()\n    }\n\n    private doRedraw() {\n        const g = this.html.mainCanvas.getContext(\"2d\")!\n        const mainCanvas = this.html.mainCanvas\n        const baseDrawingScale = this._baseDrawingScale\n\n        const width = mainCanvas.width / baseDrawingScale\n        const height = mainCanvas.height / baseDrawingScale\n        const baseTransform = new DOMMatrix(`scale(${this._baseDrawingScale})`)\n        const contentTransform = baseTransform.scale(this._actualZoomFactor)\n        this.doDrawWithContext(g, width, height, baseTransform, contentTransform, false, false)\n    }\n\n    private doDrawWithContext(g: CanvasRenderingContext2D, width: number, height: number, baseTransform: DOMMatrixReadOnly, contentTransform: DOMMatrixReadOnly, skipBorder: boolean, transparentBackground: boolean) {\n        g.setTransform(baseTransform)\n        g.lineCap = \"square\"\n        g.textBaseline = \"middle\"\n\n        // clear background\n        g.fillStyle = COLOR_BACKGROUND\n        if (transparentBackground) {\n            g.clearRect(0, 0, width, height)\n        } else {\n            g.fillRect(0, 0, width, height)\n        }\n        g.setTransform(contentTransform)\n\n        // draw highlight\n        const highlightRectFor = (comp: Component) => {\n            const margin = 15\n            let w = comp.unrotatedWidth + margin + margin\n            let h = comp.unrotatedHeight + margin + margin\n            if (Orientation.isVertical(comp.orient)) {\n                const t = w\n                w = h\n                h = t\n            }\n            return new DOMRect(comp.posX - w / 2, comp.posY - h / 2, w, h)\n        }\n\n        const highlightedItems = this._highlightedItems\n        let highlightColor: string | undefined = undefined\n        if (isDefined(highlightedItems)) {\n            const HOLD_TIME = 2000\n            const FADE_OUT_TIME = 200\n            const START_ALPHA = 0.4\n            const elapsed = this.timeline.unadjustedTime() - highlightedItems.start\n            const highlightAlpha = (elapsed < HOLD_TIME) ? START_ALPHA : START_ALPHA * (1 - (elapsed - HOLD_TIME) / FADE_OUT_TIME)\n            if (highlightAlpha <= 0) {\n                this._highlightedItems = undefined\n            } else {\n\n                g.beginPath()\n                for (const comp of highlightedItems.comps) {\n                    const highlightRect = highlightRectFor(comp)\n                    g.moveTo(highlightRect.x, highlightRect.y)\n                    g.lineTo(highlightRect.right, highlightRect.y)\n                    g.lineTo(highlightRect.right, highlightRect.bottom)\n                    g.lineTo(highlightRect.x, highlightRect.bottom)\n                    g.closePath()\n                }\n\n                highlightColor = `rgba(238,241,0,${highlightAlpha})`\n                g.shadowColor = highlightColor\n                g.shadowBlur = 20\n                g.shadowOffsetX = 0\n                g.shadowOffsetY = 0\n                g.fillStyle = highlightColor\n                g.fill()\n\n                g.shadowBlur = 0 // reset\n\n                // will make it run until alpha is 0\n                this.redrawMgr.addReason(\"highlight animation\", null)\n            }\n        }\n\n        // draw grid if moving comps\n        const isMovingComponent = this.moveMgr.areDrawablesMoving()\n        if (isMovingComponent) {\n            const widthAdjusted = width / this._actualZoomFactor\n            const heightAdjusted = height / this._actualZoomFactor\n            g.strokeStyle = COLOR_GRID_LINES\n            g.lineWidth = 1\n            g.beginPath()\n            for (let x = GRID_STEP; x < widthAdjusted; x += GRID_STEP) {\n                g.moveTo(x, 0)\n                g.lineTo(x, height)\n            }\n            for (let y = GRID_STEP; y < heightAdjusted; y += GRID_STEP) {\n                g.moveTo(0, y)\n                g.lineTo(width, y)\n            }\n            g.stroke()\n        }\n\n        // draw guidelines when moving waypoint\n        const singleMovingWayoint = this.moveMgr.getSingleMovingWaypoint()\n        if (isDefined(singleMovingWayoint)) {\n            const guides = singleMovingWayoint.getPrevAndNextAnchors()\n            g.strokeStyle = COLOR_GRID_LINES_GUIDES\n            g.lineWidth = 1.5\n            g.beginPath()\n            for (const guide of guides) {\n                g.moveTo(guide.posX, 0)\n                g.lineTo(guide.posX, height)\n                g.moveTo(0, guide.posY)\n                g.lineTo(width, guide.posY)\n            }\n            g.stroke()\n        }\n\n        // draw border according to mode\n        if (!skipBorder && (this._mode >= Mode.CONNECT || this._maxInstanceMode === MAX_MODE_WHEN_SINGLETON)) {\n            g.setTransform(baseTransform)\n            g.strokeStyle = COLOR_BORDER\n            g.lineWidth = 2\n            g.strokeRect(0, 0, width, height)\n            if (this._maxInstanceMode === MAX_MODE_WHEN_SINGLETON && this._mode < this._maxInstanceMode) {\n                const h = this.guessAdequateCanvasSize(true)[1]\n                strokeSingleLine(g, 0, h, width, h)\n\n                g.fillStyle = COLOR_BACKGROUND_UNUSED_REGION\n                g.fillRect(0, h, width, height - h)\n            }\n            g.setTransform(contentTransform)\n        }\n\n        // const currentScale = this._currentScale\n        // g.scale(currentScale, currentScale)\n\n        const drawTime = this.timeline.adjustedTime()\n        g.strokeStyle = COLOR_COMPONENT_BORDER\n        const currentMouseOverComp = this.cursorMovementMgr.currentMouseOverComp\n        const drawParams: DrawParams = {\n            drawTime,\n            currentMouseOverComp,\n            highlightedItems,\n            highlightColor,\n            currentSelection: undefined,\n        }\n        const currentSelection = this.cursorMovementMgr.currentSelection\n        drawParams.currentSelection = currentSelection\n        const drawComp = (comp: Component) => {\n            comp.draw(g, drawParams)\n            comp.forEachNode((node) => {\n                node.draw(g, drawParams) // never show nodes as selected\n                return true\n            })\n        }\n\n        // draw background components\n        for (const comp of this.components.withZIndex(DrawZIndex.Background)) {\n            drawComp(comp)\n        }\n\n        // draw wires\n        this.wireMgr.draw(g, drawParams) // never show wires as selected\n\n        // draw normal components\n        for (const comp of this.components.withZIndex(DrawZIndex.Normal)) {\n            drawComp(comp)\n        }\n\n        // draw overlays\n        for (const comp of this.components.withZIndex(DrawZIndex.Overlay)) {\n            drawComp(comp)\n        }\n\n        // draw selection\n        let selRect\n        if (isDefined(currentSelection) && isDefined(selRect = currentSelection.currentlyDrawnRect)) {\n            g.lineWidth = 1.5\n            g.strokeStyle = \"rgb(100,100,255)\"\n            g.fillStyle = \"rgba(100,100,255,0.2)\"\n            g.beginPath()\n            g.rect(selRect.x, selRect.y, selRect.width, selRect.height)\n            g.stroke()\n            g.fill()\n        }\n\n    }\n\n    public cut() {\n        // TODO stubs\n        console.log(\"cut\")\n    }\n\n    public copy() {\n        if (isUndefined(this.cursorMovementMgr.currentSelection)) {\n            // copy URL\n            copyToClipboard(window.location.href)\n            return\n        }\n        // TODO stubs\n        console.log(\"copy\")\n    }\n\n    public paste() {\n        // TODO stubs\n        console.log(\"paste\")\n    }\n\n\n    public wrapHandler<T extends unknown[], R>(f: (...params: T) => R): (...params: T) => R {\n        return (...params: T) => {\n            const result = f(...params)\n            this.recalcPropagateAndDrawIfNeeded()\n            return result\n        }\n    }\n}\n\nexport class LogicStatic {\n\n    public singleton: LogicEditor | undefined\n\n    public highlight(diagramRefs: string | string[], componentRefs: string | string[]) {\n        if (isString(diagramRefs)) {\n            diagramRefs = [diagramRefs]\n        }\n        for (const diagramRef of diagramRefs) {\n            const diagram = document.getElementById(\"logic_\" + diagramRef)\n            if (diagram === null) {\n                console.log(`Cannot find logic diagram with reference '${diagramRef}'`)\n                return\n            }\n            if (!(diagram instanceof LogicEditor)) {\n                console.log(`Element with id '${diagramRef}' is not a logic editor`)\n                return\n            }\n            diagram.highlight(componentRefs)\n        }\n    }\n\n    public printUndoStack() {\n        this.singleton?.undoMgr.dump()\n    }\n\n    public tests = new Tests()\n\n}\n\nconst template = (() => {\n    const template = document.createElement('template')\n    template.innerHTML = LogicEditorTemplate\n    const styles = [LogicEditorCSS, DialogPolyfillCSS]\n    template.content.querySelector(\"#inlineStyle\")!.innerHTML = styles.join(\"\\n\\n\\n\")\n\n    template.content.querySelectorAll(\"i.svgicon\").forEach((_iconElem) => {\n        const iconElem = _iconElem as HTMLElement\n        const iconName = iconElem.dataset[\"icon\"] ?? \"question\"\n        if (isIconName(iconName)) {\n            iconElem.innerHTML = inlineSvgFor(iconName)\n        } else {\n            console.log(`Unknown icon name '${iconName}'`)\n        }\n    })\n    return template\n})()\n// cannot be in setup function because 'template' var is not assigned until that func returns\n// and promotion of elems occurs during this 'customElements.define' call\nwindow.Logic = new LogicStatic()\nwindow.customElements.define('logic-editor', LogicEditor)\ndocument.addEventListener(\"toggle\", e => {\n    if (!(e.target instanceof HTMLDetailsElement)) {\n        return\n    }\n    if (e.target.open) {\n        e.target.querySelectorAll(\"logic-editor\").forEach(el => {\n            if (el instanceof LogicEditor) {\n                el.redraw()\n            }\n        })\n    }\n}, true)\n", "import { doALUOp } from \"./components/ALU\"\nimport { displayValuesFromArray } from \"./drawutils\"\nimport { FixedArray, FixedReadonlyArray, LogicValue } from \"./utils\"\n\nexport class Tests {\n\n    public aluOps() {\n        function* nibbles(): Generator<FixedArray<boolean, 4>, void, unknown> {\n            for (const a of [false, true]) {\n                for (const b of [false, true]) {\n                    for (const c of [false, true]) {\n                        for (const d of [false, true]) {\n                            yield [a, b, c, d]\n                        }\n                    }\n                }\n            }\n        }\n\n\n        function representationsOf(v: FixedReadonlyArray<LogicValue, 4>): [string, number, number] {\n            const [str, uint_] = displayValuesFromArray(v, true)\n            const uint = uint_ as number\n            const sint = uint < 8 ? uint : uint - 16\n            return [str, uint, sint]\n        }\n\n        let totalTests = 0\n        let failedTests = 0\n        const verbose = false\n\n        for (const a of nibbles()) {\n            for (const b of nibbles()) {\n                for (const cin of [false, true]) {\n\n\n                    const [a_str, a_uint, a_sint] = representationsOf(a)\n                    const [b_str, b_uint, b_sint] = representationsOf(b)\n\n                    a.reverse()\n                    b.reverse()\n                    const [sum, v_sum, /*z*/, c_sum] = doALUOp(\"add\", a, b, cin)\n                    const [diff, v_diff, /*z*/, c_diff] = doALUOp(\"sub\", a, b, cin)\n                    a.reverse()\n                    b.reverse()\n                    sum.reverse()\n                    diff.reverse()\n                    const [sum_str, sum_uint, sum_sint] = representationsOf(sum)\n                    const [diff_str, diff_uint, diff_sint] = representationsOf(diff)\n\n\n                    //// TEST: unsigned addition\n\n                    const should_sum_uint = a_uint + b_uint + Number(cin)\n                    const should_c_sum = should_sum_uint > 15\n\n                    let carryError = false\n                    if (should_c_sum) {\n                        // if this is an unsigned overflow, the sum has to be wrong and carry has to be set\n                        carryError = sum_uint === should_sum_uint || c_sum !== true\n                    } else {\n                        // else the sum has to be correct and carry has to be clear\n                        carryError = sum_uint !== should_sum_uint || c_sum !== false\n                    }\n                    if (carryError) {\n                        console.log(`ERROR carry - ${a_uint} (${a_str}) + ${b_uint} (${b_str}) + ${Number(cin)} = ${sum_uint} (${sum_str}) (c=${c_sum})`)\n                        failedTests++\n                    } else if (verbose) {\n                        console.log(`carry - ${a_uint} (${a_str}) + ${b_uint} (${b_str}) + ${Number(cin)} = ${sum_uint} (${sum_str}) (c=${c_sum})`)\n                    }\n                    totalTests++\n\n\n                    //// TEST: unsigned subtraction\n\n                    const should_diff_uint = a_uint - b_uint - Number(cin)\n\n                    let borrowError = false\n                    if (a_uint - Number(cin) < b_uint) {\n                        // if this is an unsigned underflow, the difference has to be wrong and borrow has to be set\n                        borrowError = diff_uint === should_diff_uint || c_diff !== true\n                    } else {\n                        // else the difference has to be correct and borrow has to be clear\n                        borrowError = diff_uint !== should_diff_uint || c_diff !== false\n                    }\n                    if (borrowError) {\n                        console.log(`ERROR borrow - ${a_uint} (${a_str}) - ${b_uint} (${b_str}) - ${Number(cin)} = ${diff_uint} (${diff_str}) (c=${c_diff})`)\n                        failedTests++\n                    } else if (verbose) {\n                        console.log(`borrow - ${a_uint} (${a_str}) - ${b_uint} (${b_str}) - ${Number(cin)} = ${diff_uint} (${diff_str}) (c=${c_diff})`)\n                    }\n                    totalTests++\n\n\n\n                    //// TEST: signed addition\n\n                    const should_sum_sint = a_sint + b_sint + Number(cin)\n                    const should_v_sum = should_sum_sint > 7 || should_sum_sint < -8\n\n                    let overflowError = false\n                    if (should_v_sum) {\n                        // if this is a signed overflow, the sum has to be wrong and overflow has to be set\n                        overflowError = sum_sint === should_sum_sint || v_sum !== true\n                    } else {\n                        // else the sum has to be correct and overflow has to be clear\n                        overflowError = sum_sint !== should_sum_sint || v_sum !== false\n                    }\n                    if (overflowError) {\n                        console.log(`ERROR overflow - ${a_sint} (${a_str}) + ${b_sint} (${b_str}) + ${Number(cin)} = ${sum_sint} (${sum_str}) (v=${v_sum})`)\n                        failedTests++\n                    } else if (verbose) {\n                        console.log(`overflow - ${a_sint} (${a_str}) + ${b_sint} (${b_str}) + ${Number(cin)} = ${sum_sint} (${sum_str}) (v=${v_sum})`)\n                    }\n                    totalTests++\n\n\n\n                    //// TEST: signed subtraction\n\n                    const should_diff_sint = a_sint - b_sint - Number(cin)\n                    const should_v_diff = should_diff_sint > 7 || should_diff_sint < -8\n\n                    let overflowError2 = false\n                    if (should_v_diff) {\n                        // if this is a signed overflow, the sum has to be wrong and overflow has to be set\n                        overflowError2 = diff_sint === should_diff_sint || v_diff !== true\n                    } else {\n                        // else the sum has to be correct and overflow has to be clear\n                        overflowError2 = diff_sint !== should_diff_sint || v_diff !== false\n                    }\n                    if (overflowError2) {\n                        console.log(`ERROR overflow - ${a_sint} (${a_str}) - ${b_sint} (${b_str}) - ${Number(cin)} = ${diff_sint} (${diff_str}) (v=${v_diff})`)\n                        failedTests++\n                    } else if (verbose) {\n                        console.log(`overflow - ${a_sint} (${a_str}) - ${b_sint} (${b_str}) - ${Number(cin)} = ${diff_sint} (${diff_str}) (v=${v_diff})`)\n                    }\n                    totalTests++\n                }\n            }\n        }\n\n        console.log(`Tests: ${totalTests} total, ${failedTests} failed, ${totalTests - failedTests} passed`)\n    }\n\n}\n", "import { LogicEditor } from \"./LogicEditor\"\nimport { PersistenceManager } from \"./PersistenceManager\"\n\nconst MAX_UNDO_SNAPSHOTS = 100\n\ntype Snapshot = {\n    time: number\n    workspace: string\n}\n\nexport class UndoManager {\n\n    public readonly editor: LogicEditor\n    private _undoSnapshots: Snapshot[] = []\n    private _redoSnapshots: Snapshot[] = []\n\n    public constructor(editor: LogicEditor) {\n        this.editor = editor\n    }\n\n    public canUndo() {\n        return this._undoSnapshots.length > 1\n    }\n\n    public canRedo() {\n        return this._redoSnapshots.length > 0\n    }\n\n    public takeSnapshot() {\n        const now = Date.now()\n        // const nowStr = new Date(now).toISOString()\n        // console.log(\"Taking snapshot at \" + nowStr)\n\n        const workspace = this.editor.save()\n        const workspaceStr = PersistenceManager.stringifyWorkspace(workspace, true)\n        this._undoSnapshots.push({ time: now, workspace: workspaceStr })\n        while (this._undoSnapshots.length > MAX_UNDO_SNAPSHOTS) {\n            this._undoSnapshots.shift()\n        }\n        if (this._redoSnapshots.length > 0) {\n            this._redoSnapshots = []\n        }\n        // this.dump()\n    }\n\n    public undo() {\n        if (!this.canUndo()) {\n            console.log(\"Nothing to undo\")\n            return\n        }\n        const stateNow = this._undoSnapshots.pop()!\n        const prevState = this._undoSnapshots[this._undoSnapshots.length - 1]\n        this._redoSnapshots.push(stateNow)\n        this.loadSnapshot(prevState)\n        // this.dump()\n    }\n\n    public redo() {\n        if (!this.canRedo()) {\n            console.log(\"Nothing to redo\")\n            return\n        }\n        const snapshot = this._redoSnapshots.pop()!\n        this._undoSnapshots.push(snapshot)\n        this.loadSnapshot(snapshot)\n        // this.dump()\n    }\n\n    public dump() {\n        function printStack(name: string, stack: Snapshot[]) {\n            const title = name + (stack.length === 0 ? \" (empty)\" : \"\")\n            console.group(title)\n            for (let i = stack.length - 1; i >= 0; i--) {\n                const snapshot = stack[i]\n                const timeStr = new Date(snapshot.time).toISOString()\n                console.log(timeStr)\n            }\n            console.groupEnd()\n        }\n        printStack(\"Undo stack\", this._undoSnapshots)\n        printStack(\"Redo stack\", this._redoSnapshots)\n    }\n\n    private loadSnapshot(snapshot: Snapshot) {\n        PersistenceManager.doLoadFromJson(this.editor, snapshot.workspace, true)\n    }\n\n\n}\n"],
  "mappings": "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,IAAK,CACtC,GAAM,GAAO,EAAS,GACtB,GAAI,EAAK,IACL,GAAK,UACL,EAAS,OAAO,EAAG,GACnB,IACI,GACA,QAKhB,MAAO,GAGJ,UAAW,CACd,OAAW,KAAY,MAAK,oBACxB,EAAS,OAAO,EAAG,EAAS;;;;;;;;;;;;;;;;8vtGCmDxC,GAAM,IAAQ,CACV,OACA,eACA,SACA,SACA,cACA,aACA,YACA,QACA,OACA,QACA,SACA,QACA,QACA,QACA,QACA,WACA,SACA,OACA,aACA,QACA,YACA,mBACA,OACA,WACA,WACA,SACA,cACA,YACA,WACA,QACA,eACA,SACA,SACA,cAGE,GAAS,CACX,SACA,OACA,OACA,QACA,QACA,OACA,SACA,cACA,WACA,eACA,gBACA,eACA,SACA,aACA,cACA,aACA,aACA,SACA,YACA,aACA,eACA,eACA,kBACA,eACA,WACA,OACA,QACA,SACA,SACA,UACA,OACA,QACA,QACA,OACA,MACA,OACA,OACA,cACA,eACA,eACA,aACA,aACA,cACA,qBACA,gBACA,uBACA,qBACA,gBACA,gBACA,gBACA,YACA,gBACA,WACA,WACA,WACA,YACA,YACA,oBACA,OACA,OACA,QACA,SACA,SACA,OACA,QACA,SAIG,YAAoB,EAAgC,CACvD,MAAO,KAAQ,IAQZ,YAAmB,EAAiB,EAAgB,EAAmC,CAC1F,GAAM,GAAU,GAAI,OAAM,EAAO,GACjC,SAAQ,IAAM,GAAO,GACd,EAGJ,YAAkB,EAAgB,EAAgB,EAA8B,CACnF,GAAM,GAAO,SAAS,cAAc,KACpC,SAAK,UAAU,IAAI,WACf,EAAU,IACV,GAAK,MAAM,MAAQ,GAAG,OAEtB,EAAU,IACV,GAAK,MAAM,OAAS,GAAG,OAE3B,EAAK,QAAQ,KAAU,EACvB,EAAK,UAAY,GAAa,GACvB,EAGJ,YAAsB,EAAwB,CACjD,MAAO,IAAM,GC1OV,YAAsB,CAIlB,YACI,EACT,CADS,0BAHJ,gCAA6B,GAAI,KAMjC,OAAO,EAAgB,CAC1B,AAAI,KAAK,2BAA2B,IAAI,GACpC,KAAK,2BAA2B,OAAO,GAEvC,KAAK,2BAA2B,IA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",
  "names": []
}
